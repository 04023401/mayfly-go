var T=Object.defineProperty,_=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var U=(e,a,d)=>a in e?T(e,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[a]=d,F=(e,a)=>{for(var d in a||(a={}))S.call(a,d)&&U(e,d,a[d]);if($)for(var d of $(a))G.call(a,d)&&U(e,d,a[d]);return e},B=(e,a)=>_(e,L(a));import{p as m}from"./api.7a509bb1.js";import{b as Q}from"./api.2b4fbbc6.js";import{x as R,a as H,o as J,t as K,s as v,P as O,e as r,Q as W,f as P,h as k,i as l,G as s,w as p,k as i,l as A,F as X,E as Y}from"./vendor.c08e96cf.js";import{n as z,a as Z}from"./assert.6143fd7f.js";import"./Api.ab367e46.js";import"./index.ef81b75e.js";var N=R({name:"ProjectList",components:{},setup(){const e=H({permissions:{saveProject:"project:save",delProject:"project:del",saveMember:"project:member:add",delMember:"project:member:del",saveEnv:"project:env:add"},query:{pageNum:1,pageSize:10,name:null},total:0,projects:[],btnLoading:!1,chooseId:null,chooseData:null,addProjectDialog:{title:"\u65B0\u589E\u9879\u76EE",visible:!1,form:{name:"",remark:""}},showEnvDialog:{visible:!1,envs:[],title:"",addVisible:!1,envForm:{name:"",remark:"",projectId:0}},showMemDialog:{visible:!1,chooseId:null,chooseData:null,query:{pageSize:8,pageNum:1,projectId:null},members:{list:[],total:null},title:"",addVisible:!1,memForm:{},accounts:[]}});J(()=>{a()});const a=async()=>{let o=await m.projects.request(e.query);e.projects=o.list,e.total=o.total},d=o=>{e.query.pageNum=o,a()},I=o=>{o?e.addProjectDialog.form=F({},o):e.addProjectDialog.form={},e.addProjectDialog.visible=!0},y=()=>{e.addProjectDialog.visible=!1,e.addProjectDialog.form={}},q=async()=>{const o=e.addProjectDialog.form;z(o.name,"\u9879\u76EE\u540D\u4E0D\u80FD\u4E3A\u7A7A"),z(o.remark,"\u9879\u76EE\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A"),await m.saveProject.request(o),v.success("\u4FDD\u5B58\u6210\u529F"),a(),y()},t=async()=>{try{await O.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u76EE?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await m.delProject.request({id:e.chooseId}),v.success("\u5220\u9664\u6210\u529F"),e.chooseData=null,e.chooseId=null,a()}catch(o){}},c=o=>{!o||(e.chooseId=o.id,e.chooseData=o)},j=async o=>{e.showMemDialog.query.projectId=o.id,await g(),e.showMemDialog.title=`${o.name}\u7684\u6210\u5458\u4FE1\u606F`,e.showMemDialog.visible=!0},n=o=>{!o||(e.showMemDialog.chooseData=o,e.showMemDialog.chooseId=o.id)},w=async()=>{Z(e.showMemDialog.chooseData,"\u8BF7\u9009\u9009\u62E9\u6210\u5458"),await m.deleteProjectMem.request(e.showMemDialog.chooseData),v.success("\u79FB\u9664\u6210\u529F"),g()},g=async()=>{const o=await m.projectMems.request(e.showMemDialog.query);e.showMemDialog.members.list=o.list,e.showMemDialog.members.total=o.total},M=async o=>{e.showEnvDialog.envs=await m.projectEnvs.request({projectId:o.id}),e.showEnvDialog.title=`${o.name}\u7684\u73AF\u5883\u4FE1\u606F`,e.showEnvDialog.visible=!0},E=()=>{e.showMemDialog.addVisible=!0},h=async()=>{const o=e.showMemDialog.memForm;o.projectId=e.chooseData.id,z(o.accountId,"\u8BF7\u5148\u9009\u62E9\u8D26\u53F7"),await m.saveProjectMem.request(o),v.success("\u4FDD\u5B58\u6210\u529F"),g(),f()},f=()=>{e.showMemDialog.memForm={},e.showMemDialog.addVisible=!1,e.showMemDialog.chooseData=null,e.showMemDialog.chooseId=null},b=o=>{Q.list.request({username:o}).then(D=>{e.showMemDialog.accounts=D.list})},V=()=>{e.showEnvDialog.addVisible=!0},C=async()=>{const o=e.showEnvDialog.envForm;o.projectId=e.chooseData.id,await m.saveProjectEnv.request(o),v.success("\u4FDD\u5B58\u6210\u529F"),e.showEnvDialog.envs=await m.projectEnvs.request({projectId:o.projectId}),u()},u=()=>{e.showEnvDialog.envForm={},e.showEnvDialog.addVisible=!1};return B(F({},K(e)),{search:a,handlePageChange:d,choose:c,showAddProjectDialog:I,addProject:q,delProject:t,cancelAddProject:y,showMembers:j,setMemebers:g,showEnv:M,showAddMemberDialog:E,addMember:h,chooseMember:n,deleteMember:w,cancelAddMember:f,showAddEnvDialog:V,addEnv:C,cancelAddEnv:u,getAccount:b})}}),Ae="";const x={class:"project-list"},ee=i("\u6DFB\u52A0"),oe=i("\u7F16\u8F91"),le=i("\u6210\u5458\u7BA1\u7406"),ae=i("\u73AF\u5883\u7BA1\u7406"),se=i("\u5220\u9664"),te={style:{float:"right"}},ie=l("i",null,null,-1),ne={class:"dialog-footer"},de=i("\u786E \u5B9A"),re=i("\u53D6 \u6D88"),ue={class:"toolbar"},me=i("\u6DFB\u52A0"),pe={class:"dialog-footer"},ce=i("\u786E \u5B9A"),ge=i("\u53D6 \u6D88"),he={class:"toolbar"},be=i("\u6DFB\u52A0"),fe=i("\u79FB\u9664"),we=l("i",null,null,-1),De={class:"dialog-footer"},ve=i("\u786E \u5B9A"),je=i("\u53D6 \u6D88");function ye(e,a,d,I,y,q){const t=r("el-button"),c=r("el-input"),j=r("el-radio"),n=r("el-table-column"),w=r("el-table"),g=r("el-pagination"),M=r("el-row"),E=r("el-card"),h=r("el-form-item"),f=r("el-form"),b=r("el-dialog"),V=r("el-option"),C=r("el-select"),u=W("auth");return P(),k("div",x,[l(E,null,{default:s(()=>[l("div",null,[p(l(t,{onClick:e.showAddProjectDialog,type:"primary",icon:"el-icon-plus",size:"mini"},{default:s(()=>[ee]),_:1},8,["onClick"]),[[u,e.permissions.saveProject]]),p(l(t,{onClick:a[1]||(a[1]=o=>e.showAddProjectDialog(e.chooseData)),disabled:e.chooseId==null,type:"primary",icon:"el-icon-edit",size:"mini"},{default:s(()=>[oe]),_:1},8,["disabled"]),[[u,e.permissions.saveProject]]),l(t,{onClick:a[2]||(a[2]=o=>e.showMembers(e.chooseData)),disabled:e.chooseId==null,type:"success",icon:"el-icon-setting",size:"mini"},{default:s(()=>[le]),_:1},8,["disabled"]),l(t,{onClick:a[3]||(a[3]=o=>e.showEnv(e.chooseData)),disabled:e.chooseId==null,type:"info",icon:"el-icon-setting",size:"mini"},{default:s(()=>[ae]),_:1},8,["disabled"]),p(l(t,{onClick:e.delProject,disabled:e.chooseId==null,type:"danger",icon:"el-icon-delete",size:"mini"},{default:s(()=>[se]),_:1},8,["onClick","disabled"]),[[u,e.permissions.delProject]]),l("div",te,[l(c,{class:"mr2",placeholder:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\uFF01",size:"small",style:{width:"300px"},modelValue:e.query.name,"onUpdate:modelValue":a[4]||(a[4]=o=>e.query.name=o),onClear:e.search,clearable:""},null,8,["modelValue","onClear"]),l(t,{onClick:e.search,type:"success",icon:"el-icon-search",size:"small"},null,8,["onClick"])])]),l(w,{data:e.projects,onCurrentChange:e.choose,ref:"table",style:{width:"100%"}},{default:s(()=>[l(n,{label:"\u9009\u62E9",width:"50px"},{default:s(o=>[l(j,{modelValue:e.chooseId,"onUpdate:modelValue":a[5]||(a[5]=D=>e.chooseId=D),label:o.row.id},{default:s(()=>[ie]),_:2},1032,["modelValue","label"])]),_:1}),l(n,{prop:"name",label:"\u9879\u76EE\u540D"}),l(n,{prop:"remark",label:"\u63CF\u8FF0","min-width":"180px","show-overflow-tooltip":""}),l(n,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(o=>[i(A(e.$filters.dateFormat(o.row.createTime)),1)]),_:1}),l(n,{prop:"creator",label:"\u521B\u5EFA\u8005"})]),_:1},8,["data","onCurrentChange"]),l(M,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:s(()=>[l(g,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":a[6]||(a[6]=o=>e.query.pageNum=o),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),l(b,{width:"400px",title:"\u9879\u76EE\u7F16\u8F91","before-close":e.cancelAddProject,modelValue:e.addProjectDialog.visible,"onUpdate:modelValue":a[10]||(a[10]=o=>e.addProjectDialog.visible=o)},{footer:s(()=>[l("div",ne,[l(t,{onClick:e.addProject,type:"primary",size:"small"},{default:s(()=>[de]),_:1},8,["onClick"]),l(t,{onClick:a[9]||(a[9]=o=>e.cancelAddProject()),size:"small"},{default:s(()=>[re]),_:1})])]),default:s(()=>[l(f,{model:e.addProjectDialog.form,size:"small","label-width":"70px"},{default:s(()=>[l(h,{label:"\u9879\u76EE\u540D:",required:""},{default:s(()=>[l(c,{disabled:!!e.addProjectDialog.form.id,modelValue:e.addProjectDialog.form.name,"onUpdate:modelValue":a[7]||(a[7]=o=>e.addProjectDialog.form.name=o),"auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),l(h,{label:"\u63CF\u8FF0:"},{default:s(()=>[l(c,{modelValue:e.addProjectDialog.form.remark,"onUpdate:modelValue":a[8]||(a[8]=o=>e.addProjectDialog.form.remark=o),"auto-complete":"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"]),l(b,{width:"500px",title:e.showEnvDialog.title,modelValue:e.showEnvDialog.visible,"onUpdate:modelValue":a[15]||(a[15]=o=>e.showEnvDialog.visible=o)},{default:s(()=>[l("div",ue,[p(l(t,{onClick:e.showAddEnvDialog,type:"primary",icon:"el-icon-plus",size:"mini"},{default:s(()=>[me]),_:1},8,["onClick"]),[[u,e.permissions.saveMember]])]),l(w,{border:"",data:e.showEnvDialog.envs,size:"small"},{default:s(()=>[l(n,{property:"name",label:"\u73AF\u5883\u540D",width:"125"}),l(n,{property:"remark",label:"\u63CF\u8FF0",width:"125"}),l(n,{property:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(o=>[i(A(e.$filters.dateFormat(o.row.createTime)),1)]),_:1})]),_:1},8,["data"]),l(b,{width:"400px",title:"\u6DFB\u52A0\u73AF\u5883","before-close":e.cancelAddEnv,modelValue:e.showEnvDialog.addVisible,"onUpdate:modelValue":a[14]||(a[14]=o=>e.showEnvDialog.addVisible=o)},{footer:s(()=>[l("div",pe,[p(l(t,{onClick:e.addEnv,type:"primary",loading:e.btnLoading,size:"small"},{default:s(()=>[ce]),_:1},8,["onClick","loading"]),[[u,e.permissions.saveEnv]]),l(t,{onClick:a[13]||(a[13]=o=>e.cancelAddEnv()),size:"small"},{default:s(()=>[ge]),_:1})])]),default:s(()=>[l(f,{model:e.showEnvDialog.envForm,size:"small","label-width":"70px"},{default:s(()=>[l(h,{label:"\u73AF\u5883\u540D:",required:""},{default:s(()=>[l(c,{modelValue:e.showEnvDialog.envForm.name,"onUpdate:modelValue":a[11]||(a[11]=o=>e.showEnvDialog.envForm.name=o),"auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(h,{label:"\u63CF\u8FF0:"},{default:s(()=>[l(c,{modelValue:e.showEnvDialog.envForm.remark,"onUpdate:modelValue":a[12]||(a[12]=o=>e.showEnvDialog.envForm.remark=o),"auto-complete":"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"])]),_:1},8,["title","modelValue"]),l(b,{width:"500px",title:e.showMemDialog.title,modelValue:e.showMemDialog.visible,"onUpdate:modelValue":a[22]||(a[22]=o=>e.showMemDialog.visible=o)},{default:s(()=>[l("div",he,[p(l(t,{onClick:a[16]||(a[16]=o=>e.showAddMemberDialog()),type:"primary",icon:"el-icon-plus",size:"mini"},{default:s(()=>[be]),_:1},512),[[u,e.permissions.saveMember]]),p(l(t,{onClick:e.deleteMember,disabled:e.showMemDialog.chooseId==null,type:"danger",icon:"el-icon-delete",size:"mini"},{default:s(()=>[fe]),_:1},8,["onClick","disabled"]),[[u,e.permissions.delMember]])]),l(w,{onCurrentChange:e.chooseMember,border:"",data:e.showMemDialog.members.list,size:"small"},{default:s(()=>[l(n,{label:"\u9009\u62E9",width:"50px"},{default:s(o=>[l(j,{modelValue:e.showMemDialog.chooseId,"onUpdate:modelValue":a[17]||(a[17]=D=>e.showMemDialog.chooseId=D),label:o.row.id},{default:s(()=>[we]),_:2},1032,["modelValue","label"])]),_:1}),l(n,{property:"username",label:"\u8D26\u53F7",width:"125"}),l(n,{property:"createTime",label:"\u52A0\u5165\u65F6\u95F4"},{default:s(o=>[i(A(e.$filters.dateFormat(o.row.createTime)),1)]),_:1}),l(n,{property:"creator",label:"\u5206\u914D\u8005",width:"125"})]),_:1},8,["onCurrentChange","data"]),l(g,{onCurrentChange:e.setMemebers,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.showMemDialog.members.total,"current-page":e.showMemDialog.query.pageNum,"onUpdate:current-page":a[18]||(a[18]=o=>e.showMemDialog.query.pageNum=o),"page-size":e.showMemDialog.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),l(b,{width:"400px",title:"\u6DFB\u52A0\u6210\u5458","before-close":e.cancelAddMember,modelValue:e.showMemDialog.addVisible,"onUpdate:modelValue":a[21]||(a[21]=o=>e.showMemDialog.addVisible=o)},{footer:s(()=>[l("div",De,[p(l(t,{onClick:e.addMember,type:"primary",loading:e.btnLoading,size:"small"},{default:s(()=>[ve]),_:1},8,["onClick","loading"]),[[u,e.permissions.saveMember]]),l(t,{onClick:a[20]||(a[20]=o=>e.cancelAddMember()),size:"small"},{default:s(()=>[je]),_:1})])]),default:s(()=>[l(f,{model:e.showMemDialog.memForm,size:"small","label-width":"70px"},{default:s(()=>[l(h,{label:"\u8D26\u53F7:"},{default:s(()=>[l(C,{style:{width:"100%"},remote:"","remote-method":e.getAccount,modelValue:e.showMemDialog.memForm.accountId,"onUpdate:modelValue":a[19]||(a[19]=o=>e.showMemDialog.memForm.accountId=o),filterable:"",placeholder:"\u8BF7\u9009\u62E9"},{default:s(()=>[(P(!0),k(X,null,Y(e.showMemDialog.accounts,o=>(P(),k(V,{key:o.id,label:o.username,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["remote-method","modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"])]),_:1},8,["title","modelValue"])])}N.render=ye;export default N;
