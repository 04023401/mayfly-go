var H=Object.defineProperty,J=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var z=(e,o,d)=>o in e?H(e,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[o]=d,B=(e,o)=>{for(var d in o||(o={}))X.call(o,d)&&z(e,d,o[d]);if(U)for(var d of U(o))x.call(o,d)&&z(e,d,o[d]);return e},F=(e,o)=>J(e,W(o));import{x as L,r as ee,a as A,A as le,t as M,s as N,e as u,f as c,h as w,i as l,G as n,F as k,E as T,k as m,o as oe,P as ae,Q as S,w as q,l as j,j as $}from"./vendor.c08e96cf.js";import{d as y}from"./api.590f108c.js";import{p as P}from"./api.7a509bb1.js";import"./Api.ab367e46.js";import"./index.ef81b75e.js";function te(e){const o=Number(e);if(e&&!isNaN(o)){const d=["B","KB","MB","GB","TB","PB","EB","ZB","YB","BB"];let r=0,g=o;if(o>=1024)for(;g>1024;)g=g/1024,r++;return`${g.toFixed(2)}${d[r]}`}return"-"}var R=L({name:"DbEdit",props:{visible:{type:Boolean},projects:{type:Array},db:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const d=ee(null),r=A({dialogVisible:!1,projects:[],envs:[],form:{id:null,name:null,port:3306,username:null,password:null,project:null,projectId:null,envId:null,env:null},btnLoading:!1,rules:{projectId:[{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE",trigger:["change","blur"]}],envId:[{required:!0,message:"\u8BF7\u9009\u62E9\u73AF\u5883",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u522B\u540D",trigger:["change","blur"]}],type:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B",trigger:["change","blur"]}],host:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3B\u673Aip",trigger:["change","blur"]}],port:[{required:!0,message:"\u8BF7\u8F93\u5165\u7AEF\u53E3",trigger:["change","blur"]}],username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["change","blur"]}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:["change","blur"]}],database:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D",trigger:["change","blur"]}]}});le(e,async s=>{r.dialogVisible=s.visible,r.projects=s.projects,s.db?(g(s.db.projectId),r.form=B({},s.db)):(r.envs=[],r.form={port:3306})});const g=async s=>{r.envs=await P.projectEnvs.request({projectId:s})},V=s=>{for(let f of r.projects)f.id==s&&(r.form.project=f.name);r.envs=[],g(s)},b=s=>{for(let f of r.envs)f.id==s&&(r.form.env=f.name)},v=async()=>{d.value.validate(s=>{if(s)r.form.port=Number.parseInt(r.form.port),y.saveDb.request(r.form).then(()=>{N.success("\u4FDD\u5B58\u6210\u529F"),o("val-change",r.form),r.btnLoading=!0,setTimeout(()=>{r.btnLoading=!1},1e3),p()});else return N.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},p=()=>{o("update:visible",!1),o("cancel"),setTimeout(()=>{d.value.resetFields(),r.form={}},200)};return F(B({},M(r)),{dbForm:d,changeProject:V,changeEnv:b,btnOk:v,cancel:p})}}),qe="";const ne={class:"dialog-footer"},ie=m("\u786E \u5B9A"),re=m("\u53D6 \u6D88");function se(e,o,d,r,g,V){const b=u("el-option"),v=u("el-select"),p=u("el-form-item"),s=u("el-input"),f=u("el-form"),D=u("el-button"),i=u("el-dialog");return c(),w("div",null,[l(i,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[11]||(o[11]=a=>e.dialogVisible=a),"show-close":!1,"before-close":e.cancel,width:"35%"},{footer:n(()=>[l("div",ne,[l(D,{type:"primary",loading:e.btnLoading,onClick:e.btnOk,size:"mini"},{default:n(()=>[ie]),_:1},8,["loading","onClick"]),l(D,{onClick:o[10]||(o[10]=a=>e.cancel()),size:"mini"},{default:n(()=>[re]),_:1})])]),default:n(()=>[l(f,{model:e.form,ref:"dbForm",rules:e.rules,"label-width":"85px",size:"small"},{default:n(()=>[l(p,{prop:"projectId",label:"\u9879\u76EE:",required:""},{default:n(()=>[l(v,{style:{width:"100%"},modelValue:e.form.projectId,"onUpdate:modelValue":o[1]||(o[1]=a=>e.form.projectId=a),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",onChange:e.changeProject,filterable:""},{default:n(()=>[(c(!0),w(k,null,T(e.projects,a=>(c(),w(b,{key:a.id,label:`${a.name} [${a.remark}]`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(p,{prop:"envId",label:"\u73AF\u5883:",required:""},{default:n(()=>[l(v,{onChange:e.changeEnv,style:{width:"100%"},modelValue:e.form.envId,"onUpdate:modelValue":o[2]||(o[2]=a=>e.form.envId=a),placeholder:"\u8BF7\u9009\u62E9\u73AF\u5883"},{default:n(()=>[(c(!0),w(k,null,T(e.envs,a=>(c(),w(b,{key:a.id,label:`${a.name} [${a.remark}]`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["onChange","modelValue"])]),_:1}),l(p,{prop:"name",label:"\u522B\u540D:",required:""},{default:n(()=>[l(s,{modelValue:e.form.name,"onUpdate:modelValue":o[3]||(o[3]=a=>e.form.name=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u522B\u540D","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(p,{prop:"type",label:"\u7C7B\u578B:",required:""},{default:n(()=>[l(v,{style:{width:"100%"},modelValue:e.form.type,"onUpdate:modelValue":o[4]||(o[4]=a=>e.form.type=a),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B"},{default:n(()=>[l(b,{key:"item.id",label:"mysql",value:"mysql"})]),_:1},8,["modelValue"])]),_:1}),l(p,{prop:"host",label:"host:",required:""},{default:n(()=>[l(s,{modelValue:e.form.host,"onUpdate:modelValue":o[5]||(o[5]=a=>e.form.host=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u4E3B\u673Aip","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(p,{prop:"port",label:"port:",required:""},{default:n(()=>[l(s,{type:"number",modelValue:e.form.port,"onUpdate:modelValue":o[6]||(o[6]=a=>e.form.port=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3"},null,8,["modelValue"])]),_:1}),l(p,{prop:"username",label:"\u7528\u6237\u540D:",required:""},{default:n(()=>[l(s,{modelValue:e.form.username,"onUpdate:modelValue":o[7]||(o[7]=a=>e.form.username=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),l(p,{prop:"password",label:"\u5BC6\u7801:",required:""},{default:n(()=>[l(s,{type:"password","show-password":"",modelValue:e.form.password,"onUpdate:modelValue":o[8]||(o[8]=a=>e.form.password=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),l(p,{prop:"database",label:"\u6570\u636E\u5E93\u540D:",required:""},{default:n(()=>[l(s,{modelValue:e.form.database,"onUpdate:modelValue":o[9]||(o[9]=a=>e.form.database=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}R.render=se;var O=L({name:"DbList",components:{DbEdit:R},setup(){const e=A({permissions:{saveDb:"db:save",delDb:"db:del"},projects:[],chooseId:null,chooseData:null,query:{pageNum:1,pageSize:10},datas:[],total:0,chooseTableName:"",tableInfoDialog:{visible:!1,infos:[]},columnDialog:{visible:!1,columns:[]},indexDialog:{visible:!1,indexs:[]},ddlDialog:{visible:!1,ddl:""},dbEditDialog:{visible:!1,data:null,title:"\u65B0\u589E\u6570\u636E\u5E93"}});oe(async()=>{d(),e.projects=(await P.projects.request({pageNum:1,pageSize:100})).list});const o=i=>{!i||(e.chooseId=i.id,e.chooseData=i)},d=async()=>{let i=await y.dbs.request(e.query);e.datas=i.list,e.total=i.total},r=i=>{e.query.pageNum=i,d()},g=(i=!1)=>{i?(e.dbEditDialog.data=null,e.dbEditDialog.title="\u65B0\u589E\u6570\u636E\u5E93"):(e.dbEditDialog.data=e.chooseData,e.dbEditDialog.title="\u4FEE\u6539\u6570\u636E\u5E93"),e.dbEditDialog.visible=!0},V=()=>{d()},b=async i=>{try{await ae.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u5E93?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await y.deleteDb.request({id:i}),N.success("\u5220\u9664\u6210\u529F"),e.chooseData=null,e.chooseId=null,d()}catch(a){}},v=async i=>{e.tableInfoDialog.infos=await y.tableInfos.request({id:i.id}),e.tableInfoDialog.visible=!0},p=()=>{e.tableInfoDialog.visible=!1,e.tableInfoDialog.infos=[]},s=async i=>{e.chooseTableName=i.tableName,e.columnDialog.columns=await y.columnMetadata.request({id:e.chooseId,tableName:i.tableName}),e.columnDialog.visible=!0},f=async i=>{e.chooseTableName=i.tableName,e.indexDialog.indexs=await y.tableIndex.request({id:e.chooseId,tableName:i.tableName}),e.indexDialog.visible=!0},D=async i=>{e.chooseTableName=i.tableName;const a=await y.tableDdl.request({id:e.chooseId,tableName:i.tableName});e.ddlDialog.ddl=a[0]["Create Table"],console.log(e.ddlDialog),e.ddlDialog.visible=!0};return F(B({},M(e)),{search:d,choose:o,handlePageChange:r,editDb:g,valChange:V,deleteDb:b,tableInfo:v,closeTableInfo:p,showColumns:s,showTableIndex:f,showCreateDdl:D,formatByteSize:te})}}),je="";const de={class:"db-list"},ue=m("\u6DFB\u52A0"),pe=m("\u7F16\u8F91"),me=m("\u5220\u9664"),be={style:{float:"right"}},fe=m("\u67E5\u8BE2"),ge=l("i",null,null,-1),he=m("\u8868\u4FE1\u606F"),ve=m("\u5B57\u6BB5"),ce=m("\u7D22\u5F15"),we=m("SQL");function ye(e,o,d,r,g,V){const b=u("el-button"),v=u("el-option"),p=u("el-select"),s=u("el-form-item"),f=u("el-input"),D=u("el-form"),i=u("el-radio"),a=u("el-table-column"),E=u("el-link"),I=u("el-table"),G=u("el-pagination"),Q=u("el-row"),K=u("el-card"),C=u("el-dialog"),Y=u("db-edit"),_=S("auth"),Z=S("waves");return c(),w("div",de,[l(K,null,{default:n(()=>[q(l(b,{type:"primary",icon:"el-icon-plus",size:"mini",onClick:o[1]||(o[1]=t=>e.editDb(!0))},{default:n(()=>[ue]),_:1},512),[[_,e.permissions.saveDb]]),q(l(b,{disabled:e.chooseId==null,onClick:o[2]||(o[2]=t=>e.editDb(!1)),type:"primary",icon:"el-icon-edit",size:"mini"},{default:n(()=>[pe]),_:1},8,["disabled"]),[[_,e.permissions.saveDb]]),q(l(b,{disabled:e.chooseId==null,onClick:o[3]||(o[3]=t=>e.deleteDb(e.chooseId)),type:"danger",icon:"el-icon-delete",size:"mini"},{default:n(()=>[me]),_:1},8,["disabled"]),[[_,e.permissions.delDb]]),l("div",be,[l(D,{class:"search-form","label-position":"right",inline:!0,"label-width":"60px",size:"small"},{default:n(()=>[l(s,{prop:"project"},{default:n(()=>[l(p,{modelValue:e.query.projectId,"onUpdate:modelValue":o[4]||(o[4]=t=>e.query.projectId=t),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",filterable:"",clearable:""},{default:n(()=>[(c(!0),w(k,null,T(e.projects,t=>(c(),w(v,{key:t.id,label:`${t.name} [${t.remark}]`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,null,{default:n(()=>[l(f,{modelValue:e.query.database,"onUpdate:modelValue":o[5]||(o[5]=t=>e.query.database=t),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93","auto-complete":"off",clearable:""},null,8,["modelValue"])]),_:1}),q(l(b,{type:"primary",icon:"el-icon-search",size:"mini",onClick:o[6]||(o[6]=t=>e.search())},{default:n(()=>[fe]),_:1},512),[[Z]])]),_:1})]),l(I,{data:e.datas,ref:"table",onCurrentChange:e.choose,"show-overflow-tooltip":""},{default:n(()=>[l(a,{label:"\u9009\u62E9",width:"50px"},{default:n(t=>[l(i,{modelValue:e.chooseId,"onUpdate:modelValue":o[7]||(o[7]=h=>e.chooseId=h),label:t.row.id},{default:n(()=>[ge]),_:2},1032,["modelValue","label"])]),_:1}),l(a,{prop:"project",label:"\u9879\u76EE","min-width":"100"}),l(a,{prop:"env",label:"\u73AF\u5883","min-width":"100"}),l(a,{prop:"name",label:"\u540D\u79F0","min-width":"200"}),l(a,{"min-width":"160",label:"host:port"},{default:n(t=>[m(j(`${t.row.host}:${t.row.port}`),1)]),_:1}),l(a,{prop:"type",label:"\u7C7B\u578B","min-width":"80"}),l(a,{prop:"database",label:"\u6570\u636E\u5E93","min-width":"120"}),l(a,{prop:"username",label:"\u7528\u6237\u540D","min-width":"100"}),l(a,{"min-width":"115",prop:"creator",label:"\u521B\u5EFA\u8D26\u53F7"}),l(a,{"min-width":"160",prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:n(t=>[m(j(e.$filters.dateFormat(t.row.createTime)),1)]),_:1}),l(a,{fixed:"right",label:"\u66F4\u591A\u4FE1\u606F","min-width":"100"},{default:n(t=>[l(E,{onClick:$(h=>e.tableInfo(t.row),["prevent"]),type:"success"},{default:n(()=>[he]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),l(Q,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:n(()=>[l(G,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":o[8]||(o[8]=t=>e.query.pageNum=t),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),l(C,{width:"75%",title:`${e.chooseData?e.chooseData.database:""} \u8868\u4FE1\u606F`,"before-close":e.closeTableInfo,modelValue:e.tableInfoDialog.visible,"onUpdate:modelValue":o[9]||(o[9]=t=>e.tableInfoDialog.visible=t)},{default:n(()=>[l(I,{border:"",data:e.tableInfoDialog.infos,size:"small"},{default:n(()=>[l(a,{property:"tableName",label:"\u8868\u540D","min-width":"150","show-overflow-tooltip":""}),l(a,{property:"tableComment",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""}),l(a,{prop:"tableRows",label:"Rows","min-width":"70",sortable:"","sort-method":(t,h)=>parseInt(t.tableRows)-parseInt(h.tableRows)},null,8,["sort-method"]),l(a,{property:"dataLength",label:"\u6570\u636E\u5927\u5C0F",sortable:"","sort-method":(t,h)=>parseInt(t.dataLength)-parseInt(h.dataLength)},{default:n(t=>[m(j(e.formatByteSize(t.row.dataLength)),1)]),_:1},8,["sort-method"]),l(a,{property:"indexLength",label:"\u7D22\u5F15\u5927\u5C0F",sortable:"","sort-method":(t,h)=>parseInt(t.indexLength)-parseInt(h.indexLength)},{default:n(t=>[m(j(e.formatByteSize(t.row.indexLength)),1)]),_:1},8,["sort-method"]),l(a,{property:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":"150"}),l(a,{label:"\u66F4\u591A\u4FE1\u606F","min-width":"100"},{default:n(t=>[l(E,{onClick:$(h=>e.showColumns(t.row),["prevent"]),type:"primary"},{default:n(()=>[ve]),_:2},1032,["onClick"]),l(E,{class:"ml5",onClick:$(h=>e.showTableIndex(t.row),["prevent"]),type:"success"},{default:n(()=>[ce]),_:2},1032,["onClick"]),l(E,{class:"ml5",onClick:$(h=>e.showCreateDdl(t.row),["prevent"]),type:"info"},{default:n(()=>[we]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["title","before-close","modelValue"]),l(C,{width:"40%",title:`${e.chooseTableName} \u5B57\u6BB5\u4FE1\u606F`,modelValue:e.columnDialog.visible,"onUpdate:modelValue":o[10]||(o[10]=t=>e.columnDialog.visible=t)},{default:n(()=>[l(I,{border:"",data:e.columnDialog.columns,size:"mini"},{default:n(()=>[l(a,{prop:"columnName",label:"\u540D\u79F0","show-overflow-tooltip":""}),l(a,{prop:"columnComment",label:"\u5907\u6CE8","show-overflow-tooltip":""}),l(a,{width:"120",prop:"columnType",label:"\u7C7B\u578B","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),l(C,{width:"40%",title:`${e.chooseTableName} \u7D22\u5F15\u4FE1\u606F`,modelValue:e.indexDialog.visible,"onUpdate:modelValue":o[11]||(o[11]=t=>e.indexDialog.visible=t)},{default:n(()=>[l(I,{border:"",data:e.indexDialog.indexs,size:"mini"},{default:n(()=>[l(a,{prop:"indexName",label:"\u7D22\u5F15\u540D","show-overflow-tooltip":""}),l(a,{prop:"columnName",label:"\u5217\u540D","show-overflow-tooltip":""}),l(a,{prop:"seqInIndex",label:"\u5217\u5E8F\u5217\u53F7","show-overflow-tooltip":""}),l(a,{prop:"indexType",label:"\u7C7B\u578B"})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),l(C,{width:"55%",title:`${e.chooseTableName} Create-DDL`,modelValue:e.ddlDialog.visible,"onUpdate:modelValue":o[13]||(o[13]=t=>e.ddlDialog.visible=t)},{default:n(()=>[l(f,{disabled:"",type:"textarea",autosize:{minRows:15,maxRows:30},modelValue:e.ddlDialog.ddl,"onUpdate:modelValue":o[12]||(o[12]=t=>e.ddlDialog.ddl=t)},null,8,["modelValue"])]),_:1},8,["title","modelValue"]),l(Y,{onValChange:e.valChange,projects:e.projects,title:e.dbEditDialog.title,visible:e.dbEditDialog.visible,"onUpdate:visible":o[14]||(o[14]=t=>e.dbEditDialog.visible=t),db:e.dbEditDialog.data,"onUpdate:db":o[15]||(o[15]=t=>e.dbEditDialog.data=t)},null,8,["onValChange","projects","title","visible","db"])])}O.render=ye;export default O;
