var H=Object.defineProperty,J=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var L=(e,o,u)=>o in e?H(e,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[o]=u,q=(e,o)=>{for(var u in o||(o={}))X.call(o,u)&&L(e,u,o[u]);if(z)for(var u of z(o))x.call(o,u)&&L(e,u,o[u]);return e},F=(e,o)=>J(e,W(o));import{x as A,r as ee,a as M,A as le,t as S,s as N,e as m,f as w,h as D,i as l,G as t,F as T,E as U,k as f,o as oe,P as ae,Q as P,w as $,l as j,j as _}from"./vendor.c08e96cf.js";import{d as y}from"./api.fa4016da.js";import{p as R}from"./api.b589497a.js";import"./Api.7190d43f.js";import"./index.01696ebf.js";function te(e){const o=Number(e);if(e&&!isNaN(o)){const u=["B","KB","MB","GB","TB","PB","EB","ZB","YB","BB"];let r=0,g=o;if(o>=1024)for(;g>1024;)g=g/1024,r++;return`${g.toFixed(2)}${u[r]}`}return"-"}var O=A({name:"DbEdit",props:{visible:{type:Boolean},projects:{type:Array},db:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const u=ee(null),r=M({dialogVisible:!1,projects:[],envs:[],form:{id:null,name:null,port:3306,username:null,password:null,project:null,projectId:null,envId:null,env:null},btnLoading:!1,rules:{projectId:[{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE",trigger:["change","blur"]}],envId:[{required:!0,message:"\u8BF7\u9009\u62E9\u73AF\u5883",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u522B\u540D",trigger:["change","blur"]}],type:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B",trigger:["change","blur"]}],host:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3B\u673Aip",trigger:["change","blur"]}],port:[{required:!0,message:"\u8BF7\u8F93\u5165\u7AEF\u53E3",trigger:["change","blur"]}],username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["change","blur"]}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:["change","blur"]}],database:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D",trigger:["change","blur"]}]}});le(e,async s=>{r.dialogVisible=s.visible,r.projects=s.projects,s.db?(g(s.db.projectId),r.form=q({},s.db)):(r.envs=[],r.form={port:3306})});const g=async s=>{r.envs=await R.projectEnvs.request({projectId:s})},E=s=>{for(let b of r.projects)b.id==s&&(r.form.project=b.name);r.envs=[],g(s)},v=s=>{for(let b of r.envs)b.id==s&&(r.form.env=b.name)},c=async()=>{u.value.validate(s=>{if(s)r.form.port=Number.parseInt(r.form.port),y.saveDb.request(r.form).then(()=>{N.success("\u4FDD\u5B58\u6210\u529F"),o("val-change",r.form),r.btnLoading=!0,setTimeout(()=>{r.btnLoading=!1},1e3),p()});else return N.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},p=()=>{o("update:visible",!1),o("cancel"),setTimeout(()=>{u.value.resetFields(),r.form={}},200)};return F(q({},S(r)),{dbForm:u,changeProject:E,changeEnv:v,btnOk:c,cancel:p})}}),qe="";const ne={class:"dialog-footer"},ie=f("\u786E \u5B9A"),re=f("\u53D6 \u6D88");function se(e,o,u,r,g,E){const v=m("el-option"),c=m("el-select"),p=m("el-form-item"),s=m("el-input"),b=m("el-form"),V=m("el-button"),i=m("el-dialog");return w(),D("div",null,[l(i,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[11]||(o[11]=n=>e.dialogVisible=n),"show-close":!1,"before-close":e.cancel,width:"35%"},{footer:t(()=>[l("div",ne,[l(V,{type:"primary",loading:e.btnLoading,onClick:e.btnOk,size:"mini"},{default:t(()=>[ie]),_:1},8,["loading","onClick"]),l(V,{onClick:o[10]||(o[10]=n=>e.cancel()),size:"mini"},{default:t(()=>[re]),_:1})])]),default:t(()=>[l(b,{model:e.form,ref:"dbForm",rules:e.rules,"label-width":"85px",size:"small"},{default:t(()=>[l(p,{prop:"projectId",label:"\u9879\u76EE:",required:""},{default:t(()=>[l(c,{style:{width:"100%"},modelValue:e.form.projectId,"onUpdate:modelValue":o[1]||(o[1]=n=>e.form.projectId=n),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",onChange:e.changeProject,filterable:""},{default:t(()=>[(w(!0),D(T,null,U(e.projects,n=>(w(),D(v,{key:n.id,label:`${n.name} [${n.remark}]`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(p,{prop:"envId",label:"\u73AF\u5883:",required:""},{default:t(()=>[l(c,{onChange:e.changeEnv,style:{width:"100%"},modelValue:e.form.envId,"onUpdate:modelValue":o[2]||(o[2]=n=>e.form.envId=n),placeholder:"\u8BF7\u9009\u62E9\u73AF\u5883"},{default:t(()=>[(w(!0),D(T,null,U(e.envs,n=>(w(),D(v,{key:n.id,label:`${n.name} [${n.remark}]`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["onChange","modelValue"])]),_:1}),l(p,{prop:"name",label:"\u522B\u540D:",required:""},{default:t(()=>[l(s,{modelValue:e.form.name,"onUpdate:modelValue":o[3]||(o[3]=n=>e.form.name=n),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u522B\u540D","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(p,{prop:"type",label:"\u7C7B\u578B:",required:""},{default:t(()=>[l(c,{style:{width:"100%"},modelValue:e.form.type,"onUpdate:modelValue":o[4]||(o[4]=n=>e.form.type=n),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B"},{default:t(()=>[l(v,{key:"item.id",label:"mysql",value:"mysql"})]),_:1},8,["modelValue"])]),_:1}),l(p,{prop:"host",label:"host:",required:""},{default:t(()=>[l(s,{modelValue:e.form.host,"onUpdate:modelValue":o[5]||(o[5]=n=>e.form.host=n),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u4E3B\u673Aip","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(p,{prop:"port",label:"port:",required:""},{default:t(()=>[l(s,{type:"number",modelValue:e.form.port,"onUpdate:modelValue":o[6]||(o[6]=n=>e.form.port=n),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3"},null,8,["modelValue"])]),_:1}),l(p,{prop:"username",label:"\u7528\u6237\u540D:",required:""},{default:t(()=>[l(s,{modelValue:e.form.username,"onUpdate:modelValue":o[7]||(o[7]=n=>e.form.username=n),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),l(p,{prop:"password",label:"\u5BC6\u7801:",required:""},{default:t(()=>[l(s,{type:"password","show-password":"",modelValue:e.form.password,"onUpdate:modelValue":o[8]||(o[8]=n=>e.form.password=n),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),l(p,{prop:"database",label:"\u6570\u636E\u5E93\u540D:",required:""},{default:t(()=>[l(s,{modelValue:e.form.database,"onUpdate:modelValue":o[9]||(o[9]=n=>e.form.database=n),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}O.render=se;var G=A({name:"DbList",components:{DbEdit:O},setup(){const e=M({permissions:{saveDb:"db:save",delDb:"db:del"},projects:[],chooseId:null,chooseData:null,query:{pageNum:1,pageSize:10},datas:[],total:0,chooseTableName:"",tableInfoDialog:{visible:!1,infos:[]},columnDialog:{visible:!1,columns:[]},indexDialog:{visible:!1,indexs:[]},ddlDialog:{visible:!1,ddl:""},dbEditDialog:{visible:!1,data:null,title:"\u65B0\u589E\u6570\u636E\u5E93"}});oe(async()=>{u(),e.projects=(await R.projects.request({pageNum:1,pageSize:100})).list});const o=i=>{!i||(e.chooseId=i.id,e.chooseData=i)},u=async()=>{let i=await y.dbs.request(e.query);e.datas=i.list,e.total=i.total},r=i=>{e.query.pageNum=i,u()},g=(i=!1)=>{i?(e.dbEditDialog.data=null,e.dbEditDialog.title="\u65B0\u589E\u6570\u636E\u5E93"):(e.dbEditDialog.data=e.chooseData,e.dbEditDialog.title="\u4FEE\u6539\u6570\u636E\u5E93"),e.dbEditDialog.visible=!0},E=()=>{u()},v=async i=>{try{await ae.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u5E93?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await y.deleteDb.request({id:i}),N.success("\u5220\u9664\u6210\u529F"),e.chooseData=null,e.chooseId=null,u()}catch(n){}},c=async i=>{e.tableInfoDialog.infos=await y.tableInfos.request({id:i.id}),e.tableInfoDialog.visible=!0},p=()=>{e.tableInfoDialog.visible=!1,e.tableInfoDialog.infos=[]},s=async i=>{e.chooseTableName=i.tableName,e.columnDialog.columns=await y.columnMetadata.request({id:e.chooseId,tableName:i.tableName}),e.columnDialog.visible=!0},b=async i=>{e.chooseTableName=i.tableName,e.indexDialog.indexs=await y.tableIndex.request({id:e.chooseId,tableName:i.tableName}),e.indexDialog.visible=!0},V=async i=>{e.chooseTableName=i.tableName;const n=await y.tableDdl.request({id:e.chooseId,tableName:i.tableName});e.ddlDialog.ddl=n[0]["Create Table"],console.log(e.ddlDialog),e.ddlDialog.visible=!0};return F(q({},S(e)),{search:u,choose:o,handlePageChange:r,editDb:g,valChange:E,deleteDb:v,tableInfo:c,closeTableInfo:p,showColumns:s,showTableIndex:b,showCreateDdl:V,formatByteSize:te})}}),$e="";const de={class:"db-list"},ue={class:"toolbar"},me=f("\u67E5\u8BE2"),pe=f("\u6DFB\u52A0"),be=f("\u7F16\u8F91"),fe=f("\u5220\u9664"),ge=l("i",null,null,-1),he=f("\u8868\u4FE1\u606F"),ve=f("\u5B57\u6BB5"),ce=f("\u7D22\u5F15"),we=f("SQL");function De(e,o,u,r,g,E){const v=m("el-option"),c=m("el-select"),p=m("el-form-item"),s=m("el-input"),b=m("el-button"),V=m("el-form"),i=m("el-col"),n=m("el-row"),Q=m("el-radio"),d=m("el-table-column"),I=m("el-link"),C=m("el-table"),K=m("el-pagination"),B=m("el-dialog"),Y=m("db-edit"),Z=P("waves"),k=P("auth");return w(),D("div",de,[l("div",ue,[l(n,null,{default:t(()=>[l(i,null,{default:t(()=>[l(V,{class:"search-form","label-position":"right",inline:!0,"label-width":"60px",size:"small"},{default:t(()=>[l(p,{prop:"project",label:"\u9879\u76EE"},{default:t(()=>[l(c,{modelValue:e.query.projectId,"onUpdate:modelValue":o[1]||(o[1]=a=>e.query.projectId=a),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",filterable:"",clearable:""},{default:t(()=>[(w(!0),D(T,null,U(e.projects,a=>(w(),D(v,{key:a.id,label:`${a.name} [${a.remark}]`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"\u6570\u636E\u5E93"},{default:t(()=>[l(s,{modelValue:e.query.database,"onUpdate:modelValue":o[2]||(o[2]=a=>e.query.database=a),"auto-complete":"off",clearable:""},null,8,["modelValue"])]),_:1}),$(l(b,{type:"primary",icon:"el-icon-search",size:"mini",onClick:o[3]||(o[3]=a=>e.search())},{default:t(()=>[me]),_:1},512),[[Z]])]),_:1})]),_:1})]),_:1}),l(n,{class:"mt5"},{default:t(()=>[l(i,null,{default:t(()=>[$(l(b,{type:"primary",icon:"el-icon-plus",size:"mini",onClick:o[4]||(o[4]=a=>e.editDb(!0))},{default:t(()=>[pe]),_:1},512),[[k,e.permissions.saveDb]]),$(l(b,{disabled:e.chooseId==null,onClick:o[5]||(o[5]=a=>e.editDb(!1)),type:"primary",icon:"el-icon-edit",size:"mini"},{default:t(()=>[be]),_:1},8,["disabled"]),[[k,e.permissions.saveDb]]),$(l(b,{disabled:e.chooseId==null,onClick:o[6]||(o[6]=a=>e.deleteDb(e.chooseId)),type:"danger",icon:"el-icon-delete",size:"mini"},{default:t(()=>[fe]),_:1},8,["disabled"]),[[k,e.permissions.delDb]])]),_:1})]),_:1})]),l(C,{data:e.datas,border:"",ref:"table",onCurrentChange:e.choose,"show-overflow-tooltip":""},{default:t(()=>[l(d,{label:"\u9009\u62E9",width:"50px"},{default:t(a=>[l(Q,{modelValue:e.chooseId,"onUpdate:modelValue":o[7]||(o[7]=h=>e.chooseId=h),label:a.row.id},{default:t(()=>[ge]),_:2},1032,["modelValue","label"])]),_:1}),l(d,{prop:"project",label:"\u9879\u76EE","min-width":"100"}),l(d,{prop:"env",label:"\u73AF\u5883","min-width":"100"}),l(d,{prop:"name",label:"\u540D\u79F0","min-width":"200"}),l(d,{"min-width":"160",label:"host:port"},{default:t(a=>[f(j(`${a.row.host}:${a.row.port}`),1)]),_:1}),l(d,{prop:"type",label:"\u7C7B\u578B","min-width":"80"}),l(d,{prop:"database",label:"\u6570\u636E\u5E93","min-width":"120"}),l(d,{prop:"username",label:"\u7528\u6237\u540D","min-width":"100"}),l(d,{"min-width":"115",prop:"creator",label:"\u521B\u5EFA\u8D26\u53F7"}),l(d,{"min-width":"160",prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:t(a=>[f(j(e.$filters.dateFormat(a.row.createTime)),1)]),_:1}),l(d,{fixed:"right",label:"\u66F4\u591A\u4FE1\u606F","min-width":"100"},{default:t(a=>[l(I,{onClick:_(h=>e.tableInfo(a.row),["prevent"]),type:"success"},{default:t(()=>[he]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),l(K,{onCurrentChange:e.handlePageChange,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"onUpdate:current-page":o[8]||(o[8]=a=>e.query.pageNum=a),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),l(B,{width:"75%",title:`${e.chooseData?e.chooseData.database:""} \u8868\u4FE1\u606F`,"before-close":e.closeTableInfo,modelValue:e.tableInfoDialog.visible,"onUpdate:modelValue":o[9]||(o[9]=a=>e.tableInfoDialog.visible=a)},{default:t(()=>[l(C,{border:"",data:e.tableInfoDialog.infos,size:"small"},{default:t(()=>[l(d,{property:"tableName",label:"\u8868\u540D","min-width":"150","show-overflow-tooltip":""}),l(d,{property:"tableComment",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""}),l(d,{prop:"tableRows",label:"Rows","min-width":"70",sortable:"","sort-method":(a,h)=>parseInt(a.tableRows)-parseInt(h.tableRows)},null,8,["sort-method"]),l(d,{property:"dataLength",label:"\u6570\u636E\u5927\u5C0F",sortable:"","sort-method":(a,h)=>parseInt(a.dataLength)-parseInt(h.dataLength)},{default:t(a=>[f(j(e.formatByteSize(a.row.dataLength)),1)]),_:1},8,["sort-method"]),l(d,{property:"indexLength",label:"\u7D22\u5F15\u5927\u5C0F",sortable:"","sort-method":(a,h)=>parseInt(a.indexLength)-parseInt(h.indexLength)},{default:t(a=>[f(j(e.formatByteSize(a.row.indexLength)),1)]),_:1},8,["sort-method"]),l(d,{property:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":"150"}),l(d,{label:"\u66F4\u591A\u4FE1\u606F","min-width":"100"},{default:t(a=>[l(I,{onClick:_(h=>e.showColumns(a.row),["prevent"]),type:"primary"},{default:t(()=>[ve]),_:2},1032,["onClick"]),l(I,{class:"ml5",onClick:_(h=>e.showTableIndex(a.row),["prevent"]),type:"success"},{default:t(()=>[ce]),_:2},1032,["onClick"]),l(I,{class:"ml5",onClick:_(h=>e.showCreateDdl(a.row),["prevent"]),type:"info"},{default:t(()=>[we]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["title","before-close","modelValue"]),l(B,{width:"40%",title:`${e.chooseTableName} \u5B57\u6BB5\u4FE1\u606F`,modelValue:e.columnDialog.visible,"onUpdate:modelValue":o[10]||(o[10]=a=>e.columnDialog.visible=a)},{default:t(()=>[l(C,{border:"",data:e.columnDialog.columns,size:"mini"},{default:t(()=>[l(d,{prop:"columnName",label:"\u540D\u79F0","show-overflow-tooltip":""}),l(d,{prop:"columnComment",label:"\u5907\u6CE8","show-overflow-tooltip":""}),l(d,{width:"120",prop:"columnType",label:"\u7C7B\u578B","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),l(B,{width:"40%",title:`${e.chooseTableName} \u7D22\u5F15\u4FE1\u606F`,modelValue:e.indexDialog.visible,"onUpdate:modelValue":o[11]||(o[11]=a=>e.indexDialog.visible=a)},{default:t(()=>[l(C,{border:"",data:e.indexDialog.indexs,size:"mini"},{default:t(()=>[l(d,{prop:"indexName",label:"\u7D22\u5F15\u540D","show-overflow-tooltip":""}),l(d,{prop:"columnName",label:"\u5217\u540D","show-overflow-tooltip":""}),l(d,{prop:"seqInIndex",label:"\u5217\u5E8F\u5217\u53F7","show-overflow-tooltip":""}),l(d,{prop:"indexType",label:"\u7C7B\u578B"})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),l(B,{width:"55%",title:`${e.chooseTableName} Create-DDL`,modelValue:e.ddlDialog.visible,"onUpdate:modelValue":o[13]||(o[13]=a=>e.ddlDialog.visible=a)},{default:t(()=>[l(s,{disabled:"",type:"textarea",autosize:{minRows:15,maxRows:30},modelValue:e.ddlDialog.ddl,"onUpdate:modelValue":o[12]||(o[12]=a=>e.ddlDialog.ddl=a)},null,8,["modelValue"])]),_:1},8,["title","modelValue"]),l(Y,{onValChange:e.valChange,projects:e.projects,title:e.dbEditDialog.title,visible:e.dbEditDialog.visible,"onUpdate:visible":o[14]||(o[14]=a=>e.dbEditDialog.visible=a),db:e.dbEditDialog.data,"onUpdate:db":o[15]||(o[15]=a=>e.dbEditDialog.data=a)},null,8,["onValChange","projects","title","visible","db"])])}G.render=De;export default G;
