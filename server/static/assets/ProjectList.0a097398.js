var T=Object.defineProperty,L=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var $=(e,o,r)=>o in e?T(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,C=(e,o)=>{for(var r in o||(o={}))_.call(o,r)&&$(e,r,o[r]);if(q)for(var r of q(o))G.call(o,r)&&$(e,r,o[r]);return e},U=(e,o)=>L(e,S(o));import{p}from"./api.b589497a.js";import{b as Q}from"./api.cfb83391.js";import{x as R,a as H,o as J,t as K,s as j,P as O,e as u,Q as W,f as F,h as P,i as l,w as c,G as s,k as n,l as k,F as X,E as Y}from"./vendor.c08e96cf.js";import{n as A,a as Z}from"./assert.6143fd7f.js";import"./Api.7190d43f.js";import"./index.01696ebf.js";var B=R({name:"ProjectList",components:{},setup(){const e=H({permissions:{saveProject:"project:save",delProject:"project:del",saveMember:"project:member:add",delMember:"project:member:del",saveEnv:"project:env:add"},query:{pageNum:1,pageSize:10,name:null},total:0,projects:[],btnLoading:!1,chooseId:null,chooseData:null,addProjectDialog:{title:"\u65B0\u589E\u9879\u76EE",visible:!1,form:{name:"",remark:""}},showEnvDialog:{visible:!1,envs:[],title:"",addVisible:!1,envForm:{name:"",remark:"",projectId:0}},showMemDialog:{visible:!1,chooseId:null,chooseData:null,query:{pageSize:8,pageNum:1,projectId:null},members:{list:[],total:null},title:"",addVisible:!1,memForm:{},accounts:[]}});J(()=>{o()});const o=async()=>{let t=await p.projects.request(e.query);e.projects=t.list,e.total=t.total},r=t=>{e.query.pageNum=t,o()},z=t=>{t?e.addProjectDialog.form=C({},t):e.addProjectDialog.form={},e.addProjectDialog.visible=!0},E=()=>{e.addProjectDialog.visible=!1,e.addProjectDialog.form={}},I=async()=>{const t=e.addProjectDialog.form;A(t.name,"\u9879\u76EE\u540D\u4E0D\u80FD\u4E3A\u7A7A"),A(t.remark,"\u9879\u76EE\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A"),await p.saveProject.request(t),j.success("\u4FDD\u5B58\u6210\u529F"),o(),E()},i=async()=>{try{await O.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u76EE?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await p.delProject.request({id:e.chooseId}),j.success("\u5220\u9664\u6210\u529F"),e.chooseData=null,e.chooseId=null,o()}catch(t){}},g=t=>{!t||(e.chooseId=t.id,e.chooseData=t)},y=async t=>{e.showMemDialog.query.projectId=t.id,await h(),e.showMemDialog.title=`${t.name}\u7684\u6210\u5458\u4FE1\u606F`,e.showMemDialog.visible=!0},d=t=>{!t||(e.showMemDialog.chooseData=t,e.showMemDialog.chooseId=t.id)},w=async()=>{Z(e.showMemDialog.chooseData,"\u8BF7\u9009\u9009\u62E9\u6210\u5458"),await p.deleteProjectMem.request(e.showMemDialog.chooseData),j.success("\u79FB\u9664\u6210\u529F"),h()},h=async()=>{const t=await p.projectMems.request(e.showMemDialog.query);e.showMemDialog.members.list=t.list,e.showMemDialog.members.total=t.total},b=async t=>{e.showEnvDialog.envs=await p.projectEnvs.request({projectId:t.id}),e.showEnvDialog.title=`${t.name}\u7684\u73AF\u5883\u4FE1\u606F`,e.showEnvDialog.visible=!0},v=()=>{e.showMemDialog.addVisible=!0},f=async()=>{const t=e.showMemDialog.memForm;t.projectId=e.chooseData.id,A(t.accountId,"\u8BF7\u5148\u9009\u62E9\u8D26\u53F7"),await p.saveProjectMem.request(t),j.success("\u4FDD\u5B58\u6210\u529F"),h(),M()},M=()=>{e.showMemDialog.memForm={},e.showMemDialog.addVisible=!1,e.showMemDialog.chooseData=null,e.showMemDialog.chooseId=null},V=t=>{Q.list.request({username:t}).then(N=>{e.showMemDialog.accounts=N.list})},m=()=>{e.showEnvDialog.addVisible=!0},a=async()=>{const t=e.showEnvDialog.envForm;t.projectId=e.chooseData.id,await p.saveProjectEnv.request(t),j.success("\u4FDD\u5B58\u6210\u529F"),e.showEnvDialog.envs=await p.projectEnvs.request({projectId:t.projectId}),D()},D=()=>{e.showEnvDialog.envForm={},e.showEnvDialog.addVisible=!1};return U(C({},K(e)),{search:o,handlePageChange:r,choose:g,showAddProjectDialog:z,addProject:I,delProject:i,cancelAddProject:E,showMembers:y,setMemebers:h,showEnv:b,showAddMemberDialog:v,addMember:f,chooseMember:d,deleteMember:w,cancelAddMember:M,showAddEnvDialog:m,addEnv:a,cancelAddEnv:D,getAccount:V})}}),ze="";const x={class:"project-list"},ee={class:"toolbar"},oe=n("\u6DFB\u52A0"),le=n("\u7F16\u8F91"),ae=n("\u6210\u5458\u7BA1\u7406"),se=n("\u73AF\u5883\u7BA1\u7406"),te=n("\u5220\u9664"),ie={style:{float:"right"}},ne=l("i",null,null,-1),de={class:"dialog-footer"},re=n("\u786E \u5B9A"),ue=n("\u53D6 \u6D88"),me={class:"toolbar"},pe=n("\u6DFB\u52A0"),ce={class:"dialog-footer"},ge=n("\u786E \u5B9A"),he=n("\u53D6 \u6D88"),be={class:"toolbar"},fe=n("\u6DFB\u52A0"),De=n("\u79FB\u9664"),we=l("i",null,null,-1),ve={class:"dialog-footer"},je=n("\u786E \u5B9A"),ye=n("\u53D6 \u6D88");function Me(e,o,r,z,E,I){const i=u("el-button"),g=u("el-input"),y=u("el-radio"),d=u("el-table-column"),w=u("el-table"),h=u("el-pagination"),b=u("el-form-item"),v=u("el-form"),f=u("el-dialog"),M=u("el-option"),V=u("el-select"),m=W("auth");return F(),P("div",x,[l("div",ee,[c(l(i,{onClick:e.showAddProjectDialog,type:"primary",icon:"el-icon-plus",size:"mini"},{default:s(()=>[oe]),_:1},8,["onClick"]),[[m,e.permissions.saveProject]]),c(l(i,{onClick:o[1]||(o[1]=a=>e.showAddProjectDialog(e.chooseData)),disabled:e.chooseId==null,type:"primary",icon:"el-icon-edit",size:"mini"},{default:s(()=>[le]),_:1},8,["disabled"]),[[m,e.permissions.saveProject]]),l(i,{onClick:o[2]||(o[2]=a=>e.showMembers(e.chooseData)),disabled:e.chooseId==null,type:"success",icon:"el-icon-setting",size:"mini"},{default:s(()=>[ae]),_:1},8,["disabled"]),l(i,{onClick:o[3]||(o[3]=a=>e.showEnv(e.chooseData)),disabled:e.chooseId==null,type:"info",icon:"el-icon-setting",size:"mini"},{default:s(()=>[se]),_:1},8,["disabled"]),c(l(i,{onClick:e.delProject,disabled:e.chooseId==null,type:"danger",icon:"el-icon-delete",size:"mini"},{default:s(()=>[te]),_:1},8,["onClick","disabled"]),[[m,e.permissions.delProject]]),l("div",ie,[l(g,{class:"mr2",placeholder:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\uFF01",size:"small",style:{width:"140px"},modelValue:e.query.name,"onUpdate:modelValue":o[4]||(o[4]=a=>e.query.name=a),onClear:e.search,clearable:""},null,8,["modelValue","onClear"]),l(i,{onClick:e.search,type:"success",icon:"el-icon-search",size:"mini"},null,8,["onClick"])])]),l(w,{data:e.projects,onCurrentChange:e.choose,border:"",ref:"table",style:{width:"100%"}},{default:s(()=>[l(d,{label:"\u9009\u62E9",width:"50px"},{default:s(a=>[l(y,{modelValue:e.chooseId,"onUpdate:modelValue":o[5]||(o[5]=D=>e.chooseId=D),label:a.row.id},{default:s(()=>[ne]),_:2},1032,["modelValue","label"])]),_:1}),l(d,{prop:"name",label:"\u9879\u76EE\u540D"}),l(d,{prop:"remark",label:"\u63CF\u8FF0","min-width":"180px","show-overflow-tooltip":""}),l(d,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(a=>[n(k(e.$filters.dateFormat(a.row.createTime)),1)]),_:1}),l(d,{prop:"creator",label:"\u521B\u5EFA\u8005"})]),_:1},8,["data","onCurrentChange"]),l(h,{onCurrentChange:e.handlePageChange,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"onUpdate:current-page":o[6]||(o[6]=a=>e.query.pageNum=a),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),l(f,{width:"400px",title:"\u9879\u76EE\u7F16\u8F91","before-close":e.cancelAddProject,modelValue:e.addProjectDialog.visible,"onUpdate:modelValue":o[10]||(o[10]=a=>e.addProjectDialog.visible=a)},{footer:s(()=>[l("div",de,[l(i,{onClick:e.addProject,type:"primary",size:"small"},{default:s(()=>[re]),_:1},8,["onClick"]),l(i,{onClick:o[9]||(o[9]=a=>e.cancelAddProject()),size:"small"},{default:s(()=>[ue]),_:1})])]),default:s(()=>[l(v,{model:e.addProjectDialog.form,size:"small","label-width":"70px"},{default:s(()=>[l(b,{label:"\u9879\u76EE\u540D:",required:""},{default:s(()=>[l(g,{disabled:!!e.addProjectDialog.form.id,modelValue:e.addProjectDialog.form.name,"onUpdate:modelValue":o[7]||(o[7]=a=>e.addProjectDialog.form.name=a),"auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),l(b,{label:"\u63CF\u8FF0:"},{default:s(()=>[l(g,{modelValue:e.addProjectDialog.form.remark,"onUpdate:modelValue":o[8]||(o[8]=a=>e.addProjectDialog.form.remark=a),"auto-complete":"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"]),l(f,{width:"500px",title:e.showEnvDialog.title,modelValue:e.showEnvDialog.visible,"onUpdate:modelValue":o[15]||(o[15]=a=>e.showEnvDialog.visible=a)},{default:s(()=>[l("div",me,[c(l(i,{onClick:e.showAddEnvDialog,type:"primary",icon:"el-icon-plus",size:"mini"},{default:s(()=>[pe]),_:1},8,["onClick"]),[[m,e.permissions.saveMember]])]),l(w,{border:"",data:e.showEnvDialog.envs,size:"small"},{default:s(()=>[l(d,{property:"name",label:"\u73AF\u5883\u540D",width:"125"}),l(d,{property:"remark",label:"\u63CF\u8FF0",width:"125"}),l(d,{property:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(a=>[n(k(e.$filters.dateFormat(a.row.createTime)),1)]),_:1})]),_:1},8,["data"]),l(f,{width:"400px",title:"\u6DFB\u52A0\u73AF\u5883","before-close":e.cancelAddEnv,modelValue:e.showEnvDialog.addVisible,"onUpdate:modelValue":o[14]||(o[14]=a=>e.showEnvDialog.addVisible=a)},{footer:s(()=>[l("div",ce,[c(l(i,{onClick:e.addEnv,type:"primary",loading:e.btnLoading,size:"small"},{default:s(()=>[ge]),_:1},8,["onClick","loading"]),[[m,e.permissions.saveEnv]]),l(i,{onClick:o[13]||(o[13]=a=>e.cancelAddEnv()),size:"small"},{default:s(()=>[he]),_:1})])]),default:s(()=>[l(v,{model:e.showEnvDialog.envForm,size:"small","label-width":"70px"},{default:s(()=>[l(b,{label:"\u73AF\u5883\u540D:",required:""},{default:s(()=>[l(g,{modelValue:e.showEnvDialog.envForm.name,"onUpdate:modelValue":o[11]||(o[11]=a=>e.showEnvDialog.envForm.name=a),"auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(b,{label:"\u63CF\u8FF0:"},{default:s(()=>[l(g,{modelValue:e.showEnvDialog.envForm.remark,"onUpdate:modelValue":o[12]||(o[12]=a=>e.showEnvDialog.envForm.remark=a),"auto-complete":"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"])]),_:1},8,["title","modelValue"]),l(f,{width:"500px",title:e.showMemDialog.title,modelValue:e.showMemDialog.visible,"onUpdate:modelValue":o[22]||(o[22]=a=>e.showMemDialog.visible=a)},{default:s(()=>[l("div",be,[c(l(i,{onClick:o[16]||(o[16]=a=>e.showAddMemberDialog()),type:"primary",icon:"el-icon-plus",size:"mini"},{default:s(()=>[fe]),_:1},512),[[m,e.permissions.saveMember]]),c(l(i,{onClick:e.deleteMember,disabled:e.showMemDialog.chooseId==null,type:"danger",icon:"el-icon-delete",size:"mini"},{default:s(()=>[De]),_:1},8,["onClick","disabled"]),[[m,e.permissions.delMember]])]),l(w,{onCurrentChange:e.chooseMember,border:"",data:e.showMemDialog.members.list,size:"small"},{default:s(()=>[l(d,{label:"\u9009\u62E9",width:"50px"},{default:s(a=>[l(y,{modelValue:e.showMemDialog.chooseId,"onUpdate:modelValue":o[17]||(o[17]=D=>e.showMemDialog.chooseId=D),label:a.row.id},{default:s(()=>[we]),_:2},1032,["modelValue","label"])]),_:1}),l(d,{property:"username",label:"\u8D26\u53F7",width:"125"}),l(d,{property:"createTime",label:"\u52A0\u5165\u65F6\u95F4"},{default:s(a=>[n(k(e.$filters.dateFormat(a.row.createTime)),1)]),_:1}),l(d,{property:"creator",label:"\u5206\u914D\u8005",width:"125"})]),_:1},8,["onCurrentChange","data"]),l(h,{onCurrentChange:e.setMemebers,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.showMemDialog.members.total,"current-page":e.showMemDialog.query.pageNum,"onUpdate:current-page":o[18]||(o[18]=a=>e.showMemDialog.query.pageNum=a),"page-size":e.showMemDialog.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),l(f,{width:"400px",title:"\u6DFB\u52A0\u6210\u5458","before-close":e.cancelAddMember,modelValue:e.showMemDialog.addVisible,"onUpdate:modelValue":o[21]||(o[21]=a=>e.showMemDialog.addVisible=a)},{footer:s(()=>[l("div",ve,[c(l(i,{onClick:e.addMember,type:"primary",loading:e.btnLoading,size:"small"},{default:s(()=>[je]),_:1},8,["onClick","loading"]),[[m,e.permissions.saveMember]]),l(i,{onClick:o[20]||(o[20]=a=>e.cancelAddMember()),size:"small"},{default:s(()=>[ye]),_:1})])]),default:s(()=>[l(v,{model:e.showMemDialog.memForm,size:"small","label-width":"70px"},{default:s(()=>[l(b,{label:"\u8D26\u53F7:"},{default:s(()=>[l(V,{style:{width:"100%"},remote:"","remote-method":e.getAccount,modelValue:e.showMemDialog.memForm.accountId,"onUpdate:modelValue":o[19]||(o[19]=a=>e.showMemDialog.memForm.accountId=a),filterable:"",placeholder:"\u8BF7\u9009\u62E9"},{default:s(()=>[(F(!0),P(X,null,Y(e.showMemDialog.accounts,a=>(F(),P(M,{key:a.id,label:a.username,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["remote-method","modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"])]),_:1},8,["title","modelValue"])])}B.render=Me;export default B;
