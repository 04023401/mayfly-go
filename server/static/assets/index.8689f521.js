var N=Object.defineProperty,O=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var S=(s,o,d)=>o in s?N(s,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):s[o]=d,y=(s,o)=>{for(var d in o||(o={}))G.call(o,d)&&S(s,d,o[d]);if(B)for(var d of B(o))H.call(o,d)&&S(s,d,o[d]);return s},C=(s,o)=>O(s,K(o));import{x as k,a as D,A as F,t as I,e as _,f as m,h as f,i as e,G as t,l,F as $,E as j,r as J,s as q,k as b,o as Q,P as W}from"./vendor.c08e96cf.js";import{r as V}from"./api.08881235.js";import{p as P}from"./api.7a509bb1.js";import"./Api.ab367e46.js";import"./index.ef81b75e.js";var z=k({name:"Info",props:{visible:{type:Boolean},title:{type:String},info:{type:[Boolean,Object]}},setup(s,{emit:o}){const d=D({dialogVisible:!1});F(()=>s.visible,g=>{d.dialogVisible=g});const a=()=>{o("update:visible",!1),o("close")};return C(y({},I(d)),{close:a})}}),Hs=`
.row .title {
    font-size: 12px;
    color: #8492a6;
    margin-right: 6px;
}
.row .value {
    font-size: 12px;
    color: black;
}
`;const X={class:"row"},Y=e("span",{class:"title"},"redis_version(\u7248\u672C):",-1),Z={class:"value"},x={class:"row"},ee=e("span",{class:"title"},"tcp_port(\u7AEF\u53E3):",-1),se={class:"value"},oe={class:"row"},te=e("span",{class:"title"},"redis_mode(\u6A21\u5F0F):",-1),le={class:"value"},ne={class:"row"},ie=e("span",{class:"title"},"os(\u5BBF\u4E3B\u64CD\u4F5C\u7CFB\u7EDF):",-1),ae={class:"value"},re={class:"row"},de=e("span",{class:"title"},"uptime_in_days(\u8FD0\u884C\u5929\u6570):",-1),ue={class:"value"},ce={class:"row"},_e=e("span",{class:"title"},"executable(\u53EF\u6267\u884C\u6587\u4EF6\u8DEF\u5F84):",-1),pe={class:"value"},me={class:"row"},fe=e("span",{class:"title"},"config_file(\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84):",-1),ve={class:"value"},he={class:"row"},ge=e("span",{class:"title"},"connected_clients(\u5DF2\u8FDE\u63A5\u5BA2\u6237\u7AEF\u6570):",-1),be={class:"value"},ye={class:"row"},we=e("span",{class:"title"},"blocked_clients(\u6B63\u5728\u7B49\u5F85\u963B\u585E\u547D\u4EE4\u5BA2\u6237\u7AEF\u6570):",-1),Ce={class:"value"},$e={class:"title"},je={class:"value"},Ve={class:"row"},Ee=e("span",{class:"title"},"total_commands_processed(\u603B\u5904\u7406\u547D\u4EE4\u6570):",-1),ke={class:"value"},De={class:"row"},Ie=e("span",{class:"title"},"instantaneous_ops_per_sec(\u5F53\u524Dqps):",-1),qe={class:"value"},Ue={class:"row"},Be=e("span",{class:"title"},"total_net_input_bytes(\u7F51\u7EDC\u5165\u53E3\u6D41\u91CF\u5B57\u8282\u6570):",-1),Se={class:"value"},Fe={class:"row"},Pe=e("span",{class:"title"},"total_net_output_bytes(\u7F51\u7EDC\u51FA\u53E3\u6D41\u91CF\u5B57\u8282\u6570):",-1),ze={class:"value"},Re={class:"row"},Me=e("span",{class:"title"},"expired_keys(\u8FC7\u671Fkey\u7684\u603B\u6570\u91CF):",-1),Ae={class:"value"},Te={class:"row"},Le=e("span",{class:"title"},"instantaneous_ops_per_sec(\u5F53\u524Dqps):",-1),Ne={class:"value"},Oe={class:"row"},Ke=e("span",{class:"title"},"aof_enabled(\u662F\u5426\u542F\u7528aof):",-1),Ge={class:"value"},He={class:"row"},Je=e("span",{class:"title"},"loading(\u662F\u5426\u6B63\u5728\u8F7D\u5165\u6301\u4E45\u5316\u6587\u4EF6):",-1),Qe={class:"value"},We={class:"row"},Xe=e("span",{class:"title"},"cluster_enabled(\u662F\u5426\u542F\u7528\u96C6\u7FA4\u6A21\u5F0F):",-1),Ye={class:"value"},Ze={class:"row"},xe=e("span",{class:"title"},"used_memory(\u5206\u914D\u5185\u5B58\u603B\u91CF):",-1),es={class:"value"},ss={class:"row"},os=e("span",{class:"title"},"maxmemory(\u6700\u5927\u5185\u5B58\u914D\u7F6E):",-1),ts={class:"value"},ls={class:"row"},ns=e("span",{class:"title"},"used_memory_rss(\u5DF2\u5206\u914D\u7684\u5185\u5B58\u603B\u91CF\uFF0C\u64CD\u4F5C\u7CFB\u7EDF\u89D2\u5EA6):",-1),is={class:"value"},as={class:"row"},rs=e("span",{class:"title"},"mem_fragmentation_ratio(used_memory_rss\u548Cused_memory \u4E4B\u95F4\u7684\u6BD4\u7387):",-1),ds={class:"value"},us={class:"row"},cs=e("span",{class:"title"},"used_memory_peak(\u5185\u5B58\u6D88\u8017\u5CF0\u503C):",-1),_s={class:"value"},ps={class:"row"},ms=e("span",{class:"title"},"total_system_memory(\u4E3B\u673A\u603B\u5185\u5B58):",-1),fs={class:"value"},vs={class:"row"},hs=e("span",{class:"title"},"used_cpu_sys(\u7531Redis\u670D\u52A1\u5668\u6D88\u8017\u7684\u7CFB\u7EDFCPU):",-1),gs={class:"value"},bs={class:"row"},ys=e("span",{class:"title"},"used_cpu_user(\u7531Redis\u670D\u52A1\u5668\u6D88\u8017\u7684\u7528\u6237CPU):",-1),ws={class:"value"},Cs={class:"row"},$s=e("span",{class:"title"},"used_cpu_sys_children(\u7531\u540E\u53F0\u8FDB\u7A0B\u6D88\u8017\u7684\u7CFB\u7EDFCPU):",-1),js={class:"value"},Vs={class:"row"},Es=e("span",{class:"title"},"used_cpu_user_children(\u7531\u540E\u53F0\u8FDB\u7A0B\u6D88\u8017\u7684\u7528\u6237CPU):",-1),ks={class:"value"};function Ds(s,o,d,a,g,v){const c=_("el-collapse-item"),h=_("el-collapse"),n=_("el-dialog");return m(),f("div",null,[e(n,{title:s.title,modelValue:s.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=i=>s.dialogVisible=i),"show-close":!0,width:"35%",onClose:o[2]||(o[2]=i=>s.close())},{default:t(()=>[e(h,null,{default:t(()=>[e(c,{title:"Server(Redis\u670D\u52A1\u5668\u7684\u4E00\u822C\u4FE1\u606F)",name:"server"},{default:t(()=>[e("div",X,[Y,e("span",Z,l(s.info.Server.redis_version),1)]),e("div",x,[ee,e("span",se,l(s.info.Server.tcp_port),1)]),e("div",oe,[te,e("span",le,l(s.info.Server.redis_mode),1)]),e("div",ne,[ie,e("span",ae,l(s.info.Server.os),1)]),e("div",re,[de,e("span",ue,l(s.info.Server.uptime_in_days),1)]),e("div",ce,[_e,e("span",pe,l(s.info.Server.executable),1)]),e("div",me,[fe,e("span",ve,l(s.info.Server.config_file),1)])]),_:1}),e(c,{title:"Clients(\u5BA2\u6237\u7AEF\u8FDE\u63A5)",name:"client"},{default:t(()=>[e("div",he,[ge,e("span",be,l(s.info.Clients.connected_clients),1)]),e("div",ye,[we,e("span",Ce,l(s.info.Clients.blocked_clients),1)])]),_:1}),e(c,{title:"Keyspace(key\u4FE1\u606F)",name:"keyspace"},{default:t(()=>[(m(!0),f($,null,j(s.info.Keyspace,(i,p)=>(m(),f("div",{class:"row",key:p},[e("span",$e,l(p)+": ",1),e("span",je,l(i),1)]))),128))]),_:1}),e(c,{title:"Stats(\u7EDF\u8BA1)",name:"state"},{default:t(()=>[e("div",Ve,[Ee,e("span",ke,l(s.info.Stats.total_commands_processed),1)]),e("div",De,[Ie,e("span",qe,l(s.info.Stats.instantaneous_ops_per_sec),1)]),e("div",Ue,[Be,e("span",Se,l(s.info.Stats.total_net_input_bytes),1)]),e("div",Fe,[Pe,e("span",ze,l(s.info.Stats.total_net_output_bytes),1)]),e("div",Re,[Me,e("span",Ae,l(s.info.Stats.expired_keys),1)]),e("div",Te,[Le,e("span",Ne,l(s.info.Stats.instantaneous_ops_per_sec),1)])]),_:1}),e(c,{title:"Persistence(\u6301\u4E45\u5316)",name:"persistence"},{default:t(()=>[e("div",Oe,[Ke,e("span",Ge,l(s.info.Persistence.aof_enabled),1)]),e("div",He,[Je,e("span",Qe,l(s.info.Persistence.loading),1)])]),_:1}),e(c,{title:"Cluster(\u96C6\u7FA4)",name:"cluster"},{default:t(()=>[e("div",We,[Xe,e("span",Ye,l(s.info.Cluster.cluster_enabled),1)])]),_:1}),e(c,{title:"Memory(\u5185\u5B58\u6D88\u8017\u76F8\u5173\u4FE1\u606F)",name:"memory"},{default:t(()=>[e("div",Ze,[xe,e("span",es,l(s.info.Memory.used_memory_human),1)]),e("div",ss,[os,e("span",ts,l(s.info.Memory.maxmemory),1)]),e("div",ls,[ns,e("span",is,l(s.info.Memory.used_memory_rss_human),1)]),e("div",as,[rs,e("span",ds,l(s.info.Memory.mem_fragmentation_ratio),1)]),e("div",us,[cs,e("span",_s,l(s.info.Memory.used_memory_peak_human),1)]),e("div",ps,[ms,e("span",fs,l(s.info.Memory.total_system_memory_human),1)])]),_:1}),e(c,{title:"CPU",name:"cpu"},{default:t(()=>[e("div",vs,[hs,e("span",gs,l(s.info.CPU.used_cpu_sys),1)]),e("div",bs,[ys,e("span",ws,l(s.info.CPU.used_cpu_user),1)]),e("div",Cs,[$s,e("span",js,l(s.info.CPU.used_cpu_sys_children),1)]),e("div",Vs,[Es,e("span",ks,l(s.info.CPU.used_cpu_user_children),1)])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])])}z.render=Ds;var R=k({name:"RedisEdit",props:{visible:{type:Boolean},projects:{type:Array},redis:{type:[Boolean,Object]},title:{type:String}},setup(s,{emit:o}){const d=J(null),a=D({dialogVisible:!1,projects:[],envs:[],form:{id:null,name:null,host:null,password:null,project:null,projectId:null,envId:null,env:null},btnLoading:!1,rules:{projectId:[{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE",trigger:["change","blur"]}],envId:[{required:!0,message:"\u8BF7\u9009\u62E9\u73AF\u5883",trigger:["change","blur"]}],host:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3B\u673Aip:port",trigger:["change","blur"]}],db:[{required:!0,message:"\u8BF7\u8F93\u5165\u5E93\u53F7",trigger:["change","blur"]}]}});F(s,async i=>{a.dialogVisible=i.visible,a.projects=i.projects,i.redis?(g(i.redis.projectId),a.form=y({},i.redis)):(a.envs=[],a.form={db:0})});const g=async i=>{a.envs=await P.projectEnvs.request({projectId:i})},v=i=>{for(let p of a.projects)p.id==i&&(a.form.project=p.name);a.envs=[],g(i)},c=i=>{for(let p of a.envs)p.id==i&&(a.form.env=p.name)},h=async()=>{d.value.validate(i=>{if(i)V.saveRedis.request(a.form).then(()=>{q.success("\u4FDD\u5B58\u6210\u529F"),o("val-change",a.form),a.btnLoading=!0,setTimeout(()=>{a.btnLoading=!1},1e3),n()});else return q.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},n=()=>{o("update:visible",!1),o("cancel"),setTimeout(()=>{d.value.resetFields(),a.form={}},200)};return C(y({},I(a)),{redisForm:d,changeProject:v,changeEnv:c,btnOk:h,cancel:n})}}),Js="";const Is={class:"dialog-footer"},qs=b("\u786E \u5B9A"),Us=b("\u53D6 \u6D88");function Bs(s,o,d,a,g,v){const c=_("el-option"),h=_("el-select"),n=_("el-form-item"),i=_("el-input"),p=_("el-form"),w=_("el-button"),E=_("el-dialog");return m(),f("div",null,[e(E,{title:s.title,modelValue:s.dialogVisible,"onUpdate:modelValue":o[7]||(o[7]=r=>s.dialogVisible=r),"show-close":!1,"before-close":s.cancel,width:"35%"},{footer:t(()=>[e("div",Is,[e(w,{type:"primary",loading:s.btnLoading,onClick:s.btnOk,size:"mini"},{default:t(()=>[qs]),_:1},8,["loading","onClick"]),e(w,{onClick:o[6]||(o[6]=r=>s.cancel()),size:"mini"},{default:t(()=>[Us]),_:1})])]),default:t(()=>[e(p,{model:s.form,ref:"redisForm",rules:s.rules,"label-width":"85px",size:"small"},{default:t(()=>[e(n,{prop:"projectId",label:"\u9879\u76EE:",required:""},{default:t(()=>[e(h,{style:{width:"100%"},modelValue:s.form.projectId,"onUpdate:modelValue":o[1]||(o[1]=r=>s.form.projectId=r),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",onChange:s.changeProject,filterable:""},{default:t(()=>[(m(!0),f($,null,j(s.projects,r=>(m(),f(c,{key:r.id,label:`${r.name} [${r.remark}]`,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),e(n,{prop:"envId",label:"\u73AF\u5883:",required:""},{default:t(()=>[e(h,{onChange:s.changeEnv,style:{width:"100%"},modelValue:s.form.envId,"onUpdate:modelValue":o[2]||(o[2]=r=>s.form.envId=r),placeholder:"\u8BF7\u9009\u62E9\u73AF\u5883"},{default:t(()=>[(m(!0),f($,null,j(s.envs,r=>(m(),f(c,{key:r.id,label:`${r.name} [${r.remark}]`,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["onChange","modelValue"])]),_:1}),e(n,{prop:"host",label:"host:",required:""},{default:t(()=>[e(i,{modelValue:s.form.host,"onUpdate:modelValue":o[3]||(o[3]=r=>s.form.host=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165host:port","auto-complete":"off"},null,8,["modelValue"])]),_:1}),e(n,{prop:"password",label:"\u5BC6\u7801:"},{default:t(()=>[e(i,{type:"password","show-password":"",modelValue:s.form.password,"onUpdate:modelValue":o[4]||(o[4]=r=>s.form.password=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),e(n,{prop:"db",label:"\u5E93\u53F7:",required:""},{default:t(()=>[e(i,{modelValue:s.form.db,"onUpdate:modelValue":o[5]||(o[5]=r=>s.form.db=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5E93\u53F7"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}R.render=Bs;var M=k({name:"RedisList",components:{Info:z,RedisEdit:R},setup(){const s=D({projects:[],redisTable:[],total:0,currentId:null,currentData:null,query:{pageNum:1,pageSize:10,prjectId:null,clusterId:null},redisInfo:{url:""},clusters:[{id:0,name:"\u5355\u673A"}],infoDialog:{title:"",visible:!1,info:{Server:{},Keyspace:{},Clients:{},CPU:{},Memory:{}}},redisEditDialog:{visible:!1,data:null,title:"\u65B0\u589Eredis"}});Q(async()=>{v(),s.projects=(await P.projects.request({pageNum:1,pageSize:100})).list});const o=n=>{s.query.pageNum=n,v()},d=n=>{!n||(s.currentId=n.id,s.currentData=n)},a=async()=>{try{await W.confirm("\u786E\u5B9A\u5220\u9664\u8BE5redis?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await V.delRedis.request({id:s.currentId}),q.success("\u5220\u9664\u6210\u529F"),s.currentData=null,s.currentId=null,v()}catch(n){}},g=n=>{V.redisInfo.request({id:n.id}).then(i=>{s.infoDialog.info=i,s.infoDialog.title=`'${n.host}' info`,s.infoDialog.visible=!0})},v=async()=>{const n=await V.redisList.request(s.query);s.redisTable=n.list,s.total=n.total},c=(n=!1)=>{n?(s.redisEditDialog.data=null,s.redisEditDialog.title="\u65B0\u589Eredis"):(s.redisEditDialog.data=s.currentData,s.redisEditDialog.title="\u4FEE\u6539redis"),s.redisEditDialog.visible=!0},h=()=>{v()};return C(y({},I(s)),{search:v,handlePageChange:o,choose:d,info:g,deleteRedis:a,editRedis:c,valChange:h})}}),Qs=`
`;const Ss=b("\u6DFB\u52A0"),Fs=b("\u7F16\u8F91"),Ps=b("\u5220\u9664"),zs={style:{float:"right"}},Rs=e("i",null,null,-1),Ms=b("info");function As(s,o,d,a,g,v){const c=_("el-button"),h=_("el-option"),n=_("el-select"),i=_("el-radio"),p=_("el-table-column"),w=_("el-table"),E=_("el-pagination"),r=_("el-row"),A=_("el-card"),T=_("info"),L=_("redis-edit");return m(),f("div",null,[e(A,null,{default:t(()=>[e(c,{type:"primary",icon:"el-icon-plus",size:"mini",onClick:o[1]||(o[1]=u=>s.editRedis(!0)),plain:""},{default:t(()=>[Ss]),_:1}),e(c,{type:"primary",icon:"el-icon-edit",disabled:s.currentId==null,size:"mini",onClick:o[2]||(o[2]=u=>s.editRedis(!1)),plain:""},{default:t(()=>[Fs]),_:1},8,["disabled"]),e(c,{type:"danger",icon:"el-icon-delete",disabled:s.currentId==null,size:"mini",onClick:s.deleteRedis,plain:""},{default:t(()=>[Ps]),_:1},8,["disabled","onClick"]),e("div",zs,[e(n,{modelValue:s.query.projectId,"onUpdate:modelValue":o[3]||(o[3]=u=>s.query.projectId=u),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",filterable:"",clearable:"",size:"small"},{default:t(()=>[(m(!0),f($,null,j(s.projects,u=>(m(),f(h,{key:u.id,label:`${u.name} [${u.remark}]`,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(c,{class:"ml5",onClick:s.search,type:"success",icon:"el-icon-search",size:"small"},null,8,["onClick"])]),e(w,{data:s.redisTable,style:{width:"100%"},onCurrentChange:s.choose},{default:t(()=>[e(p,{label:"\u9009\u62E9",width:"50px"},{default:t(u=>[e(i,{modelValue:s.currentId,"onUpdate:modelValue":o[4]||(o[4]=U=>s.currentId=U),label:u.row.id},{default:t(()=>[Rs]),_:2},1032,["modelValue","label"])]),_:1}),e(p,{prop:"project",label:"\u9879\u76EE",width:""}),e(p,{prop:"env",label:"\u73AF\u5883",width:""}),e(p,{prop:"host",label:"host:port",width:""}),e(p,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:t(u=>[b(l(s.$filters.dateFormat(u.row.createTime)),1)]),_:1}),e(p,{prop:"creator",label:"\u521B\u5EFA\u4EBA"}),e(p,{label:"\u64CD\u4F5C",width:""},{default:t(u=>[e(c,{type:"primary",onClick:U=>s.info(u.row),icon:"el-icon-tickets",size:"mini",plain:""},{default:t(()=>[Ms]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),e(r,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:t(()=>[e(E,{style:{"text-align":"right"},onCurrentChange:s.handlePageChange,total:s.total,layout:"prev, pager, next, total, jumper","current-page":s.query.pageNum,"onUpdate:current-page":o[5]||(o[5]=u=>s.query.pageNum=u),"page-size":s.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),e(T,{visible:s.infoDialog.visible,"onUpdate:visible":o[6]||(o[6]=u=>s.infoDialog.visible=u),title:s.infoDialog.title,info:s.infoDialog.info},null,8,["visible","title","info"]),e(L,{onValChange:s.valChange,projects:s.projects,title:s.redisEditDialog.title,visible:s.redisEditDialog.visible,"onUpdate:visible":o[7]||(o[7]=u=>s.redisEditDialog.visible=u),redis:s.redisEditDialog.data,"onUpdate:redis":o[8]||(o[8]=u=>s.redisEditDialog.data=u)},null,8,["onValChange","projects","title","visible","redis"])])}M.render=As;export default M;
