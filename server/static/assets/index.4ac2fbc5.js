var Q=Object.defineProperty,J=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var L=(e,o,s)=>o in e?Q(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,k=(e,o)=>{for(var s in o||(o={}))X.call(o,s)&&L(e,s,o[s]);if(A)for(var s of A(o))Y.call(o,s)&&L(e,s,o[s]);return e},E=(e,o)=>J(e,W(o));import{a as w,r as Z}from"./api.2b4fbbc6.js";import{x as V,a as F,A as S,t as I,e as u,f as _,h as C,i as l,G as n,k as h,r as x,s as B,l as $,D as T,P as N,g as ee,j as M,o as oe,Q as le,w as q}from"./vendor.c08e96cf.js";import{e as O}from"./enums.a05a011e.js";import"./Api.ab367e46.js";import"./index.ef81b75e.js";import"./Enum.2b540114.js";var P=V({name:"RoleEdit",props:{visible:{type:Boolean},data:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const s=F({visible:!1,form:{id:null,name:"",status:1,remark:""},btnLoading:!1});S(e,m=>{s.visible=m.visible,m.data?s.form=k({},m.data):s.form={}});const p=()=>{o("update:visible",!1),o("cancel")},b=async()=>{await w.save.request(s.form),o("val-change",s.form),p(),s.btnLoading=!0,setTimeout(()=>{s.btnLoading=!1},1e3)};return E(k({},I(s)),{btnOk:b,cancel:p})}}),Se="";const se={class:"role-dialog"},te={class:"dialog-footer"},ae=h("\u786E \u5B9A"),ne=h("\u53D6 \u6D88");function ie(e,o,s,p,b,m){const r=u("el-input"),f=u("el-form-item"),d=u("el-form"),t=u("el-button"),c=u("el-dialog");return _(),C("div",se,[l(c,{title:e.title,modelValue:e.visible,"onUpdate:modelValue":o[5]||(o[5]=g=>e.visible=g),"show-close":!1,"before-close":e.cancel,width:"500px"},{footer:n(()=>[l("div",te,[l(t,{type:"primary",loading:e.btnLoading,onClick:e.btnOk,size:"small"},{default:n(()=>[ae]),_:1},8,["loading","onClick"]),l(t,{onClick:o[4]||(o[4]=g=>e.cancel()),size:"small"},{default:n(()=>[ne]),_:1})])]),default:n(()=>[l(d,{model:e.form,size:"small","label-width":"90px"},{default:n(()=>[l(f,{label:"\u89D2\u8272\u540D\u79F0:",required:""},{default:n(()=>[l(r,{modelValue:e.form.name,"onUpdate:modelValue":o[1]||(o[1]=g=>e.form.name=g),"auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(f,{label:"\u89D2\u8272code:",required:""},{default:n(()=>[l(r,{disabled:e.form.id,modelValue:e.form.code,"onUpdate:modelValue":o[2]||(o[2]=g=>e.form.code=g),placeholder:"COMMON\u5F00\u5934\u5219\u4E3A\u6240\u6709\u8D26\u53F7\u5171\u6709\u89D2\u8272","auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),l(f,{label:"\u89D2\u8272\u63CF\u8FF0:"},{default:n(()=>[l(r,{modelValue:e.form.remark,"onUpdate:modelValue":o[3]||(o[3]=g=>e.form.remark=g),type:"textarea",rows:3,placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u63CF\u8FF0"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue","before-close"])])}P.render=ie;var K=V({name:"ResourceEdit",props:{visible:{type:Boolean},title:{type:String},role:{type:Object},defaultCheckedKeys:{type:Array},resources:{type:Array}},setup(e,{emit:o}){const s=x(null),p=F({dialogVisible:!1,defaultProps:{children:"children",label:"name"}});S(()=>e.visible,d=>{p.dialogVisible=d});const b=d=>{let t=[];for(let c of d)m(c,t);return t},m=(d,t)=>{if(d.children!==null)for(let c of d.children)m(c,t);else t.push(d.id)},r=async()=>{let d=s.value.getCheckedKeys(),t=s.value.getHalfCheckedKeys(),c=[].concat(d,t).join(",");await w.saveResources.request({id:e.role.id,resourceIds:c}),B.success("\u4FDD\u5B58\u6210\u529F!"),o("cancel")},f=()=>{o("update:visible",!1),setTimeout(()=>{o("cancel")},700)};return E(k({},I(p)),{enums:O,menuTree:s,btnOk:r,getAllLeafIds:b,cancel:f})}}),Be=`
`;const re={class:"custom-tree-node"},ue={key:0},de={key:1,style:{color:"#67c23a"}},ce={class:"dialog-footer"},pe=h("\u786E \u5B9A"),me=h("\u53D6 \u6D88");function fe(e,o,s,p,b,m){const r=u("el-tree"),f=u("el-button"),d=u("el-dialog");return _(),C("div",null,[l(d,{title:"\u5206\u914D\u201C"+e.role.name+"\u201D\u83DC\u5355&\u6743\u9650",modelValue:e.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=t=>e.dialogVisible=t),"before-close":e.cancel,"show-close":!1,width:"400px"},{footer:n(()=>[l("div",ce,[l(f,{type:"primary",onClick:e.btnOk,size:"small"},{default:n(()=>[pe]),_:1},8,["onClick"]),l(f,{onClick:e.cancel,size:"small"},{default:n(()=>[me]),_:1},8,["onClick"])])]),default:n(()=>[l(r,{style:{height:"50vh",overflow:"auto"},ref:"menuTree",data:e.resources,"show-checkbox":"","node-key":"id","default-checked-keys":e.defaultCheckedKeys,props:e.defaultProps},{default:n(({node:t,data:c})=>[l("span",re,[c.type==e.enums.ResourceTypeEnum.MENU.value?(_(),C("span",ue,$(t.label),1)):T("",!0),c.type==e.enums.ResourceTypeEnum.PERMISSION.value?(_(),C("span",de,$(t.label),1)):T("",!0)])]),_:1},8,["data","default-checked-keys","props"])]),_:1},8,["title","modelValue","before-close"])])}K.render=fe;var H=V({name:"ShowResource",props:{visible:{type:Boolean},resources:{type:Array},title:{type:String}},setup(e,{emit:o}){const{proxy:s}=ee(),p=F({dialogVisible:!1,defaultProps:{children:"children",label:"name"}});S(()=>e.visible,r=>{p.dialogVisible=r});const b=r=>{N.alert('<strong style="margin-right: 18px">\u8D44\u6E90\u540D\u79F0:</strong>'+r.name+' <br/><strong style="margin-right: 18px">\u5206\u914D\u8D26\u53F7:</strong>'+r.creator+' <br/><strong style="margin-right: 18px">\u5206\u914D\u65F6\u95F4:</strong>'+s.$filters.dateFormat(r.createTime)+"","\u5206\u914D\u4FE1\u606F",{type:"info",dangerouslyUseHTMLString:!0,closeOnClickModal:!0,showConfirmButton:!1}).catch(()=>{})},m=()=>{o("update:visible",!1),o("update:resources",[])};return E(k({},I(p)),{enums:O,info:b,closeDialog:m})}}),je=`
`;const ge={class:"custom-tree-node"},be={key:0},he={key:1,style:{color:"#67c23a"}};function ye(e,o,s,p,b,m){const r=u("el-link"),f=u("el-tree"),d=u("el-dialog");return _(),C("div",null,[l(d,{onClose:e.closeDialog,title:e.title,"before-close":e.closeDialog,modelValue:e.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=t=>e.dialogVisible=t),width:"400px"},{default:n(()=>[l(f,{style:{height:"50vh",overflow:"auto"},data:e.resources,"node-key":"id",props:e.defaultProps,"expand-on-click-node":!1},{default:n(({node:t,data:c})=>[l("span",ge,[c.type==e.enums.ResourceTypeEnum.MENU.value?(_(),C("span",be,$(t.label),1)):T("",!0),c.type==e.enums.ResourceTypeEnum.PERMISSION.value?(_(),C("span",he,$(t.label),1)):T("",!0),l(r,{onClick:M(g=>e.info(c),["prevent"]),style:{"margin-left":"25px"},icon:"el-icon-view",type:"info",underline:!1},null,8,["onClick"])])]),_:1},8,["data","props"])]),_:1},8,["onClose","title","before-close","modelValue"])])}H.render=ye;var G=V({name:"RoleList",components:{RoleEdit:P,ResourceEdit:K,ShowResource:H},setup(){const e=F({dialogFormVisible:!1,currentEditPermissions:!1,query:{pageNum:1,pageSize:10,name:null},total:0,roles:[],chooseId:null,chooseData:null,resourceDialog:{visible:!1,role:{},resources:[],defaultCheckedKeys:[]},roleEdit:{title:"\u89D2\u8272\u7F16\u8F91",visible:!1,role:{}},showResourceDialog:{visible:!1,resources:[],title:""}});oe(()=>{o()});const o=async()=>{let a=await w.list.request(e.query);e.roles=a.list,e.total=a.total},s=a=>{e.query.pageNum=a,o()},p=a=>{!a||(e.chooseId=a.id,e.chooseData=a)},b=()=>{B.success("\u4FEE\u6539\u6210\u529F\uFF01"),o()},m=a=>{a?e.roleEdit.role=a:e.roleEdit.role=!1,e.roleEdit.visible=!0},r=async a=>{try{await N.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${a.name}] \u8BE5\u89D2\u8272\uFF0C\u4EE5\u53CA\u4E0E\u8BE5\u89D2\u8272\u6709\u5173\u7684\u8D26\u53F7\u89D2\u8272\u5173\u8054\u4FE1\u606F\u548C\u8D44\u6E90\u89D2\u8272\u5173\u8054\u4FE1\u606F, \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await w.del.request({id:a.id}),B.success("\u5220\u9664\u6210\u529F\uFF01"),o()}catch(y){}},f=async a=>{e.showResourceDialog.resources=await w.roleResources.request({id:a.id}),e.showResourceDialog.title='"'+a.name+'"\u7684\u83DC\u5355&\u6743\u9650',e.showResourceDialog.visible=!0},d=()=>{e.showResourceDialog.visible=!1,e.showResourceDialog.resources=[]},t=async a=>{let y=await Z.list.request(null);e.resourceDialog.resources=y;let v=await w.roleResourceIds.request({id:a.id}),z=v||[],R=[],D=c(e.resourceDialog.resources);for(let i of D)z.includes(i)&&R.push(i);e.resourceDialog.defaultCheckedKeys=R,e.resourceDialog.visible=!0,e.resourceDialog.role=a},c=a=>{let y=[];for(let v of a)g(v,y);return y},g=(a,y)=>{if(a.children!==null)for(let v of a.children)g(v,y);else y.push(a.id)},U=()=>{e.resourceDialog.visible=!1,setTimeout(()=>{e.resourceDialog.role={},e.resourceDialog.defaultCheckedKeys=[]},10)};return E(k({},I(e)),{search:o,handlePageChange:s,choose:p,roleEditChange:b,editRole:m,deleteRole:r,showResources:f,closeShowResourceDialog:d,editResource:t,cancelEditResources:U})}}),Ae="";const ve={class:"role-list"},_e=h("\u6DFB\u52A0"),Ce=h("\u7F16\u8F91"),De=h("\u5206\u914D\u83DC\u5355&\u6743\u9650"),ke=h("\u5220\u9664"),we={style:{float:"right"}},$e=l("i",null,null,-1),Ee=h("\u83DC\u5355&\u6743\u9650");function Re(e,o,s,p,b,m){const r=u("el-button"),f=u("el-input"),d=u("el-radio"),t=u("el-table-column"),c=u("el-link"),g=u("el-table"),U=u("el-pagination"),a=u("el-row"),y=u("el-card"),v=u("role-edit"),z=u("resource-edit"),R=u("show-resource"),D=le("auth");return _(),C("div",ve,[l(y,null,{default:n(()=>[q(l(r,{type:"primary",icon:"el-icon-plus",size:"mini",onClick:o[1]||(o[1]=i=>e.editRole(!1))},{default:n(()=>[_e]),_:1},512),[[D,"role:add"]]),q(l(r,{disabled:e.chooseId==null,onClick:o[2]||(o[2]=i=>e.editRole(e.chooseData)),type:"primary",icon:"el-icon-edit",size:"mini"},{default:n(()=>[Ce]),_:1},8,["disabled"]),[[D,"role:update"]]),q(l(r,{disabled:e.chooseId==null,onClick:o[3]||(o[3]=i=>e.editResource(e.chooseData)),type:"success",icon:"el-icon-setting",size:"mini"},{default:n(()=>[De]),_:1},8,["disabled"]),[[D,"role:saveResources"]]),q(l(r,{disabled:e.chooseId==null,onClick:o[4]||(o[4]=i=>e.deleteRole(e.chooseData)),type:"danger",icon:"el-icon-delete",size:"mini"},{default:n(()=>[ke]),_:1},8,["disabled"]),[[D,"role:del"]]),l("div",we,[l(f,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0\uFF01",class:"mr2",size:"small",style:{width:"300px"},modelValue:e.query.name,"onUpdate:modelValue":o[5]||(o[5]=i=>e.query.name=i),onClear:e.search,clearable:""},null,8,["modelValue","onClear"]),l(r,{onClick:e.search,type:"success",icon:"el-icon-search",size:"small"},null,8,["onClick"])]),l(g,{data:e.roles,onCurrentChange:e.choose,ref:"table",style:{width:"100%"}},{default:n(()=>[l(t,{label:"\u9009\u62E9",width:"50px"},{default:n(i=>[l(d,{modelValue:e.chooseId,"onUpdate:modelValue":o[6]||(o[6]=j=>e.chooseId=j),label:i.row.id},{default:n(()=>[$e]),_:2},1032,["modelValue","label"])]),_:1}),l(t,{prop:"name",label:"\u89D2\u8272\u540D\u79F0"}),l(t,{prop:"code",label:"\u89D2\u8272code"}),l(t,{prop:"remark",label:"\u63CF\u8FF0","min-width":"180px","show-overflow-tooltip":""}),l(t,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:n(i=>[h($(e.$filters.dateFormat(i.row.createTime)),1)]),_:1}),l(t,{prop:"updateTime",label:"\u4FEE\u6539\u65F6\u95F4"},{default:n(i=>[h($(e.$filters.dateFormat(i.row.updateTime)),1)]),_:1}),l(t,{label:"\u67E5\u770B\u66F4\u591A","min-width":"80px"},{default:n(i=>[l(c,{onClick:M(j=>e.showResources(i.row),["prevent"]),type:"info"},{default:n(()=>[Ee]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),l(a,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:n(()=>[l(U,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":o[7]||(o[7]=i=>e.query.pageNum=i),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),l(v,{title:e.roleEdit.title,visible:e.roleEdit.visible,"onUpdate:visible":o[8]||(o[8]=i=>e.roleEdit.visible=i),data:e.roleEdit.role,onValChange:e.roleEditChange},null,8,["title","visible","data","onValChange"]),l(z,{visible:e.resourceDialog.visible,"onUpdate:visible":o[9]||(o[9]=i=>e.resourceDialog.visible=i),role:e.resourceDialog.role,resources:e.resourceDialog.resources,defaultCheckedKeys:e.resourceDialog.defaultCheckedKeys,onCancel:o[10]||(o[10]=i=>e.cancelEditResources())},null,8,["visible","role","resources","defaultCheckedKeys"]),l(R,{visible:e.showResourceDialog.visible,"onUpdate:visible":o[11]||(o[11]=i=>e.showResourceDialog.visible=i),title:e.showResourceDialog.title,resources:e.showResourceDialog.resources,"onUpdate:resources":o[12]||(o[12]=i=>e.showResourceDialog.resources=i)},null,8,["visible","title","resources"])])}G.render=Re;export default G;
