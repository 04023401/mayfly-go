var T=Object.defineProperty,L=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var S=(s,o,d)=>o in s?T(s,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):s[o]=d,y=(s,o)=>{for(var d in o||(o={}))O.call(o,d)&&S(s,d,o[d]);if(B)for(var d of B(o))K.call(o,d)&&S(s,d,o[d]);return s},C=(s,o)=>L(s,N(o));import{x as E,a as D,A as F,t as I,e as p,f as m,h as f,i as e,G as t,l,F as $,E as j,r as G,s as q,k as b,o as H,P as J}from"./vendor.c08e96cf.js";import{r as V}from"./api.c6363ffb.js";import{p as P}from"./api.b589497a.js";import"./Api.7190d43f.js";import"./index.01696ebf.js";var z=E({name:"Info",props:{visible:{type:Boolean},title:{type:String},info:{type:[Boolean,Object]}},setup(s,{emit:o}){const d=D({dialogVisible:!1});F(()=>s.visible,g=>{d.dialogVisible=g});const a=()=>{o("update:visible",!1),o("close")};return C(y({},I(d)),{close:a})}}),Gs=`
.row .title {
    font-size: 12px;
    color: #8492a6;
    margin-right: 6px;
}
.row .value {
    font-size: 12px;
    color: black;
}
`;const Q={class:"row"},W=e("span",{class:"title"},"redis_version(\u7248\u672C):",-1),X={class:"value"},Y={class:"row"},Z=e("span",{class:"title"},"tcp_port(\u7AEF\u53E3):",-1),x={class:"value"},ee={class:"row"},se=e("span",{class:"title"},"redis_mode(\u6A21\u5F0F):",-1),oe={class:"value"},te={class:"row"},le=e("span",{class:"title"},"os(\u5BBF\u4E3B\u64CD\u4F5C\u7CFB\u7EDF):",-1),ne={class:"value"},ie={class:"row"},ae=e("span",{class:"title"},"uptime_in_days(\u8FD0\u884C\u5929\u6570):",-1),re={class:"value"},de={class:"row"},ue=e("span",{class:"title"},"executable(\u53EF\u6267\u884C\u6587\u4EF6\u8DEF\u5F84):",-1),ce={class:"value"},pe={class:"row"},_e=e("span",{class:"title"},"config_file(\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84):",-1),me={class:"value"},fe={class:"row"},ve=e("span",{class:"title"},"connected_clients(\u5DF2\u8FDE\u63A5\u5BA2\u6237\u7AEF\u6570):",-1),he={class:"value"},ge={class:"row"},be=e("span",{class:"title"},"blocked_clients(\u6B63\u5728\u7B49\u5F85\u963B\u585E\u547D\u4EE4\u5BA2\u6237\u7AEF\u6570):",-1),ye={class:"value"},we={class:"title"},Ce={class:"value"},$e={class:"row"},je=e("span",{class:"title"},"total_commands_processed(\u603B\u5904\u7406\u547D\u4EE4\u6570):",-1),Ve={class:"value"},ke={class:"row"},Ee=e("span",{class:"title"},"instantaneous_ops_per_sec(\u5F53\u524Dqps):",-1),De={class:"value"},Ie={class:"row"},qe=e("span",{class:"title"},"total_net_input_bytes(\u7F51\u7EDC\u5165\u53E3\u6D41\u91CF\u5B57\u8282\u6570):",-1),Ue={class:"value"},Be={class:"row"},Se=e("span",{class:"title"},"total_net_output_bytes(\u7F51\u7EDC\u51FA\u53E3\u6D41\u91CF\u5B57\u8282\u6570):",-1),Fe={class:"value"},Pe={class:"row"},ze=e("span",{class:"title"},"expired_keys(\u8FC7\u671Fkey\u7684\u603B\u6570\u91CF):",-1),Re={class:"value"},Me={class:"row"},Ae=e("span",{class:"title"},"instantaneous_ops_per_sec(\u5F53\u524Dqps):",-1),Te={class:"value"},Le={class:"row"},Ne=e("span",{class:"title"},"aof_enabled(\u662F\u5426\u542F\u7528aof):",-1),Oe={class:"value"},Ke={class:"row"},Ge=e("span",{class:"title"},"loading(\u662F\u5426\u6B63\u5728\u8F7D\u5165\u6301\u4E45\u5316\u6587\u4EF6):",-1),He={class:"value"},Je={class:"row"},Qe=e("span",{class:"title"},"cluster_enabled(\u662F\u5426\u542F\u7528\u96C6\u7FA4\u6A21\u5F0F):",-1),We={class:"value"},Xe={class:"row"},Ye=e("span",{class:"title"},"used_memory(\u5206\u914D\u5185\u5B58\u603B\u91CF):",-1),Ze={class:"value"},xe={class:"row"},es=e("span",{class:"title"},"maxmemory(\u6700\u5927\u5185\u5B58\u914D\u7F6E):",-1),ss={class:"value"},os={class:"row"},ts=e("span",{class:"title"},"used_memory_rss(\u5DF2\u5206\u914D\u7684\u5185\u5B58\u603B\u91CF\uFF0C\u64CD\u4F5C\u7CFB\u7EDF\u89D2\u5EA6):",-1),ls={class:"value"},ns={class:"row"},is=e("span",{class:"title"},"mem_fragmentation_ratio(used_memory_rss\u548Cused_memory \u4E4B\u95F4\u7684\u6BD4\u7387):",-1),as={class:"value"},rs={class:"row"},ds=e("span",{class:"title"},"used_memory_peak(\u5185\u5B58\u6D88\u8017\u5CF0\u503C):",-1),us={class:"value"},cs={class:"row"},ps=e("span",{class:"title"},"total_system_memory(\u4E3B\u673A\u603B\u5185\u5B58):",-1),_s={class:"value"},ms={class:"row"},fs=e("span",{class:"title"},"used_cpu_sys(\u7531Redis\u670D\u52A1\u5668\u6D88\u8017\u7684\u7CFB\u7EDFCPU):",-1),vs={class:"value"},hs={class:"row"},gs=e("span",{class:"title"},"used_cpu_user(\u7531Redis\u670D\u52A1\u5668\u6D88\u8017\u7684\u7528\u6237CPU):",-1),bs={class:"value"},ys={class:"row"},ws=e("span",{class:"title"},"used_cpu_sys_children(\u7531\u540E\u53F0\u8FDB\u7A0B\u6D88\u8017\u7684\u7CFB\u7EDFCPU):",-1),Cs={class:"value"},$s={class:"row"},js=e("span",{class:"title"},"used_cpu_user_children(\u7531\u540E\u53F0\u8FDB\u7A0B\u6D88\u8017\u7684\u7528\u6237CPU):",-1),Vs={class:"value"};function ks(s,o,d,a,g,v){const c=p("el-collapse-item"),h=p("el-collapse"),n=p("el-dialog");return m(),f("div",null,[e(n,{title:s.title,modelValue:s.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=i=>s.dialogVisible=i),"show-close":!0,width:"35%",onClose:o[2]||(o[2]=i=>s.close())},{default:t(()=>[e(h,null,{default:t(()=>[e(c,{title:"Server(Redis\u670D\u52A1\u5668\u7684\u4E00\u822C\u4FE1\u606F)",name:"server"},{default:t(()=>[e("div",Q,[W,e("span",X,l(s.info.Server.redis_version),1)]),e("div",Y,[Z,e("span",x,l(s.info.Server.tcp_port),1)]),e("div",ee,[se,e("span",oe,l(s.info.Server.redis_mode),1)]),e("div",te,[le,e("span",ne,l(s.info.Server.os),1)]),e("div",ie,[ae,e("span",re,l(s.info.Server.uptime_in_days),1)]),e("div",de,[ue,e("span",ce,l(s.info.Server.executable),1)]),e("div",pe,[_e,e("span",me,l(s.info.Server.config_file),1)])]),_:1}),e(c,{title:"Clients(\u5BA2\u6237\u7AEF\u8FDE\u63A5)",name:"client"},{default:t(()=>[e("div",fe,[ve,e("span",he,l(s.info.Clients.connected_clients),1)]),e("div",ge,[be,e("span",ye,l(s.info.Clients.blocked_clients),1)])]),_:1}),e(c,{title:"Keyspace(key\u4FE1\u606F)",name:"keyspace"},{default:t(()=>[(m(!0),f($,null,j(s.info.Keyspace,(i,_)=>(m(),f("div",{class:"row",key:_},[e("span",we,l(_)+": ",1),e("span",Ce,l(i),1)]))),128))]),_:1}),e(c,{title:"Stats(\u7EDF\u8BA1)",name:"state"},{default:t(()=>[e("div",$e,[je,e("span",Ve,l(s.info.Stats.total_commands_processed),1)]),e("div",ke,[Ee,e("span",De,l(s.info.Stats.instantaneous_ops_per_sec),1)]),e("div",Ie,[qe,e("span",Ue,l(s.info.Stats.total_net_input_bytes),1)]),e("div",Be,[Se,e("span",Fe,l(s.info.Stats.total_net_output_bytes),1)]),e("div",Pe,[ze,e("span",Re,l(s.info.Stats.expired_keys),1)]),e("div",Me,[Ae,e("span",Te,l(s.info.Stats.instantaneous_ops_per_sec),1)])]),_:1}),e(c,{title:"Persistence(\u6301\u4E45\u5316)",name:"persistence"},{default:t(()=>[e("div",Le,[Ne,e("span",Oe,l(s.info.Persistence.aof_enabled),1)]),e("div",Ke,[Ge,e("span",He,l(s.info.Persistence.loading),1)])]),_:1}),e(c,{title:"Cluster(\u96C6\u7FA4)",name:"cluster"},{default:t(()=>[e("div",Je,[Qe,e("span",We,l(s.info.Cluster.cluster_enabled),1)])]),_:1}),e(c,{title:"Memory(\u5185\u5B58\u6D88\u8017\u76F8\u5173\u4FE1\u606F)",name:"memory"},{default:t(()=>[e("div",Xe,[Ye,e("span",Ze,l(s.info.Memory.used_memory_human),1)]),e("div",xe,[es,e("span",ss,l(s.info.Memory.maxmemory),1)]),e("div",os,[ts,e("span",ls,l(s.info.Memory.used_memory_rss_human),1)]),e("div",ns,[is,e("span",as,l(s.info.Memory.mem_fragmentation_ratio),1)]),e("div",rs,[ds,e("span",us,l(s.info.Memory.used_memory_peak_human),1)]),e("div",cs,[ps,e("span",_s,l(s.info.Memory.total_system_memory_human),1)])]),_:1}),e(c,{title:"CPU",name:"cpu"},{default:t(()=>[e("div",ms,[fs,e("span",vs,l(s.info.CPU.used_cpu_sys),1)]),e("div",hs,[gs,e("span",bs,l(s.info.CPU.used_cpu_user),1)]),e("div",ys,[ws,e("span",Cs,l(s.info.CPU.used_cpu_sys_children),1)]),e("div",$s,[js,e("span",Vs,l(s.info.CPU.used_cpu_user_children),1)])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])])}z.render=ks;var R=E({name:"RedisEdit",props:{visible:{type:Boolean},projects:{type:Array},redis:{type:[Boolean,Object]},title:{type:String}},setup(s,{emit:o}){const d=G(null),a=D({dialogVisible:!1,projects:[],envs:[],form:{id:null,name:null,host:null,password:null,project:null,projectId:null,envId:null,env:null},btnLoading:!1,rules:{projectId:[{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE",trigger:["change","blur"]}],envId:[{required:!0,message:"\u8BF7\u9009\u62E9\u73AF\u5883",trigger:["change","blur"]}],host:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3B\u673Aip:port",trigger:["change","blur"]}],db:[{required:!0,message:"\u8BF7\u8F93\u5165\u5E93\u53F7",trigger:["change","blur"]}]}});F(s,async i=>{a.dialogVisible=i.visible,a.projects=i.projects,i.redis?(g(i.redis.projectId),a.form=y({},i.redis)):(a.envs=[],a.form={db:0})});const g=async i=>{a.envs=await P.projectEnvs.request({projectId:i})},v=i=>{for(let _ of a.projects)_.id==i&&(a.form.project=_.name);a.envs=[],g(i)},c=i=>{for(let _ of a.envs)_.id==i&&(a.form.env=_.name)},h=async()=>{d.value.validate(i=>{if(i)V.saveRedis.request(a.form).then(()=>{q.success("\u4FDD\u5B58\u6210\u529F"),o("val-change",a.form),a.btnLoading=!0,setTimeout(()=>{a.btnLoading=!1},1e3),n()});else return q.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},n=()=>{o("update:visible",!1),o("cancel"),setTimeout(()=>{d.value.resetFields(),a.form={}},200)};return C(y({},I(a)),{redisForm:d,changeProject:v,changeEnv:c,btnOk:h,cancel:n})}}),Hs="";const Es={class:"dialog-footer"},Ds=b("\u786E \u5B9A"),Is=b("\u53D6 \u6D88");function qs(s,o,d,a,g,v){const c=p("el-option"),h=p("el-select"),n=p("el-form-item"),i=p("el-input"),_=p("el-form"),w=p("el-button"),k=p("el-dialog");return m(),f("div",null,[e(k,{title:s.title,modelValue:s.dialogVisible,"onUpdate:modelValue":o[7]||(o[7]=r=>s.dialogVisible=r),"show-close":!1,"before-close":s.cancel,width:"35%"},{footer:t(()=>[e("div",Es,[e(w,{type:"primary",loading:s.btnLoading,onClick:s.btnOk,size:"mini"},{default:t(()=>[Ds]),_:1},8,["loading","onClick"]),e(w,{onClick:o[6]||(o[6]=r=>s.cancel()),size:"mini"},{default:t(()=>[Is]),_:1})])]),default:t(()=>[e(_,{model:s.form,ref:"redisForm",rules:s.rules,"label-width":"85px",size:"small"},{default:t(()=>[e(n,{prop:"projectId",label:"\u9879\u76EE:",required:""},{default:t(()=>[e(h,{style:{width:"100%"},modelValue:s.form.projectId,"onUpdate:modelValue":o[1]||(o[1]=r=>s.form.projectId=r),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",onChange:s.changeProject,filterable:""},{default:t(()=>[(m(!0),f($,null,j(s.projects,r=>(m(),f(c,{key:r.id,label:`${r.name} [${r.remark}]`,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),e(n,{prop:"envId",label:"\u73AF\u5883:",required:""},{default:t(()=>[e(h,{onChange:s.changeEnv,style:{width:"100%"},modelValue:s.form.envId,"onUpdate:modelValue":o[2]||(o[2]=r=>s.form.envId=r),placeholder:"\u8BF7\u9009\u62E9\u73AF\u5883"},{default:t(()=>[(m(!0),f($,null,j(s.envs,r=>(m(),f(c,{key:r.id,label:`${r.name} [${r.remark}]`,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["onChange","modelValue"])]),_:1}),e(n,{prop:"host",label:"host:",required:""},{default:t(()=>[e(i,{modelValue:s.form.host,"onUpdate:modelValue":o[3]||(o[3]=r=>s.form.host=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165host:port","auto-complete":"off"},null,8,["modelValue"])]),_:1}),e(n,{prop:"password",label:"\u5BC6\u7801:"},{default:t(()=>[e(i,{type:"password","show-password":"",modelValue:s.form.password,"onUpdate:modelValue":o[4]||(o[4]=r=>s.form.password=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),e(n,{prop:"db",label:"\u5E93\u53F7:",required:""},{default:t(()=>[e(i,{modelValue:s.form.db,"onUpdate:modelValue":o[5]||(o[5]=r=>s.form.db=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5E93\u53F7"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}R.render=qs;var M=E({name:"RedisList",components:{Info:z,RedisEdit:R},setup(){const s=D({projects:[],redisTable:[],total:0,currentId:null,currentData:null,query:{pageNum:1,pageSize:10,prjectId:null,clusterId:null},redisInfo:{url:""},clusters:[{id:0,name:"\u5355\u673A"}],infoDialog:{title:"",visible:!1,info:{Server:{},Keyspace:{},Clients:{},CPU:{},Memory:{}}},redisEditDialog:{visible:!1,data:null,title:"\u65B0\u589Eredis"}});H(async()=>{v(),s.projects=(await P.projects.request({pageNum:1,pageSize:100})).list});const o=n=>{s.query.pageNum=n,v()},d=n=>{!n||(s.currentId=n.id,s.currentData=n)},a=async()=>{try{await J.confirm("\u786E\u5B9A\u5220\u9664\u8BE5redis?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await V.delRedis.request({id:s.currentId}),q.success("\u5220\u9664\u6210\u529F"),s.currentData=null,s.currentId=null,v()}catch(n){}},g=n=>{V.redisInfo.request({id:n.id}).then(i=>{s.infoDialog.info=i,s.infoDialog.title=`'${n.host}' info`,s.infoDialog.visible=!0})},v=async()=>{const n=await V.redisList.request(s.query);s.redisTable=n.list,s.total=n.total},c=(n=!1)=>{n?(s.redisEditDialog.data=null,s.redisEditDialog.title="\u65B0\u589Eredis"):(s.redisEditDialog.data=s.currentData,s.redisEditDialog.title="\u4FEE\u6539redis"),s.redisEditDialog.visible=!0},h=()=>{v()};return C(y({},I(s)),{search:v,handlePageChange:o,choose:d,info:g,deleteRedis:a,editRedis:c,valChange:h})}}),Js=`
`;const Us={class:"toolbar"},Bs=b("\u6DFB\u52A0"),Ss=b("\u7F16\u8F91"),Fs=b("\u5220\u9664"),Ps={style:{float:"right"}},zs=e("i",null,null,-1),Rs=b("info");function Ms(s,o,d,a,g,v){const c=p("el-button"),h=p("el-option"),n=p("el-select"),i=p("el-radio"),_=p("el-table-column"),w=p("el-table"),k=p("el-pagination"),r=p("info"),A=p("redis-edit");return m(),f("div",null,[e("div",Us,[e(c,{type:"primary",icon:"el-icon-plus",size:"mini",onClick:o[1]||(o[1]=u=>s.editRedis(!0)),plain:""},{default:t(()=>[Bs]),_:1}),e(c,{type:"primary",icon:"el-icon-edit",disabled:s.currentId==null,size:"mini",onClick:o[2]||(o[2]=u=>s.editRedis(!1)),plain:""},{default:t(()=>[Ss]),_:1},8,["disabled"]),e(c,{type:"danger",icon:"el-icon-delete",disabled:s.currentId==null,size:"mini",onClick:s.deleteRedis,plain:""},{default:t(()=>[Fs]),_:1},8,["disabled","onClick"]),e("div",Ps,[e(n,{modelValue:s.query.projectId,"onUpdate:modelValue":o[3]||(o[3]=u=>s.query.projectId=u),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",filterable:"",clearable:"",size:"small"},{default:t(()=>[(m(!0),f($,null,j(s.projects,u=>(m(),f(h,{key:u.id,label:`${u.name} [${u.remark}]`,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(c,{class:"ml5",onClick:s.search,type:"success",icon:"el-icon-search",size:"mini"},null,8,["onClick"])])]),e(w,{data:s.redisTable,stripe:"",style:{width:"100%"},onCurrentChange:s.choose},{default:t(()=>[e(_,{label:"\u9009\u62E9",width:"50px"},{default:t(u=>[e(i,{modelValue:s.currentId,"onUpdate:modelValue":o[4]||(o[4]=U=>s.currentId=U),label:u.row.id},{default:t(()=>[zs]),_:2},1032,["modelValue","label"])]),_:1}),e(_,{prop:"project",label:"\u9879\u76EE",width:""}),e(_,{prop:"env",label:"\u73AF\u5883",width:""}),e(_,{prop:"host",label:"host:port",width:""}),e(_,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:t(u=>[b(l(s.$filters.dateFormat(u.row.createTime)),1)]),_:1}),e(_,{prop:"creator",label:"\u521B\u5EFA\u4EBA"}),e(_,{label:"\u64CD\u4F5C",width:""},{default:t(u=>[e(c,{type:"primary",onClick:U=>s.info(u.row),icon:"el-icon-tickets",size:"mini",plain:""},{default:t(()=>[Rs]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),e(k,{onCurrentChange:s.handlePageChange,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:s.total,"current-page":s.query.pageNum,"onUpdate:current-page":o[5]||(o[5]=u=>s.query.pageNum=u),"page-size":s.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),e(r,{visible:s.infoDialog.visible,"onUpdate:visible":o[6]||(o[6]=u=>s.infoDialog.visible=u),title:s.infoDialog.title,info:s.infoDialog.info},null,8,["visible","title","info"]),e(A,{onValChange:s.valChange,projects:s.projects,title:s.redisEditDialog.title,visible:s.redisEditDialog.visible,"onUpdate:visible":o[7]||(o[7]=u=>s.redisEditDialog.visible=u),redis:s.redisEditDialog.data,"onUpdate:redis":o[8]||(o[8]=u=>s.redisEditDialog.data=u)},null,8,["onValChange","projects","title","visible","redis"])])}M.render=Ms;export default M;
