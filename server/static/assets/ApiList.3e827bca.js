var L=Object.defineProperty,P=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var j=(e,o,u)=>o in e?L(e,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[o]=u,C=(e,o)=>{for(var u in o||(o={}))M.call(o,u)&&j(e,u,o[u]);if(q)for(var u of q(o))J.call(o,u)&&j(e,u,o[u]);return e},F=(e,o)=>P(e,O(o));import{s as _}from"./api.b3ebe2bf.js";import{x as E,r as G,a as $,A as R,t as B,s as A,e as d,f,h as g,i as l,G as s,F as z,E as I,k as v,o as Q,Q as H,w as S,l as K}from"./vendor.c08e96cf.js";import{n as U}from"./assert.6143fd7f.js";import{V as W}from"./vue3-json-editor.esm.prod.1958cd47.js";import"./Api.7190d43f.js";import"./index.01696ebf.js";var T=E({name:"RedisEdit",components:{Vue3JsonEditor:W},props:{visible:{type:Boolean},services:{type:Array},api:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const u=G(null),i=$({dialogVisible:!1,services:[],form:{id:null,name:null,code:null,uri:null,serviceName:null,serviceId:null,schema:null},jsonschema:{},btnLoading:!1,rules:{serviceId:[{required:!0,message:"\u8BF7\u9009\u62E9\u670D\u52A1",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165api\u540D\u79F0",trigger:["change","blur"]}],method:[{required:!0,message:"\u8BF7\u8F93\u5165\u8BF7\u6C42method",trigger:["change","blur"]}],uri:[{required:!0,message:"\u8BF7\u8F93\u5165\u8BF7\u6C42uri",trigger:["change","blur"]}],code:[{required:!0,message:"\u8BF7\u8F93\u5165code",trigger:["change","blur"]}]}});R(e,async n=>{i.services=n.services,n.api?(i.form=C({},n.api),console.log(i.form),i.form.schema&&(i.jsonschema=JSON.parse(i.form.schema))):i.form={},i.dialogVisible=n.visible});const b=n=>{for(let p of i.services)p.id==n&&(i.form.serviceName=p.name)},h=n=>{i.form.schema=JSON.stringify(n)},m=async()=>{u.value.validate(n=>{if(n)_.saveServiceApi.request(i.form).then(()=>{A.success("\u4FDD\u5B58\u6210\u529F"),o("val-change",i.form),i.btnLoading=!0,setTimeout(()=>{i.btnLoading=!1},1e3),c()});else return A.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},c=()=>{o("update:visible",!1),o("cancel"),setTimeout(()=>{u.value.resetFields(),i.form={},i.jsonschema={}},200)};return F(C({},B(i)),{schemaChange:h,apiForm:u,changeService:b,btnOk:m,cancel:c})}}),fe="";const X={class:"dialog-footer"},Y=v("\u786E \u5B9A"),Z=v("\u53D6 \u6D88");function x(e,o,u,i,b,h){const m=d("el-option"),c=d("el-select"),n=d("el-form-item"),p=d("el-input"),y=d("vue3-json-editor"),a=d("el-form"),V=d("el-button"),D=d("el-dialog");return f(),g("div",null,[l(D,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[8]||(o[8]=r=>e.dialogVisible=r),"show-close":!1,"before-close":e.cancel,width:"65%"},{footer:s(()=>[l("div",X,[l(V,{type:"primary",loading:e.btnLoading,onClick:e.btnOk,size:"mini"},{default:s(()=>[Y]),_:1},8,["loading","onClick"]),l(V,{onClick:o[7]||(o[7]=r=>e.cancel()),size:"mini"},{default:s(()=>[Z]),_:1})])]),default:s(()=>[l(a,{model:e.form,ref:"apiForm",rules:e.rules,"label-width":"85px",size:"small"},{default:s(()=>[l(n,{prop:"serviceId",label:"\u670D\u52A1:",required:""},{default:s(()=>[l(c,{style:{width:"100%"},modelValue:e.form.serviceId,"onUpdate:modelValue":o[1]||(o[1]=r=>e.form.serviceId=r),placeholder:"\u8BF7\u9009\u62E9\u670D\u52A1",onChange:e.changeService,filterable:""},{default:s(()=>[(f(!0),g(z,null,I(e.services,r=>(f(),g(m,{key:r.id,label:`${r.name}`,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(n,{prop:"name",label:"\u540D\u79F0:",required:""},{default:s(()=>[l(p,{modelValue:e.form.name,"onUpdate:modelValue":o[2]||(o[2]=r=>e.form.name=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165api\u540D\u79F0","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(n,{prop:"code",label:"code:",required:""},{default:s(()=>[l(p,{disabled:e.form.id,modelValue:e.form.code,"onUpdate:modelValue":o[3]||(o[3]=r=>e.form.code=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165code","auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),l(n,{prop:"method",label:"method:",required:""},{default:s(()=>[l(c,{style:{width:"100%"},modelValue:e.form.method,"onUpdate:modelValue":o[4]||(o[4]=r=>e.form.method=r),placeholder:"\u8BF7\u9009\u62E9\u8BF7\u6C42\u65B9\u6CD5",onChange:e.changeService,filterable:""},{default:s(()=>[l(m,{key:"get",label:"GET",value:"GET"}),l(m,{key:"post",label:"POST",value:"POST"}),l(m,{key:"put",label:"PUT",value:"PUT"}),l(m,{key:"delete",label:"DELETE",value:"DELETE"})]),_:1},8,["modelValue","onChange"])]),_:1}),l(n,{prop:"uri",label:"uri:",required:""},{default:s(()=>[l(p,{modelValue:e.form.uri,"onUpdate:modelValue":o[5]||(o[5]=r=>e.form.uri=r),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165method:uri\u683C\u5F0F"},null,8,["modelValue"])]),_:1}),l(n,{label:"schema:"},{default:s(()=>[l(y,{modelValue:e.jsonschema,"onUpdate:modelValue":o[6]||(o[6]=r=>e.jsonschema=r),onJsonChange:e.schemaChange,"show-btns":!1,expandedOnStart:!0},null,8,["modelValue","onJsonChange"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}T.render=x;var N=E({name:"ServiceList",components:{ApiEdit:T},setup(){const e=$({permissions:{saveProject:"project:save",saveMember:"project:member:add",delMember:"project:member:del",saveEnv:"project:env:add"},query:{pageNum:1,pageSize:10,name:null},total:0,apis:[],services:[],btnLoading:!1,chooseId:null,chooseData:null,saveApiDialog:{title:"\u65B0\u589Eapi",visible:!1,form:{name:"",remark:""}}});Q(()=>{u()});const o=async()=>{let a=await _.serviceApis.request(e.query);e.apis=a.list,e.total=a.total},u=async()=>{let a=await _.services.request({pateNum:1,pageSize:100});e.services=a.list},i=async()=>{o()},b=a=>{e.query.pageNum=a,o()},h=a=>{a?e.saveApiDialog.form=C({},a):e.saveApiDialog.form={},e.saveApiDialog.visible=!0},m=()=>{e.saveApiDialog.visible=!1,e.saveApiDialog.form={}},c=async()=>{const a=e.saveApiDialog.form;U(a.name,"\u670D\u52A1\u540D\u4E0D\u80FD\u4E3A\u7A7A"),U(a.remark,"\u670D\u52A1\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A"),await _.saveService.request(a),A.success("\u4FDD\u5B58\u6210\u529F"),o(),m()},n=a=>{!a||(e.chooseId=a.id,e.chooseData=a)},p=async a=>{await _.syncServiceApi.request({apiId:a.id,id:a.serviceId}),A.success("\u540C\u6B65\u6210\u529F"),a.canSync=-1},y=()=>{o()};return F(C({},B(e)),{search:o,changeService:i,handlePageChange:b,choose:n,showSaveApiDialog:h,saveService:c,syncServiceApi:p,cancelAddApi:m,valChange:y})}}),ge="";const ee={class:"toolbar"},oe=v("\u6DFB\u52A0"),le=v("\u7F16\u8F91"),ae=v("\u5220\u9664"),se={style:{float:"right"}},ie=l("i",null,null,-1),ne=v("\u540C\u6B65");function re(e,o,u,i,b,h){const m=d("el-button"),c=d("el-option"),n=d("el-select"),p=d("el-input"),y=d("el-radio"),a=d("el-table-column"),V=d("el-table"),D=d("el-pagination"),r=d("api-edit"),w=H("auth");return f(),g("div",null,[l("div",ee,[S(l(m,{onClick:e.showSaveApiDialog,type:"primary",icon:"el-icon-plus",size:"mini"},{default:s(()=>[oe]),_:1},8,["onClick"]),[[w,e.permissions.saveProject]]),S(l(m,{onClick:o[1]||(o[1]=t=>e.showSaveApiDialog(e.chooseData)),disabled:e.chooseId==null,type:"primary",icon:"el-icon-edit",size:"mini"},{default:s(()=>[le]),_:1},8,["disabled"]),[[w,e.permissions.saveProject]]),S(l(m,{disabled:e.chooseId==null,type:"danger",icon:"el-icon-delete",size:"mini"},{default:s(()=>[ae]),_:1},8,["disabled"]),[[w,"role:del"]]),l("div",se,[l(n,{modelValue:e.query.serviceId,"onUpdate:modelValue":o[2]||(o[2]=t=>e.query.serviceId=t),onChange:e.changeService,placeholder:"\u8BF7\u9009\u62E9\u670D\u52A1",filterable:"",size:"small"},{default:s(()=>[(f(!0),g(z,null,I(e.services,t=>(f(),g(c,{key:t.id,label:`${t.name}`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),l(p,{class:"mr2 ml2",placeholder:"\u8BF7\u8F93\u5165\u670D\u52A1\u540D\uFF01",size:"small",style:{width:"140px"},modelValue:e.query.name,"onUpdate:modelValue":o[3]||(o[3]=t=>e.query.name=t),onClear:e.search,clearable:""},null,8,["modelValue","onClear"]),l(m,{onClick:e.search,type:"success",icon:"el-icon-search",size:"mini"},null,8,["onClick"])])]),l(V,{data:e.apis,onCurrentChange:e.choose,border:"",ref:"table",style:{width:"100%"}},{default:s(()=>[l(a,{label:"\u9009\u62E9",width:"50px"},{default:s(t=>[l(y,{modelValue:e.chooseId,"onUpdate:modelValue":o[4]||(o[4]=k=>e.chooseId=k),label:t.row.id},{default:s(()=>[ie]),_:2},1032,["modelValue","label"])]),_:1}),l(a,{prop:"serviceName",label:"\u670D\u52A1"}),l(a,{prop:"name",label:"\u540D\u79F0","show-overflow-tooltip":""}),l(a,{prop:"code",label:"code","show-overflow-tooltip":""}),l(a,{prop:"method",label:"method","min-width":"45","show-overflow-tooltip":""}),l(a,{prop:"uri",label:"uri","show-overflow-tooltip":""}),l(a,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(t=>[v(K(e.$filters.dateFormat(t.row.createTime)),1)]),_:1}),l(a,{prop:"creator",label:"\u521B\u5EFA\u8005","min-width":"50"}),l(a,{label:"\u64CD\u4F5C","min-width":"50"},{default:s(t=>[l(m,{onClick:k=>e.syncServiceApi(t.row),type:"success",icom:"el-icon-tickets",size:"mini",plain:"",disabled:t.row.canSync==-1},{default:s(()=>[ne]),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data","onCurrentChange"]),l(D,{onCurrentChange:e.handlePageChange,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"onUpdate:current-page":o[5]||(o[5]=t=>e.query.pageNum=t),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),l(r,{services:e.services,visible:e.saveApiDialog.visible,"onUpdate:visible":o[6]||(o[6]=t=>e.saveApiDialog.visible=t),api:e.saveApiDialog.form,onValChange:e.valChange},null,8,["services","visible","api","onValChange"])])}N.render=re;export default N;
