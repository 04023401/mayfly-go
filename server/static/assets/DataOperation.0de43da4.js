var U=Object.defineProperty,J=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var F=(e,l,t)=>l in e?U(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[l]=t,w=(e,l)=>{for(var t in l||(l={}))K.call(l,t)&&F(e,t,l[t]);if(z)for(var t of z(l))G.call(l,t)&&F(e,t,l[t]);return e},E=(e,l)=>J(e,T(l));import{r as _}from"./api.08881235.js";import{x as S,a as B,A as q,t as R,s as I,e as u,f as P,h as D,G as o,i as a,k as h,P as H,Q,F as M,E as W,l as j,w as X}from"./vendor.c08e96cf.js";import{i as $,a as Y}from"./assert.6143fd7f.js";import{_ as Z}from"./ProjectEnvSelect.b6e049b1.js";import"./Api.ab367e46.js";import"./index.ef81b75e.js";import"./api.7a509bb1.js";var N=S({name:"ValueDialog",components:{},props:{visible:{type:Boolean},title:{type:String},keyValue:{type:[String,Object]}},setup(e,{emit:l}){const t=B({dialogVisible:!1,keyValue2:{}}),V=()=>{l("update:visible",!1),l("cancel")};q(()=>e.visible,r=>{t.dialogVisible=r}),q(()=>e.keyValue,r=>{t.keyValue2=r,typeof r.value=="string"?t.keyValue2.jsonValue=JSON.stringify(JSON.parse(r.value),null,2):t.keyValue2.jsonValue=JSON.stringify(r.value,null,2)});const y=async()=>{$(t.keyValue2.type=="string","\u6682\u4E0D\u652F\u6301\u9664string\u5916\u5176\u4ED6\u7C7B\u578B\u4FEE\u6539"),t.keyValue2.value=t.keyValue2.jsonValue,await _.saveStringValue.request(t.keyValue2),I.success("\u4FDD\u5B58\u6210\u529F"),V()},k=r=>{t.keyValue2.value=JSON.stringify(r)};return E(w({},R(t)),{saveValue:y,valueChange:k,cancel:V})}});const x={class:"dialog-footer"},ee=h("\u786E \u5B9A"),le=h("\u53D6 \u6D88");function ae(e,l,t,V,y,k){const r=u("el-input"),C=u("el-form-item"),p=u("el-form"),g=u("el-button"),m=u("el-dialog");return P(),D(m,{title:e.keyValue.key,modelValue:e.dialogVisible,"onUpdate:modelValue":l[3]||(l[3]=v=>e.dialogVisible=v),"before-close":e.cancel,"show-close":!1,width:"900px"},{footer:o(()=>[a("div",x,[a(g,{onClick:e.saveValue,type:"primary",size:"mini"},{default:o(()=>[ee]),_:1},8,["onClick"]),a(g,{onClick:l[2]||(l[2]=v=>e.cancel()),size:"mini"},{default:o(()=>[le]),_:1})])]),default:o(()=>[a(p,null,{default:o(()=>[a(C,null,{default:o(()=>[a(r,{class:"json-text",modelValue:e.keyValue2.jsonValue,"onUpdate:modelValue":l[1]||(l[1]=v=>e.keyValue2.jsonValue=v),type:"textarea",autosize:{minRows:10,maxRows:20}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["title","modelValue","before-close"])}N.render=ae;var O=S({name:"DataOperation",components:{ValueDialog:N,ProjectEnvSelect:Z},setup(){const e=B({loading:!1,cluster:0,redisList:[],query:{envId:0},scanParam:{id:null,cluster:0,match:null,count:10,cursor:0,prevCursor:null},valueDialog:{visible:!1,value:{}},keys:[],dbsize:0}),l=async()=>{Y(e.query.envId,"\u8BF7\u5148\u9009\u62E9\u9879\u76EE\u73AF\u5883");const n=await _.redisList.request(e.query);e.redisList=n.list},t=(n,i)=>{r(),i!=null&&(e.query.envId=i,l())},V=()=>{p(),e.keys=[],e.dbsize=0,k()},y=()=>{$(e.scanParam.id!=null,"\u8BF7\u5148\u9009\u62E9redis"),$(e.scanParam.count<2001,"count\u4E0D\u80FD\u8D85\u8FC72000"),e.loading=!0,e.scanParam.cluster=e.cluster==0?0:1,_.scan.request(e.scanParam).then(n=>{e.keys=n.keys,e.dbsize=n.dbSize,e.scanParam.cursor=n.cursor,e.loading=!1})},k=()=>{e.scanParam.cursor=0,y()},r=()=>{e.redisList=[],e.scanParam.id=null,p(),e.keys=[],e.dbsize=0},C=()=>{p(),e.scanParam.id&&y()},p=()=>{e.scanParam.match=null,e.scanParam.cursor=0,e.scanParam.count=10},g=async n=>{let i;switch(n.type){case"string":i=_.getStringValue;break;case"hash":i=_.getHashValue;break;case"set":i=_.getSetValue;break;default:i=_.getStringValue;break}const c=e.cluster==0?e.scanParam.id:e.cluster,d=await i.request({cluster:e.cluster,key:n.key,id:c});let b=n.ttl==18446744073709552e3?0:n.ttl;e.valueDialog.value={id:e.scanParam.id,key:n.key,value:d,timed:b,type:n.type},e.valueDialog.visible=!0},m=n=>{H.confirm("\u6B64\u64CD\u4F5C\u5C06\u5220\u9664\u5BF9\u5E94\u7684key , \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{let i=e.cluster==0?e.scanParam.id:e.cluster;_.delKey.request({cluster:e.cluster,key:n,id:i}).then(()=>{I.success("\u5220\u9664\u6210\u529F\uFF01"),y()})}).catch(()=>{})},v=n=>{if(n==18446744073709552e3)return"\u6C38\u4E45";n||(n=0);let i=parseInt(n),c=0,d=0,b=0;i>60&&(c=parseInt(i/60+""),i=i%60,c>60&&(d=parseInt(c/60+""),c=c%60,d>24&&(b=parseInt(d/24+""),d=d%24)));let f=""+i+"s";return c>0&&(f=""+c+"m:"+f),d>0&&(f=""+d+"h:"+f),b>0&&(f=""+b+"d:"+f),f};return E(w({},R(e)),{changeProjectEnv:t,changeRedis:V,clearRedis:r,searchKey:k,scan:y,clear:C,getValue:g,del:m,ttlConveter:v})}}),Ve=`
`;const te={style:{float:"left"}},ne={style:{float:"left"}},se={style:{float:"right",color:"#8492a6","margin-left":"6px","font-size":"13px"}},oe=h("scan"),ie={style:{float:"right"}},ue=h("\u67E5\u770B"),re=h("\u5220\u9664"),ce=a("div",{style:{"text-align":"center","margin-top":"10px"}},null,-1);function de(e,l,t,V,y,k){const r=u("el-option"),C=u("el-select"),p=u("el-form-item"),g=u("el-input"),m=u("el-button"),v=u("project-env-select"),n=u("el-col"),i=u("el-row"),c=u("el-table-column"),d=u("el-table"),b=u("el-card"),f=u("value-dialog"),A=Q("loading");return P(),D("div",null,[a(b,null,{default:o(()=>[a("div",te,[a(i,{type:"flex",justify:"space-between"},{default:o(()=>[a(n,{span:24},{default:o(()=>[a(v,{onChangeProjectEnv:e.changeProjectEnv,onClear:e.clearRedis},{default:o(()=>[a(p,{label:"redis","label-width":"40px"},{default:o(()=>[a(C,{modelValue:e.scanParam.id,"onUpdate:modelValue":l[1]||(l[1]=s=>e.scanParam.id=s),placeholder:"\u8BF7\u9009\u62E9redis",onChange:e.changeRedis,onClear:e.clearRedis,clearable:""},{default:o(()=>[(P(!0),D(M,null,W(e.redisList,s=>(P(),D(r,{key:s.id,label:s.host,value:s.id},{default:o(()=>[a("span",ne,j(s.host),1),a("span",se,j(`\u5E93: [${s.db}]`),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onChange","onClear"])]),_:1}),a(p,{label:"key","label-width":"40px"},{default:o(()=>[a(g,{placeholder:"\u652F\u6301*\u6A21\u7CCAkey",style:{width:"180px"},modelValue:e.scanParam.match,"onUpdate:modelValue":l[2]||(l[2]=s=>e.scanParam.match=s),size:"mini",onClear:l[3]||(l[3]=s=>e.clear()),clearable:""},null,8,["modelValue"])]),_:1}),a(p,{"label-width":"40px"},{default:o(()=>[a(g,{placeholder:"count",style:{width:"62px"},modelValue:e.scanParam.count,"onUpdate:modelValue":l[4]||(l[4]=s=>e.scanParam.count=s),size:"mini"},null,8,["modelValue"])]),_:1}),a(m,{onClick:l[5]||(l[5]=s=>e.searchKey()),type:"success",icon:"el-icon-search",size:"mini",plain:""}),a(m,{onClick:l[6]||(l[6]=s=>e.scan()),icon:"el-icon-bottom",size:"mini",plain:""},{default:o(()=>[oe]),_:1}),a(m,{type:"primary",icon:"el-icon-plus",size:"mini",onClick:l[7]||(l[7]=s=>e.save(!1)),plain:""})]),_:1},8,["onChangeProjectEnv","onClear"])]),_:1})]),_:1})]),a("div",ie,[a("span",null,"keys: "+j(e.dbsize),1)]),X(a(d,{data:e.keys,stripe:"","highlight-current-row":!0,style:{cursor:"pointer"}},{default:o(()=>[a(c,{"show-overflow-tooltip":"",prop:"key",label:"key"}),a(c,{prop:"type",label:"type",width:"80"}),a(c,{prop:"ttl",label:"ttl(\u8FC7\u671F\u65F6\u95F4)",width:"120"},{default:o(s=>[h(j(e.ttlConveter(s.row.ttl)),1)]),_:1}),a(c,{label:"\u64CD\u4F5C"},{default:o(s=>[a(m,{onClick:L=>e.getValue(s.row),type:"success",icon:"el-icon-search",size:"mini",plain:""},{default:o(()=>[ue]),_:2},1032,["onClick"]),a(m,{onClick:L=>e.del(s.row.key),type:"danger",size:"mini",icon:"el-icon-delete",plain:""},{default:o(()=>[re]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),[[A,e.loading]])]),_:1}),ce,a(f,{visible:e.valueDialog.visible,"onUpdate:visible":l[8]||(l[8]=s=>e.valueDialog.visible=s),keyValue:e.valueDialog.value},null,8,["visible","keyValue"])])}O.render=de;export default O;
