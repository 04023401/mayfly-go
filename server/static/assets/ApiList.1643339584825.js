var P=Object.defineProperty,M=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var q=(e,o,u)=>o in e?P(e,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[o]=u,F=(e,o)=>{for(var u in o||(o={}))G.call(o,u)&&q(e,u,o[u]);if(k)for(var u of k(o))J.call(o,u)&&q(e,u,o[u]);return e},E=(e,o)=>M(e,O(o));import{s as y}from"./api.16433395848256.js";import{n as $}from"./assert.1643339584825.js";import{_ as j}from"./index.1643339584825.js";import{y as I,r as R,a as z,F as H,t as N,E as C,d as p,q as f,e as A,j as l,k as i,f as B,I as T,J as U,G as D,h as v,o as K,V as Q,w as _,i as W}from"./vendor.1643339584825.js";import"./Api.1643339584825.js";const X=I({name:"RedisEdit",components:{},props:{visible:{type:Boolean},services:{type:Array},api:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const u=R(null),s=z({dialogVisible:!1,services:[],form:{id:null,name:null,code:null,uri:null,serviceName:null,serviceId:null,schema:null},jsonschema:{},btnLoading:!1,rules:{serviceId:[{required:!0,message:"\u8BF7\u9009\u62E9\u670D\u52A1",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165api\u540D\u79F0",trigger:["change","blur"]}],method:[{required:!0,message:"\u8BF7\u8F93\u5165\u8BF7\u6C42method",trigger:["change","blur"]}],uri:[{required:!0,message:"\u8BF7\u8F93\u5165\u8BF7\u6C42uri",trigger:["change","blur"]}],code:[{required:!0,message:"\u8BF7\u8F93\u5165code",trigger:["change","blur"]}]}});H(e,async r=>{s.services=r.services,r.api?(s.form=F({},r.api),console.log(s.form),s.form.schema&&(s.jsonschema=JSON.parse(s.form.schema))):s.form={},s.dialogVisible=r.visible});const g=r=>{for(let m of s.services)m.id==r&&(s.form.serviceName=m.name)},b=r=>{s.form.schema=JSON.stringify(r)},d=async()=>{u.value.validate(r=>{if(r)y.saveServiceApi.request(s.form).then(()=>{C.success("\u4FDD\u5B58\u6210\u529F"),o("val-change",s.form),s.btnLoading=!0,setTimeout(()=>{s.btnLoading=!1},1e3),c()});else return C.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},c=()=>{o("update:visible",!1),o("cancel"),setTimeout(()=>{u.value.resetFields(),s.form={},s.jsonschema={}},200)};return E(F({},N(s)),{schemaChange:b,apiForm:u,changeService:g,btnOk:d,cancel:c})}}),Y={class:"dialog-footer"},Z=v("\u786E \u5B9A"),x=v("\u53D6 \u6D88");function ee(e,o,u,s,g,b){const d=p("el-option"),c=p("el-select"),r=p("el-form-item"),m=p("el-input"),h=p("el-form"),a=p("el-button"),V=p("el-dialog");return f(),A("div",null,[l(V,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[6]||(o[6]=t=>e.dialogVisible=t),"show-close":!1,"before-close":e.cancel,width:"65%"},{footer:i(()=>[B("div",Y,[l(a,{type:"primary",loading:e.btnLoading,onClick:e.btnOk,size:"mini"},{default:i(()=>[Z]),_:1},8,["loading","onClick"]),l(a,{onClick:o[5]||(o[5]=t=>e.cancel()),size:"mini"},{default:i(()=>[x]),_:1})])]),default:i(()=>[l(h,{model:e.form,ref:"apiForm",rules:e.rules,"label-width":"85px",size:"small"},{default:i(()=>[l(r,{prop:"serviceId",label:"\u670D\u52A1:",required:""},{default:i(()=>[l(c,{style:{width:"100%"},modelValue:e.form.serviceId,"onUpdate:modelValue":o[0]||(o[0]=t=>e.form.serviceId=t),placeholder:"\u8BF7\u9009\u62E9\u670D\u52A1",onChange:e.changeService,filterable:""},{default:i(()=>[(f(!0),A(T,null,U(e.services,t=>(f(),D(d,{key:t.id,label:`${t.name}`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(r,{prop:"name",label:"\u540D\u79F0:",required:""},{default:i(()=>[l(m,{modelValue:e.form.name,"onUpdate:modelValue":o[1]||(o[1]=t=>e.form.name=t),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165api\u540D\u79F0","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(r,{prop:"code",label:"code:",required:""},{default:i(()=>[l(m,{disabled:e.form.id,modelValue:e.form.code,"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.code=t),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165code","auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),l(r,{prop:"method",label:"method:",required:""},{default:i(()=>[l(c,{style:{width:"100%"},modelValue:e.form.method,"onUpdate:modelValue":o[3]||(o[3]=t=>e.form.method=t),placeholder:"\u8BF7\u9009\u62E9\u8BF7\u6C42\u65B9\u6CD5",onChange:e.changeService,filterable:""},{default:i(()=>[l(d,{key:"get",label:"GET",value:"GET"}),l(d,{key:"post",label:"POST",value:"POST"}),l(d,{key:"put",label:"PUT",value:"PUT"}),l(d,{key:"delete",label:"DELETE",value:"DELETE"})]),_:1},8,["modelValue","onChange"])]),_:1}),l(r,{prop:"uri",label:"uri:",required:""},{default:i(()=>[l(m,{modelValue:e.form.uri,"onUpdate:modelValue":o[4]||(o[4]=t=>e.form.uri=t),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165method:uri\u683C\u5F0F"},null,8,["modelValue"])]),_:1}),l(r,{label:"schema:"})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}var oe=j(X,[["render",ee]]);const le=I({name:"ServiceList",components:{ApiEdit:oe},setup(){const e=z({permissions:{saveProject:"project:save",saveMember:"project:member:add",delMember:"project:member:del",saveEnv:"project:env:add"},query:{pageNum:1,pageSize:10,name:null},total:0,apis:[],services:[],btnLoading:!1,chooseId:null,chooseData:null,saveApiDialog:{title:"\u65B0\u589Eapi",visible:!1,form:{name:"",remark:""}}});K(()=>{u()});const o=async()=>{let a=await y.serviceApis.request(e.query);e.apis=a.list,e.total=a.total},u=async()=>{let a=await y.services.request({pateNum:1,pageSize:100});e.services=a.list},s=async()=>{o()},g=a=>{e.query.pageNum=a,o()},b=a=>{a?e.saveApiDialog.form=F({},a):e.saveApiDialog.form={},e.saveApiDialog.visible=!0},d=()=>{e.saveApiDialog.visible=!1,e.saveApiDialog.form={}},c=async()=>{const a=e.saveApiDialog.form;$(a.name,"\u670D\u52A1\u540D\u4E0D\u80FD\u4E3A\u7A7A"),$(a.remark,"\u670D\u52A1\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A"),await y.saveService.request(a),C.success("\u4FDD\u5B58\u6210\u529F"),o(),d()},r=a=>{!a||(e.chooseId=a.id,e.chooseData=a)},m=async a=>{await y.syncServiceApi.request({apiId:a.id,id:a.serviceId}),C.success("\u540C\u6B65\u6210\u529F"),a.canSync=-1},h=()=>{o()};return E(F({},N(e)),{search:o,changeService:s,handlePageChange:g,choose:r,showSaveApiDialog:b,saveService:c,syncServiceApi:m,cancelAddApi:d,valChange:h})}}),ae={class:"toolbar"},se=v("\u6DFB\u52A0"),ie=v("\u7F16\u8F91"),re=v("\u5220\u9664"),ne={style:{float:"right"}},ue=B("i",null,null,-1),te=v("\u540C\u6B65");function de(e,o,u,s,g,b){const d=p("el-button"),c=p("el-option"),r=p("el-select"),m=p("el-input"),h=p("el-radio"),a=p("el-table-column"),V=p("el-table"),t=p("el-pagination"),L=p("api-edit"),w=Q("auth");return f(),A("div",null,[B("div",ae,[_((f(),D(d,{onClick:e.showSaveApiDialog,type:"primary",icon:"el-icon-plus",size:"mini"},{default:i(()=>[se]),_:1},8,["onClick"])),[[w,e.permissions.saveProject]]),_((f(),D(d,{onClick:o[0]||(o[0]=n=>e.showSaveApiDialog(e.chooseData)),disabled:e.chooseId==null,type:"primary",icon:"el-icon-edit",size:"mini"},{default:i(()=>[ie]),_:1},8,["disabled"])),[[w,e.permissions.saveProject]]),_((f(),D(d,{disabled:e.chooseId==null,type:"danger",icon:"el-icon-delete",size:"mini"},{default:i(()=>[re]),_:1},8,["disabled"])),[[w,"role:del"]]),B("div",ne,[l(r,{modelValue:e.query.serviceId,"onUpdate:modelValue":o[1]||(o[1]=n=>e.query.serviceId=n),onChange:e.changeService,placeholder:"\u8BF7\u9009\u62E9\u670D\u52A1",filterable:"",size:"small"},{default:i(()=>[(f(!0),A(T,null,U(e.services,n=>(f(),D(c,{key:n.id,label:`${n.name}`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),l(m,{class:"mr2 ml2",placeholder:"\u8BF7\u8F93\u5165\u670D\u52A1\u540D\uFF01",size:"small",style:{width:"140px"},modelValue:e.query.name,"onUpdate:modelValue":o[2]||(o[2]=n=>e.query.name=n),onClear:e.search,clearable:""},null,8,["modelValue","onClear"]),l(d,{onClick:e.search,type:"success",icon:"el-icon-search",size:"mini"},null,8,["onClick"])])]),l(V,{data:e.apis,onCurrentChange:e.choose,border:"",ref:"table",style:{width:"100%"}},{default:i(()=>[l(a,{label:"\u9009\u62E9",width:"50px"},{default:i(n=>[l(h,{modelValue:e.chooseId,"onUpdate:modelValue":o[3]||(o[3]=S=>e.chooseId=S),label:n.row.id},{default:i(()=>[ue]),_:2},1032,["modelValue","label"])]),_:1}),l(a,{prop:"serviceName",label:"\u670D\u52A1"}),l(a,{prop:"name",label:"\u540D\u79F0","show-overflow-tooltip":""}),l(a,{prop:"code",label:"code","show-overflow-tooltip":""}),l(a,{prop:"method",label:"method","min-width":"45","show-overflow-tooltip":""}),l(a,{prop:"uri",label:"uri","show-overflow-tooltip":""}),l(a,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:i(n=>[v(W(e.$filters.dateFormat(n.row.createTime)),1)]),_:1}),l(a,{prop:"creator",label:"\u521B\u5EFA\u8005","min-width":"50"}),l(a,{label:"\u64CD\u4F5C","min-width":"50"},{default:i(n=>[l(d,{onClick:S=>e.syncServiceApi(n.row),type:"success",icom:"el-icon-tickets",size:"mini",plain:"",disabled:n.row.canSync==-1},{default:i(()=>[te]),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data","onCurrentChange"]),l(t,{onCurrentChange:e.handlePageChange,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"onUpdate:current-page":o[4]||(o[4]=n=>e.query.pageNum=n),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),l(L,{services:e.services,visible:e.saveApiDialog.visible,"onUpdate:visible":o[5]||(o[5]=n=>e.saveApiDialog.visible=n),api:e.saveApiDialog.form,onValChange:e.valChange},null,8,["services","visible","api","onValChange"])])}var be=j(le,[["render",de]]);export{be as default};
