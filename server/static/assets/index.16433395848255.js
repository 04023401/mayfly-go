var K=Object.defineProperty,Q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var L=(e,o,s)=>o in e?K(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,V=(e,o)=>{for(var s in o||(o={}))X.call(o,s)&&L(e,s,o[s]);if(z)for(var s of z(o))Y.call(o,s)&&L(e,s,o[s]);return e},S=(e,o)=>Q(e,W(o));import{y as N,r as O,a as I,F as M,t as U,E as R,d as i,q as f,e as A,j as a,k as n,f as F,h as c,i as q,o as Z,V as x,w as B,G as C,H as E,g as P,P as ee}from"./vendor.1643339584825.js";import{b as y,a as oe}from"./api.16433395848252.js";import{_ as j}from"./index.1643339584825.js";import{e as le}from"./enums.1643339584825.js";import"./Api.1643339584825.js";import"./Enum.1643339584825.js";const te=N({name:"RoleEdit",props:{visible:{type:Boolean},account:{type:[Boolean,Object]}},setup(e,{emit:o}){const s=O(null),u=I({visible:!1,btnLoading:!1,allRole:[],roles:[],query:{name:null,pageNum:1,pageSize:5},total:0});M(e,(l,p)=>{if(u.visible=l.visible,l.account&&l.account.id!=0)y.roleIds.request({id:e.account.id}).then(h=>{u.roles=h||[],m()});else return});const D=()=>{m()},w=l=>l.code.indexOf("COMMON")!=0,r=(l,p)=>{let h=u.roles;if(h.includes(p.id)){for(let k=0;k<h.length;k++)if(h[k]===p.id){h.splice(k,1);break}}else h.push(p.id)},g=()=>{setTimeout(()=>{s.value.clearSelection(),u.allRole.forEach(l=>{u.roles.includes(l.id)&&s.value.toggleRowSelection(l,!0)})},50)},b=async()=>{let l=u.roles.join(",");await y.saveRoles.request({id:e.account.id,roleIds:l}),R.success("\u4FDD\u5B58\u6210\u529F!"),d()},d=()=>{u.query.pageNum=1,u.query.name=null,o("update:visible",!1),o("cancel")},v=()=>{u.query.pageNum=1,u.query.name=null,m()},m=async()=>{let l=await oe.list.request(u.query);u.allRole=l.list,u.total=l.total,g()};return S(V({},U(u)),{roleTable:s,search:m,handlePageChange:D,selectable:w,select:r,btnOk:b,cancel:d,clear:v})}}),ae={class:"account-dialog"},ne={class:"toolbar"},ue={style:{float:"left"}},se={class:"dialog-footer"},ie=c("\u53D6 \u6D88"),re=c("\u786E \u5B9A");function de(e,o,s,u,D,w){const r=i("el-input"),g=i("el-button"),b=i("el-table-column"),d=i("el-table"),v=i("el-pagination"),m=i("el-dialog");return f(),A("div",ae,[a(m,{title:e.account==null?"":"\u5206\u914D\u201C"+e.account.username+"\u201D\u7684\u89D2\u8272",modelValue:e.visible,"onUpdate:modelValue":o[4]||(o[4]=l=>e.visible=l),"before-close":e.cancel,"show-close":!1},{footer:n(()=>[F("div",se,[a(g,{onClick:o[3]||(o[3]=l=>e.cancel())},{default:n(()=>[ie]),_:1}),a(g,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:n(()=>[re]),_:1},8,["loading","onClick"])])]),default:n(()=>[F("div",ne,[F("div",ue,[a(r,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",style:{width:"150px"},modelValue:e.query.name,"onUpdate:modelValue":o[0]||(o[0]=l=>e.query.name=l),onClear:o[1]||(o[1]=l=>e.clear()),clearable:""},null,8,["modelValue"]),a(g,{onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])])]),a(d,{data:e.allRole,border:"",ref:"roleTable",onSelect:e.select,style:{width:"100%"}},{default:n(()=>[a(b,{selectable:e.selectable,type:"selection",width:"40"},null,8,["selectable"]),a(b,{prop:"name",label:"\u89D2\u8272\u540D\u79F0"}),a(b,{prop:"code",label:"\u89D2\u8272code"}),a(b,{prop:"remark",label:"\u89D2\u8272\u63CF\u8FF0"},{default:n(l=>[c(q(l.row.remark?l.row.remark:"\u6682\u65E0\u63CF\u8FF0"),1)]),_:1})]),_:1},8,["data","onSelect"]),a(v,{onCurrentChange:e.handlePageChange,style:{"text-align":"center","margin-top":"20px"},background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"onUpdate:current-page":o[2]||(o[2]=l=>e.query.pageNum=l),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1},8,["title","modelValue","before-close"])])}var ce=j(te,[["render",de]]);const pe=N({name:"AccountEdit",props:{visible:{type:Boolean},account:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const s=O(null),u=I({dialogVisible:!1,edit:!1,form:{id:null,username:null,password:null,repassword:null},btnLoading:!1,rules:{username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["change","blur"]}]}});M(e,r=>{r.account?u.form=V({},r.account):u.form={},u.dialogVisible=r.visible});const D=async()=>{let r=u.form.id?y.update:y.save;s.value.validate(g=>{if(g)r.request(u.form).then(()=>{R.success("\u64CD\u4F5C\u6210\u529F"),o("val-change",u.form),u.btnLoading=!0,setTimeout(()=>{u.btnLoading=!1},1e3),s.resetFields(),u.form={}});else return R.error("\u8868\u5355\u586B\u5199\u6709\u8BEF"),!1})},w=()=>{o("update:visible",!1),setTimeout(()=>{o("update:account",null)},800),o("cancel"),setTimeout(()=>{s.value.resetFields(),u.form={}},200)};return S(V({},U(u)),{accountForm:s,btnOk:D,cancel:w})}}),me={class:"account-dialog"},ge={class:"dialog-footer"},fe=c("\u53D6 \u6D88"),be=c("\u786E \u5B9A");function he(e,o,s,u,D,w){const r=i("el-input"),g=i("el-form-item"),b=i("el-form"),d=i("el-button"),v=i("el-dialog");return f(),A("div",me,[a(v,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[2]||(o[2]=m=>e.dialogVisible=m),"before-close":e.cancel,"show-close":!1,width:"35%"},{footer:n(()=>[F("div",ge,[a(d,{onClick:o[1]||(o[1]=m=>e.cancel())},{default:n(()=>[fe]),_:1}),a(d,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:n(()=>[be]),_:1},8,["loading","onClick"])])]),default:n(()=>[a(b,{model:e.form,ref:"accountForm",rules:e.rules,"label-width":"85px"},{default:n(()=>[a(g,{prop:"username",label:"\u7528\u6237\u540D:",required:""},{default:n(()=>[a(r,{disabled:e.edit,modelValue:e.form.username,"onUpdate:modelValue":o[0]||(o[0]=m=>e.form.username=m),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u7528\u6237\u540D","auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}var ve=j(pe,[["render",he]]);const ye=N({name:"AccountList",components:{RoleEdit:ce,AccountEdit:ve},setup(){const e=I({chooseId:null,chooseData:null,query:{pageNum:1,pageSize:10},datas:[],total:0,showRoleDialog:{title:"",visible:!1,accountRoles:[]},showResourceDialog:{title:"",visible:!1,resources:[],defaultProps:{children:"children",label:"name"}},roleDialog:{visible:!1,account:null,roles:[]},accountDialog:{visible:!1,data:null}});Z(()=>{s()});const o=l=>{!l||(e.chooseId=l.id,e.chooseData=l)},s=async()=>{let l=await y.list.request(e.query);e.datas=l.list,e.total=l.total},u=async l=>{let p=e.showResourceDialog;p.title='"'+l.username+'" \u7684\u83DC\u5355&\u6743\u9650',p.resources=[],p.resources=await y.resources.request({id:l.id}),p.visible=!0},D=async l=>{let p=e.showRoleDialog;p.title='"'+l.username+'" \u7684\u89D2\u8272\u4FE1\u606F',p.accountRoles=await y.roles.request({id:l.id}),p.visible=!0},w=async l=>{let p=l.id,h=l.status==-1?1:-1;await y.changeStatus.request({id:p,status:h}),R.success("\u64CD\u4F5C\u6210\u529F"),s()},r=l=>{e.query.pageNum=l,s()},g=()=>{e.chooseId||R.error("\u8BF7\u9009\u62E9\u8D26\u53F7"),e.roleDialog.visible=!0,e.roleDialog.account=e.chooseData},b=(l=!1)=>{l?e.accountDialog.data=null:e.accountDialog.data=e.chooseData,e.accountDialog.visible=!0},d=()=>{e.roleDialog.visible=!1,e.roleDialog.account=null,s()},v=()=>{e.accountDialog.visible=!1,s()},m=async()=>{try{await ee.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u8D26\u53F7?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await y.del.request({id:e.chooseId}),R.success("\u5220\u9664\u6210\u529F"),e.chooseData=null,e.chooseId=null,s()}catch{}};return S(V({},U(e)),{enums:le,search:s,choose:o,showResources:u,showRoles:D,changeStatus:w,handlePageChange:r,roleEdit:g,editAccount:b,cancel:d,valChange:v,deleteAccount:m})}}),De={class:"role-list"},we=c("\u6DFB\u52A0"),_e=c("\u7F16\u8F91"),Ce=c("\u89D2\u8272\u5206\u914D"),Fe=c("\u5220\u9664"),ke={style:{float:"right"}},$e=F("i",null,null,-1),Re=c("\u6B63\u5E38"),qe=c("\u7981\u7528"),Be=c("\u89D2\u8272"),Ee=c("\u83DC\u5355&\u6743\u9650"),Ve=c("\u7981\u7528"),Ae=c("\u542F\u7528"),Se={class:"custom-tree-node"},Te={key:0},Ne={key:1,style:{color:"#67c23a"}};function Ie(e,o,s,u,D,w){const r=i("el-button"),g=i("el-input"),b=i("el-radio"),d=i("el-table-column"),v=i("el-tag"),m=i("el-link"),l=i("el-table"),p=i("el-pagination"),h=i("el-row"),k=i("el-card"),T=i("el-dialog"),G=i("el-tree"),H=i("role-edit"),J=i("account-edit"),$=x("auth");return f(),A("div",De,[a(k,null,{default:n(()=>[B((f(),C(r,{type:"primary",icon:"plus",onClick:o[0]||(o[0]=t=>e.editAccount(!0))},{default:n(()=>[we]),_:1})),[[$,"account:add"]]),B((f(),C(r,{disabled:e.chooseId==null,onClick:o[1]||(o[1]=t=>e.editAccount(!1)),type:"primary",icon:"edit"},{default:n(()=>[_e]),_:1},8,["disabled"])),[[$,"account:update"]]),B((f(),C(r,{disabled:e.chooseId==null,onClick:o[2]||(o[2]=t=>e.roleEdit()),type:"success",icon:"setting"},{default:n(()=>[Ce]),_:1},8,["disabled"])),[[$,"account:saveRoles"]]),B((f(),C(r,{disabled:e.chooseId==null,onClick:o[3]||(o[3]=t=>e.deleteAccount()),type:"danger",icon:"delete"},{default:n(()=>[Fe]),_:1},8,["disabled"])),[[$,"account:del"]]),F("div",ke,[a(g,{class:"mr2",placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u540D",size:"small",style:{width:"300px"},modelValue:e.query.username,"onUpdate:modelValue":o[4]||(o[4]=t=>e.query.username=t),onClear:o[5]||(o[5]=t=>e.search()),clearable:""},null,8,["modelValue"]),a(r,{onClick:o[6]||(o[6]=t=>e.search()),type:"success",icon:"search",size:"small"})]),a(l,{data:e.datas,ref:"table",onCurrentChange:e.choose,"show-overflow-tooltip":""},{default:n(()=>[a(d,{label:"\u9009\u62E9",width:"50px"},{default:n(t=>[a(b,{modelValue:e.chooseId,"onUpdate:modelValue":o[7]||(o[7]=_=>e.chooseId=_),label:t.row.id},{default:n(()=>[$e]),_:2},1032,["modelValue","label"])]),_:1}),a(d,{prop:"username",label:"\u7528\u6237\u540D","min-width":"115"}),a(d,{align:"center",prop:"status",label:"\u72B6\u6001","min-width":"63"},{default:n(t=>[t.row.status==1?(f(),C(v,{key:0,type:"success"},{default:n(()=>[Re]),_:1})):E("",!0),t.row.status==-1?(f(),C(v,{key:1,type:"danger"},{default:n(()=>[qe]),_:1})):E("",!0)]),_:1}),a(d,{"min-width":"160",prop:"lastLoginTime",label:"\u6700\u540E\u767B\u5F55\u65F6\u95F4"},{default:n(t=>[c(q(e.$filters.dateFormat(t.row.lastLoginTime)),1)]),_:1}),a(d,{"min-width":"115",prop:"creator",label:"\u521B\u5EFA\u8D26\u53F7"}),a(d,{"min-width":"160",prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:n(t=>[c(q(e.$filters.dateFormat(t.row.createTime)),1)]),_:1}),a(d,{label:"\u67E5\u770B\u66F4\u591A","min-width":"150"},{default:n(t=>[a(m,{onClick:P(_=>e.showRoles(t.row),["prevent"]),type:"success"},{default:n(()=>[Be]),_:2},1032,["onClick"]),a(m,{class:"ml5",onClick:P(_=>e.showResources(t.row),["prevent"]),type:"info"},{default:n(()=>[Ee]),_:2},1032,["onClick"])]),_:1}),a(d,{label:"\u64CD\u4F5C","min-width":"200px"},{default:n(t=>[t.row.status==1?B((f(),C(r,{key:0,onClick:_=>e.changeStatus(t.row),type:"danger",icom:"tickets",size:"small",plain:""},{default:n(()=>[Ve]),_:2},1032,["onClick"])),[[$,"account:changeStatus"]]):E("",!0),t.row.status==-1?B((f(),C(r,{key:1,type:"success",onClick:_=>e.changeStatus(t.row),size:"small",plain:""},{default:n(()=>[Ae]),_:2},1032,["onClick"])),[[$,"account:changeStatus"]]):E("",!0)]),_:1})]),_:1},8,["data","onCurrentChange"]),a(h,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:n(()=>[a(p,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":o[8]||(o[8]=t=>e.query.pageNum=t),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),a(T,{width:"500px",title:e.showRoleDialog.title,modelValue:e.showRoleDialog.visible,"onUpdate:modelValue":o[9]||(o[9]=t=>e.showRoleDialog.visible=t)},{default:n(()=>[a(l,{border:"",data:e.showRoleDialog.accountRoles},{default:n(()=>[a(d,{property:"name",label:"\u89D2\u8272\u540D",width:"125"}),a(d,{property:"creator",label:"\u5206\u914D\u8D26\u53F7",width:"125"}),a(d,{property:"createTime",label:"\u5206\u914D\u65F6\u95F4"},{default:n(t=>[c(q(e.$filters.dateFormat(t.row.createTime)),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),a(T,{title:e.showResourceDialog.title,modelValue:e.showResourceDialog.visible,"onUpdate:modelValue":o[10]||(o[10]=t=>e.showResourceDialog.visible=t),width:"400px"},{default:n(()=>[a(G,{style:{height:"50vh",overflow:"auto"},data:e.showResourceDialog.resources,"node-key":"id",props:e.showResourceDialog.defaultProps,"expand-on-click-node":!0},{default:n(({node:t,data:_})=>[F("span",Se,[_.type==e.enums.ResourceTypeEnum.MENU.value?(f(),A("span",Te,q(t.label),1)):E("",!0),_.type==e.enums.ResourceTypeEnum.PERMISSION.value?(f(),A("span",Ne,q(t.label),1)):E("",!0)])]),_:1},8,["data","props"])]),_:1},8,["title","modelValue"]),a(H,{visible:e.roleDialog.visible,"onUpdate:visible":o[11]||(o[11]=t=>e.roleDialog.visible=t),account:e.roleDialog.account,onCancel:o[12]||(o[12]=t=>e.cancel())},null,8,["visible","account"]),a(J,{visible:e.accountDialog.visible,"onUpdate:visible":o[13]||(o[13]=t=>e.accountDialog.visible=t),account:e.accountDialog.data,"onUpdate:account":o[14]||(o[14]=t=>e.accountDialog.data=t),onValChange:o[15]||(o[15]=t=>e.valChange())},null,8,["visible","account"])])}var Ge=j(ye,[["render",Ie]]);export{Ge as default};
