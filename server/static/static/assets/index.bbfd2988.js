import{d as q,S as Dt,l as Ue}from"./SqlExecBox.b0f3476a.js";import{n as W,i as he,a as It}from"./assert.d82c837d.js";import{d as Vt,u as $t,r as Lt,O as Rt,c as At,t as Mt,f as Ot,e as Wt,L as Ut,h,V as zt,i as f,j as x,q as N,k as s,w as u,l as c,Q as R,R as A,m as _,G as H,F as Q,N as Kt,v as F,P as Pt,ab as jt,s as G,I as ze,E as M,W as Ke,ac as Ht}from"./index.3ab9ca99.js";import{t as Qt}from"./api.359a68e0.js";import{W as Gt,e as Pe,S as Yt,K as Y,a as je,l as S}from"./MonacoEditor.1b395942.js";import{language as ae}from"./mysql.b3be80b5.js";import"./Api.7cd1a1f8.js";const Zt={class:"toolbar"},Jt={style:{float:"left"}},Xt={style:{float:"right",color:"#8492a6","margin-left":"10px","font-size":"13px"}},ea={class:"toolbar"},ta={class:"fl"},aa={style:{float:"right"},class:"fl"},la={class:"mt5 sqlEditor"},na={class:"mt5"},oa={key:1},sa=N("span",{style:{"font-size":"12px"}},"\u5BFC\u51FA",-1),ua={class:"dialog-footer"},ia=Vt({__name:"SqlExec",setup(ra){const le=$t(),ne=Lt(null),ye=Rt("token"),oe=new Map,U=20,t=At({token:ye,tags:[],dbs:[],databaseList:[],db:"",dbType:"",tables:[],dbId:null,tableName:"",tableMetadata:[],sqlName:"",sqlNames:[],activeName:"Query",nowTableName:"",dataTabs:{},dataTabsTableHeight:600,queryTab:{label:"\u67E5\u8BE2",name:"Query",execRes:{data:[],tableColumn:[]},loading:!1,nowTableName:"",selectionDatas:[]},params:{pageNum:1,pageSize:100,tagPath:null},conditionDialog:{title:"",placeholder:"",columnRow:null,dataTab:null,visible:!1,condition:"=",value:null},genSqlDialog:{visible:!1,sql:""},monacoOptions:{editor:{},height:"",tableMaxHeight:250,dbTables:{}}}),{tags:He,dbs:Qe,databaseList:Ge,db:se,dbId:Z,tableName:ue,tableMetadata:Ye,sqlName:ie,sqlNames:Ze,activeName:re,nowTableName:Je,dataTabs:Xe,dataTabsTableHeight:et,queryTab:w,params:Ee,conditionDialog:D,genSqlDialog:z,monacoOptions:Ce}=Mt(t),tt=Ot(()=>le.state.themeConfig.themeConfig);let y=null;self.MonacoEnvironment={getWorker(){return new Gt}};const at=()=>{Pe.defineTheme("SolarizedLight",Yt),y=Pe.create(ne.value,{language:"sql",theme:tt.value.editorTheme,automaticLayout:!0,folding:!1,roundedSelection:!1,matchBrackets:"near",linkedEditing:!0,cursorBlinking:"smooth",mouseWheelZoom:!0,overviewRulerBorder:!1,tabSize:2,fontFamily:"JetBrainsMono",fontWeight:"bold",minimap:{enabled:!1}}),y.addAction({id:"run-sql-action",label:"\u6267\u884CSQL",precondition:null,keybindingContext:null,keybindings:[Y.chord(Y.CtrlCmd|je.KeyR)],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:async function(){try{await _e()}catch(e){e.message&&M.error(e.message)}}}),y.addAction({id:"format-sql-action",label:"\u683C\u5F0F\u5316SQL",precondition:null,keybindingContext:null,keybindings:[Y.chord(Y.CtrlCmd|Y.Shift|je.KeyF)],contextMenuGroupId:"navigation",contextMenuOrder:2,run:async function(){try{await Ae()}catch(e){e.message&&M.error(e.message)}}}),S.registerCompletionItemProvider("sql",{triggerCharacters:["."],provideCompletionItems:async(e,a)=>{let l=e.getWordUntilPosition(a);const{lineNumber:o,column:i}=a,{startColumn:b,endColumn:d}=l;if(e.getLineContent(o).startsWith("--"))return{suggestions:[]};let r={startLineNumber:o,endLineNumber:o,startColumn:b,endColumn:d};const g=e.getValueInRange({startLineNumber:o,startColumn:0,endLineNumber:o,endColumn:i}),C=e.getValueInRange({startLineNumber:1,startColumn:0,endLineNumber:o,endColumn:i}),ge=e.getValueInRange({startLineNumber:o,startColumn:i,endLineNumber:e.getLineCount(),endColumn:e.getLineMaxColumn(e.getLineCount())}),I=g.trim().split(/\s+/),P=I[I.length-1].toLowerCase();if(P.endsWith(".")){let p=P.substring(0,P.lastIndexOf("."));if(t.databaseList.indexOf(p)>-1){let $=await ke(p),v=[];for(let k of $){const{tableName:B,tableComment:L}=k;v.push({label:{label:B+(L?" - "+L:""),description:"table"},kind:S.CompletionItemKind.File,insertText:B,range:r})}return{suggestions:v}}let O=C.split(";")[C.split(";").length-1]+ge.split(";")[0],V=lt(O,t.db,p);if(V.tableName){let $=V.tableName,v=V.dbName,k=t.monacoOptions.dbTables[v],B=k?k[$]||[]:[];(!B||B.length===0)&&v&&(t.monacoOptions.dbTables[v]=await Be(v),k=t.monacoOptions.dbTables[v],B=k?k[$]||[]:[]);let L=[];return B.forEach((j,n)=>{const St=j.split("  ")[0];L.push({label:{label:j,description:"column"},kind:S.CompletionItemKind.Property,detail:"",insertText:St+" ",range:r,sortText:100+n+""})}),{suggestions:L}}return{suggestions:[]}}let T=[];return ae.keywords.forEach(p=>{T.push({label:{label:p,description:"keyword"},kind:S.CompletionItemKind.Keyword,insertText:p,range:r})}),ae.operators.forEach(p=>{T.push({label:{label:p,description:"opt"},kind:S.CompletionItemKind.Operator,insertText:p,range:r})}),ae.builtinFunctions.forEach(p=>{T.push({label:{label:p,description:"func"},kind:S.CompletionItemKind.Function,insertText:p,range:r})}),ae.builtinVariables.forEach(p=>{T.push({label:{label:p,description:"var"},kind:S.CompletionItemKind.Variable,insertText:p,range:r})}),t.databaseList.forEach(p=>{T.push({label:{label:p,description:"schema"},kind:S.CompletionItemKind.Folder,insertText:p,range:r})}),t.tableMetadata.forEach(p=>{const{tableName:O,tableComment:V}=p;T.push({label:{label:O+" - "+V,description:"table"},kind:S.CompletionItemKind.File,detail:V,insertText:O+" ",range:r})}),{suggestions:T}}})},lt=(e,a,l)=>{let o={},i={},b=e.match(/(join|from)\n*\s+\n*(\w*-?\w*\.?\w+)\s*(as)?\s*(\w*)\n*/gi);return b&&b.length>0&&b.forEach(d=>{let m=d.substring(5,d.length).replaceAll(/\s+/g," ").replaceAll(/\s+as\s+/gi," ").replaceAll(/\r\n/g," ").trim().split(/\s+/),r=m[0].split("."),g=r.length>1?r[1]:r[0],C=r.length>1?r[0]:a||"";m.length==2?o[m[1]]={tableName:g,dbName:C}:i={tableName:g,dbName:a}}),o[l]||i};Wt(()=>{Te(),at(),window.onresize=()=>(()=>{Te()})()});const Te=()=>{t.monacoOptions.height=window.innerHeight-550+"px",t.dataTabsTableHeight=window.innerHeight-274},nt=()=>{document.onmousemove=e=>{e.preventDefault(),t.monacoOptions.height=`${ne.value.offsetHeight+e.movementY}px`,t.monacoOptions.tableMaxHeight-=e.movementY},document.onmouseup=()=>{document.onmousemove=null}},ot=()=>{t.dbs=[],t.dbId=null,t.db="",t.databaseList=[],ee(),Me()},st=async()=>{t.tags=await Qt.getAccountTags.request(null)},_e=async()=>{W(t.dbId,"\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93");let e=ve();W(e&&e.trim(),"\u8BF7\u9009\u4E2D\u9700\u8981\u6267\u884C\u7684sql"),e=e.replace(/(^\s*)/g,"");let a="",l=!0;if((e.startsWith("update")||e.startsWith("UPDATE")||e.startsWith("INSERT")||e.startsWith("insert")||e.startsWith("DELETE")||e.startsWith("delete"))&&(a=(await Ke.prompt("\u8BF7\u8F93\u5165\u5907\u6CE8","Tip",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputPattern:/^[\s\S]*.*[^\s][\s\S]*$/,inputErrorMessage:"\u8BF7\u8F93\u5165\u6267\u884C\u8BE5sql\u7684\u5907\u6CE8\u4FE1\u606F"})).value,a||(l=!1)),!!l){try{t.queryTab.loading=!0;const o=await J(e,a);t.queryTab.execRes.data=o.res,t.queryTab.execRes.tableColumn=o.colNames,t.queryTab.loading=!1}catch{t.queryTab.loading=!1}if(e.startsWith("SELECT *")||e.startsWith("select *")||e.startsWith(`SELECT
  *`)){t.queryTab.selectionDatas=[];const o=e.split(/from/i)[1];if(o){const i=o.trim().split(" ")[0];t.queryTab.nowTableName=i,t.nowTableName=i}else t.queryTab.nowTableName="",t.nowTableName=""}else t.queryTab.nowTableName="",t.nowTableName=""}},ut=()=>{const e=t.queryTab.execRes.data;he(e.length>0,"\u6CA1\u6709\u6570\u636E\u53EF\u5BFC\u51FA");const a=t.queryTab.execRes.tableColumn,l=[a];for(let m of e){let r=[];for(let g of a)r.push(m[g]);l.push(r)}const o=l.map(m=>m.join(",")).join(`
`);let i=document.createElement("a"),b="\uFEFF",d=new Blob([b+o],{type:"text/plain;charset=utrf-8"});i.id="download-csv",i.setAttribute("href",URL.createObjectURL(d)),i.setAttribute("download",`\u67E5\u8BE2\u6570\u636E\u5BFC\u51FA-${Ht("yyyyMMddHHmmss",new Date)}.csv`),document.body.appendChild(i),i.click()},J=async(e,a="")=>await q.sqlExec.request({id:t.dbId,db:t.db,sql:e.trim(),remark:a}),it=e=>{const a=Object.keys(t.dataTabs);let l=t.activeName;a.forEach((o,i)=>{if(o===e){const b=a[i+1]||a[i-1]||t.queryTab.name;b&&(l=b)}}),t.activeName=l,delete t.dataTabs[e]},rt=e=>{const a=e.props.name;a!=t.queryTab.name?(t.tableName=a,t.nowTableName=a):t.nowTableName=t.queryTab.nowTableName},ct=e=>{if(!t.dbId)return M.error("\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93"),!1;M.success(`'${e.name}' \u6B63\u5728\u4E0A\u4F20\u6267\u884C, \u8BF7\u5173\u6CE8\u7ED3\u679C\u901A\u77E5`)},dt=e=>{e.code!==200&&M.error(e.msg)},mt=()=>`${Kt.baseApiUrl}/dbs/${t.dbId}/exec-sql-file?db=${t.db}`,Ne=(e,a,l="equal")=>{e=e+"";let o="";if(!a||!a.length||a.length===0||a===void 0||!e||!e.length||e.length===0||e===void 0)return;if(l==="equal"){for(let m=0;m<a.length;m++)if((a[m][e]+"").length>0){o=a[m][e]+"";break}}else{let m=0;for(let r=0;r<a.length;r++){if(a[r][e]===null)return;const g=a[r][e]+"",C=a[m][e]+"";g.length>C.length&&(m=r)}o=a[m][e]+""}const i=we(o),b=we(e)+43;return(i>b?i:b)+"px"},we=e=>{let a=0;for(const l of e){if(a>500)break;if(l>="0"&&l<="9"||l>="a"&&l<="z"){a+=8.5;continue}if(l>="A"&&l<="Z"){a+=9;continue}l>="\u4E00"&&l<="\u9FA5"?a+=16:a+=8}return a>500&&(a=500),a},bt=(e,a)=>{let l=ce(e);if(!l)return"";const o=l.find(b=>b.columnName==a),i=o.columnComment;return`${o.columnType} ${i?" |  "+i:""}`},ve=()=>{var l,o;let e="";if(!y.getModel)return e;let a=y.getSelection();return a&&(e=(l=y.getModel())==null?void 0:l.getValueInRange(a)),e||((o=y.getModel())==null?void 0:o.getValue())},qe=e=>{t.db="";const a=t.dbs.find(l=>l.id==e);t.dbType=a.type,t.databaseList=a.database.split(" "),ee()},xe=async e=>{!e||(ee(),t.tableMetadata=await ke(e),t.monacoOptions.dbTables[e]=await Be(e),Ie())},ke=async e=>await q.tableMetadata.request({id:t.dbId,db:e}),Be=async e=>await q.hintTables.request({id:t.dbId,db:e}),pt=async(e,a=!0)=>{if(e==""||!a)return;t.nowTableName=e,t.activeName=e;let l=t.dataTabs[e];l||(l={label:e,name:e,datas:[],columnNames:[],pageNum:1,count:0},l.columnNames=await ft(e),t.dataTabs[e]=l,K(e))},X=async e=>{let a=ce(e);return a||(a=await q.columnMetadata.request({id:t.dbId,db:t.db,tableName:e}),oe.set(e,a),a)},ce=e=>oe.get(e),ft=async e=>(await X(e)).map(l=>l.columnName),gt=(e,a)=>{const l=e[0];t.conditionDialog.title=`\u8BF7\u8F93\u5165 [${l.columnName}] \u7684\u503C`,t.conditionDialog.placeholder=`${l.columnType}  ${l.columnComment}`,t.conditionDialog.columnRow=l,t.conditionDialog.dataTab=a,t.conditionDialog.visible=!0},ht=()=>{const e=t.conditionDialog,a=t.conditionDialog.dataTab;let l=a.condition;l&&(l+=" AND ");const o=e.columnRow;l+=`${o.columnName} ${e.condition} `,a.condition=l+te(o,e.value),Fe()},Fe=()=>{t.conditionDialog.visible=!1,t.conditionDialog.title="",t.conditionDialog.placeholder="",t.conditionDialog.value=null,t.conditionDialog.columnRow=null,t.conditionDialog.dataTab=null},K=async e=>{const a=t.dataTabs[e];a.condition="",a.pageNum=1,de(a)},yt=async e=>{de(e)},Et=async(e,a)=>{It(a,"\u6761\u4EF6\u4E0D\u80FD\u4E3A\u7A7A");const l=t.dataTabs[e];l.pageNum=1,de(l)},de=async e=>{e.loading=!0;try{if(e.count=await Ct(e.name,e.condition),e.count>0){const a=await J(Tt(e.name,e.condition,e.orderBy,e.pageNum));e.datas=a.res}else e.datas=[]}finally{e.loading=!1}},Ct=async(e,a="")=>(await J(_t(e,a))).res[0].count,Tt=(e,a="",l="",o=1)=>{const i=`SELECT * FROM ${e} ${a?"WHERE "+a:""} ${l||""}`;return t.dbType=="mysql"?`${i} LIMIT ${(o-1)*U}, ${U};`:t.dbType=="postgres"?`${i} OFFSET ${(o-1)*U} LIMIT ${U};`:i},_t=(e,a="")=>`SELECT COUNT(*) count FROM ${e} ${a?"WHERE "+a:""}`,Se=()=>{W(t.dbId,"\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93"),J("COMMIT;"),M.success("COMMIT success")},Nt=async e=>{if(!t.nowTableName||!e.prop)return;const a=t.activeName,l=e.order=="descending"?"DESC":"ASC",o=`ORDER BY ${e.prop} ${l}`;t.dataTabs[t.activeName].orderBy=o,K(a)},wt=()=>{De()},De=()=>{W(t.dbId,"\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93"),q.getSql.request({id:t.dbId,type:1,name:t.sqlName,db:t.db}).then(e=>{me(e?e.sql:"")})},me=e=>{var a;(a=y.getModel())==null||a.setValue(e)},Ie=()=>{q.getSqlNames.request({id:t.dbId,db:t.db}).then(e=>{e&&e.length>0?(t.sqlNames=e.map(a=>a.name),t.sqlName=t.sqlNames[0]):(t.sqlNames=["default"],t.sqlName="default"),De()})},Ve=async()=>{var a;const e=(a=y.getModel())==null?void 0:a.getValue();W(e,"sql\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"),W(t.dbId,"\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93\u5B9E\u4F8B"),await q.saveSql.request({id:t.dbId,db:t.db,sql:e,type:1,name:t.sqlName}),M.success("\u4FDD\u5B58\u6210\u529F"),q.getSqlNames.request({id:t.dbId,db:t.db}).then(l=>{l&&(t.sqlNames=l.map(o=>o.name))})},vt=async()=>{W(t.dbId,"\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93");try{await Ke.confirm(`\u786E\u5B9A\u5220\u9664\u3010${t.sqlName}\u3011\u8BE5SQL\u6A21\u677F?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await q.deleteDbSql.request({id:t.dbId,name:t.sqlName,db:t.db}),M.success("\u5220\u9664\u6210\u529F"),Ie()}catch{}},ee=()=>{t.tableName="",t.nowTableName="",t.tableMetadata=[],t.dataTabs={},me(""),t.sqlNames=[],t.sqlName="",t.activeName=t.queryTab.name,t.queryTab.execRes.data=[],t.queryTab.execRes.tableColumn=[],oe.clear()},$e=e=>{be()?t.queryTab.selectionDatas=e:t.dataTabs[t.activeName].selectionDatas=e},Le=async()=>{const e=be(),a=e?t.queryTab.selectionDatas:t.dataTabs[t.activeName].selectionDatas;he(a&&a.length>0,"\u8BF7\u5148\u9009\u62E9\u8981\u5220\u9664\u7684\u6570\u636E");const l=await pe(t.nowTableName),o=l.columnName,i=a.map(d=>`${te(l,d[o])}`).join(","),b=`DELETE FROM ${t.nowTableName} WHERE ${o} IN (${i})`;fe(b,null,()=>{e?(t.queryTab.execRes.data=t.queryTab.execRes.data.filter(d=>a.findIndex(m=>m[o]==d[o])==-1),t.queryTab.selectionDatas=[]):K(t.activeName)})},qt=async()=>{const a=be()?t.queryTab.selectionDatas:t.dataTabs[t.activeName].selectionDatas;he(a&&a.length>0,"\u8BF7\u5148\u9009\u62E9\u8981\u751F\u6210insert\u8BED\u53E5\u7684\u6570\u636E");const l=t.nowTableName,o=await X(l),i=[];for(let b of a){let d=[],m=[];for(let r of o){const g=r.columnName;d.push(g),m.push(xt(b[g]))}i.push(`INSERT INTO ${l} (${d.join(", ")}) VALUES(${m.join(", ")})`)}t.genSqlDialog.sql=i.join(`;
`)+";",t.genSqlDialog.visible=!0},xt=e=>e==null?"NULL":typeof e=="number"?e:`'${e}'`,be=()=>t.activeName==t.queryTab.name,Re=(e,a,l)=>{const o=a.property;if(!t.nowTableName||!o)return;let i=(e[o]||e[o]==0?e[o]:"")+"",b=l.children[0];if(b){let d=document.createElement("input");d.setAttribute("value",i),d.setAttribute("style","height:23px;text-align:center;border:none;"+b.getAttribute("style")),l.replaceChildren(d),d.focus(),d.addEventListener("blur",async()=>{if(e[o]=d.value,l.replaceChildren(b),d.value!==i){const m=await pe(t.nowTableName),r=m.columnName,g=await pe(t.nowTableName,a.rawColumnKey),C=`UPDATE ${t.nowTableName} SET ${a.rawColumnKey} = ${te(g,d.value)} 
                                        WHERE ${r} = ${te(m,e[r])}`;fe(C,()=>{e[o]=i})}})}},pe=async(e,a="")=>{const l=await X(e);return a?l.find(o=>o.columnName==a):l.find(i=>i.columnKey=="PRI")||l[0]},te=(e,a)=>kt(e.columnType)?a:`'${a}'`,kt=e=>e.match(/int|double|float|nubmer|decimal/gi),fe=(e,a=null,l=null)=>{Dt({sql:e,dbId:t.dbId,db:t.db,runSuccessCallback:l,cancelCallback:a})},Bt=async()=>{const e=t.nowTableName,a=await X(e);let l={};a.forEach(d=>{l[`${d.columnName}`]=`'${d.columnName}[${d.columnType}]${d.nullable=="YES"?"":"[not null]"}'`});let o=Object.keys(l).join(","),i=Object.values(l).join(","),b=`INSERT INTO ${t.nowTableName} (${o}) VALUES (${i});`;fe(b,null,()=>{K(e)})},Ae=()=>{var l,o;let e=y.getSelection(),a=(l=y.getModel())==null?void 0:l.getValueInRange(e);if(a){Ft(Ue.format(a),e);return}(o=y.getModel())==null||o.setValue(Ue.format(y.getValue()))},Ft=(e,a)=>{if(!a){y.getModel().setValue(e);return}const{startLineNumber:l,endLineNumber:o,startColumn:i,endColumn:b}=a,d=y.getModel(),m=d.getValueInRange({startLineNumber:1,startColumn:0,endLineNumber:l,endColumn:i}),r=d.getValueInRange({startLineNumber:o,startColumn:b,endLineNumber:d.getLineCount(),endColumn:d.getLineMaxColumn(d.getLineCount())});y.setValue(m+e+r),y.focus(),y.setPosition({lineNumber:l,column:0})},Me=async()=>{const e=await q.dbs.request(t.params);t.dbs=e.list},Oe=async e=>{let a=ve();a&&a.length>0&&t.dbId&&await Ve();const{tagPath:l,dbId:o,db:i}=e.dbOptInfo;t.params.tagPath=l,await Me(),qe(o),t.dbId=o,t.db=i,await xe(i)};let We=le.state.sqlExecInfo;return We.dbOptInfo.tagPath&&Oe(We),Ut(le.state.sqlExecInfo,async e=>{await Oe(e)}),(e,a)=>{const l=h("el-option"),o=h("el-select"),i=h("el-form-item"),b=h("el-form"),d=h("el-col"),m=h("el-row"),r=h("el-link"),g=h("el-divider"),C=h("el-tooltip"),ge=h("el-upload"),I=h("el-button"),P=h("el-icon"),T=h("el-table-column"),p=h("el-table"),O=h("el-tab-pane"),V=h("el-popover"),$=h("el-input"),v=h("el-pagination"),k=h("el-tabs"),B=h("el-container"),L=h("el-dialog"),j=zt("loading");return f(),x("div",null,[N("div",Zt,[s(m,{type:"flex",justify:"space-between"},{default:u(()=>[s(d,{span:24},{default:u(()=>[s(b,{class:"search-form","label-position":"right",inline:!0},{default:u(()=>[s(i,{label:"\u6807\u7B7E"},{default:u(()=>[s(o,{onChange:ot,onFocus:st,modelValue:c(Ee).tagPath,"onUpdate:modelValue":a[0]||(a[0]=n=>c(Ee).tagPath=n),placeholder:"\u8BF7\u9009\u62E9\u6807\u7B7E",filterable:"",style:{width:"220px"}},{default:u(()=>[(f(!0),x(R,null,A(c(He),n=>(f(),_(l,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(i,{label:"\u8D44\u6E90"},{default:u(()=>[s(o,{modelValue:c(Z),"onUpdate:modelValue":a[1]||(a[1]=n=>H(Z)?Z.value=n:null),placeholder:"\u8BF7\u9009\u62E9\u8D44\u6E90\u5B9E\u4F8B",onChange:qe,filterable:"",style:{width:"220px"}},{default:u(()=>[(f(!0),x(R,null,A(c(Qe),n=>(f(),_(l,{key:n.id,label:`${n.name} [${n.tagPath}]`,value:n.id},{default:u(()=>[N("span",Jt,Q(`${n.name} [${n.tagPath}]`),1),N("span",Xt,Q(`${n.host}:${n.port} ${n.type}`),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(i,{label:"\u6570\u636E\u5E93"},{default:u(()=>[s(o,{modelValue:c(se),"onUpdate:modelValue":a[2]||(a[2]=n=>H(se)?se.value=n:null),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93",onChange:xe,onClear:ee,clearable:"",filterable:"",style:{width:"150px"}},{default:u(()=>[(f(!0),x(R,null,A(c(Ge),n=>(f(),_(l,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(i,{"label-width":"20",label:"\u8868"},{default:u(()=>[s(o,{modelValue:c(ue),"onUpdate:modelValue":a[3]||(a[3]=n=>H(ue)?ue.value=n:null),placeholder:"\u9009\u62E9\u8868\u67E5\u770B\u8868\u6570\u636E",onChange:pt,filterable:"",style:{width:"250px"}},{default:u(()=>[(f(!0),x(R,null,A(c(Ye),n=>(f(),_(l,{key:n.tableName,label:n.tableName+(n.tableComment!=""?`\u3010${n.tableComment}\u3011`:""),value:n.tableName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),s(B,{id:"data-exec",style:{border:"1px solid #eee","margin-top":"1px"}},{default:u(()=>[s(k,{onTabRemove:it,onTabClick:rt,style:{width:"100%"},modelValue:c(re),"onUpdate:modelValue":a[5]||(a[5]=n=>H(re)?re.value=n:null)},{default:u(()=>[s(O,{label:c(w).label,name:c(w).name},{default:u(()=>[N("div",null,[N("div",null,[N("div",ea,[N("div",ta,[s(r,{onClick:_e,underline:!1,class:"ml15",icon:"VideoPlay"}),s(g,{direction:"vertical","border-style":"dashed"}),s(C,{class:"box-item",effect:"dark",content:"format sql",placement:"top"},{default:u(()=>[s(r,{onClick:Ae,type:"primary",underline:!1,icon:"MagicStick"})]),_:1}),s(g,{direction:"vertical","border-style":"dashed"}),s(C,{class:"box-item",effect:"dark",content:"commit",placement:"top"},{default:u(()=>[s(r,{onClick:Se,type:"success",underline:!1,icon:"CircleCheck"})]),_:1}),s(g,{direction:"vertical","border-style":"dashed"}),s(ge,{style:{display:"inline-block"},"before-upload":ct,"on-success":dt,headers:{Authorization:c(ye)},data:{dbId:1},action:mt(),"show-file-list":!1,name:"file",multiple:"",limit:100},{default:u(()=>[s(C,{class:"box-item",effect:"dark",content:"SQL\u811A\u672C\u6267\u884C",placement:"top"},{default:u(()=>[s(r,{type:"success",underline:!1,icon:"Document"})]),_:1})]),_:1},8,["headers","action"])]),N("div",aa,[s(o,{modelValue:c(ie),"onUpdate:modelValue":a[4]||(a[4]=n=>H(ie)?ie.value=n:null),placeholder:"\u9009\u62E9or\u8F93\u5165SQL\u6A21\u677F\u540D",onChange:wt,filterable:"","allow-create":"","default-first-option":"",size:"small",class:"mr10"},{default:u(()=>[(f(!0),x(R,null,A(c(Ze),n=>(f(),_(l,{key:n,label:n.database,value:n},{default:u(()=>[F(Q(n),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),s(I,{onClick:Ve,type:"primary",icon:"document-add",plain:"",size:"small"},{default:u(()=>[F("\u4FDD\u5B58 ")]),_:1}),s(I,{onClick:vt,type:"danger",icon:"delete",plain:"",size:"small"},{default:u(()=>[F("\u5220\u9664 ")]),_:1})])])]),N("div",la,[N("div",{ref_key:"monacoTextarea",ref:ne,style:Pt({height:c(Ce).height})},null,4)]),N("div",{class:"editor-move-resize",onMousedown:nt},[s(P,null,{default:u(()=>[s(c(jt))]),_:1})],32),N("div",na,[s(m,null,{default:u(()=>[c(w).nowTableName?(f(),_(r,{key:0,onClick:Le,class:"ml5",type:"danger",icon:"delete",underline:!1})):G("",!0),c(w).execRes.data.length>0?(f(),x("span",oa,[s(g,{direction:"vertical","border-style":"dashed"}),s(r,{type:"success",underline:!1,onClick:ut},{default:u(()=>[sa]),_:1})])):G("",!0)]),_:1}),ze((f(),_(p,{onCellDblclick:Re,onSelectionChange:$e,data:c(w).execRes.data,"element-loading-text":"\u67E5\u8BE2\u4E2D...",size:"small","max-height":c(Ce).tableMaxHeight,"empty-text":"tips: select *\u5F00\u5934\u7684\u5355\u8868\u67E5\u8BE2\u6216\u70B9\u51FB\u8868\u540D\u9ED8\u8BA4\u67E5\u8BE2\u7684\u6570\u636E,\u53EF\u53CC\u51FB\u6570\u636E\u5728\u7EBF\u4FEE\u6539",stripe:"",border:"",class:"mt5"},{default:u(()=>[c(w).execRes.tableColumn.length>0&&c(w).nowTableName?(f(),_(T,{key:0,type:"selection",width:"35"})):G("",!0),(f(!0),x(R,null,A(c(w).execRes.tableColumn,n=>(f(),_(T,{"min-width":"100",width:Ne(n,c(w).execRes.data),align:"center",key:n,prop:n,label:n,"show-overflow-tooltip":""},null,8,["width","prop","label"]))),128))]),_:1},8,["data","max-height"])),[[j,c(w).loading]])])])]),_:1},8,["label","name"]),(f(!0),x(R,null,A(c(Xe),n=>(f(),_(O,{closable:"",key:n.name,label:n.label,name:n.name},{default:u(()=>[c(Z)?(f(),_(m,{key:0},{default:u(()=>[s(d,{span:8},{default:u(()=>[s(r,{onClick:E=>K(n.name),icon:"refresh",underline:!1,class:"ml5"},null,8,["onClick"]),s(g,{direction:"vertical","border-style":"dashed"}),s(r,{onClick:Bt,type:"primary",icon:"plus",underline:!1}),s(g,{direction:"vertical","border-style":"dashed"}),s(r,{onClick:Le,type:"danger",icon:"delete",underline:!1}),s(g,{direction:"vertical","border-style":"dashed"}),s(C,{class:"box-item",effect:"dark",content:"commit",placement:"top"},{default:u(()=>[s(r,{onClick:Se,type:"success",icon:"CircleCheck",underline:!1})]),_:1}),s(g,{direction:"vertical","border-style":"dashed"}),s(C,{class:"box-item",effect:"dark",content:"\u751F\u6210insert sql",placement:"top"},{default:u(()=>[s(r,{onClick:qt,type:"success",underline:!1},{default:u(()=>[F("gi")]),_:1})]),_:1})]),_:2},1024),s(d,{span:16},{default:u(()=>[s($,{modelValue:n.condition,"onUpdate:modelValue":E=>n.condition=E,placeholder:"\u82E5\u9700\u6761\u4EF6\u8FC7\u6EE4\uFF0C\u53EF\u9009\u62E9\u5217\u5E76\u70B9\u51FB\u5BF9\u5E94\u7684\u5B57\u6BB5\u5E76\u8F93\u5165\u9700\u8981\u8FC7\u6EE4\u7684\u5185\u5BB9\u70B9\u51FB\u67E5\u8BE2\u6309\u94AE\u5373\u53EF",clearable:"",size:"small",style:{width:"100%"}},{prepend:u(()=>[s(V,{trigger:"click",width:320,placement:"right"},{reference:u(()=>[s(r,{type:"success",underline:!1},{default:u(()=>[F("\u9009\u62E9\u5217")]),_:1})]),default:u(()=>[s(p,{data:ce(n.name),"max-height":"500",size:"small",onRowClick:(...E)=>{gt(E,n)},style:{cursor:"pointer"}},{default:u(()=>[s(T,{property:"columnName",label:"\u5217\u540D","show-overflow-tooltip":""}),s(T,{property:"columnComment",label:"\u5907\u6CE8","show-overflow-tooltip":""})]),_:2},1032,["data","onRowClick"])]),_:2},1024)]),append:u(()=>[s(I,{onClick:E=>Et(n.name,n.condition),icon:"search",size:"small"},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):G("",!0),ze((f(),_(p,{onCellDblclick:Re,onSortChange:Nt,onSelectionChange:$e,data:n.datas,size:"small","max-height":c(et),"element-loading-text":"\u67E5\u8BE2\u4E2D...","empty-text":"\u6682\u65E0\u6570\u636E",stripe:"",border:"",class:"mt5"},{default:u(()=>[n.datas.length>0?(f(),_(T,{key:0,type:"selection",width:"35"})):G("",!0),(f(!0),x(R,null,A(n.columnNames,E=>(f(),_(T,{"min-width":"100",width:Ne(E,n.datas),align:"center",key:E,prop:E,label:E,"show-overflow-tooltip":"",sortable:c(Je)!=""?"custom":!1},{header:u(()=>[s(C,{"raw-content":"",placement:"top",effect:"customized"},{content:u(()=>[F(Q(bt(n.name,E)),1)]),default:u(()=>[F(" "+Q(E),1)]),_:2},1024)]),_:2},1032,["width","prop","label","sortable"]))),128))]),_:2},1032,["data","max-height"])),[[j,n.loading]]),s(m,{type:"flex",class:"mt5",justify:"center"},{default:u(()=>[s(v,{small:"",total:n.count,onCurrentChange:E=>yt(n),layout:"prev, pager, next, total, jumper","current-page":n.pageNum,"onUpdate:current-page":E=>n.pageNum=E,"page-size":U},null,8,["total","onCurrentChange","current-page","onUpdate:current-page"])]),_:2},1024)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(L,{modelValue:c(D).visible,"onUpdate:modelValue":a[8]||(a[8]=n=>c(D).visible=n),title:c(D).title,width:"420px"},{footer:u(()=>[N("span",ua,[s(I,{onClick:Fe},{default:u(()=>[F("\u53D6\u6D88")]),_:1}),s(I,{type:"primary",onClick:ht},{default:u(()=>[F("\u786E\u5B9A")]),_:1})])]),default:u(()=>[s(m,null,{default:u(()=>[s(d,{span:5},{default:u(()=>[s(o,{modelValue:c(D).condition,"onUpdate:modelValue":a[6]||(a[6]=n=>c(D).condition=n)},{default:u(()=>[s(l,{label:"=",value:"="}),s(l,{label:"LIKE",value:"LIKE"}),s(l,{label:">",value:">"}),s(l,{label:">=",value:">="}),s(l,{label:"<",value:"<"}),s(l,{label:"<=",value:"<="})]),_:1},8,["modelValue"])]),_:1}),s(d,{span:19},{default:u(()=>[s($,{modelValue:c(D).value,"onUpdate:modelValue":a[7]||(a[7]=n=>c(D).value=n),placeholder:c(D).placeholder},null,8,["modelValue","placeholder"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"]),s(L,{onClose:a[10]||(a[10]=n=>c(z).visible=!1),modelValue:c(z).visible,"onUpdate:modelValue":a[11]||(a[11]=n=>c(z).visible=n),title:"SQL",width:"1000px"},{default:u(()=>[s($,{modelValue:c(z).sql,"onUpdate:modelValue":a[9]||(a[9]=n=>c(z).sql=n),type:"textarea",rows:"20"},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}});var ha=ia;export{ha as default};
