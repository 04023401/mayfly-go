var M=Object.defineProperty,K=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var O=(e,l,d)=>l in e?M(e,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[l]=d,F=(e,l)=>{for(var d in l||(l={}))G.call(l,d)&&O(e,d,l[d]);if(N)for(var d of N(l))H.call(l,d)&&O(e,d,l[d]);return e},w=(e,l)=>K(e,R(l));import{c as B}from"./api.16667884549733.js";import{d as z,r as Q,c as A,J as W,t as L,_ as J,k as r,m as p,p as _,q as a,w as o,y as I,A as D,O as U,P as $,v as y,e as X,D as Y,E as P}from"./index.1666788454973.js";import"./Api.1666788454973.js";const Z=z({name:"ConfigEdit",props:{visible:{type:Boolean},data:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:l}){const d=Q(null),i=A({dvisible:!1,params:[],form:{id:null,name:"",key:"",params:"",value:"",remark:""},btnLoading:!1});W(e,s=>{i.dvisible=s.visible,s.data?(i.form=F({},s.data),i.form.params?i.params=JSON.parse(i.form.params):i.params=[]):(i.form={},i.params=[])});const v=()=>{i.params.push({name:"",model:"",placeholder:""})},h=s=>{i.params.splice(s,1)},m=()=>{l("update:visible",!1),l("cancel")},g=async()=>{d.value.validate(async s=>{s&&(i.params&&(i.form.params=JSON.stringify(i.params)),await B.save.request(i.form),l("val-change",i.form),m(),i.btnLoading=!0,setTimeout(()=>{i.btnLoading=!1},1e3))})};return w(F({},L(i)),{onAddParam:v,onDeleteParam:h,configForm:d,btnOk:g,cancel:m})}}),x={class:"dialog-footer"};function ee(e,l,d,i,v,h){const m=r("el-input"),g=r("el-form-item"),s=r("el-button"),C=r("el-row"),n=r("el-col"),f=r("el-divider"),V=r("el-form"),E=r("el-dialog");return p(),_("div",null,[a(E,{title:e.title,modelValue:e.dvisible,"onUpdate:modelValue":l[4]||(l[4]=u=>e.dvisible=u),"show-close":!1,"before-close":e.cancel,width:"750px","destroy-on-close":!0},{footer:o(()=>[I("div",x,[a(s,{onClick:l[3]||(l[3]=u=>e.cancel())},{default:o(()=>[D("\u53D6 \u6D88")]),_:1}),a(s,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:o(()=>[D("\u786E \u5B9A")]),_:1},8,["loading","onClick"])])]),default:o(()=>[a(V,{ref:"configForm",model:e.form,"label-width":"90px"},{default:o(()=>[a(g,{prop:"name",label:"\u914D\u7F6E\u9879:",required:""},{default:o(()=>[a(m,{modelValue:e.form.name,"onUpdate:modelValue":l[0]||(l[0]=u=>e.form.name=u)},null,8,["modelValue"])]),_:1}),a(g,{prop:"key",label:"\u914D\u7F6Ekey:",required:""},{default:o(()=>[a(m,{disabled:e.form.id!=null,modelValue:e.form.key,"onUpdate:modelValue":l[1]||(l[1]=u=>e.form.key=u)},null,8,["disabled","modelValue"])]),_:1}),a(C,{style:{"margin-left":"30px","margin-bottom":"5px"}},{default:o(()=>[a(s,{onClick:e.onAddParam,size:"small",type:"success"},{default:o(()=>[D("\u65B0\u589E\u914D\u7F6E\u9879")]),_:1},8,["onClick"])]),_:1}),(p(!0),_(U,null,$(e.params,(u,k)=>(p(),y(g,{key:u,prop:"params",label:`\u53C2\u6570${k+1}`},{default:o(()=>[a(C,null,{default:o(()=>[a(n,{span:5},{default:o(()=>[a(m,{modelValue:u.model,"onUpdate:modelValue":c=>u.model=c,placeholder:"model"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(f,{span:1,direction:"vertical","border-style":"dashed"}),a(n,{span:4},{default:o(()=>[a(m,{modelValue:u.name,"onUpdate:modelValue":c=>u.name=c,placeholder:"\u5B57\u6BB5\u540D"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(f,{span:1,direction:"vertical","border-style":"dashed"}),a(n,{span:4},{default:o(()=>[a(m,{modelValue:u.placeholder,"onUpdate:modelValue":c=>u.placeholder=c,placeholder:"\u5B57\u6BB5\u8BF4\u660E"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(f,{span:1,direction:"vertical","border-style":"dashed"}),a(n,{span:4},{default:o(()=>[a(m,{modelValue:u.options,"onUpdate:modelValue":c=>u.options=c,placeholder:"\u53EF\u9009\u503C ,\u5206\u5272"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(f,{span:1,direction:"vertical","border-style":"dashed"}),a(n,{span:2},{default:o(()=>[a(s,{onClick:c=>e.onDeleteParam(k),size:"small",type:"danger"},{default:o(()=>[D("\u5220\u9664")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]))),128)),a(g,{label:"\u5907\u6CE8:"},{default:o(()=>[a(m,{modelValue:e.form.remark,"onUpdate:modelValue":l[2]||(l[2]=u=>e.form.remark=u),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue","before-close"])])}var le=J(Z,[["render",ee]]);const ae=z({name:"ConfigList",components:{ConfigEdit:le},setup(){const e=A({dialogFormVisible:!1,currentEditPermissions:!1,query:{pageNum:1,pageSize:10,name:null},total:0,configs:[],chooseId:null,chooseData:null,paramsDialog:{visible:!1,config:null,params:{},paramsFormItem:[]},configEdit:{title:"\u914D\u7F6E\u4FEE\u6539",visible:!1,config:{}}});X(()=>{l()});const l=async()=>{let n=await B.list.request(e.query);e.configs=n.list,e.total=n.total},d=n=>{e.query.pageNum=n,l()},i=n=>{e.paramsDialog.config=n,n.params?(e.paramsDialog.paramsFormItem=JSON.parse(n.params),e.paramsDialog.paramsFormItem&&e.paramsDialog.paramsFormItem.length>0&&n.value&&(e.paramsDialog.params=JSON.parse(n.value))):e.paramsDialog.params=n.value,e.paramsDialog.visible=!0},v=()=>{e.paramsDialog.visible=!1,setTimeout(()=>{e.paramsDialog.config={},e.paramsDialog.params={},e.paramsDialog.paramsFormItem=[]},300)},h=async()=>{let n=e.paramsDialog.params;if(e.paramsDialog.paramsFormItem.length>0){for(let f in n)m(f,e.paramsDialog.paramsFormItem)||delete n[f];n=JSON.stringify(n)}await B.save.request({id:e.paramsDialog.config.id,key:e.paramsDialog.config.key,name:e.paramsDialog.config.name,value:n}),P.success("\u4FDD\u5B58\u6210\u529F"),v(),l()},m=(n,f)=>{for(let V of f)if(V.model==n)return!0;return!1},g=n=>{!n||(e.chooseId=n.id,e.chooseData=n)},s=()=>{P.success("\u4FDD\u5B58\u6210\u529F"),e.chooseId=null,e.chooseData=null,l()},C=n=>{n?e.configEdit.config=n:e.configEdit.config=!1,e.configEdit.visible=!0};return w(F({},L(e)),{showSetConfigDialog:i,closeSetConfigDialog:v,setConfig:h,search:l,handlePageChange:d,choose:g,configEditChange:s,editConfig:C})}}),oe={class:"role-list"},ne=I("i",null,null,-1),te={class:"dialog-footer"};function se(e,l,d,i,v,h){const m=r("el-button"),g=r("el-radio"),s=r("el-table-column"),C=r("el-link"),n=r("el-table"),f=r("el-pagination"),V=r("el-row"),E=r("el-card"),u=r("el-input"),k=r("el-option"),c=r("el-select"),q=r("el-form-item"),S=r("el-form"),T=r("el-dialog"),j=r("config-edit");return p(),_("div",oe,[a(E,null,{default:o(()=>[a(m,{type:"primary",icon:"plus",onClick:l[0]||(l[0]=t=>e.editConfig(!1))},{default:o(()=>[D("\u6DFB\u52A0")]),_:1}),a(m,{disabled:e.chooseId==null,onClick:l[1]||(l[1]=t=>e.editConfig(e.chooseData)),type:"primary",icon:"edit"},{default:o(()=>[D("\u7F16\u8F91")]),_:1},8,["disabled"]),a(n,{data:e.configs,onCurrentChange:e.choose,ref:"table",style:{width:"100%"}},{default:o(()=>[a(s,{label:"\u9009\u62E9",width:"55px"},{default:o(t=>[a(g,{modelValue:e.chooseId,"onUpdate:modelValue":l[2]||(l[2]=b=>e.chooseId=b),label:t.row.id},{default:o(()=>[ne]),_:2},1032,["modelValue","label"])]),_:1}),a(s,{prop:"name",label:"\u914D\u7F6E\u9879"}),a(s,{prop:"key",label:"\u914D\u7F6Ekey"}),a(s,{prop:"value",label:"\u914D\u7F6E\u503C","min-width":"100px","show-overflow-tooltip":""}),a(s,{prop:"remark",label:"\u5907\u6CE8","min-width":"100px","show-overflow-tooltip":""}),a(s,{prop:"updateTime",label:"\u66F4\u65B0\u65F6\u95F4","min-width":"100px"},{default:o(t=>[D(Y(e.$filters.dateFormat(t.row.createTime)),1)]),_:1}),a(s,{prop:"modifier",label:"\u4FEE\u6539\u8005","show-overflow-tooltip":""}),a(s,{label:"\u64CD\u4F5C","min-width":"50",fixed:"right"},{default:o(t=>[a(C,{disabled:t.row.status==-1,type:"warning",onClick:b=>e.showSetConfigDialog(t.row),plain:"",size:"small",underline:!1},{default:o(()=>[D("\u914D\u7F6E")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),a(V,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:o(()=>[a(f,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":l[3]||(l[3]=t=>e.query.pageNum=t),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),a(T,{"before-close":e.closeSetConfigDialog,title:"\u914D\u7F6E\u9879\u8BBE\u7F6E",modelValue:e.paramsDialog.visible,"onUpdate:modelValue":l[7]||(l[7]=t=>e.paramsDialog.visible=t),width:"500px"},{footer:o(()=>[I("span",te,[a(m,{onClick:l[5]||(l[5]=t=>e.closeSetConfigDialog())},{default:o(()=>[D("\u53D6 \u6D88")]),_:1}),a(m,{type:"primary",onClick:l[6]||(l[6]=t=>e.setConfig())},{default:o(()=>[D("\u786E \u5B9A")]),_:1})])]),default:o(()=>[e.paramsDialog.paramsFormItem.length>0?(p(),y(S,{key:0,ref:"paramsForm",model:e.paramsDialog.params,"label-width":"90px"},{default:o(()=>[(p(!0),_(U,null,$(e.paramsDialog.paramsFormItem,t=>(p(),y(q,{key:t.name,prop:t.model,label:t.name,required:""},{default:o(()=>[t.options?(p(),y(c,{key:1,modelValue:e.paramsDialog.params[t.model],"onUpdate:modelValue":b=>e.paramsDialog.params[t.model]=b,placeholder:t.placeholder,filterable:"",autocomplete:"off",clearable:"",style:{width:"100%"}},{default:o(()=>[(p(!0),_(U,null,$(t.options.split(","),b=>(p(),y(k,{key:b,label:b,value:b},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):(p(),y(u,{key:0,modelValue:e.paramsDialog.params[t.model],"onUpdate:modelValue":b=>e.paramsDialog.params[t.model]=b,placeholder:t.placeholder,autocomplete:"off",clearable:""},null,8,["modelValue","onUpdate:modelValue","placeholder"]))]),_:2},1032,["prop","label"]))),128))]),_:1},8,["model"])):(p(),y(S,{key:1,ref:"paramsForm","label-width":"90px"},{default:o(()=>[a(q,{label:"\u914D\u7F6E\u503C",required:""},{default:o(()=>[a(u,{modelValue:e.paramsDialog.params,"onUpdate:modelValue":l[4]||(l[4]=t=>e.paramsDialog.params=t),placeholder:e.paramsDialog.config.remark,autocomplete:"off",clearable:""},null,8,["modelValue","placeholder"])]),_:1})]),_:1},512))]),_:1},8,["before-close","modelValue"]),a(j,{title:e.configEdit.title,visible:e.configEdit.visible,"onUpdate:visible":l[8]||(l[8]=t=>e.configEdit.visible=t),data:e.configEdit.config,onValChange:e.configEditChange},null,8,["title","visible","data","onValChange"])])}var me=J(ae,[["render",se]]);export{me as default};
