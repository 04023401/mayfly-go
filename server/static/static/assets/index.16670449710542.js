var te=Object.defineProperty;var U=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var T=(n,i,s)=>i in n?te(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s,B=(n,i)=>{for(var s in i||(i={}))ne.call(i,s)&&T(n,s,i[s]);if(U)for(var s of U(i))se.call(i,s)&&T(n,s,i[s]);return n};import{o as x,_ as $,d as K,u as N,a as le,b as ie,r as R,c as M,t as W,e as re,n as ue,f as Z,g as ce,h as f,i as V,j,k as a,w as l,l as o,m as de,p as ge,q as p,s as pe,v as S,x as G,y as H,z as q,A as me,B as fe,C as L,E as z,D as we,F as he,G as _e,H as be,T as ye,I as ve,J as xe}from"./index.1667044971054.js";import{R as P}from"./rsa.1667044971054.js";import"./assert.1667044971054.js";const Fe="UseLoginCaptcha",Ce="UseWartermark";async function Be(n){return await x.getConfigValue({key:n})}async function J(n,i){const s=await Be(n);return s?s=="1":i}async function Pe(){return await J(Fe,!0)}async function Ve(){return await J(Ce,!0)}const De=n=>(G("data-v-2abedfa5"),n=n(),H(),n),ke={class:"login-content-code"},Ee=["src"],Ie=De(()=>p("span",null,"\u767B \u5F55",-1)),Ae={class:"dialog-footer"},Ue=K({__name:"AccountLogin",setup(n){const i={username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}],captcha:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}]},s=N(),_=le(),w=ie(),b=R(null),y=R(null),e=M({isUseLoginCaptcha:!1,captchaImage:"",loginForm:{username:"",password:"",captcha:"",cid:""},changePwdDialog:{visible:!1,form:{username:"",oldPassword:"",newPassword:""},rules:{newPassword:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801",trigger:"blur"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)(?=.*[`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]])[A-Za-z\d`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]]{8,}$/,message:"\u987B\u4E3A8\u4F4D\u4EE5\u4E0A\u4E14\u5305\u542B\u5B57\u2E9F\u2F24\u2F29\u5199+\u6570\u5B57+\u7279\u6B8A\u7B26\u53F7",trigger:"blur"}]}},loading:{signIn:!1,changePwd:!1}}),{isUseLoginCaptcha:v,captchaImage:F,loginForm:m,changePwdDialog:g,loading:D}=W(e);re(async()=>{ue(async()=>{e.isUseLoginCaptcha=await Pe(),h()}),sessionStorage.removeItem("RsaPublicKey")});const h=async()=>{if(!e.isUseLoginCaptcha)return;let r=await x.captcha();e.captchaImage=r.base64Captcha,e.loginForm.cid=r.cid},Q=Z(()=>ce(new Date)),k=()=>{b.value.validate(r=>{if(r)X();else return!1})},X=async()=>{e.loading.signIn=!0;let r;const t=e.loginForm.password;try{const c=B({},e.loginForm);c.password=await P(t),r=await x.login(c),q("token",r.token),q("menus",r.menus)}catch(c){e.loading.signIn=!1,e.loginForm.captcha="",c.code&&c.code==401?(e.changePwdDialog.form.username=e.loginForm.username,e.changePwdDialog.form.oldPassword=t,e.changePwdDialog.form.newPassword="",e.changePwdDialog.visible=!0):h();return}const u={username:e.loginForm.username,photo:me(e.loginForm.username),time:new Date().getTime(),permissions:r.permissions,lastLoginTime:r.lastLoginTime,lastLoginIp:r.lastLoginIp};fe(u),s.dispatch("userInfos/setUserInfos",u),s.state.themeConfig.themeConfig.isRequestRoutes?(await L(),E()):(await L(),E())},E=()=>{var t;let r=Q.value;(t=_.query)!=null&&t.redirect?w.push(_.query.redirect):w.push("/"),setTimeout(async()=>{e.loading.signIn=!0,z.success(`${r}\uFF0C\u6B22\u8FCE\u56DE\u6765\uFF01`),await Ve()&&we(!0)},300)},Y=()=>{y.value.validate(async r=>{if(!r)return!1;try{e.loading.changePwd=!0;const t=e.changePwdDialog.form,u=B({},t);u.oldPassword=await P(t.oldPassword),u.newPassword=await P(t.newPassword),await x.changePwd(u),z.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F, \u65B0\u5BC6\u7801\u5DF2\u586B\u5145\u81F3\u767B\u5F55\u5BC6\u7801\u6846"),e.loginForm.password=e.changePwdDialog.form.newPassword,e.changePwdDialog.visible=!1,h()}finally{e.loading.changePwd=!1}})},ee=()=>{e.changePwdDialog.visible=!1,e.changePwdDialog.form.newPassword="",e.changePwdDialog.form.oldPassword="",e.changePwdDialog.form.username="",h()};return(r,t)=>{const u=f("el-input"),c=f("el-form-item"),I=f("el-col"),oe=f("el-row"),C=f("el-button"),A=f("el-form"),ae=f("el-dialog");return V(),j("div",null,[a(A,{ref_key:"loginFormRef",ref:b,model:o(m),rules:i,class:"login-content-form",size:"large"},{default:l(()=>[a(c,{prop:"username"},{default:l(()=>[a(u,{type:"text",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D","prefix-icon":"user",modelValue:o(m).username,"onUpdate:modelValue":t[0]||(t[0]=d=>o(m).username=d),clearable:"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(c,{prop:"password"},{default:l(()=>[a(u,{type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","prefix-icon":"lock",modelValue:o(m).password,"onUpdate:modelValue":t[1]||(t[1]=d=>o(m).password=d),autocomplete:"off","show-password":""},null,8,["modelValue"])]),_:1}),o(v)?(V(),de(c,{key:0,prop:"captcha"},{default:l(()=>[a(oe,{gutter:15},{default:l(()=>[a(I,{span:16},{default:l(()=>[a(u,{type:"text",maxlength:"6",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801","prefix-icon":"position",modelValue:o(m).captcha,"onUpdate:modelValue":t[2]||(t[2]=d=>o(m).captcha=d),clearable:"",autocomplete:"off",onKeyup:ge(k,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),a(I,{span:8},{default:l(()=>[p("div",ke,[p("img",{class:"login-content-code-img",onClick:h,width:"130px",height:"40px",src:o(F),style:{cursor:"pointer"}},null,8,Ee)])]),_:1})]),_:1})]),_:1})):pe("",!0),a(c,null,{default:l(()=>[a(C,{type:"primary",class:"login-content-submit",round:"",onClick:k,loading:o(D).signIn},{default:l(()=>[Ie]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),a(ae,{title:"\u4FEE\u6539\u5BC6\u7801",modelValue:o(g).visible,"onUpdate:modelValue":t[6]||(t[6]=d=>o(g).visible=d),"close-on-click-modal":!1,width:"450px","destroy-on-close":!0},{footer:l(()=>[p("div",Ae,[a(C,{onClick:ee},{default:l(()=>[S("\u53D6 \u6D88")]),_:1}),a(C,{onClick:Y,type:"primary",loading:o(D).changePwd},{default:l(()=>[S("\u786E \u5B9A")]),_:1},8,["loading"])])]),default:l(()=>[a(A,{model:o(g).form,rules:o(g).rules,ref_key:"changePwdFormRef",ref:y,"label-width":"65px"},{default:l(()=>[a(c,{prop:"username",label:"\u7528\u6237\u540D",required:""},{default:l(()=>[a(u,{modelValue:o(g).form.username,"onUpdate:modelValue":t[3]||(t[3]=d=>o(g).form.username=d),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),_:1}),a(c,{prop:"oldPassword",label:"\u65E7\u5BC6\u7801",required:""},{default:l(()=>[a(u,{modelValue:o(g).form.oldPassword,"onUpdate:modelValue":t[4]||(t[4]=d=>o(g).form.oldPassword=d),modelModifiers:{trim:!0},autocomplete:"new-password",type:"password"},null,8,["modelValue"])]),_:1}),a(c,{prop:"newPassword",label:"\u65B0\u5BC6\u7801",required:""},{default:l(()=>[a(u,{modelValue:o(g).form.newPassword,"onUpdate:modelValue":t[5]||(t[5]=d=>o(g).form.newPassword=d),modelModifiers:{trim:!0},placeholder:"\u987B\u4E3A8\u4F4D\u4EE5\u4E0A\u4E14\u5305\u542B\u5B57\u2E9F\u2F24\u2F29\u5199+\u6570\u5B57+\u7279\u6B8A\u7B26\u53F7",type:"password",autocomplete:"new-password"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});var Te=$(Ue,[["__scopeId","data-v-2abedfa5"]]);const O=n=>(G("data-v-95005104"),n=n(),H(),n),Re={class:"login-container"},Se={class:"login-logo"},qe={class:"login-content-main"},Le=O(()=>p("h4",{class:"login-content-title"},"mayfly-go",-1)),ze=O(()=>p("div",{class:"login-copyright"},[p("div",{class:"mb5 login-copyright-company"},"mayfly"),p("div",{class:"login-copyright-msg"},"mayfly")],-1)),$e=K({__name:"index",setup(n){const i=N(),s=M({tabsActiveName:"account",isTabPaneShow:!0}),{isTabPaneShow:_,tabsActiveName:w}=W(s),b=Z(()=>i.state.themeConfig.themeConfig),y=()=>{s.isTabPaneShow=!s.isTabPaneShow};return(e,v)=>{const F=f("el-tab-pane"),m=f("el-tabs");return V(),j("div",Re,[p("div",Se,[p("span",null,he(o(b).globalViceTitle),1)]),p("div",{class:be(["login-content",{"login-content-mobile":o(w)==="mobile"}])},[p("div",qe,[Le,a(m,{modelValue:o(w),"onUpdate:modelValue":v[0]||(v[0]=g=>_e(w)?w.value=g:null),onTabClick:y},{default:l(()=>[a(F,{label:"\u8D26\u53F7\u5BC6\u7801\u767B\u5F55",name:"account",disabled:o(w)==="account"},{default:l(()=>[a(ye,{name:"el-zoom-in-center"},{default:l(()=>[ve(a(Te,null,null,512),[[xe,o(_)]])]),_:1})]),_:1},8,["disabled"])]),_:1},8,["modelValue"])])],2),ze])}}});var Ze=$($e,[["__scopeId","data-v-95005104"]]);export{Ze as default};
