var el=Object.defineProperty;var Ue=Object.getOwnPropertySymbols;var ll=Object.prototype.hasOwnProperty,al=Object.prototype.propertyIsEnumerable;var Le=(z,I,t)=>I in z?el(z,I,{enumerable:!0,configurable:!0,writable:!0,value:t}):z[I]=t,De=(z,I)=>{for(var t in I||(I={}))ll.call(I,t)&&Le(z,t,I[t]);if(Ue)for(var t of Ue(I))al.call(I,t)&&Le(z,t,I[t]);return z};import{d as ke,r as Qe,c as Te,t as qe,L as Ne,h as g,i as d,j as U,k as e,w as a,q as Ee,v as f,l,X as ze,G as ce,Q as j,R as Q,m as _,s as q,E as he,F as Z,a1 as se,a2 as tl,e as ol,f as ul,V as Be,I as ge,a3 as nl,U as Re,W as Me,N as il,O as sl,a4 as Oe,a5 as rl}from"./index.1667044971054.js";import{f as Pe}from"./format.1667044971054.js";import{d as P,S as He}from"./SqlExecBox.1667044971054.js";import{m as dl,_ as ml}from"./TagSelect.1667044971054.js";import{n as pl,i as bl}from"./assert.1667044971054.js";import{R as je}from"./rsa.1667044971054.js";import{E as cl}from"./Enum.1667044971054.js";import{t as fl}from"./api.16670449710542.js";import"./Api.1667044971054.js";import"./codemirror.1667044971054.js";const gl={class:"dialog-footer"},El=ke({__name:"DbEdit",props:{visible:{type:Boolean},db:{type:[Boolean,Object]},title:{type:String}},emits:["update:visible","cancel","val-change"],setup(z,{emit:I}){const t=z,re={tagId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6807\u7B7E",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u522B\u540D",trigger:["change","blur"]}],type:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B",trigger:["change","blur"]}],host:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3B\u673Aip\u548Cport",trigger:["change","blur"]}],username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["change","blur"]}],database:[{required:!0,message:"\u8BF7\u6DFB\u52A0\u6570\u636E\u5E93",trigger:["change","blur"]}]},ee=Qe(null),s=Te({dialogVisible:!1,allDatabases:[],databaseList:[],sshTunnelMachineList:[],form:{id:null,tagId:null,tagPath:null,type:null,name:null,host:"",port:3306,username:null,password:null,params:null,database:"",project:null,projectId:null,envId:null,env:null,remark:"",enableSshTunnel:null,sshTunnelMachineId:null},pwd:"",btnLoading:!1}),{dialogVisible:R,allDatabases:K,databaseList:W,sshTunnelMachineList:fe,form:D,pwd:ue,btnLoading:S}=qe(s);Ne(t,k=>{s.dialogVisible=k.visible,s.dialogVisible&&(k.db?(s.form=De({},k.db),s.databaseList=k.db.database.split(" ")):(s.form={port:3306,enableSshTunnel:-1},s.databaseList=[]),le())});const F=()=>{s.form.database=s.databaseList.length==0?"":s.databaseList.join(" ")},le=async()=>{if(s.form.enableSshTunnel==1&&s.sshTunnelMachineList.length==0){const k=await dl.list.request({pageNum:1,pageSize:100});s.sshTunnelMachineList=k.list}},H=async()=>{const k=De({},s.form);k.password=await je(k.password),s.allDatabases=await P.getAllDatabase.request(k),he.success("\u83B7\u53D6\u6210\u529F, \u8BF7\u9009\u62E9\u9700\u8981\u7BA1\u7406\u64CD\u4F5C\u7684\u6570\u636E\u5E93")},ne=async()=>{s.pwd=await P.getDbPwd.request({id:s.form.id})},ie=async()=>{s.form.id||pl(s.form.password,"\u65B0\u589E\u64CD\u4F5C\uFF0C\u5BC6\u7801\u4E0D\u53EF\u4E3A\u7A7A"),ee.value.validate(async k=>{if(k){const E=De({},s.form);E.password=await je(E.password),P.saveDb.request(E).then(()=>{he.success("\u4FDD\u5B58\u6210\u529F"),I("val-change",s.form),s.btnLoading=!0,setTimeout(()=>{s.btnLoading=!1},1e3),J()})}else return he.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},ae=()=>{s.databaseList=[],s.allDatabases=[]},J=()=>{I("update:visible",!1),I("cancel"),setTimeout(()=>{ae()},500)};return(k,E)=>{const M=g("el-form-item"),X=g("el-input"),$=g("el-option"),v=g("el-select"),r=g("el-col"),V=g("el-link"),m=g("el-popover"),p=g("el-divider"),x=g("el-checkbox"),y=g("el-form"),C=g("el-button"),T=g("el-dialog");return d(),U("div",null,[e(T,{title:z.title,modelValue:l(R),"onUpdate:modelValue":E[15]||(E[15]=i=>ce(R)?R.value=i:null),"before-close":J,"close-on-click-modal":!1,"destroy-on-close":!0,width:"38%"},{footer:a(()=>[Ee("div",gl,[e(C,{onClick:E[14]||(E[14]=i=>J())},{default:a(()=>[f("\u53D6 \u6D88")]),_:1}),e(C,{type:"primary",loading:l(S),onClick:ie},{default:a(()=>[f("\u786E \u5B9A")]),_:1},8,["loading"])])]),default:a(()=>[e(y,{model:l(D),ref_key:"dbForm",ref:ee,rules:re,"label-width":"95px"},{default:a(()=>[e(M,{prop:"tagId",label:"\u6807\u7B7E:",required:""},{default:a(()=>[e(ml,{"tag-id":l(D).tagId,"onUpdate:tag-id":E[0]||(E[0]=i=>l(D).tagId=i),"tag-path":l(D).tagPath,"onUpdate:tag-path":E[1]||(E[1]=i=>l(D).tagPath=i),style:{width:"100%"}},null,8,["tag-id","tag-path"])]),_:1}),e(M,{prop:"name",label:"\u522B\u540D:",required:""},{default:a(()=>[e(X,{modelValue:l(D).name,"onUpdate:modelValue":E[2]||(E[2]=i=>l(D).name=i),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u522B\u540D","auto-complete":"off"},null,8,["modelValue"])]),_:1}),e(M,{prop:"type",label:"\u7C7B\u578B:",required:""},{default:a(()=>[e(v,{style:{width:"100%"},modelValue:l(D).type,"onUpdate:modelValue":E[3]||(E[3]=i=>l(D).type=i),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B"},{default:a(()=>[e($,{key:"item.id",label:"mysql",value:"mysql"}),e($,{key:"item.id",label:"postgres",value:"postgres"})]),_:1},8,["modelValue"])]),_:1}),e(M,{prop:"host",label:"host:",required:""},{default:a(()=>[e(r,{span:18},{default:a(()=>[e(X,{disabled:l(D).id!==void 0,modelValue:l(D).host,"onUpdate:modelValue":E[4]||(E[4]=i=>l(D).host=i),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u4E3B\u673Aip","auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),e(r,{style:{"text-align":"center"},span:1},{default:a(()=>[f(":")]),_:1}),e(r,{span:5},{default:a(()=>[e(X,{type:"number",modelValue:l(D).port,"onUpdate:modelValue":E[5]||(E[5]=i=>l(D).port=i),modelModifiers:{number:!0},placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3"},null,8,["modelValue"])]),_:1})]),_:1}),e(M,{prop:"username",label:"\u7528\u6237\u540D:",required:""},{default:a(()=>[e(X,{modelValue:l(D).username,"onUpdate:modelValue":E[6]||(E[6]=i=>l(D).username=i),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),e(M,{prop:"password",label:"\u5BC6\u7801:"},{default:a(()=>[e(X,{type:"password","show-password":"",modelValue:l(D).password,"onUpdate:modelValue":E[8]||(E[8]=i=>l(D).password=i),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF0C\u4FEE\u6539\u64CD\u4F5C\u53EF\u4E0D\u586B",autocomplete:"new-password"},ze({_:2},[l(D).id&&l(D).id!=0?{name:"suffix",fn:a(()=>[e(m,{onHide:E[7]||(E[7]=i=>ue.value=""),placement:"right",title:"\u539F\u5BC6\u7801",width:200,trigger:"click",content:l(ue)},{reference:a(()=>[e(V,{onClick:ne,underline:!1,type:"primary",class:"mr5"},{default:a(()=>[f("\u539F\u5BC6\u7801 ")]),_:1})]),_:1},8,["content"])]),key:"0"}:void 0]),1032,["modelValue"])]),_:1}),e(M,{prop:"params",label:"\u8FDE\u63A5\u53C2\u6570:"},{default:a(()=>[e(X,{modelValue:l(D).params,"onUpdate:modelValue":E[9]||(E[9]=i=>l(D).params=i),modelModifiers:{trim:!0},placeholder:"\u5176\u4ED6\u8FDE\u63A5\u53C2\u6570\uFF0C\u5F62\u5982: key1=value1&key2=value2"},ze({_:2},[l(D).id&&l(D).id!=0?{name:"suffix",fn:a(()=>[e(V,{target:"_blank",href:"https://github.com/go-sql-driver/mysql#dsn-data-source-name",underline:!1,type:"primary",class:"mr5"},{default:a(()=>[f("\u53C2\u6570\u53C2\u8003")]),_:1})]),key:"0"}:void 0]),1032,["modelValue"])]),_:1}),e(M,{prop:"database",label:"\u6570\u636E\u5E93\u540D:",required:""},{default:a(()=>[e(r,{span:19},{default:a(()=>[e(v,{onChange:F,modelValue:l(W),"onUpdate:modelValue":E[10]||(E[10]=i=>ce(W)?W.value=i:null),multiple:"",clearable:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"","allow-create":"",placeholder:"\u8BF7\u786E\u4FDD\u6570\u636E\u5E93\u5B9E\u4F8B\u4FE1\u606F\u586B\u5199\u5B8C\u6574\u540E\u83B7\u53D6\u5E93\u540D",style:{width:"100%"}},{default:a(()=>[(d(!0),U(j,null,Q(l(K),i=>(d(),_($,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{style:{"text-align":"center"},span:1},{default:a(()=>[e(p,{direction:"vertical","border-style":"dashed"})]),_:1}),e(r,{span:4},{default:a(()=>[e(V,{onClick:H,underline:!1,type:"success"},{default:a(()=>[f("\u83B7\u53D6\u5E93\u540D")]),_:1})]),_:1})]),_:1}),e(M,{prop:"remark",label:"\u5907\u6CE8:"},{default:a(()=>[e(X,{modelValue:l(D).remark,"onUpdate:modelValue":E[11]||(E[11]=i=>l(D).remark=i),modelModifiers:{trim:!0},"auto-complete":"off",type:"textarea"},null,8,["modelValue"])]),_:1}),e(M,{prop:"enableSshTunnel",label:"SSH\u96A7\u9053:"},{default:a(()=>[e(r,{span:3},{default:a(()=>[e(x,{onChange:le,modelValue:l(D).enableSshTunnel,"onUpdate:modelValue":E[12]||(E[12]=i=>l(D).enableSshTunnel=i),"true-label":1,"false-label":-1},null,8,["modelValue"])]),_:1}),l(D).enableSshTunnel==1?(d(),_(r,{key:0,span:5},{default:a(()=>[f(" \u673A\u5668: ")]),_:1})):q("",!0),l(D).enableSshTunnel==1?(d(),_(r,{key:1,span:16},{default:a(()=>[e(v,{style:{width:"100%"},modelValue:l(D).sshTunnelMachineId,"onUpdate:modelValue":E[13]||(E[13]=i=>l(D).sshTunnelMachineId=i),placeholder:"\u8BF7\u9009\u62E9SSH\u96A7\u9053\u673A\u5668"},{default:a(()=>[(d(!0),U(j,null,Q(l(fe),i=>(d(),_($,{key:i.id,label:`${i.ip}:${i.port} [${i.name}]`,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):q("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),hl=["bigint","binary","blob","char","datetime","date","decimal","double","enum","float","int","json","longblob","longtext","mediumblob","mediumtext","set","smallint","text","time","timestamp","tinyint","varbinary","varchar"],yl=["armscii8","ascii","big5","binary","cp1250","cp1251","cp1256","cp1257","cp850","cp852","cp866","cp932","dec8","eucjpms","euckr","gb18030","gb2312","gbk","geostd8","greek","hebrew","hp8","keybcs2","koi8r","koi8u","latin1","latin2","latin5","latin7","macce","macroman","sjis","swe7","tis620","ucs2","ujis","utf16","utf16le","utf32","utf8","utf8mb4"],Dl=["unicode_ci","bin","croatian_ci","czech_ci","danish_ci","esperanto_ci","estonian_ci","general_ci","german2_ci","hungarian_ci","icelandic_ci","latvian_ci","lithuanian_ci","persian_ci","polish_ci","roman_ci","romanian_ci","sinhala_ci","slovak_ci","slovenian_ci","spanish2_ci","spanish_ci","swedish_ci","turkish_ci","unicode_520_ci","vietnamese_ci"],_l=ke({__name:"CreateTable",props:{visible:{type:Boolean},title:{type:String},data:{type:Object},dbId:{type:Number},db:{type:String}},emits:["update:visible","cancel","val-change"],setup(z,{emit:I}){const t=z,re=Qe(),{proxy:ee}=tl(),s=Te({dialogVisible:!1,btnloading:!1,activeName:"1",columnTypeList:hl,indexTypeList:["BTREE"],characterSetNameList:yl,collationNameList:Dl,tableData:{fields:{colNames:[{prop:"name",label:"\u5B57\u6BB5\u540D\u79F0"},{prop:"type",label:"\u5B57\u6BB5\u7C7B\u578B"},{prop:"length",label:"\u957F\u5EA6"},{prop:"value",label:"\u9ED8\u8BA4\u503C"},{prop:"notNull",label:"\u975E\u7A7A"},{prop:"pri",label:"\u4E3B\u952E"},{prop:"auto_increment",label:"\u81EA\u589E"},{prop:"remark",label:"\u5907\u6CE8"},{prop:"action",label:"\u64CD\u4F5C"}],res:[{name:"",type:"",value:"",length:"",notNull:!1,pri:!1,auto_increment:!1,remark:""}]},indexs:{colNames:[{prop:"indexName",label:"\u7D22\u5F15\u540D"},{prop:"columnNames",label:"\u5217\u540D"},{prop:"unique",label:"\u552F\u4E00"},{prop:"indexType",label:"\u7C7B\u578B"},{prop:"indexComment",label:"\u5907\u6CE8"},{prop:"action",label:"\u64CD\u4F5C"}],columns:[{name:"",remark:""}],res:[{indexName:"",columnNames:[],unique:!1,indexType:"BTREE",indexComment:""}]},characterSet:"utf8mb4",collation:"utf8mb4_general_ci",tableName:"",tableComment:"",height:550}}),{dialogVisible:R,btnloading:K,activeName:W,columnTypeList:fe,indexTypeList:D,characterSetNameList:ue,collationNameList:S,tableData:F}=qe(s);Ne(t,async v=>{s.dialogVisible=v.visible});const le=()=>{I("update:visible",!1),X()},H=()=>{s.tableData.fields.res.push({name:"",type:"",value:"",length:"",notNull:!1,pri:!1,auto_increment:!1,remark:""})},ne=()=>{s.tableData.indexs.res.push({indexName:"",columnNames:[],unique:!1,indexType:"BTREE",indexComment:""})},ie=()=>{s.tableData.fields.res.push({name:"id",type:"bigint",length:"20",value:"",notNull:!0,pri:!0,auto_increment:!0,remark:"\u4E3B\u952EID"},{name:"creator_id",type:"bigint",length:"20",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u521B\u5EFA\u4EBAid"},{name:"creator",type:"varchar",length:"100",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u521B\u5EFA\u4EBA\u59D3\u540D"},{name:"creat_time",type:"datetime",length:"",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u521B\u5EFA\u65F6\u95F4"},{name:"updater_id",type:"bigint",length:"20",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u4FEE\u6539\u4EBAid"},{name:"updater",type:"varchar",length:"100",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u4FEE\u6539\u4EBA\u59D3\u540D"},{name:"update_time",type:"datetime",length:"",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u4FEE\u6539\u65F6\u95F4"})},ae=v=>{s.tableData.fields.res.splice(v,1)},J=v=>{s.tableData.indexs.res.splice(v,1)},k=async()=>{let v=M();if(!v){he.warning("\u6CA1\u6709\u66F4\u6539");return}He({sql:v,dbId:t.dbId,db:t.db,runSuccessCallback:()=>{ee.$parent.openEditTable({tableName:s.tableData.tableName})}})},E=(v,r,V)=>{let m={del:[],add:[],upd:[]};if(v&&Array.isArray(v)&&v.length===0&&r&&Array.isArray(r)&&r.length>0)return m.add=r,m;if(r&&Array.isArray(r)&&r.length===0&&v&&Array.isArray(v)&&v.length>0)return m.del=v,m;let p={},x={};return v.forEach(y=>p[y[V]]=y),r.forEach(y=>{let C=y[V];x[C]=y,p.hasOwnProperty(C)||m.add.push(y)}),v.forEach(y=>{let C=y[V],T=x[C];if(!T)m.del.push(y);else for(let i in y){let O=y[i],de=T[i];if(O.toString()!==de.toString()){m.upd.push(T);break}}}),m},M=()=>{var V;const v=m=>{let p=m.value?m.value==="CURRENT_TIMESTAMP"?m.value:"'"+m.value+"'":"",x=`${p?"DEFAULT "+p:""}`,y=m.length?`(${m.length})`:"";return` ${m.name} ${m.type}${y} ${m.notNull?"NOT NULL":"NULL"} ${m.auto_increment?"AUTO_INCREMENT":""} ${x} comment '${m.remark||""}' `};let r=s.tableData;if((V=t.data)!=null&&V.edit){let m="",p="",x="";if(s.activeName==="1"){let y=E($.fields,s.tableData.fields.res,"name");return y.add.length>0&&(m=`ALTER TABLE ${r.tableName}`,y.add.forEach(C=>{m+=` ADD ${v(C)},`}),m=m.substring(0,m.length-1),m+=";"),y.upd.length>0&&(p=`ALTER TABLE ${r.tableName}`,y.upd.forEach(C=>{p+=` MODIFY ${v(C)},`}),p=p.substring(0,p.length-1),p+=";"),y.del.length>0&&y.del.forEach(C=>{x+=` ALTER TABLE ${r.tableName} DROP COLUMN ${C.name}; `}),m+p+x}else if(s.activeName==="2"){let y=E($.indexs,s.tableData.indexs.res,"indexName"),C=[],T=[];if(y.upd.length>0&&y.upd.forEach(i=>{C.push(i.indexName),T.push(i)}),y.del.length>0&&y.del.forEach(i=>{C.push(i.indexName)}),y.add.length>0&&y.add.forEach(i=>{T.push(i)}),C.length>0||T.length>0){let i=`ALTER TABLE ${r.tableName} `;return C.length>0&&(C.forEach(O=>{i+=`DROP INDEX ${O},`}),i=i.substring(0,i.length-1)),T.length>0&&(i+=",",T.forEach(O=>{i+=` ADD ${O.unique?"UNIQUE":""} INDEX ${O.indexName}(${O.columnNames.join(",")}) USING ${O.indexType} COMMENT '${O.indexComment}',`}),i=i.substring(0,i.length-1)),i}}}else if(s.activeName==="1"){let m="",p=[];return r.fields.res.forEach(x=>{p.push(v(x)),x.pri&&(m+=`${x.name},`)}),`CREATE TABLE ${r.tableName}
                  ( ${p.join(",")}
                      ${m?`, PRIMARY KEY (${m.slice(0,-1)})`:""}
                  ) ENGINE=InnoDB DEFAULT CHARSET=${r.characterSet} COLLATE =${r.collation} COMMENT='${r.tableComment}';`}else if(s.activeName==="2"&&r.indexs.res.length>0){let m=`ALTER TABLE ${r.tableName}`;return s.tableData.indexs.res.forEach(p=>{m+=` ADD ${p.unique?"UNIQUE":""} INDEX ${p.indexName}(${p.columnNames.join(",")}) USING ${p.indexType} COMMENT '${p.indexComment}',`}),m.substring(0,m.length-1)+";"}},X=()=>{s.activeName="1",re.value.resetFields(),s.tableData.tableName="",s.tableData.tableComment="",s.tableData.fields.res=[{name:"",type:"",value:"",length:"",notNull:!1,pri:!1,auto_increment:!1,remark:""}],s.tableData.indexs.res=[{indexName:"",columnNames:[],unique:!1,indexType:"BTREE",indexComment:""}]},$={indexs:[],fields:[]};return Ne(()=>t.data,v=>{const{row:r,indexs:V,columns:m}=v;s.tableData.tableName=r.tableName,s.tableData.tableComment=r.tableComment,m&&Array.isArray(m)&&m.length>0&&($.fields=[],s.tableData.fields.res=[],s.tableData.indexs.columns=[],m.forEach(p=>{var i;let x=p.columnType.replace(")","").split("("),y=x[0],C=x.length>1&&x[1]||"",T={name:p.columnName,type:y,value:p.columnDefault||"",length:C,notNull:p.nullable!=="YES",pri:p.columnKey==="PRI",auto_increment:((i=p.extra)==null?void 0:i.indexOf("auto_increment"))>-1,remark:p.columnComment};s.tableData.fields.res.push(T),$.fields.push(JSON.parse(JSON.stringify(T))),s.tableData.indexs.columns.push({name:p.columnName,remark:p.columnComment})})),V&&Array.isArray(V)&&V.length>0&&($.indexs=[],s.tableData.indexs.res=[],V.filter(p=>p.indexName!=="PRIMARY").forEach(p=>{var y;let x={indexName:p.indexName,columnNames:(y=p.columnName)==null?void 0:y.split(","),unique:p.nonUnique===0||!1,indexType:p.indexType,indexComment:p.indexComment};s.tableData.indexs.res.push(x),$.indexs.push(JSON.parse(JSON.stringify(x)))}))}),(v,r)=>{const V=g("el-input"),m=g("el-form-item"),p=g("el-col"),x=g("el-option"),y=g("el-select"),C=g("el-row"),T=g("el-checkbox"),i=g("el-link"),O=g("el-table-column"),de=g("el-table"),te=g("el-button"),ye=g("el-tab-pane"),_e=g("el-tabs"),ve=g("el-form"),we=g("el-dialog");return d(),U("div",null,[e(we,{title:z.title,modelValue:l(R),"onUpdate:modelValue":r[9]||(r[9]=b=>ce(R)?R.value=b:null),"before-close":le,width:"90%"},{footer:a(()=>[e(te,{loading:l(K),onClick:r[8]||(r[8]=b=>k()),type:"primary"},{default:a(()=>[f("\u4FDD\u5B58")]),_:1},8,["loading"])]),default:a(()=>[e(ve,{"label-position":"left",ref_key:"formRef",ref:re,model:l(F),"label-width":"80px"},{default:a(()=>[e(C,null,{default:a(()=>[e(p,{span:12},{default:a(()=>[e(m,{prop:"tableName",label:"\u8868\u540D"},{default:a(()=>[e(V,{style:{width:"80%"},modelValue:l(F).tableName,"onUpdate:modelValue":r[0]||(r[0]=b=>l(F).tableName=b),size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:a(()=>[e(m,{prop:"tableComment",label:"\u5907\u6CE8"},{default:a(()=>[e(V,{style:{width:"80%"},modelValue:l(F).tableComment,"onUpdate:modelValue":r[1]||(r[1]=b=>l(F).tableComment=b),size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:a(()=>[e(m,{prop:"characterSet",label:"charset"},{default:a(()=>[e(y,{filterable:"",style:{width:"80%"},modelValue:l(F).characterSet,"onUpdate:modelValue":r[2]||(r[2]=b=>l(F).characterSet=b),size:"small"},{default:a(()=>[(d(!0),U(j,null,Q(l(ue),b=>(d(),_(x,{key:b,label:b,value:b},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:a(()=>[e(m,{prop:"characterSet",label:"collation"},{default:a(()=>[e(y,{filterable:"",style:{width:"80%"},modelValue:l(F).collation,"onUpdate:modelValue":r[3]||(r[3]=b=>l(F).collation=b),size:"small"},{default:a(()=>[(d(!0),U(j,null,Q(l(S),b=>(d(),_(x,{key:b,label:l(F).characterSet+"_"+b,value:l(F).characterSet+"_"+b},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_e,{modelValue:l(W),"onUpdate:modelValue":r[7]||(r[7]=b=>ce(W)?W.value=b:null)},{default:a(()=>[e(ye,{label:"\u5B57\u6BB5",name:"1"},{default:a(()=>[e(de,{data:l(F).fields.res,"max-height":l(F).height},{default:a(()=>[(d(!0),U(j,null,Q(l(F).fields.colNames,b=>(d(),_(O,{prop:b.prop,label:b.label,key:b.prop},{default:a(w=>[b.prop==="name"?(d(),_(V,{key:0,size:"small",modelValue:w.row.name,"onUpdate:modelValue":h=>w.row.name=h},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="type"?(d(),_(y,{key:1,filterable:"",size:"small",modelValue:w.row.type,"onUpdate:modelValue":h=>w.row.type=h},{default:a(()=>[(d(!0),U(j,null,Q(l(fe),h=>(d(),_(x,{key:h,value:h},{default:a(()=>[f(Z(h),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="value"?(d(),_(V,{key:2,size:"small",modelValue:w.row.value,"onUpdate:modelValue":h=>w.row.value=h},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="length"?(d(),_(V,{key:3,size:"small",modelValue:w.row.length,"onUpdate:modelValue":h=>w.row.length=h},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="notNull"?(d(),_(T,{key:4,size:"small",modelValue:w.row.notNull,"onUpdate:modelValue":h=>w.row.notNull=h},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="pri"?(d(),_(T,{key:5,size:"small",modelValue:w.row.pri,"onUpdate:modelValue":h=>w.row.pri=h},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="auto_increment"?(d(),_(T,{key:6,size:"small",modelValue:w.row.auto_increment,"onUpdate:modelValue":h=>w.row.auto_increment=h},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="remark"?(d(),_(V,{key:7,size:"small",modelValue:w.row.remark,"onUpdate:modelValue":h=>w.row.remark=h},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="action"?(d(),_(i,{key:8,type:"danger",plain:"",size:"small",underline:!1,onClick:se(h=>ae(w.$index),["prevent"])},{default:a(()=>[f("\u5220\u9664")]),_:2},1032,["onClick"])):q("",!0)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data","max-height"]),e(C,{style:{"margin-top":"20px"}},{default:a(()=>[e(te,{onClick:r[4]||(r[4]=b=>ie()),link:"",type:"warning",icon:"plus"},{default:a(()=>[f("\u6DFB\u52A0\u9ED8\u8BA4\u5217")]),_:1}),e(te,{onClick:r[5]||(r[5]=b=>H()),link:"",type:"primary",icon:"plus"},{default:a(()=>[f("\u6DFB\u52A0\u5217")]),_:1})]),_:1})]),_:1}),e(ye,{label:"\u7D22\u5F15",name:"2"},{default:a(()=>[e(de,{data:l(F).indexs.res,"max-height":l(F).height},{default:a(()=>[(d(!0),U(j,null,Q(l(F).indexs.colNames,b=>(d(),_(O,{prop:b.prop,label:b.label,key:b.prop},{default:a(w=>[b.prop==="indexName"?(d(),_(V,{key:0,size:"small",modelValue:w.row.indexName,"onUpdate:modelValue":h=>w.row.indexName=h},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="columnNames"?(d(),_(y,{key:1,modelValue:w.row.columnNames,"onUpdate:modelValue":h=>w.row.columnNames=h,multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5",style:{width:"100%"}},{default:a(()=>[(d(!0),U(j,null,Q(l(F).indexs.columns,h=>(d(),_(x,{key:h.name,label:h.name,value:h.name},{default:a(()=>[f(Z(h.name+" - "+(h.remark||"")),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="unique"?(d(),_(T,{key:2,size:"small",modelValue:w.row.unique,"onUpdate:modelValue":h=>w.row.unique=h},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="indexType"?(d(),_(y,{key:3,filterable:"",size:"small",modelValue:w.row.indexType,"onUpdate:modelValue":h=>w.row.indexType=h},{default:a(()=>[(d(!0),U(j,null,Q(l(D),h=>(d(),_(x,{key:h,value:h},{default:a(()=>[f(Z(h),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="indexComment"?(d(),_(V,{key:4,size:"small",modelValue:w.row.indexComment,"onUpdate:modelValue":h=>w.row.indexComment=h},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),b.prop==="action"?(d(),_(i,{key:5,type:"danger",plain:"",size:"small",underline:!1,onClick:se(h=>J(w.$index),["prevent"])},{default:a(()=>[f("\u5220\u9664")]),_:2},1032,["onClick"])):q("",!0)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data","max-height"]),e(C,{style:{"margin-top":"20px"}},{default:a(()=>[e(te,{onClick:r[6]||(r[6]=b=>ne()),link:"",type:"primary",icon:"plus"},{default:a(()=>[f("\u6DFB\u52A0\u7D22\u5F15")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});var oe={DbSqlExecTypeEnum:new cl().add("UPDATE","UPDATE",1).add("DELETE","DELETE",2).add("INSERT","INSERT",3)};const vl={class:"db-list"},wl={style:{float:"right"}},Cl=Ee("i",null,null,-1),xl={style:{"text-align":"right"}},Vl={class:"toolbar"},Ll=ke({__name:"DbList",setup(z){const I={saveDb:"db:save",delDb:"db:del"},t=Te({row:{},dbId:0,db:"",tags:[],chooseId:null,chooseData:null,query:{tagPath:null,projectId:null,pageNum:1,pageSize:10},datas:[],total:0,showDumpInfo:!1,dumpInfo:{id:0,db:"",type:3,tables:[]},sqlExecLogDialog:{title:"",visible:!1,data:[],total:0,dbs:[],query:{dbId:0,db:"",table:"",type:null,pageNum:1,pageSize:12}},rollbackSqlDialog:{visible:!1,sql:""},chooseTableName:"",tableInfoDialog:{loading:!1,visible:!1,infos:[],tableNameSearch:"",tableCommentSearch:""},columnDialog:{visible:!1,columns:[]},indexDialog:{visible:!1,indexs:[]},ddlDialog:{visible:!1,ddl:""},dbEditDialog:{visible:!1,data:null,title:"\u65B0\u589E\u6570\u636E\u5E93"},tableCreateDialog:{title:"\u521B\u5EFA\u8868",visible:!1,columns:[],indexs:[],activeName:"1",data:{edit:!1,row:{},indexs:[],columns:[]}},filterDb:{param:"",cache:[],list:[]}}),{dbId:re,db:ee,tags:s,chooseId:R,query:K,datas:W,total:fe,showDumpInfo:D,dumpInfo:ue,sqlExecLogDialog:S,rollbackSqlDialog:F,chooseTableName:le,tableInfoDialog:H,columnDialog:ne,indexDialog:ie,ddlDialog:ae,dbEditDialog:J,tableCreateDialog:k,filterDb:E}=qe(t);ol(async()=>{$()});const M=ul(()=>{const n=t.tableInfoDialog.infos,u=t.tableInfoDialog.tableNameSearch,B=t.tableInfoDialog.tableCommentSearch;return!u&&!B?n:n.filter(G=>{let Y=!0,L=!0;return u&&(Y=G.tableName.toLowerCase().includes(u.toLowerCase())),B&&(L=G.tableComment.includes(B)),Y&&L})}),X=n=>{!n||(t.chooseId=n.id,t.chooseData=n)},$=async()=>{let n=await P.dbs.request(t.query);n.list.forEach(u=>{u.popoverSelectDbVisible=!1,u.dbs=u.database.split(" ")}),t.datas=n.list,t.total=n.total},v=n=>{t.query.pageNum=n,$()},r=async()=>{t.tags=await fl.getAccountTags.request(null)},V=async(n=!1)=>{n?(t.dbEditDialog.data=null,t.dbEditDialog.title="\u65B0\u589E\u6570\u636E\u5E93\u8D44\u6E90"):(t.dbEditDialog.data=t.chooseData,t.dbEditDialog.title="\u4FEE\u6539\u6570\u636E\u5E93\u8D44\u6E90"),t.dbEditDialog.visible=!0},m=()=>{t.chooseData=null,t.chooseId=null,$()},p=async n=>{try{await Me.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u5E93?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await P.deleteDb.request({id:n}),he.success("\u5220\u9664\u6210\u529F"),t.chooseData=null,t.chooseId=null,$()}catch{}},x=async n=>{t.sqlExecLogDialog.title=`${n.name}[${n.host}:${n.port}]`,t.sqlExecLogDialog.query.dbId=n.id,t.sqlExecLogDialog.dbs=n.database.split(" "),C(),t.sqlExecLogDialog.visible=!0},y=()=>{t.sqlExecLogDialog.visible=!1,t.sqlExecLogDialog.data=[],t.sqlExecLogDialog.dbs=[],t.sqlExecLogDialog.total=0,t.sqlExecLogDialog.query.dbId=0,t.sqlExecLogDialog.query.pageNum=1,t.sqlExecLogDialog.query.table="",t.sqlExecLogDialog.query.db="",t.sqlExecLogDialog.query.type=null},C=async()=>{const n=await P.getSqlExecs.request(t.sqlExecLogDialog.query);t.sqlExecLogDialog.data=n.list,t.sqlExecLogDialog.total=n.total},T=n=>{t.sqlExecLogDialog.query.pageNum=n,C()},i=n=>{t.dumpInfo.tables=n.map(u=>u.tableName)},O=n=>{bl(t.dumpInfo.tables.length>0,"\u8BF7\u9009\u62E9\u8981\u5BFC\u51FA\u7684\u8868");const u=document.createElement("a");u.setAttribute("href",`${il.baseApiUrl}/dbs/${t.dbId}/dump?db=${n}&type=${t.dumpInfo.type}&tables=${t.dumpInfo.tables.join(",")}&token=${sl("token")}`),u.click(),t.showDumpInfo=!1},de=async n=>{const u=await P.columnMetadata.request({id:n.dbId,db:n.db,tableName:n.table}),B=u[0].columnName,G=JSON.parse(n.oldValue),Y=[];if(n.type==oe.DbSqlExecTypeEnum.UPDATE.value)for(let L of G){const c=[];for(let A in L)A!=B&&c.push(`${A} = ${te(L[A])}`);Y.push(`UPDATE ${n.table} SET ${c.join(", ")} WHERE ${B} = ${te(L[B])};`)}else if(n.type==oe.DbSqlExecTypeEnum.DELETE.value){const L=u.map(c=>c.columnName);for(let c of G){const A=[];for(let Ce of L)A.push(te(c[Ce]));Y.push(`INSERT INTO ${n.table} (${L.join(", ")}) VALUES (${A.join(", ")});`)}}t.rollbackSqlDialog.sql=Y.join(`
`),t.rollbackSqlDialog.visible=!0},te=n=>typeof n=="number"?n:`'${n}'`,ye=async(n,u)=>{t.tableInfoDialog.loading=!0,t.tableInfoDialog.visible=!0;try{t.tableInfoDialog.infos=await P.tableInfos.request({id:n.id,db:u}),t.dbId=n.id,t.row=n,t.db=u}catch{t.tableInfoDialog.visible=!1}finally{t.tableInfoDialog.loading=!1}},_e=()=>{t.showDumpInfo=!1,t.tableInfoDialog.visible=!1,t.tableInfoDialog.infos=[]},ve=async n=>{t.chooseTableName=n.tableName,t.columnDialog.columns=await P.columnMetadata.request({id:t.chooseId,db:t.db,tableName:n.tableName}),t.columnDialog.visible=!0},we=async n=>{t.chooseTableName=n.tableName,t.indexDialog.indexs=await P.tableIndex.request({id:t.chooseId,db:t.db,tableName:n.tableName}),t.indexDialog.visible=!0},b=async n=>{t.chooseTableName=n.tableName;const u=await P.tableDdl.request({id:t.chooseId,db:t.db,tableName:n.tableName});t.ddlDialog.ddl=u[0]["Create Table"],t.ddlDialog.visible=!0},w=async n=>{try{const u=n.tableName;await Me.confirm(`\u786E\u5B9A\u5220\u9664'${u}'\u8868?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),He({sql:`DROP TABLE ${u}`,dbId:t.chooseId,db:t.db,runSuccessCallback:async()=>{t.tableInfoDialog.infos=await P.tableInfos.request({id:t.chooseId,db:t.db})}})}catch{}},h=(n,u)=>{let B=Oe.state.sqlExecInfo.dbOptInfo.db;if(u&&B!==u){const{tagPath:G,id:Y}=n;let L={tagPath:G,dbId:Y,db:u};Oe.dispatch("sqlExecInfo/setSqlExecInfo",L)}rl.push({name:"SqlExec"})},Ye=n=>{t.filterDb.param="",t.filterDb.cache=n,t.filterDb.list=n},Je=()=>{t.filterDb.param?t.filterDb.list=t.filterDb.cache.filter(n=>String(n).toLowerCase().indexOf(t.filterDb.param)>-1):t.filterDb.list=t.filterDb.cache},Ie=async n=>{if(t.tableCreateDialog.visible=!0,t.tableCreateDialog.activeName="1",n===!1&&(t.tableCreateDialog.data={edit:!1,row:{},indexs:[],columns:[]},t.tableCreateDialog.title="\u521B\u5EFA\u8868"),n.tableName){t.tableCreateDialog.title="\u4FEE\u6539\u8868";let u=await P.tableIndex.request({id:t.chooseId,db:t.db,tableName:n.tableName}),B=await P.columnMetadata.request({id:t.chooseId,db:t.db,tableName:n.tableName});t.tableCreateDialog.data={edit:!0,row:n,indexs:u,columns:B}}};return(n,u)=>{const B=g("el-button"),G=g("el-option"),Y=g("el-select"),L=g("el-radio"),c=g("el-table-column"),A=g("el-link"),Ce=g("el-icon"),me=g("el-input"),Se=g("el-popover"),pe=g("el-table"),$e=g("el-pagination"),xe=g("el-row"),Xe=g("el-card"),Ge=g("el-radio-group"),Ae=g("el-form-item"),be=g("el-dialog"),Ve=g("el-tag"),Fe=Be("auth"),Ke=Be("waves"),We=Be("loading");return d(),U("div",vl,[e(Xe,null,{default:a(()=>[ge((d(),_(B,{type:"primary",icon:"plus",onClick:u[0]||(u[0]=o=>V(!0))},{default:a(()=>[f("\u6DFB\u52A0")]),_:1})),[[Fe,I.saveDb]]),ge((d(),_(B,{disabled:l(R)==null,onClick:u[1]||(u[1]=o=>V(!1)),type:"primary",icon:"edit"},{default:a(()=>[f("\u7F16\u8F91")]),_:1},8,["disabled"])),[[Fe,I.saveDb]]),ge((d(),_(B,{disabled:l(R)==null,onClick:u[2]||(u[2]=o=>p(l(R))),type:"danger",icon:"delete"},{default:a(()=>[f("\u5220\u9664")]),_:1},8,["disabled"])),[[Fe,I.delDb]]),Ee("div",wl,[e(Y,{onFocus:r,modelValue:l(K).tagPath,"onUpdate:modelValue":u[3]||(u[3]=o=>l(K).tagPath=o),placeholder:"\u8BF7\u9009\u62E9\u6807\u7B7E",filterable:"",clearable:""},{default:a(()=>[(d(!0),U(j,null,Q(l(s),o=>(d(),_(G,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),ge((d(),_(B,{type:"primary",icon:"search",onClick:u[4]||(u[4]=o=>$()),class:"ml5"},{default:a(()=>[f("\u67E5\u8BE2")]),_:1})),[[Ke]])]),e(pe,{data:l(W),ref:"table",onCurrentChange:X,"show-overflow-tooltip":"",stripe:""},{default:a(()=>[e(c,{label:"\u9009\u62E9",width:"60px"},{default:a(o=>[e(L,{modelValue:l(R),"onUpdate:modelValue":u[5]||(u[5]=N=>ce(R)?R.value=N:null),label:o.row.id},{default:a(()=>[Cl]),_:2},1032,["modelValue","label"])]),_:1}),e(c,{prop:"tagPath",label:"\u6807\u7B7E\u8DEF\u5F84","min-width":"150","show-overflow-tooltip":""}),e(c,{prop:"name",label:"\u540D\u79F0","min-width":"160","show-overflow-tooltip":""}),e(c,{"min-width":"170",label:"host:port","show-overflow-tooltip":""},{default:a(o=>[f(Z(`${o.row.host}:${o.row.port}`),1)]),_:1}),e(c,{prop:"type",label:"\u7C7B\u578B","min-width":"90"}),e(c,{prop:"database",label:"\u6570\u636E\u5E93","min-width":"80"},{default:a(o=>[e(Se,{placement:"right",trigger:"click",width:300},{reference:a(()=>[e(A,{type:"primary",underline:!1,plain:"",onClick:N=>Ye(o.row.dbs)},{default:a(()=>[f("\u67E5\u770B ")]),_:2},1032,["onClick"])]),default:a(()=>[e(me,{modelValue:l(E).param,"onUpdate:modelValue":u[6]||(u[6]=N=>l(E).param=N),onKeyup:Je,class:"w-50 m-2",placeholder:"\u641C\u7D22",size:"small"},{prefix:a(()=>[e(Ce,{class:"el-input__icon"},{default:a(()=>[e(l(nl))]),_:1})]),_:1},8,["modelValue"]),(d(!0),U(j,null,Q(l(E).list,N=>(d(),U("div",{class:"el-tag--plain el-tag--success",key:N,style:{border:"1px var(--color-success-light-3) solid","margin-top":"3px","border-radius":"5px",padding:"2px",position:"relative"}},[e(A,{type:"success",plain:"",size:"small",underline:!1,onClick:Ze=>ye(o.row,N)},{default:a(()=>[f(Z(N),1)]),_:2},1032,["onClick"]),e(A,{type:"primary",plain:"",size:"small",underline:!1,onClick:Ze=>h(o.row,N),style:{position:"absolute",right:"4px"}},{default:a(()=>[f("\u6570\u636E\u64CD\u4F5C ")]),_:2},1032,["onClick"])]))),128))]),_:2},1024)]),_:1}),e(c,{prop:"username",label:"\u7528\u6237\u540D","min-width":"100"}),e(c,{prop:"remark",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""}),e(c,{"min-width":"115",prop:"creator",label:"\u521B\u5EFA\u8D26\u53F7"}),e(c,{"min-width":"160",prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","show-overflow-tooltip":""},{default:a(o=>[f(Z(l(Re)(o.row.createTime)),1)]),_:1}),e(c,{label:"\u64CD\u4F5C","min-width":"120",fixed:"right"},{default:a(o=>[e(A,{type:"primary",plain:"",size:"small",underline:!1,onClick:N=>x(o.row)},{default:a(()=>[f(" SQL\u6267\u884C\u8BB0\u5F55")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(xe,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:a(()=>[e($e,{style:{"text-align":"right"},onCurrentChange:v,total:l(fe),layout:"prev, pager, next, total, jumper","current-page":l(K).pageNum,"onUpdate:current-page":u[7]||(u[7]=o=>l(K).pageNum=o),"page-size":l(K).pageSize},null,8,["total","current-page","page-size"])]),_:1})]),_:1}),e(be,{width:"80%",title:`${l(ee)} \u8868\u4FE1\u606F`,"before-close":_e,modelValue:l(H).visible,"onUpdate:modelValue":u[15]||(u[15]=o=>l(H).visible=o)},{default:a(()=>[e(xe,{class:"mb10"},{default:a(()=>[e(Se,{visible:l(D),"onUpdate:visible":u[11]||(u[11]=o=>ce(D)?D.value=o:null),width:470,placement:"right",trigger:"click"},{reference:a(()=>[e(B,{class:"ml5",type:"success",size:"small"},{default:a(()=>[f("\u5BFC\u51FA")]),_:1})]),default:a(()=>[e(Ae,{label:"\u5BFC\u51FA\u5185\u5BB9: "},{default:a(()=>[e(Ge,{modelValue:l(ue).type,"onUpdate:modelValue":u[8]||(u[8]=o=>l(ue).type=o)},{default:a(()=>[e(L,{label:1,size:"small"},{default:a(()=>[f("\u7ED3\u6784")]),_:1}),e(L,{label:2,size:"small"},{default:a(()=>[f("\u6570\u636E")]),_:1}),e(L,{label:3,size:"small"},{default:a(()=>[f("\u7ED3\u6784\uFF0B\u6570\u636E")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(Ae,{label:"\u5BFC\u51FA\u8868: "},{default:a(()=>[e(pe,{onSelectionChange:i,"max-height":"300",size:"small",data:l(H).infos},{default:a(()=>[e(c,{type:"selection",width:"45"}),e(c,{property:"tableName",label:"\u8868\u540D","min-width":"150","show-overflow-tooltip":""}),e(c,{property:"tableComment",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1}),Ee("div",xl,[e(B,{onClick:u[9]||(u[9]=o=>D.value=!1),size:"small"},{default:a(()=>[f("\u53D6\u6D88")]),_:1}),e(B,{onClick:u[10]||(u[10]=o=>O(l(ee))),type:"success",size:"small"},{default:a(()=>[f("\u786E\u5B9A")]),_:1})])]),_:1},8,["visible"]),e(B,{type:"primary",size:"small",onClick:u[12]||(u[12]=o=>Ie(!1))},{default:a(()=>[f("\u521B\u5EFA\u8868")]),_:1})]),_:1}),ge((d(),_(pe,{border:"",stripe:"",data:l(M),size:"small","max-height":"680"},{default:a(()=>[e(c,{property:"tableName",label:"\u8868\u540D","min-width":"150","show-overflow-tooltip":""},{header:a(()=>[e(me,{modelValue:l(H).tableNameSearch,"onUpdate:modelValue":u[13]||(u[13]=o=>l(H).tableNameSearch=o),size:"small",placeholder:"\u8868\u540D: \u8F93\u5165\u53EF\u8FC7\u6EE4",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{property:"tableComment",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""},{header:a(()=>[e(me,{modelValue:l(H).tableCommentSearch,"onUpdate:modelValue":u[14]||(u[14]=o=>l(H).tableCommentSearch=o),size:"small",placeholder:"\u5907\u6CE8: \u8F93\u5165\u53EF\u8FC7\u6EE4",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{prop:"tableRows",label:"Rows","min-width":"70",sortable:"","sort-method":(o,N)=>parseInt(o.tableRows)-parseInt(N.tableRows)},null,8,["sort-method"]),e(c,{property:"dataLength",label:"\u6570\u636E\u5927\u5C0F",sortable:"","sort-method":(o,N)=>parseInt(o.dataLength)-parseInt(N.dataLength)},{default:a(o=>[f(Z(l(Pe)(o.row.dataLength)),1)]),_:1},8,["sort-method"]),e(c,{property:"indexLength",label:"\u7D22\u5F15\u5927\u5C0F",sortable:"","sort-method":(o,N)=>parseInt(o.indexLength)-parseInt(N.indexLength)},{default:a(o=>[f(Z(l(Pe)(o.row.indexLength)),1)]),_:1},8,["sort-method"]),e(c,{property:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":"150"}),e(c,{label:"\u66F4\u591A\u4FE1\u606F","min-width":"140"},{default:a(o=>[e(A,{onClick:se(N=>ve(o.row),["prevent"]),type:"primary"},{default:a(()=>[f("\u5B57\u6BB5")]),_:2},1032,["onClick"]),e(A,{class:"ml5",onClick:se(N=>we(o.row),["prevent"]),type:"success"},{default:a(()=>[f("\u7D22\u5F15")]),_:2},1032,["onClick"]),e(A,{class:"ml5",onClick:se(N=>Ie(o.row),["prevent"]),type:"warning"},{default:a(()=>[f("\u7F16\u8F91\u8868")]),_:2},1032,["onClick"]),e(A,{class:"ml5",onClick:se(N=>b(o.row),["prevent"]),type:"info"},{default:a(()=>[f("DDL")]),_:2},1032,["onClick"])]),_:1}),e(c,{label:"\u64CD\u4F5C","min-width":"80"},{default:a(o=>[e(A,{onClick:se(N=>w(o.row),["prevent"]),type:"danger"},{default:a(()=>[f("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[We,l(H).loading]])]),_:1},8,["title","modelValue"]),e(be,{width:"90%",title:`${l(S).title} - SQL\u6267\u884C\u8BB0\u5F55`,"before-close":y,modelValue:l(S).visible,"onUpdate:modelValue":u[20]||(u[20]=o=>l(S).visible=o)},{default:a(()=>[Ee("div",Vl,[e(Y,{modelValue:l(S).query.db,"onUpdate:modelValue":u[16]||(u[16]=o=>l(S).query.db=o),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93",filterable:"",clearable:""},{default:a(()=>[(d(!0),U(j,null,Q(l(S).dbs,o=>(d(),_(G,{key:o,label:`${o}`,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(me,{modelValue:l(S).query.table,"onUpdate:modelValue":u[17]||(u[17]=o=>l(S).query.table=o),placeholder:"\u8BF7\u8F93\u5165\u8868\u540D",clearable:"",class:"ml5",style:{width:"180px"}},null,8,["modelValue"]),e(Y,{modelValue:l(S).query.type,"onUpdate:modelValue":u[18]||(u[18]=o=>l(S).query.type=o),placeholder:"\u8BF7\u9009\u62E9\u64CD\u4F5C\u7C7B\u578B",clearable:"",class:"ml5"},{default:a(()=>[(d(!0),U(j,null,Q(l(oe).DbSqlExecTypeEnum,o=>(d(),_(G,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(B,{class:"ml5",onClick:C,type:"success",icon:"search"})]),e(pe,{border:"",stripe:"",data:l(S).data,size:"small"},{default:a(()=>[e(c,{prop:"db",label:"\u6570\u636E\u5E93","min-width":"60","show-overflow-tooltip":""}),e(c,{prop:"table",label:"\u8868","min-width":"60","show-overflow-tooltip":""}),e(c,{prop:"type",label:"\u7C7B\u578B",width:"85","show-overflow-tooltip":""},{default:a(o=>[o.row.type==l(oe).DbSqlExecTypeEnum.UPDATE.value?(d(),_(Ve,{key:0,color:"#E4F5EB",size:"small"},{default:a(()=>[f("UPDATE")]),_:1})):q("",!0),o.row.type==l(oe).DbSqlExecTypeEnum.DELETE.value?(d(),_(Ve,{key:1,color:"#F9E2AE",size:"small"},{default:a(()=>[f("DELETE")]),_:1})):q("",!0),o.row.type==l(oe).DbSqlExecTypeEnum.INSERT.value?(d(),_(Ve,{key:2,color:"#A8DEE0",size:"small"},{default:a(()=>[f("INSERT")]),_:1})):q("",!0)]),_:1}),e(c,{prop:"sql",label:"SQL","min-width":"230","show-overflow-tooltip":""}),e(c,{prop:"oldValue",label:"\u539F\u503C","min-width":"150","show-overflow-tooltip":""}),e(c,{prop:"creator",label:"\u6267\u884C\u4EBA","min-width":"60","show-overflow-tooltip":""}),e(c,{prop:"createTime",label:"\u6267\u884C\u65F6\u95F4","show-overflow-tooltip":""},{default:a(o=>[f(Z(l(Re)(o.row.createTime)),1)]),_:1}),e(c,{prop:"remark",label:"\u5907\u6CE8","min-width":"60","show-overflow-tooltip":""}),e(c,{label:"\u64CD\u4F5C","min-width":"50",fixed:"right"},{default:a(o=>[o.row.type==l(oe).DbSqlExecTypeEnum.UPDATE.value||o.row.type==l(oe).DbSqlExecTypeEnum.DELETE.value?(d(),_(A,{key:0,type:"primary",plain:"",size:"small",underline:!1,onClick:N=>de(o.row)},{default:a(()=>[f(" \u8FD8\u539FSQL")]),_:2},1032,["onClick"])):q("",!0)]),_:1})]),_:1},8,["data"]),e(xe,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:a(()=>[e($e,{style:{"text-align":"right"},onCurrentChange:T,total:l(S).total,layout:"prev, pager, next, total, jumper","current-page":l(S).query.pageNum,"onUpdate:current-page":u[19]||(u[19]=o=>l(S).query.pageNum=o),"page-size":l(S).query.pageSize},null,8,["total","current-page","page-size"])]),_:1})]),_:1},8,["title","modelValue"]),e(be,{width:"55%",title:"\u8FD8\u539FSQL",modelValue:l(F).visible,"onUpdate:modelValue":u[22]||(u[22]=o=>l(F).visible=o)},{default:a(()=>[e(me,{type:"textarea",autosize:{minRows:15,maxRows:30},modelValue:l(F).sql,"onUpdate:modelValue":u[21]||(u[21]=o=>l(F).sql=o),size:"small"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(be,{width:"40%",title:`${l(le)} \u5B57\u6BB5\u4FE1\u606F`,modelValue:l(ne).visible,"onUpdate:modelValue":u[23]||(u[23]=o=>l(ne).visible=o)},{default:a(()=>[e(pe,{border:"",stripe:"",data:l(ne).columns,size:"small"},{default:a(()=>[e(c,{prop:"columnName",label:"\u540D\u79F0","show-overflow-tooltip":""}),e(c,{width:"120",prop:"columnType",label:"\u7C7B\u578B","show-overflow-tooltip":""}),e(c,{width:"80",prop:"nullable",label:"\u662F\u5426\u53EF\u4E3A\u7A7A","show-overflow-tooltip":""}),e(c,{prop:"columnComment",label:"\u5907\u6CE8","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),e(be,{width:"40%",title:`${l(le)} \u7D22\u5F15\u4FE1\u606F`,modelValue:l(ie).visible,"onUpdate:modelValue":u[24]||(u[24]=o=>l(ie).visible=o)},{default:a(()=>[e(pe,{border:"",stripe:"",data:l(ie).indexs,size:"small"},{default:a(()=>[e(c,{prop:"indexName",label:"\u7D22\u5F15\u540D","min-width":"120","show-overflow-tooltip":""}),e(c,{prop:"columnName",label:"\u5217\u540D","min-width":"120","show-overflow-tooltip":""}),e(c,{prop:"seqInIndex",label:"\u5217\u5E8F\u5217\u53F7","show-overflow-tooltip":""}),e(c,{prop:"indexType",label:"\u7C7B\u578B"}),e(c,{prop:"indexComment",label:"\u5907\u6CE8","min-width":"130","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),e(be,{width:"55%",title:`${l(le)} Create-DDL`,modelValue:l(ae).visible,"onUpdate:modelValue":u[26]||(u[26]=o=>l(ae).visible=o)},{default:a(()=>[e(me,{disabled:"",type:"textarea",autosize:{minRows:15,maxRows:30},modelValue:l(ae).ddl,"onUpdate:modelValue":u[25]||(u[25]=o=>l(ae).ddl=o),size:"small"},null,8,["modelValue"])]),_:1},8,["title","modelValue"]),e(El,{onValChange:m,title:l(J).title,visible:l(J).visible,"onUpdate:visible":u[27]||(u[27]=o=>l(J).visible=o),db:l(J).data,"onUpdate:db":u[28]||(u[28]=o=>l(J).data=o)},null,8,["title","visible","db"]),e(_l,{title:l(k).title,"active-name":l(k).activeName,dbId:l(re),db:l(ee),data:l(k).data,visible:l(k).visible,"onUpdate:visible":u[29]||(u[29]=o=>l(k).visible=o)},null,8,["title","active-name","dbId","db","data","visible"])])}}});export{Ll as default};
