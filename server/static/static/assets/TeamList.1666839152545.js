var O=Object.defineProperty,H=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var z=(e,o,l)=>o in e?O(e,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[o]=l,P=(e,o)=>{for(var l in o||(o={}))K.call(o,l)&&z(e,l,o[l]);if(S)for(var l of S(o))Q.call(o,l)&&z(e,l,o[l]);return e},j=(e,o)=>H(e,J(o));import{_ as W,d as X,r as R,c as Y,e as Z,t as x,V as ee,k as i,R as oe,m as p,p as L,q as s,w as u,G as v,v as h,A as n,y as g,D as M,$ as G,z as ae,O as le,P as te,E as k,S as se}from"./index.1666839152545.js";import{t as c}from"./api.16668391525452.js";import{b as ue}from"./api.16668391525453.js";import{n as ne}from"./assert.1666839152545.js";import"./Api.1666839152545.js";const ie=X({name:"TeamList",components:{},setup(){const e=R(null),o=R(null),l=Y({dialogFormVisible:!1,currentEditPermissions:!1,addTeamDialog:{title:"\u65B0\u589E\u56E2\u961F",visible:!1,form:{id:0,name:"",remark:""}},query:{pageNum:1,pageSize:10,name:null},total:0,data:[],chooseId:0,chooseData:null,showMemDialog:{visible:!1,chooseId:0,chooseData:null,query:{pageSize:8,pageNum:1,teamId:null},members:{list:[],total:null},title:"",addVisible:!1,memForm:{accountId:null,teamId:0},accounts:Array()},showTagDialog:{title:"\u9879\u76EE\u4FE1\u606F",visible:!1,tags:[],teamId:0,tagTreeTeams:[],props:{value:"id",label:"codePath",children:"children"}}});Z(()=>{f()});const f=async()=>{let t=await c.getTeams.request(l.query);l.data=t.list,l.total=t.total},_=t=>{l.query.pageNum=t,f()},U=t=>{!t||(l.chooseId=t.id,l.chooseData=t)},d=t=>{t&&(l.addTeamDialog.form.id=t.id,l.addTeamDialog.form.name=t.name,l.addTeamDialog.form.remark=t.remark,l.addTeamDialog.title=`\u4FEE\u6539 [${t.codePath}] \u4FE1\u606F`),l.addTeamDialog.visible=!0},y=async()=>{e.value.validate(async t=>{if(t){const m=l.addTeamDialog.form;await c.saveTeam.request(m),k.success("\u4FDD\u5B58\u6210\u529F"),f(),F()}})},F=()=>{l.addTeamDialog.visible=!1,l.addTeamDialog.form={},e.value.resetFields()},r=t=>{se.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${t.name}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{await c.delTeam.request({id:t.id}),k.success("\u5220\u9664\u6210\u529F\uFF01"),f()})},V=async t=>{l.showMemDialog.query.teamId=t.id,await D(),l.showMemDialog.title=`[${t.name}] \u6210\u5458\u4FE1\u606F`,l.showMemDialog.visible=!0},q=t=>{ue.list.request({username:t}).then(m=>{l.showMemDialog.accounts=m.list})},E=t=>{!t||(l.showMemDialog.chooseData=t,l.showMemDialog.chooseId=t.id)},B=async()=>{await c.delTeamMem.request(l.showMemDialog.chooseData),k.success("\u79FB\u9664\u6210\u529F"),D()},D=async()=>{const t=await c.getTeamMem.request(l.showMemDialog.query);l.showMemDialog.members.list=t.list,l.showMemDialog.members.total=t.total},A=()=>{l.showMemDialog.addVisible=!0},w=async()=>{const t=l.showMemDialog.memForm;t.teamId=l.chooseId,ne(t.accountId,"\u8BF7\u5148\u9009\u62E9\u8D26\u53F7"),await c.saveTeamMem.request(t),k.success("\u4FDD\u5B58\u6210\u529F"),D(),b()},b=()=>{l.showMemDialog.memForm={},l.showMemDialog.addVisible=!1,l.showMemDialog.chooseData=null,l.showMemDialog.chooseId=0},T=async t=>{l.showTagDialog.tags=await c.getTagTrees.request(null),l.showTagDialog.tagTreeTeams=await c.getTeamTagIds.request({teamId:t.id}),l.showTagDialog.title=`[${t.name}] \u56E2\u961F\u6807\u7B7E\u4FE1\u606F`,l.showTagDialog.teamId=t.id,l.showTagDialog.visible=!0},I=()=>{l.showTagDialog.visible=!1,setTimeout(()=>{l.showTagDialog.tagTreeTeams=[]},500)},$=async()=>{await c.saveTeamTags.request({teamId:l.showTagDialog.teamId,tagIds:l.showTagDialog.tagTreeTeams}),k.success("\u4FDD\u5B58\u6210\u529F"),I()},N=(t,m)=>{const a=o.value.getNode(t.id);console.log(a),a.checked&&a.parent&&(console.log(a.parent),o.value.setChecked(a.parent,!1,!1)),console.log(t),console.log(m)};return j(P({},x(l)),{teamForm:e,tagTreeRef:o,dateFormat:ee,choose:U,search:f,handlePageChange:_,showSaveTeamDialog:d,saveTeam:y,cancelSaveTeam:F,deleteTeam:r,showMembers:V,setMemebers:D,getAccount:q,showAddMemberDialog:A,addMember:w,cancelAddMember:b,chooseMember:E,deleteMember:B,showTags:T,closeTagDialog:I,saveTags:$,tagTreeNodeCheck:N})}}),de={class:"role-list"},re={style:{float:"right"}},me=g("i",null,null,-1),ge={class:"dialog-footer"},pe={class:"custom-tree-node"},ce={style:{"font-size":"13px"}},he=g("span",{style:{color:"#3c8dbc"}},"\u3010",-1),fe=g("span",{style:{color:"#3c8dbc"}},"\u3011",-1),De={class:"dialog-footer"},we={class:"toolbar"},be=g("i",null,null,-1),Te={class:"dialog-footer"};function ve(e,o,l,f,_,U){const d=i("el-button"),y=i("el-input"),F=i("el-radio"),r=i("el-table-column"),V=i("el-link"),q=i("el-divider"),E=i("el-table"),B=i("el-pagination"),D=i("el-row"),A=i("el-card"),w=i("el-form-item"),b=i("el-form"),T=i("el-dialog"),I=i("el-tag"),$=i("el-tree-select"),N=i("el-option"),t=i("el-select"),m=oe("auth");return p(),L("div",de,[s(A,null,{default:u(()=>[v((p(),h(d,{type:"primary",icon:"plus",onClick:o[0]||(o[0]=a=>e.showSaveTeamDialog(!1))},{default:u(()=>[n("\u6DFB\u52A0")]),_:1})),[[m,"team:save"]]),v((p(),h(d,{disabled:e.chooseId==null,onClick:o[1]||(o[1]=a=>e.showSaveTeamDialog(e.chooseData)),type:"primary",icon:"edit"},{default:u(()=>[n("\u7F16\u8F91")]),_:1},8,["disabled"])),[[m,"team:save"]]),v((p(),h(d,{disabled:e.chooseId==null,onClick:o[2]||(o[2]=a=>e.deleteTeam(e.chooseData)),type:"danger",icon:"delete"},{default:u(()=>[n("\u5220\u9664")]),_:1},8,["disabled"])),[[m,"team:del"]]),g("div",re,[s(y,{placeholder:"\u8BF7\u8F93\u5165\u56E2\u961F\u540D\u79F0",class:"mr2",style:{width:"200px"},modelValue:e.query.name,"onUpdate:modelValue":o[3]||(o[3]=a=>e.query.name=a),onClear:e.search,clearable:""},null,8,["modelValue","onClear"]),s(d,{onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])]),s(E,{data:e.data,onCurrentChange:e.choose,ref:"table",style:{width:"100%"}},{default:u(()=>[s(r,{label:"\u9009\u62E9",width:"55px"},{default:u(a=>[s(F,{modelValue:e.chooseId,"onUpdate:modelValue":o[4]||(o[4]=C=>e.chooseId=C),label:a.row.id},{default:u(()=>[me]),_:2},1032,["modelValue","label"])]),_:1}),s(r,{prop:"name",label:"\u56E2\u961F\u540D\u79F0"}),s(r,{prop:"remark",label:"\u5907\u6CE8","min-width":"160px","show-overflow-tooltip":""}),s(r,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:u(a=>[n(M(e.dateFormat(a.row.createTime)),1)]),_:1}),s(r,{prop:"creator",label:"\u521B\u5EFA\u8005"}),s(r,{label:"\u64CD\u4F5C","min-width":"80px"},{default:u(a=>[s(V,{onClick:G(C=>e.showMembers(a.row),["prevent"]),underline:!1,type:"primary"},{default:u(()=>[n("\u6210\u5458")]),_:2},1032,["onClick"]),s(q,{direction:"vertical","border-style":"dashed"}),s(V,{onClick:G(C=>e.showTags(a.row),["prevent"]),underline:!1,type:"success"},{default:u(()=>[n("\u6807\u7B7E")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),s(D,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:u(()=>[s(B,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":o[5]||(o[5]=a=>e.query.pageNum=a),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),s(T,{width:"400px",title:"\u56E2\u961F\u7F16\u8F91","before-close":e.cancelSaveTeam,modelValue:e.addTeamDialog.visible,"onUpdate:modelValue":o[9]||(o[9]=a=>e.addTeamDialog.visible=a)},{footer:u(()=>[g("div",ge,[s(d,{onClick:o[8]||(o[8]=a=>e.cancelSaveTeam())},{default:u(()=>[n("\u53D6 \u6D88")]),_:1}),s(d,{onClick:e.saveTeam,type:"primary"},{default:u(()=>[n("\u786E \u5B9A")]),_:1},8,["onClick"])])]),default:u(()=>[s(b,{ref:"teamForm",model:e.addTeamDialog.form,"label-width":"70px"},{default:u(()=>[s(w,{prop:"name",label:"\u56E2\u961F\u540D:",required:""},{default:u(()=>[s(y,{modelValue:e.addTeamDialog.form.name,"onUpdate:modelValue":o[6]||(o[6]=a=>e.addTeamDialog.form.name=a),"auto-complete":"off"},null,8,["modelValue"])]),_:1}),s(w,{label:"\u5907\u6CE8:"},{default:u(()=>[s(y,{modelValue:e.addTeamDialog.form.remark,"onUpdate:modelValue":o[7]||(o[7]=a=>e.addTeamDialog.form.remark=a),"auto-complete":"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"]),s(T,{width:"500px",title:e.showTagDialog.title,"before-close":e.closeTagDialog,modelValue:e.showTagDialog.visible,"onUpdate:modelValue":o[13]||(o[13]=a=>e.showTagDialog.visible=a)},{footer:u(()=>[g("div",De,[s(d,{onClick:o[11]||(o[11]=a=>e.closeTagDialog())},{default:u(()=>[n("\u53D6 \u6D88")]),_:1}),v((p(),h(d,{onClick:o[12]||(o[12]=a=>e.saveTags()),type:"primary"},{default:u(()=>[n("\u786E \u5B9A")]),_:1})),[[m,"team:tag:save"]])])]),default:u(()=>[s(b,{"label-width":"70px"},{default:u(()=>[s(w,{prop:"project",label:"\u6807\u7B7E:"},{default:u(()=>[s($,{ref:"tagTreeRef",style:{width:"100%"},modelValue:e.showTagDialog.tagTreeTeams,"onUpdate:modelValue":o[10]||(o[10]=a=>e.showTagDialog.tagTreeTeams=a),data:e.showTagDialog.tags,"default-expanded-keys":e.showTagDialog.tagTreeTeams,multiple:"","render-after-expand":!0,"show-checkbox":"","check-strictly":"","node-key":"id",props:e.showTagDialog.props,onCheck:e.tagTreeNodeCheck},{default:u(({data:a})=>[g("span",pe,[g("span",ce,[n(M(a.code)+" ",1),he,n(" "+M(a.name)+" ",1),fe,a.children!==null?(p(),h(I,{key:0,size:"small"},{default:u(()=>[n(M(a.children.length),1)]),_:2},1024)):ae("",!0)])])]),_:1},8,["modelValue","data","default-expanded-keys","props","onCheck"])]),_:1})]),_:1})]),_:1},8,["title","before-close","modelValue"]),s(T,{width:"600px",title:e.showMemDialog.title,modelValue:e.showMemDialog.visible,"onUpdate:modelValue":o[20]||(o[20]=a=>e.showMemDialog.visible=a)},{default:u(()=>[g("div",we,[v((p(),h(d,{onClick:o[14]||(o[14]=a=>e.showAddMemberDialog()),type:"primary",icon:"plus"},{default:u(()=>[n("\u6DFB\u52A0")]),_:1})),[[m,"team:member:save"]]),v((p(),h(d,{onClick:e.deleteMember,disabled:e.showMemDialog.chooseId==null,type:"danger",icon:"delete"},{default:u(()=>[n("\u79FB\u9664")]),_:1},8,["onClick","disabled"])),[[m,"team:member:del"]])]),s(E,{onCurrentChange:e.chooseMember,border:"",data:e.showMemDialog.members.list},{default:u(()=>[s(r,{label:"\u9009\u62E9",width:"50px"},{default:u(a=>[s(F,{modelValue:e.showMemDialog.chooseId,"onUpdate:modelValue":o[15]||(o[15]=C=>e.showMemDialog.chooseId=C),label:a.row.id},{default:u(()=>[be]),_:2},1032,["modelValue","label"])]),_:1}),s(r,{property:"username",label:"\u8D26\u53F7",width:"135"}),s(r,{property:"createTime",label:"\u52A0\u5165\u65F6\u95F4"},{default:u(a=>[n(M(e.dateFormat(a.row.createTime)),1)]),_:1}),s(r,{property:"creator",label:"\u5206\u914D\u8005",width:"135"})]),_:1},8,["onCurrentChange","data"]),s(B,{onCurrentChange:e.setMemebers,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.showMemDialog.members.total,"current-page":e.showMemDialog.query.pageNum,"onUpdate:current-page":o[16]||(o[16]=a=>e.showMemDialog.query.pageNum=a),"page-size":e.showMemDialog.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),s(T,{width:"400px",title:"\u6DFB\u52A0\u6210\u5458","before-close":e.cancelAddMember,modelValue:e.showMemDialog.addVisible,"onUpdate:modelValue":o[19]||(o[19]=a=>e.showMemDialog.addVisible=a)},{footer:u(()=>[g("div",Te,[s(d,{onClick:o[18]||(o[18]=a=>e.cancelAddMember())},{default:u(()=>[n("\u53D6 \u6D88")]),_:1}),s(d,{onClick:e.addMember,type:"primary"},{default:u(()=>[n("\u786E \u5B9A")]),_:1},8,["onClick"])])]),default:u(()=>[s(b,{model:e.showMemDialog.memForm,"label-width":"70px"},{default:u(()=>[s(w,{label:"\u8D26\u53F7:"},{default:u(()=>[s(t,{style:{width:"100%"},remote:"","remote-method":e.getAccount,modelValue:e.showMemDialog.memForm.accountId,"onUpdate:modelValue":o[17]||(o[17]=a=>e.showMemDialog.memForm.accountId=a),filterable:"",placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u6A21\u7CCA\u641C\u7D22\u5E76\u9009\u62E9"},{default:u(()=>[(p(!0),L(le,null,te(e.showMemDialog.accounts,a=>(p(),h(N,{key:a.id,label:a.username,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["remote-method","modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"])]),_:1},8,["title","modelValue"])])}var Ee=W(ie,[["render",ve]]);export{Ee as default};
