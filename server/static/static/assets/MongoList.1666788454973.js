var W=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var I=(e,t,g)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:g}):e[t]=g,k=(e,t)=>{for(var g in t||(t={}))Z.call(t,g)&&I(e,g,t[g]);if(_)for(var g of _(t))x.call(t,g)&&I(e,g,t[g]);return e},M=(e,t)=>X(e,Y(t));import{m as D}from"./api.16667884549735.js";import{t as ee}from"./api.16667884549732.js";import{T as le,m as ae}from"./TagSelect.1666788454973.js";import{d as L,r as te,c as N,J as oe,t as O,_ as P,E as T,k as s,m as C,p as $,q as l,w as a,y as q,A as n,v as A,z as U,O as j,P as H,e as ie,V as ne,D as u,S as se}from"./index.1666788454973.js";import{f as ue}from"./format.1666788454973.js";import"./Api.1666788454973.js";const re=L({name:"MongoEdit",components:{TagSelect:le},props:{visible:{type:Boolean},mongo:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:t}){const g=te(null),m=N({dialogVisible:!1,sshTunnelMachineList:[],form:{id:null,name:null,uri:null,enableSshTunnel:-1,sshTunnelMachineId:null,tagId:null,tagPath:null},btnLoading:!1,rules:{tagId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6807\u7B7E",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:["change","blur"]}],uri:[{required:!0,message:"\u8BF7\u8F93\u5165mongo uri",trigger:["change","blur"]}]}});oe(e,async p=>{m.dialogVisible=p.visible,m.dialogVisible&&(p.mongo?m.form=k({},p.mongo):m.form={db:0},v())});const v=async()=>{if(m.form.enableSshTunnel==1&&m.sshTunnelMachineList.length==0){const p=await ae.list.request({pageNum:1,pageSize:100});m.sshTunnelMachineList=p.list}},z=async()=>{g.value.validate(async p=>{if(p){const h=k({},m.form);D.saveMongo.request(h).then(()=>{T.success("\u4FDD\u5B58\u6210\u529F"),t("val-change",m.form),m.btnLoading=!0,setTimeout(()=>{m.btnLoading=!1},1e3),c()})}else return T.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},c=()=>{t("update:visible",!1),t("cancel")};return M(k({},O(m)),{mongoForm:g,getSshTunnelMachines:v,btnOk:z,cancel:c})}}),de={class:"dialog-footer"};function ge(e,t,g,m,v,z){const c=s("tag-select"),p=s("el-form-item"),h=s("el-input"),E=s("el-checkbox"),d=s("el-col"),f=s("el-option"),b=s("el-select"),B=s("el-form"),S=s("el-button"),F=s("el-dialog");return C(),$("div",null,[l(F,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=o=>e.dialogVisible=o),"before-close":e.cancel,"close-on-click-modal":!1,width:"38%","destroy-on-close":!0},{footer:a(()=>[q("div",de,[l(S,{onClick:t[6]||(t[6]=o=>e.cancel())},{default:a(()=>[n("\u53D6 \u6D88")]),_:1}),l(S,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:a(()=>[n("\u786E \u5B9A")]),_:1},8,["loading","onClick"])])]),default:a(()=>[l(B,{model:e.form,ref:"mongoForm",rules:e.rules,"label-width":"85px"},{default:a(()=>[l(p,{prop:"tagId",label:"\u6807\u7B7E:",required:""},{default:a(()=>[l(c,{"tag-id":e.form.tagId,"onUpdate:tag-id":t[0]||(t[0]=o=>e.form.tagId=o),"tag-path":e.form.tagPath,"onUpdate:tag-path":t[1]||(t[1]=o=>e.form.tagPath=o),style:{width:"100%"}},null,8,["tag-id","tag-path"])]),_:1}),l(p,{prop:"name",label:"\u540D\u79F0",required:""},{default:a(()=>[l(h,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=o=>e.form.name=o),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(p,{prop:"uri",label:"uri",required:""},{default:a(()=>[l(h,{type:"textarea",rows:2,modelValue:e.form.uri,"onUpdate:modelValue":t[3]||(t[3]=o=>e.form.uri=o),modelModifiers:{trim:!0},placeholder:"\u5F62\u5982 mongodb://username:password@host1:port1","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(p,{prop:"enableSshTunnel",label:"SSH\u96A7\u9053:"},{default:a(()=>[l(d,{span:3},{default:a(()=>[l(E,{onChange:e.getSshTunnelMachines,modelValue:e.form.enableSshTunnel,"onUpdate:modelValue":t[4]||(t[4]=o=>e.form.enableSshTunnel=o),"true-label":1,"false-label":-1},null,8,["onChange","modelValue"])]),_:1}),e.form.enableSshTunnel==1?(C(),A(d,{key:0,span:2},{default:a(()=>[n(" \u673A\u5668: ")]),_:1})):U("",!0),e.form.enableSshTunnel==1?(C(),A(d,{key:1,span:19},{default:a(()=>[l(b,{style:{width:"100%"},modelValue:e.form.sshTunnelMachineId,"onUpdate:modelValue":t[5]||(t[5]=o=>e.form.sshTunnelMachineId=o),placeholder:"\u8BF7\u9009\u62E9SSH\u96A7\u9053\u673A\u5668"},{default:a(()=>[(C(!0),$(j,null,H(e.sshTunnelMachineList,o=>(C(),A(f,{key:o.id,label:`${o.ip}:${o.port} [${o.name}]`,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):U("",!0)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}var me=P(re,[["render",ge]]);const ce=L({name:"MongoList",components:{MongoEdit:me},setup(){const e=N({tags:[],list:[],total:0,currentId:null,currentData:null,query:{pageNum:1,pageSize:10,tagPath:null},mongoEditDialog:{visible:!1,data:null,title:"\u65B0\u589Emongo"},databaseDialog:{visible:!1,data:[],title:"",statsDialog:{visible:!1,data:{},title:""}},collectionsDialog:{database:"",visible:!1,data:[],title:"",statsDialog:{visible:!1,data:{},title:""}},createCollectionDialog:{visible:!1,form:{name:""}}});ie(async()=>{b()});const t=o=>{e.query.pageNum=o,b()},g=o=>{!o||(e.currentId=o.id,e.currentData=o)},m=async o=>{e.databaseDialog.data=(await D.databases.request({id:o})).Databases,e.databaseDialog.title="\u6570\u636E\u5E93\u5217\u8868",e.databaseDialog.visible=!0},v=async o=>{e.databaseDialog.statsDialog.data=await D.runCommand.request({id:e.currentId,database:o,command:{dbStats:1}}),e.databaseDialog.statsDialog.title=`'${o}' stats`,e.databaseDialog.statsDialog.visible=!0},z=async o=>{e.collectionsDialog.database=o,e.collectionsDialog.data=[],c(o),e.collectionsDialog.title=`'${o}' \u96C6\u5408`,e.collectionsDialog.visible=!0},c=async o=>{const r=await D.collections.request({id:e.currentId,database:o}),V=[];for(let y of r)V.push({name:y});e.collectionsDialog.data=V},p=async o=>{e.collectionsDialog.statsDialog.data=await D.runCommand.request({id:e.currentId,database:e.collectionsDialog.database,command:{collStats:o}}),e.collectionsDialog.statsDialog.title=`'${o}' stats`,e.collectionsDialog.statsDialog.visible=!0},h=async o=>{await D.runCommand.request({id:e.currentId,database:e.collectionsDialog.database,command:{drop:o}}),T.success("\u96C6\u5408\u5220\u9664\u6210\u529F"),c(e.collectionsDialog.database)},E=()=>{e.createCollectionDialog.visible=!0},d=async()=>{const o=e.createCollectionDialog.form;await D.runCommand.request({id:e.currentId,database:e.collectionsDialog.database,command:{create:o.name}}),T.success("\u96C6\u5408\u521B\u5EFA\u6210\u529F"),e.createCollectionDialog.visible=!1,e.createCollectionDialog.form={},c(e.collectionsDialog.database)},f=async()=>{try{await se.confirm("\u786E\u5B9A\u5220\u9664\u8BE5mongo?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await D.deleteMongo.request({id:e.currentId}),T.success("\u5220\u9664\u6210\u529F"),e.currentData=null,e.currentId=null,b()}catch{}},b=async()=>{const o=await D.mongoList.request(e.query);e.list=o.list,e.total=o.total},B=async()=>{e.tags=await ee.getAccountTags.request(null)},S=async(o=!1)=>{o?(e.mongoEditDialog.data=null,e.mongoEditDialog.title="\u65B0\u589Emongo"):(e.mongoEditDialog.data=e.currentData,e.mongoEditDialog.title="\u4FEE\u6539mongo"),e.mongoEditDialog.visible=!0},F=()=>{e.currentId=null,e.currentData=null,b()};return M(k({},O(e)),{dateFormat:ne,getTags:B,search:b,handlePageChange:t,choose:g,showDatabases:m,showDatabaseStats:v,showCollections:z,showCollectionStats:p,onDeleteCollection:h,showCreateCollectionDialog:E,onCreateCollection:d,formatByteSize:ue,deleteMongo:f,editMongo:S,valChange:F})}}),pe={style:{float:"right"}},be=q("i",null,null,-1);function fe(e,t,g,m,v,z){const c=s("el-button"),p=s("el-option"),h=s("el-select"),E=s("el-radio"),d=s("el-table-column"),f=s("el-link"),b=s("el-table"),B=s("el-pagination"),S=s("el-row"),F=s("el-card"),o=s("el-divider"),r=s("el-descriptions-item"),V=s("el-descriptions"),y=s("el-dialog"),J=s("el-popconfirm"),R=s("el-input"),G=s("el-form-item"),K=s("el-form"),Q=s("mongo-edit");return C(),$("div",null,[l(F,null,{default:a(()=>[l(c,{type:"primary",icon:"plus",onClick:t[0]||(t[0]=i=>e.editMongo(!0)),plain:""},{default:a(()=>[n("\u6DFB\u52A0")]),_:1}),l(c,{type:"primary",icon:"edit",disabled:e.currentId==null,onClick:t[1]||(t[1]=i=>e.editMongo(!1)),plain:""},{default:a(()=>[n("\u7F16\u8F91")]),_:1},8,["disabled"]),l(c,{type:"danger",icon:"delete",disabled:e.currentId==null,onClick:e.deleteMongo,plain:""},{default:a(()=>[n("\u5220\u9664")]),_:1},8,["disabled","onClick"]),q("div",pe,[l(h,{onFocus:e.getTags,modelValue:e.query.tagPath,"onUpdate:modelValue":t[2]||(t[2]=i=>e.query.tagPath=i),placeholder:"\u8BF7\u9009\u62E9\u6807\u7B7E",filterable:"",clearable:""},{default:a(()=>[(C(!0),$(j,null,H(e.tags,i=>(C(),A(p,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["onFocus","modelValue"]),l(c,{class:"ml5",onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])]),l(b,{data:e.list,style:{width:"100%"},onCurrentChange:e.choose,stripe:""},{default:a(()=>[l(d,{label:"\u9009\u62E9",width:"60px"},{default:a(i=>[l(E,{modelValue:e.currentId,"onUpdate:modelValue":t[3]||(t[3]=w=>e.currentId=w),label:i.row.id},{default:a(()=>[be]),_:2},1032,["modelValue","label"])]),_:1}),l(d,{prop:"tagPath",label:"\u6807\u7B7E\u8DEF\u5F84","min-width":"150","show-overflow-tooltip":""}),l(d,{prop:"name",label:"\u540D\u79F0",width:""}),l(d,{prop:"uri",label:"\u8FDE\u63A5uri","min-width":"150","show-overflow-tooltip":""},{default:a(i=>[n(u(i.row.uri.split("@")[1]),1)]),_:1}),l(d,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":"150"},{default:a(i=>[n(u(e.dateFormat(i.row.createTime)),1)]),_:1}),l(d,{prop:"creator",label:"\u521B\u5EFA\u4EBA"}),l(d,{label:"\u64CD\u4F5C",width:""},{default:a(i=>[l(f,{type:"primary",onClick:w=>e.showDatabases(i.row.id),plain:"",size:"small",underline:!1},{default:a(()=>[n("\u6570\u636E\u5E93")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),l(S,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:a(()=>[l(B,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":t[4]||(t[4]=i=>e.query.pageNum=i),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),l(y,{width:"800px",title:e.databaseDialog.title,modelValue:e.databaseDialog.visible,"onUpdate:modelValue":t[6]||(t[6]=i=>e.databaseDialog.visible=i)},{default:a(()=>[l(b,{data:e.databaseDialog.data,size:"small"},{default:a(()=>[l(d,{"min-width":"130",property:"Name",label:"\u5E93\u540D"}),l(d,{"min-width":"90",property:"SizeOnDisk",label:"size"},{default:a(i=>[n(u(e.formatByteSize(i.row.SizeOnDisk)),1)]),_:1}),l(d,{"min-width":"80",property:"Empty",label:"\u662F\u5426\u4E3A\u7A7A"}),l(d,{"min-width":"80",label:"\u64CD\u4F5C"},{default:a(i=>[l(f,{type:"success",onClick:w=>e.showDatabaseStats(i.row.Name),plain:"",size:"small",underline:!1},{default:a(()=>[n("stats")]),_:2},1032,["onClick"]),l(o,{direction:"vertical","border-style":"dashed"}),l(f,{type:"primary",onClick:w=>e.showCollections(i.row.Name),plain:"",size:"small",underline:!1},{default:a(()=>[n("\u96C6\u5408")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(y,{width:"700px",title:e.databaseDialog.statsDialog.title,modelValue:e.databaseDialog.statsDialog.visible,"onUpdate:modelValue":t[5]||(t[5]=i=>e.databaseDialog.statsDialog.visible=i)},{default:a(()=>[l(V,{title:"\u5E93\u72B6\u6001\u4FE1\u606F",column:3,border:"",size:"small"},{default:a(()=>[l(r,{label:"db","label-align":"right",align:"center"},{default:a(()=>[n(u(e.databaseDialog.statsDialog.data.db),1)]),_:1}),l(r,{label:"collections","label-align":"right",align:"center"},{default:a(()=>[n(u(e.databaseDialog.statsDialog.data.collections),1)]),_:1}),l(r,{label:"objects","label-align":"right",align:"center"},{default:a(()=>[n(u(e.databaseDialog.statsDialog.data.objects),1)]),_:1}),l(r,{label:"indexes","label-align":"right",align:"center"},{default:a(()=>[n(u(e.databaseDialog.statsDialog.data.indexes),1)]),_:1}),l(r,{label:"avgObjSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.databaseDialog.statsDialog.data.avgObjSize)),1)]),_:1}),l(r,{label:"dataSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.databaseDialog.statsDialog.data.dataSize)),1)]),_:1}),l(r,{label:"totalSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.databaseDialog.statsDialog.data.totalSize)),1)]),_:1}),l(r,{label:"storageSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.databaseDialog.statsDialog.data.storageSize)),1)]),_:1}),l(r,{label:"fsTotalSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.databaseDialog.statsDialog.data.fsTotalSize)),1)]),_:1}),l(r,{label:"fsUsedSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.databaseDialog.statsDialog.data.fsUsedSize)),1)]),_:1}),l(r,{label:"indexSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.databaseDialog.statsDialog.data.indexSize)),1)]),_:1})]),_:1})]),_:1},8,["title","modelValue"])]),_:1},8,["title","modelValue"]),l(y,{width:"600px",title:e.collectionsDialog.title,modelValue:e.collectionsDialog.visible,"onUpdate:modelValue":t[8]||(t[8]=i=>e.collectionsDialog.visible=i)},{default:a(()=>[q("div",null,[l(c,{onClick:e.showCreateCollectionDialog,type:"primary",icon:"plus",size:"small"},{default:a(()=>[n("\u65B0\u5EFA")]),_:1},8,["onClick"])]),l(b,{border:"",stripe:"",data:e.collectionsDialog.data,size:"small"},{default:a(()=>[l(d,{prop:"name",label:"\u540D\u79F0","show-overflow-tooltip":""}),l(d,{"min-width":"80",label:"\u64CD\u4F5C"},{default:a(i=>[l(f,{type:"success",onClick:w=>e.showCollectionStats(i.row.name),plain:"",size:"small",underline:!1},{default:a(()=>[n("stats")]),_:2},1032,["onClick"]),l(o,{direction:"vertical","border-style":"dashed"}),l(J,{onConfirm:w=>e.onDeleteCollection(i.row.name),title:"\u786E\u5B9A\u5220\u9664\u8BE5\u96C6\u5408?"},{reference:a(()=>[l(f,{type:"danger",plain:"",size:"small",underline:!1},{default:a(()=>[n("\u5220\u9664")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),l(y,{width:"700px",title:e.collectionsDialog.statsDialog.title,modelValue:e.collectionsDialog.statsDialog.visible,"onUpdate:modelValue":t[7]||(t[7]=i=>e.collectionsDialog.statsDialog.visible=i)},{default:a(()=>[l(V,{title:"\u96C6\u5408\u72B6\u6001\u4FE1\u606F",column:3,border:"",size:"small"},{default:a(()=>[l(r,{label:"ns","label-align":"right",span:2,align:"center"},{default:a(()=>[n(u(e.collectionsDialog.statsDialog.data.ns),1)]),_:1}),l(r,{label:"count","label-align":"right",align:"center"},{default:a(()=>[n(u(e.collectionsDialog.statsDialog.data.count),1)]),_:1}),l(r,{label:"avgObjSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.collectionsDialog.statsDialog.data.avgObjSize)),1)]),_:1}),l(r,{label:"nindexes","label-align":"right",align:"center"},{default:a(()=>[n(u(e.collectionsDialog.statsDialog.data.nindexes),1)]),_:1}),l(r,{label:"size","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.collectionsDialog.statsDialog.data.size)),1)]),_:1}),l(r,{label:"totalSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.collectionsDialog.statsDialog.data.totalSize)),1)]),_:1}),l(r,{label:"storageSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.collectionsDialog.statsDialog.data.storageSize)),1)]),_:1}),l(r,{label:"freeStorageSize","label-align":"right",align:"center"},{default:a(()=>[n(u(e.formatByteSize(e.collectionsDialog.statsDialog.data.freeStorageSize)),1)]),_:1})]),_:1})]),_:1},8,["title","modelValue"])]),_:1},8,["title","modelValue"]),l(y,{width:"400px",title:"\u65B0\u5EFA\u96C6\u5408",modelValue:e.createCollectionDialog.visible,"onUpdate:modelValue":t[11]||(t[11]=i=>e.createCollectionDialog.visible=i),"destroy-on-close":!0},{footer:a(()=>[q("div",null,[l(c,{onClick:t[10]||(t[10]=i=>e.createCollectionDialog.visible=!1)},{default:a(()=>[n("\u53D6 \u6D88")]),_:1}),l(c,{onClick:e.onCreateCollection,type:"primary"},{default:a(()=>[n("\u786E \u5B9A")]),_:1},8,["onClick"])])]),default:a(()=>[l(K,{model:e.createCollectionDialog.form,"label-width":"70px"},{default:a(()=>[l(G,{prop:"name",label:"\u96C6\u5408\u540D",required:""},{default:a(()=>[l(R,{modelValue:e.createCollectionDialog.form.name,"onUpdate:modelValue":t[9]||(t[9]=i=>e.createCollectionDialog.form.name=i),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Q,{onValChange:e.valChange,title:e.mongoEditDialog.title,visible:e.mongoEditDialog.visible,"onUpdate:visible":t[12]||(t[12]=i=>e.mongoEditDialog.visible=i),mongo:e.mongoEditDialog.data,"onUpdate:mongo":t[13]||(t[13]=i=>e.mongoEditDialog.data=i)},null,8,["onValChange","title","visible","mongo"])])}var ze=P(ce,[["render",fe]]);export{ze as default};
