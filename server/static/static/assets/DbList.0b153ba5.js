var ll=Object.defineProperty;var Ae=Object.getOwnPropertySymbols;var al=Object.prototype.hasOwnProperty,tl=Object.prototype.propertyIsEnumerable;var Ue=(M,$,t)=>$ in M?ll(M,$,{enumerable:!0,configurable:!0,writable:!0,value:t}):M[$]=t,ye=(M,$)=>{for(var t in $||($={}))al.call($,t)&&Ue(M,t,$[t]);if(Ae)for(var t of Ae($))tl.call($,t)&&Ue(M,t,$[t]);return M};import{d as ke,r as je,c as Te,t as qe,L as Ne,h as f,i,j as U,k as e,w as a,q as Ee,v as c,l,X as Le,G as ce,Q as P,R as j,m as D,s as S,E as he,F as K,a1 as ne,e as ol,f as ul,V as Be,I as ge,a3 as nl,U as ze,W as Re,N as il,O as sl,a4 as Me,a5 as rl}from"./index.7802fdb0.js";import{f as Oe}from"./format.fd72f709.js";import{d as R,S as Qe}from"./SqlExecBox.3bce0c86.js";import{m as dl,_ as ml}from"./TagSelect.e8f74317.js";import{n as pl,i as bl}from"./assert.d82c837d.js";import{R as Pe}from"./rsa.c09b4898.js";import{E as cl}from"./Enum.48e42737.js";import{t as fl}from"./api.2081aeb1.js";import"./Api.3111dcb4.js";import"./MonacoEditor.69d759a4.js";const gl={class:"dialog-footer"},El=ke({__name:"DbEdit",props:{visible:{type:Boolean},db:{type:[Boolean,Object]},title:{type:String}},emits:["update:visible","cancel","val-change"],setup(M,{emit:$}){const t=M,ie={tagId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6807\u7B7E",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u522B\u540D",trigger:["change","blur"]}],type:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B",trigger:["change","blur"]}],host:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3B\u673Aip\u548Cport",trigger:["change","blur"]}],username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["change","blur"]}],database:[{required:!0,message:"\u8BF7\u6DFB\u52A0\u6570\u636E\u5E93",trigger:["change","blur"]}]},_=je(null),x=Te({dialogVisible:!1,allDatabases:[],databaseList:[],sshTunnelMachineList:[],form:{id:null,tagId:null,tagPath:null,type:null,name:null,host:"",port:3306,username:null,password:null,params:null,database:"",project:null,projectId:null,envId:null,env:null,remark:"",enableSshTunnel:null,sshTunnelMachineId:null},pwd:"",btnLoading:!1}),{dialogVisible:Q,allDatabases:J,databaseList:ae,sshTunnelMachineList:fe,form:y,pwd:te,btnLoading:v}=qe(x);Ne(t,k=>{x.dialogVisible=k.visible,x.dialogVisible&&(k.db?(x.form=ye({},k.db),x.databaseList=k.db.database.split(" ")):(x.form={port:3306,enableSshTunnel:-1},x.databaseList=[]),Z())});const W=()=>{x.form.database=x.databaseList.length==0?"":x.databaseList.join(" ")},Z=async()=>{if(x.form.enableSshTunnel==1&&x.sshTunnelMachineList.length==0){const k=await dl.list.request({pageNum:1,pageSize:100});x.sshTunnelMachineList=k.list}},H=async()=>{const k=ye({},x.form);k.password=await Pe(k.password),x.allDatabases=await R.getAllDatabase.request(k),he.success("\u83B7\u53D6\u6210\u529F, \u8BF7\u9009\u62E9\u9700\u8981\u7BA1\u7406\u64CD\u4F5C\u7684\u6570\u636E\u5E93")},oe=async()=>{x.pwd=await R.getDbPwd.request({id:x.form.id})},ue=async()=>{x.form.id||pl(x.form.password,"\u65B0\u589E\u64CD\u4F5C\uFF0C\u5BC6\u7801\u4E0D\u53EF\u4E3A\u7A7A"),_.value.validate(async k=>{if(k){const E=ye({},x.form);E.password=await Pe(E.password),R.saveDb.request(E).then(()=>{he.success("\u4FDD\u5B58\u6210\u529F"),$("val-change",x.form),x.btnLoading=!0,setTimeout(()=>{x.btnLoading=!1},1e3),X()})}else return he.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},ee=()=>{x.databaseList=[],x.allDatabases=[]},X=()=>{$("update:visible",!1),$("cancel"),setTimeout(()=>{ee()},500)};return(k,E)=>{const O=f("el-form-item"),L=f("el-input"),w=f("el-option"),d=f("el-select"),C=f("el-col"),r=f("el-link"),m=f("el-popover"),B=f("el-divider"),h=f("el-checkbox"),N=f("el-form"),T=f("el-button"),F=f("el-dialog");return i(),U("div",null,[e(F,{title:M.title,modelValue:l(Q),"onUpdate:modelValue":E[15]||(E[15]=s=>ce(Q)?Q.value=s:null),"before-close":X,"close-on-click-modal":!1,"destroy-on-close":!0,width:"38%"},{footer:a(()=>[Ee("div",gl,[e(T,{onClick:E[14]||(E[14]=s=>X())},{default:a(()=>[c("\u53D6 \u6D88")]),_:1}),e(T,{type:"primary",loading:l(v),onClick:ue},{default:a(()=>[c("\u786E \u5B9A")]),_:1},8,["loading"])])]),default:a(()=>[e(N,{model:l(y),ref_key:"dbForm",ref:_,rules:ie,"label-width":"95px"},{default:a(()=>[e(O,{prop:"tagId",label:"\u6807\u7B7E:",required:""},{default:a(()=>[e(ml,{"tag-id":l(y).tagId,"onUpdate:tag-id":E[0]||(E[0]=s=>l(y).tagId=s),"tag-path":l(y).tagPath,"onUpdate:tag-path":E[1]||(E[1]=s=>l(y).tagPath=s),style:{width:"100%"}},null,8,["tag-id","tag-path"])]),_:1}),e(O,{prop:"name",label:"\u522B\u540D:",required:""},{default:a(()=>[e(L,{modelValue:l(y).name,"onUpdate:modelValue":E[2]||(E[2]=s=>l(y).name=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u522B\u540D","auto-complete":"off"},null,8,["modelValue"])]),_:1}),e(O,{prop:"type",label:"\u7C7B\u578B:",required:""},{default:a(()=>[e(d,{style:{width:"100%"},modelValue:l(y).type,"onUpdate:modelValue":E[3]||(E[3]=s=>l(y).type=s),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B"},{default:a(()=>[e(w,{key:"item.id",label:"mysql",value:"mysql"}),e(w,{key:"item.id",label:"postgres",value:"postgres"})]),_:1},8,["modelValue"])]),_:1}),e(O,{prop:"host",label:"host:",required:""},{default:a(()=>[e(C,{span:18},{default:a(()=>[e(L,{disabled:l(y).id!==void 0,modelValue:l(y).host,"onUpdate:modelValue":E[4]||(E[4]=s=>l(y).host=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u4E3B\u673Aip","auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),e(C,{style:{"text-align":"center"},span:1},{default:a(()=>[c(":")]),_:1}),e(C,{span:5},{default:a(()=>[e(L,{type:"number",modelValue:l(y).port,"onUpdate:modelValue":E[5]||(E[5]=s=>l(y).port=s),modelModifiers:{number:!0},placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3"},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{prop:"username",label:"\u7528\u6237\u540D:",required:""},{default:a(()=>[e(L,{modelValue:l(y).username,"onUpdate:modelValue":E[6]||(E[6]=s=>l(y).username=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),e(O,{prop:"password",label:"\u5BC6\u7801:"},{default:a(()=>[e(L,{type:"password","show-password":"",modelValue:l(y).password,"onUpdate:modelValue":E[8]||(E[8]=s=>l(y).password=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF0C\u4FEE\u6539\u64CD\u4F5C\u53EF\u4E0D\u586B",autocomplete:"new-password"},Le({_:2},[l(y).id&&l(y).id!=0?{name:"suffix",fn:a(()=>[e(m,{onHide:E[7]||(E[7]=s=>te.value=""),placement:"right",title:"\u539F\u5BC6\u7801",width:200,trigger:"click",content:l(te)},{reference:a(()=>[e(r,{onClick:oe,underline:!1,type:"primary",class:"mr5"},{default:a(()=>[c("\u539F\u5BC6\u7801 ")]),_:1})]),_:1},8,["content"])]),key:"0"}:void 0]),1032,["modelValue"])]),_:1}),e(O,{prop:"params",label:"\u8FDE\u63A5\u53C2\u6570:"},{default:a(()=>[e(L,{modelValue:l(y).params,"onUpdate:modelValue":E[9]||(E[9]=s=>l(y).params=s),modelModifiers:{trim:!0},placeholder:"\u5176\u4ED6\u8FDE\u63A5\u53C2\u6570\uFF0C\u5F62\u5982: key1=value1&key2=value2"},Le({_:2},[l(y).id&&l(y).id!=0?{name:"suffix",fn:a(()=>[e(r,{target:"_blank",href:"https://github.com/go-sql-driver/mysql#dsn-data-source-name",underline:!1,type:"primary",class:"mr5"},{default:a(()=>[c("\u53C2\u6570\u53C2\u8003")]),_:1})]),key:"0"}:void 0]),1032,["modelValue"])]),_:1}),e(O,{prop:"database",label:"\u6570\u636E\u5E93\u540D:",required:""},{default:a(()=>[e(C,{span:19},{default:a(()=>[e(d,{onChange:W,modelValue:l(ae),"onUpdate:modelValue":E[10]||(E[10]=s=>ce(ae)?ae.value=s:null),multiple:"",clearable:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"","allow-create":"",placeholder:"\u8BF7\u786E\u4FDD\u6570\u636E\u5E93\u5B9E\u4F8B\u4FE1\u606F\u586B\u5199\u5B8C\u6574\u540E\u83B7\u53D6\u5E93\u540D",style:{width:"100%"}},{default:a(()=>[(i(!0),U(P,null,j(l(J),s=>(i(),D(w,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(C,{style:{"text-align":"center"},span:1},{default:a(()=>[e(B,{direction:"vertical","border-style":"dashed"})]),_:1}),e(C,{span:4},{default:a(()=>[e(r,{onClick:H,underline:!1,type:"success"},{default:a(()=>[c("\u83B7\u53D6\u5E93\u540D")]),_:1})]),_:1})]),_:1}),e(O,{prop:"remark",label:"\u5907\u6CE8:"},{default:a(()=>[e(L,{modelValue:l(y).remark,"onUpdate:modelValue":E[11]||(E[11]=s=>l(y).remark=s),modelModifiers:{trim:!0},"auto-complete":"off",type:"textarea"},null,8,["modelValue"])]),_:1}),e(O,{prop:"enableSshTunnel",label:"SSH\u96A7\u9053:"},{default:a(()=>[e(C,{span:3},{default:a(()=>[e(h,{onChange:Z,modelValue:l(y).enableSshTunnel,"onUpdate:modelValue":E[12]||(E[12]=s=>l(y).enableSshTunnel=s),"true-label":1,"false-label":-1},null,8,["modelValue"])]),_:1}),l(y).enableSshTunnel==1?(i(),D(C,{key:0,span:5},{default:a(()=>[c(" \u673A\u5668: ")]),_:1})):S("",!0),l(y).enableSshTunnel==1?(i(),D(C,{key:1,span:16},{default:a(()=>[e(d,{style:{width:"100%"},modelValue:l(y).sshTunnelMachineId,"onUpdate:modelValue":E[13]||(E[13]=s=>l(y).sshTunnelMachineId=s),placeholder:"\u8BF7\u9009\u62E9SSH\u96A7\u9053\u673A\u5668"},{default:a(()=>[(i(!0),U(P,null,j(l(fe),s=>(i(),D(w,{key:s.id,label:`${s.ip}:${s.port} [${s.name}]`,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):S("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),hl=["bigint","binary","blob","char","datetime","date","decimal","double","enum","float","int","json","longblob","longtext","mediumblob","mediumtext","set","smallint","text","time","timestamp","tinyint","varbinary","varchar"],yl=["armscii8","ascii","big5","binary","cp1250","cp1251","cp1256","cp1257","cp850","cp852","cp866","cp932","dec8","eucjpms","euckr","gb18030","gb2312","gbk","geostd8","greek","hebrew","hp8","keybcs2","koi8r","koi8u","latin1","latin2","latin5","latin7","macce","macroman","sjis","swe7","tis620","ucs2","ujis","utf16","utf16le","utf32","utf8","utf8mb4"],Dl=["unicode_ci","bin","croatian_ci","czech_ci","danish_ci","esperanto_ci","estonian_ci","general_ci","german2_ci","hungarian_ci","icelandic_ci","latvian_ci","lithuanian_ci","persian_ci","polish_ci","roman_ci","romanian_ci","sinhala_ci","slovak_ci","slovenian_ci","spanish2_ci","spanish_ci","swedish_ci","turkish_ci","unicode_520_ci","vietnamese_ci"],_l=ke({__name:"CreateTable",props:{visible:{type:Boolean},title:{type:String},data:{type:Object},dbId:{type:Number},db:{type:String}},emits:["update:visible","cancel","val-change","submit-sql"],setup(M,{emit:$}){const t=M,ie=je(),_=Te({dialogVisible:!1,btnloading:!1,activeName:"1",columnTypeList:hl,indexTypeList:["BTREE"],characterSetNameList:yl,collationNameList:Dl,tableData:{fields:{colNames:[{prop:"name",label:"\u5B57\u6BB5\u540D\u79F0"},{prop:"type",label:"\u5B57\u6BB5\u7C7B\u578B"},{prop:"length",label:"\u957F\u5EA6"},{prop:"value",label:"\u9ED8\u8BA4\u503C"},{prop:"notNull",label:"\u975E\u7A7A"},{prop:"pri",label:"\u4E3B\u952E"},{prop:"auto_increment",label:"\u81EA\u589E"},{prop:"remark",label:"\u5907\u6CE8"},{prop:"action",label:"\u64CD\u4F5C"}],res:[{name:"",type:"",value:"",length:"",notNull:!1,pri:!1,auto_increment:!1,remark:""}]},indexs:{colNames:[{prop:"indexName",label:"\u7D22\u5F15\u540D"},{prop:"columnNames",label:"\u5217\u540D"},{prop:"unique",label:"\u552F\u4E00"},{prop:"indexType",label:"\u7C7B\u578B"},{prop:"indexComment",label:"\u5907\u6CE8"},{prop:"action",label:"\u64CD\u4F5C"}],columns:[{name:"",remark:""}],res:[{indexName:"",columnNames:[],unique:!1,indexType:"BTREE",indexComment:""}]},characterSet:"utf8mb4",collation:"utf8mb4_general_ci",tableName:"",tableComment:"",height:550}}),{dialogVisible:x,btnloading:Q,activeName:J,columnTypeList:ae,indexTypeList:fe,characterSetNameList:y,collationNameList:te,tableData:v}=qe(_);Ne(t,async w=>{_.dialogVisible=w.visible});const W=()=>{$("update:visible",!1),O()},Z=()=>{_.tableData.fields.res.push({name:"",type:"",value:"",length:"",notNull:!1,pri:!1,auto_increment:!1,remark:""})},H=()=>{_.tableData.indexs.res.push({indexName:"",columnNames:[],unique:!1,indexType:"BTREE",indexComment:""})},oe=()=>{_.tableData.fields.res.push({name:"id",type:"bigint",length:"20",value:"",notNull:!0,pri:!0,auto_increment:!0,remark:"\u4E3B\u952EID"},{name:"creator_id",type:"bigint",length:"20",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u521B\u5EFA\u4EBAid"},{name:"creator",type:"varchar",length:"100",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u521B\u5EFA\u4EBA\u59D3\u540D"},{name:"creat_time",type:"datetime",length:"",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u521B\u5EFA\u65F6\u95F4"},{name:"updater_id",type:"bigint",length:"20",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u4FEE\u6539\u4EBAid"},{name:"updater",type:"varchar",length:"100",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u4FEE\u6539\u4EBA\u59D3\u540D"},{name:"update_time",type:"datetime",length:"",value:"",notNull:!0,pri:!1,auto_increment:!1,remark:"\u4FEE\u6539\u65F6\u95F4"})},ue=w=>{_.tableData.fields.res.splice(w,1)},ee=w=>{_.tableData.indexs.res.splice(w,1)},X=async()=>{let w=E();if(!w){he.warning("\u6CA1\u6709\u66F4\u6539");return}Qe({sql:w,dbId:t.dbId,db:t.db,runSuccessCallback:()=>{$("submit-sql",{tableName:_.tableData.tableName})}})},k=(w,d,C)=>{let r={del:[],add:[],upd:[]};if(w&&Array.isArray(w)&&w.length===0&&d&&Array.isArray(d)&&d.length>0)return r.add=d,r;if(d&&Array.isArray(d)&&d.length===0&&w&&Array.isArray(w)&&w.length>0)return r.del=w,r;let m={},B={};return w.forEach(h=>m[h[C]]=h),d.forEach(h=>{let N=h[C];B[N]=h,m.hasOwnProperty(N)||r.add.push(h)}),w.forEach(h=>{let N=h[C],T=B[N];if(!T)r.del.push(h);else for(let F in h){let s=h[F],se=T[F];if(s.toString()!==se.toString()){r.upd.push(T);break}}}),r},E=()=>{var C;const w=r=>{let m=r.value?r.value==="CURRENT_TIMESTAMP"?r.value:"'"+r.value+"'":"",B=`${m?"DEFAULT "+m:""}`,h=r.length?`(${r.length})`:"";return` ${r.name} ${r.type}${h} ${r.notNull?"NOT NULL":"NULL"} ${r.auto_increment?"AUTO_INCREMENT":""} ${B} comment '${r.remark||""}' `};let d=_.tableData;if((C=t.data)!=null&&C.edit){let r="",m="",B="";if(_.activeName==="1"){let h=k(L.fields,_.tableData.fields.res,"name");return h.add.length>0&&(r=`ALTER TABLE ${d.tableName}`,h.add.forEach(N=>{r+=` ADD ${w(N)},`}),r=r.substring(0,r.length-1),r+=";"),h.upd.length>0&&(m=`ALTER TABLE ${d.tableName}`,h.upd.forEach(N=>{m+=` MODIFY ${w(N)},`}),m=m.substring(0,m.length-1),m+=";"),h.del.length>0&&h.del.forEach(N=>{B+=` ALTER TABLE ${d.tableName} DROP COLUMN ${N.name}; `}),r+m+B}else if(_.activeName==="2"){let h=k(L.indexs,_.tableData.indexs.res,"indexName"),N=[],T=[];if(h.upd.length>0&&h.upd.forEach(F=>{N.push(F.indexName),T.push(F)}),h.del.length>0&&h.del.forEach(F=>{N.push(F.indexName)}),h.add.length>0&&h.add.forEach(F=>{T.push(F)}),N.length>0||T.length>0){let F=`ALTER TABLE ${d.tableName} `;return N.length>0&&(N.forEach(s=>{F+=`DROP INDEX ${s},`}),F=F.substring(0,F.length-1)),T.length>0&&(N.length>0&&(F+=","),T.forEach(s=>{F+=` ADD ${s.unique?"UNIQUE":""} INDEX ${s.indexName}(${s.columnNames.join(",")}) USING ${s.indexType} COMMENT '${s.indexComment}',`}),F=F.substring(0,F.length-1)),F}}}else if(_.activeName==="1"){let r="",m=[];return d.fields.res.forEach(B=>{m.push(w(B)),B.pri&&(r+=`${B.name},`)}),`CREATE TABLE ${d.tableName}
                  ( ${m.join(",")}
                      ${r?`, PRIMARY KEY (${r.slice(0,-1)})`:""}
                  ) ENGINE=InnoDB DEFAULT CHARSET=${d.characterSet} COLLATE =${d.collation} COMMENT='${d.tableComment}';`}else if(_.activeName==="2"&&d.indexs.res.length>0){let r=`ALTER TABLE ${d.tableName}`;return _.tableData.indexs.res.forEach(m=>{r+=` ADD ${m.unique?"UNIQUE":""} INDEX ${m.indexName}(${m.columnNames.join(",")}) USING ${m.indexType} COMMENT '${m.indexComment}',`}),r.substring(0,r.length-1)+";"}},O=()=>{_.activeName="1",ie.value.resetFields(),_.tableData.tableName="",_.tableData.tableComment="",_.tableData.fields.res=[{name:"",type:"",value:"",length:"",notNull:!1,pri:!1,auto_increment:!1,remark:""}],_.tableData.indexs.res=[{indexName:"",columnNames:[],unique:!1,indexType:"BTREE",indexComment:""}]},L={indexs:[],fields:[]};return Ne(()=>t.data,w=>{const{row:d,indexs:C,columns:r}=w;_.tableData.tableName=d.tableName,_.tableData.tableComment=d.tableComment,r&&Array.isArray(r)&&r.length>0&&(L.fields=[],_.tableData.fields.res=[],_.tableData.indexs.columns=[],r.forEach(m=>{var F;let B=m.columnType.replace(")","").split("("),h=B[0],N=B.length>1&&B[1]||"",T={name:m.columnName,type:h,value:m.columnDefault||"",length:N,notNull:m.nullable!=="YES",pri:m.columnKey==="PRI",auto_increment:((F=m.extra)==null?void 0:F.indexOf("auto_increment"))>-1,remark:m.columnComment};_.tableData.fields.res.push(T),L.fields.push(JSON.parse(JSON.stringify(T))),_.tableData.indexs.columns.push({name:m.columnName,remark:m.columnComment})})),C&&Array.isArray(C)&&C.length>0&&(L.indexs=[],_.tableData.indexs.res=[],C.filter(m=>m.indexName!=="PRIMARY").forEach(m=>{var h;let B={indexName:m.indexName,columnNames:(h=m.columnName)==null?void 0:h.split(","),unique:m.nonUnique===0||!1,indexType:m.indexType,indexComment:m.indexComment};_.tableData.indexs.res.push(B),L.indexs.push(JSON.parse(JSON.stringify(B)))}))}),(w,d)=>{const C=f("el-input"),r=f("el-form-item"),m=f("el-col"),B=f("el-option"),h=f("el-select"),N=f("el-row"),T=f("el-checkbox"),F=f("el-link"),s=f("el-table-column"),se=f("el-table"),re=f("el-button"),de=f("el-tab-pane"),De=f("el-tabs"),_e=f("el-form"),ve=f("el-dialog");return i(),U("div",null,[e(ve,{title:M.title,modelValue:l(x),"onUpdate:modelValue":d[9]||(d[9]=p=>ce(x)?x.value=p:null),"before-close":W,width:"90%"},{footer:a(()=>[e(re,{loading:l(Q),onClick:d[8]||(d[8]=p=>X()),type:"primary"},{default:a(()=>[c("\u4FDD\u5B58")]),_:1},8,["loading"])]),default:a(()=>[e(_e,{"label-position":"left",ref_key:"formRef",ref:ie,model:l(v),"label-width":"80px"},{default:a(()=>[e(N,null,{default:a(()=>[e(m,{span:12},{default:a(()=>[e(r,{prop:"tableName",label:"\u8868\u540D"},{default:a(()=>[e(C,{style:{width:"80%"},modelValue:l(v).tableName,"onUpdate:modelValue":d[0]||(d[0]=p=>l(v).tableName=p),size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:a(()=>[e(r,{prop:"tableComment",label:"\u5907\u6CE8"},{default:a(()=>[e(C,{style:{width:"80%"},modelValue:l(v).tableComment,"onUpdate:modelValue":d[1]||(d[1]=p=>l(v).tableComment=p),size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:a(()=>[e(r,{prop:"characterSet",label:"charset"},{default:a(()=>[e(h,{filterable:"",style:{width:"80%"},modelValue:l(v).characterSet,"onUpdate:modelValue":d[2]||(d[2]=p=>l(v).characterSet=p),size:"small"},{default:a(()=>[(i(!0),U(P,null,j(l(y),p=>(i(),D(B,{key:p,label:p,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:a(()=>[e(r,{prop:"characterSet",label:"collation"},{default:a(()=>[e(h,{filterable:"",style:{width:"80%"},modelValue:l(v).collation,"onUpdate:modelValue":d[3]||(d[3]=p=>l(v).collation=p),size:"small"},{default:a(()=>[(i(!0),U(P,null,j(l(te),p=>(i(),D(B,{key:p,label:l(v).characterSet+"_"+p,value:l(v).characterSet+"_"+p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(De,{modelValue:l(J),"onUpdate:modelValue":d[7]||(d[7]=p=>ce(J)?J.value=p:null)},{default:a(()=>[e(de,{label:"\u5B57\u6BB5",name:"1"},{default:a(()=>[e(se,{data:l(v).fields.res,"max-height":l(v).height},{default:a(()=>[(i(!0),U(P,null,j(l(v).fields.colNames,p=>(i(),D(s,{prop:p.prop,label:p.label,key:p.prop},{default:a(V=>[p.prop==="name"?(i(),D(C,{key:0,size:"small",modelValue:V.row.name,"onUpdate:modelValue":g=>V.row.name=g},null,8,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="type"?(i(),D(h,{key:1,filterable:"",size:"small",modelValue:V.row.type,"onUpdate:modelValue":g=>V.row.type=g},{default:a(()=>[(i(!0),U(P,null,j(l(ae),g=>(i(),D(B,{key:g,value:g},{default:a(()=>[c(K(g),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="value"?(i(),D(C,{key:2,size:"small",modelValue:V.row.value,"onUpdate:modelValue":g=>V.row.value=g},null,8,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="length"?(i(),D(C,{key:3,size:"small",modelValue:V.row.length,"onUpdate:modelValue":g=>V.row.length=g},null,8,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="notNull"?(i(),D(T,{key:4,size:"small",modelValue:V.row.notNull,"onUpdate:modelValue":g=>V.row.notNull=g},null,8,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="pri"?(i(),D(T,{key:5,size:"small",modelValue:V.row.pri,"onUpdate:modelValue":g=>V.row.pri=g},null,8,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="auto_increment"?(i(),D(T,{key:6,size:"small",modelValue:V.row.auto_increment,"onUpdate:modelValue":g=>V.row.auto_increment=g},null,8,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="remark"?(i(),D(C,{key:7,size:"small",modelValue:V.row.remark,"onUpdate:modelValue":g=>V.row.remark=g},null,8,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="action"?(i(),D(F,{key:8,type:"danger",plain:"",size:"small",underline:!1,onClick:ne(g=>ue(V.$index),["prevent"])},{default:a(()=>[c("\u5220\u9664")]),_:2},1032,["onClick"])):S("",!0)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data","max-height"]),e(N,{style:{"margin-top":"20px"}},{default:a(()=>[e(re,{onClick:d[4]||(d[4]=p=>oe()),link:"",type:"warning",icon:"plus"},{default:a(()=>[c("\u6DFB\u52A0\u9ED8\u8BA4\u5217")]),_:1}),e(re,{onClick:d[5]||(d[5]=p=>Z()),link:"",type:"primary",icon:"plus"},{default:a(()=>[c("\u6DFB\u52A0\u5217")]),_:1})]),_:1})]),_:1}),e(de,{label:"\u7D22\u5F15",name:"2"},{default:a(()=>[e(se,{data:l(v).indexs.res,"max-height":l(v).height},{default:a(()=>[(i(!0),U(P,null,j(l(v).indexs.colNames,p=>(i(),D(s,{prop:p.prop,label:p.label,key:p.prop},{default:a(V=>[p.prop==="indexName"?(i(),D(C,{key:0,size:"small",modelValue:V.row.indexName,"onUpdate:modelValue":g=>V.row.indexName=g},null,8,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="columnNames"?(i(),D(h,{key:1,modelValue:V.row.columnNames,"onUpdate:modelValue":g=>V.row.columnNames=g,multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5",style:{width:"100%"}},{default:a(()=>[(i(!0),U(P,null,j(l(v).indexs.columns,g=>(i(),D(B,{key:g.name,label:g.name,value:g.name},{default:a(()=>[c(K(g.name+" - "+(g.remark||"")),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="unique"?(i(),D(T,{key:2,size:"small",modelValue:V.row.unique,"onUpdate:modelValue":g=>V.row.unique=g},null,8,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="indexType"?(i(),D(h,{key:3,filterable:"",size:"small",modelValue:V.row.indexType,"onUpdate:modelValue":g=>V.row.indexType=g},{default:a(()=>[(i(!0),U(P,null,j(l(fe),g=>(i(),D(B,{key:g,value:g},{default:a(()=>[c(K(g),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="indexComment"?(i(),D(C,{key:4,size:"small",modelValue:V.row.indexComment,"onUpdate:modelValue":g=>V.row.indexComment=g},null,8,["modelValue","onUpdate:modelValue"])):S("",!0),p.prop==="action"?(i(),D(F,{key:5,type:"danger",plain:"",size:"small",underline:!1,onClick:ne(g=>ee(V.$index),["prevent"])},{default:a(()=>[c("\u5220\u9664")]),_:2},1032,["onClick"])):S("",!0)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data","max-height"]),e(N,{style:{"margin-top":"20px"}},{default:a(()=>[e(re,{onClick:d[6]||(d[6]=p=>H()),link:"",type:"primary",icon:"plus"},{default:a(()=>[c("\u6DFB\u52A0\u7D22\u5F15")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});var le={DbSqlExecTypeEnum:new cl().add("UPDATE","UPDATE",1).add("DELETE","DELETE",2).add("INSERT","INSERT",3)};const vl={class:"db-list"},wl={style:{float:"right"}},Cl=Ee("i",null,null,-1),xl={style:{"text-align":"right"}},Vl={class:"toolbar"},Ll=ke({__name:"DbList",setup(M){const $={saveDb:"db:save",delDb:"db:del"},t=Te({row:{},dbId:0,db:"",tags:[],chooseId:null,chooseData:null,query:{tagPath:null,projectId:null,pageNum:1,pageSize:10},datas:[],total:0,showDumpInfo:!1,dumpInfo:{id:0,db:"",type:3,tables:[]},sqlExecLogDialog:{title:"",visible:!1,data:[],total:0,dbs:[],query:{dbId:0,db:"",table:"",type:null,pageNum:1,pageSize:12}},rollbackSqlDialog:{visible:!1,sql:""},chooseTableName:"",tableInfoDialog:{loading:!1,visible:!1,infos:[],tableNameSearch:"",tableCommentSearch:""},columnDialog:{visible:!1,columns:[]},indexDialog:{visible:!1,indexs:[]},ddlDialog:{visible:!1,ddl:""},dbEditDialog:{visible:!1,data:null,title:"\u65B0\u589E\u6570\u636E\u5E93"},tableCreateDialog:{title:"\u521B\u5EFA\u8868",visible:!1,activeName:"1",type:"",enableEditTypes:["mysql"],data:{edit:!1,row:{},indexs:[],columns:[]}},filterDb:{param:"",cache:[],list:[]}}),{dbId:ie,db:_,tags:x,chooseId:Q,query:J,datas:ae,total:fe,showDumpInfo:y,dumpInfo:te,sqlExecLogDialog:v,rollbackSqlDialog:W,chooseTableName:Z,tableInfoDialog:H,columnDialog:oe,indexDialog:ue,ddlDialog:ee,dbEditDialog:X,tableCreateDialog:k,filterDb:E}=qe(t);ol(async()=>{w()});const O=ul(()=>{const n=t.tableInfoDialog.infos,u=t.tableInfoDialog.tableNameSearch,q=t.tableInfoDialog.tableCommentSearch;return!u&&!q?n:n.filter(G=>{let Y=!0,z=!0;return u&&(Y=G.tableName.toLowerCase().includes(u.toLowerCase())),q&&(z=G.tableComment.includes(q)),Y&&z})}),L=n=>{!n||(t.chooseId=n.id,t.chooseData=n)},w=async()=>{let n=await R.dbs.request(t.query);n.list.forEach(u=>{u.popoverSelectDbVisible=!1,u.dbs=u.database.split(" ")}),t.datas=n.list,t.total=n.total},d=n=>{t.query.pageNum=n,w()},C=async()=>{t.tags=await fl.getAccountTags.request(null)},r=async(n=!1)=>{n?(t.dbEditDialog.data=null,t.dbEditDialog.title="\u65B0\u589E\u6570\u636E\u5E93\u8D44\u6E90"):(t.dbEditDialog.data=t.chooseData,t.dbEditDialog.title="\u4FEE\u6539\u6570\u636E\u5E93\u8D44\u6E90"),t.dbEditDialog.visible=!0},m=()=>{t.chooseData=null,t.chooseId=null,w()},B=async n=>{try{await Re.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u5E93?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await R.deleteDb.request({id:n}),he.success("\u5220\u9664\u6210\u529F"),t.chooseData=null,t.chooseId=null,w()}catch{}},h=async n=>{t.sqlExecLogDialog.title=`${n.name}[${n.host}:${n.port}]`,t.sqlExecLogDialog.query.dbId=n.id,t.sqlExecLogDialog.dbs=n.database.split(" "),T(),t.sqlExecLogDialog.visible=!0},N=()=>{t.sqlExecLogDialog.visible=!1,t.sqlExecLogDialog.data=[],t.sqlExecLogDialog.dbs=[],t.sqlExecLogDialog.total=0,t.sqlExecLogDialog.query.dbId=0,t.sqlExecLogDialog.query.pageNum=1,t.sqlExecLogDialog.query.table="",t.sqlExecLogDialog.query.db="",t.sqlExecLogDialog.query.type=null},T=async()=>{const n=await R.getSqlExecs.request(t.sqlExecLogDialog.query);t.sqlExecLogDialog.data=n.list,t.sqlExecLogDialog.total=n.total},F=n=>{t.sqlExecLogDialog.query.pageNum=n,T()},s=n=>{t.dumpInfo.tables=n.map(u=>u.tableName)},se=n=>{bl(t.dumpInfo.tables.length>0,"\u8BF7\u9009\u62E9\u8981\u5BFC\u51FA\u7684\u8868");const u=document.createElement("a");u.setAttribute("href",`${il.baseApiUrl}/dbs/${t.dbId}/dump?db=${n}&type=${t.dumpInfo.type}&tables=${t.dumpInfo.tables.join(",")}&token=${sl("token")}`),u.click(),t.showDumpInfo=!1},re=async n=>{const u=await R.columnMetadata.request({id:n.dbId,db:n.db,tableName:n.table}),q=u[0].columnName,G=JSON.parse(n.oldValue),Y=[];if(n.type==le.DbSqlExecTypeEnum.UPDATE.value)for(let z of G){const b=[];for(let A in z)A!=q&&b.push(`${A} = ${de(z[A])}`);Y.push(`UPDATE ${n.table} SET ${b.join(", ")} WHERE ${q} = ${de(z[q])};`)}else if(n.type==le.DbSqlExecTypeEnum.DELETE.value){const z=u.map(b=>b.columnName);for(let b of G){const A=[];for(let Ce of z)A.push(de(b[Ce]));Y.push(`INSERT INTO ${n.table} (${z.join(", ")}) VALUES (${A.join(", ")});`)}}t.rollbackSqlDialog.sql=Y.join(`
`),t.rollbackSqlDialog.visible=!0},de=n=>typeof n=="number"?n:`'${n}'`,De=async(n,u)=>{t.tableInfoDialog.loading=!0,t.tableInfoDialog.visible=!0;try{t.tableInfoDialog.infos=await R.tableInfos.request({id:n.id,db:u}),t.tableCreateDialog.type=n.type,t.dbId=n.id,t.row=n,t.db=u}catch{t.tableInfoDialog.visible=!1}finally{t.tableInfoDialog.loading=!1}},_e=async n=>{await we(n),t.tableInfoDialog.infos=await R.tableInfos.request({id:t.dbId,db:t.db})},ve=()=>{t.showDumpInfo=!1,t.tableInfoDialog.visible=!1,t.tableInfoDialog.infos=[]},p=async n=>{t.chooseTableName=n.tableName,t.columnDialog.columns=await R.columnMetadata.request({id:t.chooseId,db:t.db,tableName:n.tableName}),t.columnDialog.visible=!0},V=async n=>{t.chooseTableName=n.tableName,t.indexDialog.indexs=await R.tableIndex.request({id:t.chooseId,db:t.db,tableName:n.tableName}),t.indexDialog.visible=!0},g=async n=>{t.chooseTableName=n.tableName;const u=await R.tableDdl.request({id:t.chooseId,db:t.db,tableName:n.tableName});t.ddlDialog.ddl=u[0]["Create Table"],t.ddlDialog.visible=!0},He=async n=>{try{const u=n.tableName;await Re.confirm(`\u786E\u5B9A\u5220\u9664'${u}'\u8868?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),Qe({sql:`DROP TABLE ${u}`,dbId:t.chooseId,db:t.db,runSuccessCallback:async()=>{t.tableInfoDialog.infos=await R.tableInfos.request({id:t.chooseId,db:t.db})}})}catch{}},Ye=(n,u)=>{let q=Me.state.sqlExecInfo.dbOptInfo.db;if(u&&q!==u){const{tagPath:G,id:Y}=n;let z={tagPath:G,dbId:Y,db:u};Me.dispatch("sqlExecInfo/setSqlExecInfo",z)}rl.push({name:"SqlExec"})},Je=n=>{t.filterDb.param="",t.filterDb.cache=n,t.filterDb.list=n},Xe=()=>{t.filterDb.param?t.filterDb.list=t.filterDb.cache.filter(n=>String(n).toLowerCase().indexOf(t.filterDb.param)>-1):t.filterDb.list=t.filterDb.cache},we=async n=>{if(t.tableCreateDialog.visible=!0,t.tableCreateDialog.activeName="1",n===!1&&(t.tableCreateDialog.data={edit:!1,row:{},indexs:[],columns:[]},t.tableCreateDialog.title="\u521B\u5EFA\u8868"),n.tableName){t.tableCreateDialog.title="\u4FEE\u6539\u8868";let u=await R.tableIndex.request({id:t.chooseId,db:t.db,tableName:n.tableName}),q=await R.columnMetadata.request({id:t.chooseId,db:t.db,tableName:n.tableName});t.tableCreateDialog.data={edit:!0,row:n,indexs:u,columns:q}}};return(n,u)=>{const q=f("el-button"),G=f("el-option"),Y=f("el-select"),z=f("el-radio"),b=f("el-table-column"),A=f("el-link"),Ce=f("el-icon"),me=f("el-input"),Ie=f("el-popover"),pe=f("el-table"),Se=f("el-pagination"),xe=f("el-row"),Ge=f("el-card"),Ke=f("el-radio-group"),$e=f("el-form-item"),be=f("el-dialog"),Ve=f("el-tag"),Fe=Be("auth"),We=Be("waves"),Ze=Be("loading");return i(),U("div",vl,[e(Ge,null,{default:a(()=>[ge((i(),D(q,{type:"primary",icon:"plus",onClick:u[0]||(u[0]=o=>r(!0))},{default:a(()=>[c("\u6DFB\u52A0")]),_:1})),[[Fe,$.saveDb]]),ge((i(),D(q,{disabled:l(Q)==null,onClick:u[1]||(u[1]=o=>r(!1)),type:"primary",icon:"edit"},{default:a(()=>[c("\u7F16\u8F91")]),_:1},8,["disabled"])),[[Fe,$.saveDb]]),ge((i(),D(q,{disabled:l(Q)==null,onClick:u[2]||(u[2]=o=>B(l(Q))),type:"danger",icon:"delete"},{default:a(()=>[c("\u5220\u9664")]),_:1},8,["disabled"])),[[Fe,$.delDb]]),Ee("div",wl,[e(Y,{onFocus:C,modelValue:l(J).tagPath,"onUpdate:modelValue":u[3]||(u[3]=o=>l(J).tagPath=o),placeholder:"\u8BF7\u9009\u62E9\u6807\u7B7E",filterable:"",clearable:""},{default:a(()=>[(i(!0),U(P,null,j(l(x),o=>(i(),D(G,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),ge((i(),D(q,{type:"primary",icon:"search",onClick:u[4]||(u[4]=o=>w()),class:"ml5"},{default:a(()=>[c("\u67E5\u8BE2")]),_:1})),[[We]])]),e(pe,{data:l(ae),ref:"table",onCurrentChange:L,"show-overflow-tooltip":"",stripe:""},{default:a(()=>[e(b,{label:"\u9009\u62E9",width:"60px"},{default:a(o=>[e(z,{modelValue:l(Q),"onUpdate:modelValue":u[5]||(u[5]=I=>ce(Q)?Q.value=I:null),label:o.row.id},{default:a(()=>[Cl]),_:2},1032,["modelValue","label"])]),_:1}),e(b,{prop:"tagPath",label:"\u6807\u7B7E\u8DEF\u5F84","min-width":"150","show-overflow-tooltip":""}),e(b,{prop:"name",label:"\u540D\u79F0","min-width":"160","show-overflow-tooltip":""}),e(b,{"min-width":"170",label:"host:port","show-overflow-tooltip":""},{default:a(o=>[c(K(`${o.row.host}:${o.row.port}`),1)]),_:1}),e(b,{prop:"type",label:"\u7C7B\u578B","min-width":"90"}),e(b,{prop:"database",label:"\u6570\u636E\u5E93","min-width":"80"},{default:a(o=>[e(Ie,{placement:"right",trigger:"click",width:300},{reference:a(()=>[e(A,{type:"primary",underline:!1,plain:"",onClick:I=>Je(o.row.dbs)},{default:a(()=>[c("\u67E5\u770B ")]),_:2},1032,["onClick"])]),default:a(()=>[e(me,{modelValue:l(E).param,"onUpdate:modelValue":u[6]||(u[6]=I=>l(E).param=I),onKeyup:Xe,class:"w-50 m-2",placeholder:"\u641C\u7D22",size:"small"},{prefix:a(()=>[e(Ce,{class:"el-input__icon"},{default:a(()=>[e(l(nl))]),_:1})]),_:1},8,["modelValue"]),(i(!0),U(P,null,j(l(E).list,I=>(i(),U("div",{class:"el-tag--plain el-tag--success",key:I,style:{border:"1px var(--color-success-light-3) solid","margin-top":"3px","border-radius":"5px",padding:"2px",position:"relative"}},[e(A,{type:"success",plain:"",size:"small",underline:!1,onClick:el=>De(o.row,I)},{default:a(()=>[c(K(I),1)]),_:2},1032,["onClick"]),e(A,{type:"primary",plain:"",size:"small",underline:!1,onClick:el=>Ye(o.row,I),style:{position:"absolute",right:"4px"}},{default:a(()=>[c("\u6570\u636E\u64CD\u4F5C ")]),_:2},1032,["onClick"])]))),128))]),_:2},1024)]),_:1}),e(b,{prop:"username",label:"\u7528\u6237\u540D","min-width":"100"}),e(b,{prop:"remark",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""}),e(b,{"min-width":"115",prop:"creator",label:"\u521B\u5EFA\u8D26\u53F7"}),e(b,{"min-width":"160",prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","show-overflow-tooltip":""},{default:a(o=>[c(K(l(ze)(o.row.createTime)),1)]),_:1}),e(b,{label:"\u64CD\u4F5C","min-width":"120",fixed:"right"},{default:a(o=>[e(A,{type:"primary",plain:"",size:"small",underline:!1,onClick:I=>h(o.row)},{default:a(()=>[c(" SQL\u6267\u884C\u8BB0\u5F55")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(xe,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:a(()=>[e(Se,{style:{"text-align":"right"},onCurrentChange:d,total:l(fe),layout:"prev, pager, next, total, jumper","current-page":l(J).pageNum,"onUpdate:current-page":u[7]||(u[7]=o=>l(J).pageNum=o),"page-size":l(J).pageSize},null,8,["total","current-page","page-size"])]),_:1})]),_:1}),e(be,{width:"80%",title:`${l(_)} \u8868\u4FE1\u606F`,"before-close":ve,modelValue:l(H).visible,"onUpdate:modelValue":u[15]||(u[15]=o=>l(H).visible=o)},{default:a(()=>[e(xe,{class:"mb10"},{default:a(()=>[e(Ie,{visible:l(y),"onUpdate:visible":u[11]||(u[11]=o=>ce(y)?y.value=o:null),width:470,placement:"right",trigger:"click"},{reference:a(()=>[e(q,{class:"ml5",type:"success",size:"small"},{default:a(()=>[c("\u5BFC\u51FA")]),_:1})]),default:a(()=>[e($e,{label:"\u5BFC\u51FA\u5185\u5BB9: "},{default:a(()=>[e(Ke,{modelValue:l(te).type,"onUpdate:modelValue":u[8]||(u[8]=o=>l(te).type=o)},{default:a(()=>[e(z,{label:1,size:"small"},{default:a(()=>[c("\u7ED3\u6784")]),_:1}),e(z,{label:2,size:"small"},{default:a(()=>[c("\u6570\u636E")]),_:1}),e(z,{label:3,size:"small"},{default:a(()=>[c("\u7ED3\u6784\uFF0B\u6570\u636E")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e($e,{label:"\u5BFC\u51FA\u8868: "},{default:a(()=>[e(pe,{onSelectionChange:s,"max-height":"300",size:"small",data:l(H).infos},{default:a(()=>[e(b,{type:"selection",width:"45"}),e(b,{property:"tableName",label:"\u8868\u540D","min-width":"150","show-overflow-tooltip":""}),e(b,{property:"tableComment",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1}),Ee("div",xl,[e(q,{onClick:u[9]||(u[9]=o=>y.value=!1),size:"small"},{default:a(()=>[c("\u53D6\u6D88")]),_:1}),e(q,{onClick:u[10]||(u[10]=o=>se(l(_))),type:"success",size:"small"},{default:a(()=>[c("\u786E\u5B9A")]),_:1})])]),_:1},8,["visible"]),e(q,{type:"primary",size:"small",onClick:u[12]||(u[12]=o=>we(!1))},{default:a(()=>[c("\u521B\u5EFA\u8868")]),_:1})]),_:1}),ge((i(),D(pe,{border:"",stripe:"",data:l(O),size:"small","max-height":"680"},{default:a(()=>[e(b,{property:"tableName",label:"\u8868\u540D","min-width":"150","show-overflow-tooltip":""},{header:a(()=>[e(me,{modelValue:l(H).tableNameSearch,"onUpdate:modelValue":u[13]||(u[13]=o=>l(H).tableNameSearch=o),size:"small",placeholder:"\u8868\u540D: \u8F93\u5165\u53EF\u8FC7\u6EE4",clearable:""},null,8,["modelValue"])]),_:1}),e(b,{property:"tableComment",label:"\u5907\u6CE8","min-width":"150","show-overflow-tooltip":""},{header:a(()=>[e(me,{modelValue:l(H).tableCommentSearch,"onUpdate:modelValue":u[14]||(u[14]=o=>l(H).tableCommentSearch=o),size:"small",placeholder:"\u5907\u6CE8: \u8F93\u5165\u53EF\u8FC7\u6EE4",clearable:""},null,8,["modelValue"])]),_:1}),e(b,{prop:"tableRows",label:"Rows","min-width":"70",sortable:"","sort-method":(o,I)=>parseInt(o.tableRows)-parseInt(I.tableRows)},null,8,["sort-method"]),e(b,{property:"dataLength",label:"\u6570\u636E\u5927\u5C0F",sortable:"","sort-method":(o,I)=>parseInt(o.dataLength)-parseInt(I.dataLength)},{default:a(o=>[c(K(l(Oe)(o.row.dataLength)),1)]),_:1},8,["sort-method"]),e(b,{property:"indexLength",label:"\u7D22\u5F15\u5927\u5C0F",sortable:"","sort-method":(o,I)=>parseInt(o.indexLength)-parseInt(I.indexLength)},{default:a(o=>[c(K(l(Oe)(o.row.indexLength)),1)]),_:1},8,["sort-method"]),e(b,{property:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":"150"}),e(b,{label:"\u66F4\u591A\u4FE1\u606F","min-width":"140"},{default:a(o=>[e(A,{onClick:ne(I=>p(o.row),["prevent"]),type:"primary"},{default:a(()=>[c("\u5B57\u6BB5")]),_:2},1032,["onClick"]),e(A,{class:"ml5",onClick:ne(I=>V(o.row),["prevent"]),type:"success"},{default:a(()=>[c("\u7D22\u5F15")]),_:2},1032,["onClick"]),l(k).enableEditTypes.indexOf(l(k).type)>-1?(i(),D(A,{key:0,class:"ml5",onClick:ne(I=>we(o.row),["prevent"]),type:"warning"},{default:a(()=>[c("\u7F16\u8F91\u8868")]),_:2},1032,["onClick"])):S("",!0),e(A,{class:"ml5",onClick:ne(I=>g(o.row),["prevent"]),type:"info"},{default:a(()=>[c("DDL")]),_:2},1032,["onClick"])]),_:1}),e(b,{label:"\u64CD\u4F5C","min-width":"80"},{default:a(o=>[e(A,{onClick:ne(I=>He(o.row),["prevent"]),type:"danger"},{default:a(()=>[c("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ze,l(H).loading]])]),_:1},8,["title","modelValue"]),e(be,{width:"90%",title:`${l(v).title} - SQL\u6267\u884C\u8BB0\u5F55`,"before-close":N,modelValue:l(v).visible,"onUpdate:modelValue":u[20]||(u[20]=o=>l(v).visible=o)},{default:a(()=>[Ee("div",Vl,[e(Y,{modelValue:l(v).query.db,"onUpdate:modelValue":u[16]||(u[16]=o=>l(v).query.db=o),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93",filterable:"",clearable:""},{default:a(()=>[(i(!0),U(P,null,j(l(v).dbs,o=>(i(),D(G,{key:o,label:`${o}`,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(me,{modelValue:l(v).query.table,"onUpdate:modelValue":u[17]||(u[17]=o=>l(v).query.table=o),placeholder:"\u8BF7\u8F93\u5165\u8868\u540D",clearable:"",class:"ml5",style:{width:"180px"}},null,8,["modelValue"]),e(Y,{modelValue:l(v).query.type,"onUpdate:modelValue":u[18]||(u[18]=o=>l(v).query.type=o),placeholder:"\u8BF7\u9009\u62E9\u64CD\u4F5C\u7C7B\u578B",clearable:"",class:"ml5"},{default:a(()=>[(i(!0),U(P,null,j(l(le).DbSqlExecTypeEnum,o=>(i(),D(G,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(q,{class:"ml5",onClick:T,type:"success",icon:"search"})]),e(pe,{border:"",stripe:"",data:l(v).data,size:"small"},{default:a(()=>[e(b,{prop:"db",label:"\u6570\u636E\u5E93","min-width":"60","show-overflow-tooltip":""}),e(b,{prop:"table",label:"\u8868","min-width":"60","show-overflow-tooltip":""}),e(b,{prop:"type",label:"\u7C7B\u578B",width:"85","show-overflow-tooltip":""},{default:a(o=>[o.row.type==l(le).DbSqlExecTypeEnum.UPDATE.value?(i(),D(Ve,{key:0,color:"#E4F5EB",size:"small"},{default:a(()=>[c("UPDATE")]),_:1})):S("",!0),o.row.type==l(le).DbSqlExecTypeEnum.DELETE.value?(i(),D(Ve,{key:1,color:"#F9E2AE",size:"small"},{default:a(()=>[c("DELETE")]),_:1})):S("",!0),o.row.type==l(le).DbSqlExecTypeEnum.INSERT.value?(i(),D(Ve,{key:2,color:"#A8DEE0",size:"small"},{default:a(()=>[c("INSERT")]),_:1})):S("",!0)]),_:1}),e(b,{prop:"sql",label:"SQL","min-width":"230","show-overflow-tooltip":""}),e(b,{prop:"oldValue",label:"\u539F\u503C","min-width":"150","show-overflow-tooltip":""}),e(b,{prop:"creator",label:"\u6267\u884C\u4EBA","min-width":"60","show-overflow-tooltip":""}),e(b,{prop:"createTime",label:"\u6267\u884C\u65F6\u95F4","show-overflow-tooltip":""},{default:a(o=>[c(K(l(ze)(o.row.createTime)),1)]),_:1}),e(b,{prop:"remark",label:"\u5907\u6CE8","min-width":"60","show-overflow-tooltip":""}),e(b,{label:"\u64CD\u4F5C","min-width":"50",fixed:"right"},{default:a(o=>[o.row.type==l(le).DbSqlExecTypeEnum.UPDATE.value||o.row.type==l(le).DbSqlExecTypeEnum.DELETE.value?(i(),D(A,{key:0,type:"primary",plain:"",size:"small",underline:!1,onClick:I=>re(o.row)},{default:a(()=>[c(" \u8FD8\u539FSQL")]),_:2},1032,["onClick"])):S("",!0)]),_:1})]),_:1},8,["data"]),e(xe,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:a(()=>[e(Se,{style:{"text-align":"right"},onCurrentChange:F,total:l(v).total,layout:"prev, pager, next, total, jumper","current-page":l(v).query.pageNum,"onUpdate:current-page":u[19]||(u[19]=o=>l(v).query.pageNum=o),"page-size":l(v).query.pageSize},null,8,["total","current-page","page-size"])]),_:1})]),_:1},8,["title","modelValue"]),e(be,{width:"55%",title:"\u8FD8\u539FSQL",modelValue:l(W).visible,"onUpdate:modelValue":u[22]||(u[22]=o=>l(W).visible=o)},{default:a(()=>[e(me,{type:"textarea",autosize:{minRows:15,maxRows:30},modelValue:l(W).sql,"onUpdate:modelValue":u[21]||(u[21]=o=>l(W).sql=o),size:"small"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(be,{width:"40%",title:`${l(Z)} \u5B57\u6BB5\u4FE1\u606F`,modelValue:l(oe).visible,"onUpdate:modelValue":u[23]||(u[23]=o=>l(oe).visible=o)},{default:a(()=>[e(pe,{border:"",stripe:"",data:l(oe).columns,size:"small"},{default:a(()=>[e(b,{prop:"columnName",label:"\u540D\u79F0","show-overflow-tooltip":""}),e(b,{width:"120",prop:"columnType",label:"\u7C7B\u578B","show-overflow-tooltip":""}),e(b,{width:"80",prop:"nullable",label:"\u662F\u5426\u53EF\u4E3A\u7A7A","show-overflow-tooltip":""}),e(b,{prop:"columnComment",label:"\u5907\u6CE8","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),e(be,{width:"40%",title:`${l(Z)} \u7D22\u5F15\u4FE1\u606F`,modelValue:l(ue).visible,"onUpdate:modelValue":u[24]||(u[24]=o=>l(ue).visible=o)},{default:a(()=>[e(pe,{border:"",stripe:"",data:l(ue).indexs,size:"small"},{default:a(()=>[e(b,{prop:"indexName",label:"\u7D22\u5F15\u540D","min-width":"120","show-overflow-tooltip":""}),e(b,{prop:"columnName",label:"\u5217\u540D","min-width":"120","show-overflow-tooltip":""}),e(b,{prop:"seqInIndex",label:"\u5217\u5E8F\u5217\u53F7","show-overflow-tooltip":""}),e(b,{prop:"indexType",label:"\u7C7B\u578B"}),e(b,{prop:"indexComment",label:"\u5907\u6CE8","min-width":"130","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),e(be,{width:"55%",title:`${l(Z)} Create-DDL`,modelValue:l(ee).visible,"onUpdate:modelValue":u[26]||(u[26]=o=>l(ee).visible=o)},{default:a(()=>[e(me,{disabled:"",type:"textarea",autosize:{minRows:15,maxRows:30},modelValue:l(ee).ddl,"onUpdate:modelValue":u[25]||(u[25]=o=>l(ee).ddl=o),size:"small"},null,8,["modelValue"])]),_:1},8,["title","modelValue"]),e(El,{onValChange:m,title:l(X).title,visible:l(X).visible,"onUpdate:visible":u[27]||(u[27]=o=>l(X).visible=o),db:l(X).data,"onUpdate:db":u[28]||(u[28]=o=>l(X).data=o)},null,8,["title","visible","db"]),e(_l,{title:l(k).title,"active-name":l(k).activeName,dbId:l(ie),db:l(_),data:l(k).data,visible:l(k).visible,"onUpdate:visible":u[29]||(u[29]=o=>l(k).visible=o),onSubmitSql:_e},null,8,["title","active-name","dbId","db","data","visible"])])}}});export{Ll as default};
