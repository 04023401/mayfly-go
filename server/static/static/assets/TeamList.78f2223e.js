import{d as ge,r as P,c as fe,t as _e,e as be,h as r,V as De,i as p,j as L,k as o,w as u,I as w,m as _,v as d,l as a,q as m,G as he,F as V,U as G,a1 as Q,s as we,Q as ye,R as Fe,E as C,W as ve}from"./index.3ab9ca99.js";import{t as g}from"./api.359a68e0.js";import{b as Te}from"./api.6c08f270.js";import{n as Ve}from"./assert.d82c837d.js";import"./Api.7cd1a1f8.js";const Ce={class:"role-list"},ke={style:{float:"right"}},Ee=m("i",null,null,-1),Me={class:"dialog-footer"},xe={class:"custom-tree-node"},Be={style:{"font-size":"13px"}},Ie=m("span",{style:{color:"#3c8dbc"}},"\u3010",-1),qe=m("span",{style:{color:"#3c8dbc"}},"\u3011",-1),Ae={class:"dialog-footer"},ze={class:"toolbar"},$e={style:{float:"right"}},Ue=m("i",null,null,-1),Ne={class:"dialog-footer"},Qe=ge({__name:"TeamList",setup(Se){const x=P(null),B=P(null),s=fe({currentEditPermissions:!1,addTeamDialog:{title:"\u65B0\u589E\u56E2\u961F",visible:!1,form:{id:0,name:"",remark:""}},query:{pageNum:1,pageSize:10,name:null},total:0,data:[],chooseId:0,chooseData:null,showMemDialog:{visible:!1,chooseId:0,chooseData:null,query:{pageSize:10,pageNum:1,teamId:null,username:null},members:{list:[],total:null},title:"",addVisible:!1,memForm:{accountIds:[],teamId:0},accounts:Array()},showTagDialog:{title:"\u9879\u76EE\u4FE1\u606F",visible:!1,tags:[],teamId:0,tagTreeTeams:[],props:{value:"id",label:"codePath",children:"children"}}}),{query:y,addTeamDialog:b,total:W,data:H,chooseId:F,chooseData:$,showMemDialog:n,showTagDialog:f}=_e(s);be(()=>{D()});const D=async()=>{let t=await g.getTeams.request(s.query);s.data=t.list,s.total=t.total},J=t=>{s.query.pageNum=t,D()},K=t=>{!t||(s.chooseId=t.id,s.chooseData=t)},U=t=>{t&&(s.addTeamDialog.form.id=t.id,s.addTeamDialog.form.name=t.name,s.addTeamDialog.form.remark=t.remark,s.addTeamDialog.title=`\u4FEE\u6539 [${t.codePath}] \u4FE1\u606F`),s.addTeamDialog.visible=!0},O=async()=>{x.value.validate(async t=>{if(t){const l=s.addTeamDialog.form;await g.saveTeam.request(l),C.success("\u4FDD\u5B58\u6210\u529F"),D(),I()}})},I=()=>{s.addTeamDialog.visible=!1,s.addTeamDialog.form={},x.value.resetFields()},X=t=>{ve.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${t.name}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{await g.delTeam.request({id:t.id}),C.success("\u5220\u9664\u6210\u529F\uFF01"),D()})},Y=async t=>{s.showMemDialog.query.teamId=t.id,await v(),s.showMemDialog.title=`[${t.name}] \u6210\u5458\u4FE1\u606F`,s.showMemDialog.visible=!0},Z=t=>{Te.list.request({username:t}).then(l=>{s.showMemDialog.accounts=l.list})},ee=t=>{!t||(s.showMemDialog.chooseData=t,s.showMemDialog.chooseId=t.id)},le=async()=>{await g.delTeamMem.request(s.showMemDialog.chooseData),C.success("\u79FB\u9664\u6210\u529F"),v()},v=async()=>{const t=await g.getTeamMem.request(s.showMemDialog.query);s.showMemDialog.members.list=t.list,s.showMemDialog.members.total=t.total},ae=()=>{s.showMemDialog.addVisible=!0},oe=async()=>{const t=s.showMemDialog.memForm;t.teamId=s.chooseId,Ve(t.accountIds,"\u8BF7\u5148\u9009\u62E9\u8D26\u53F7"),await g.saveTeamMem.request(t),C.success("\u4FDD\u5B58\u6210\u529F"),v(),q()},q=()=>{s.showMemDialog.memForm={},s.showMemDialog.addVisible=!1,s.showMemDialog.chooseData=null,s.showMemDialog.chooseId=0},te=async t=>{s.showTagDialog.tags=await g.getTagTrees.request(null),s.showTagDialog.tagTreeTeams=await g.getTeamTagIds.request({teamId:t.id}),s.showTagDialog.title=`[${t.name}] \u56E2\u961F\u6807\u7B7E\u4FE1\u606F`,s.showTagDialog.teamId=t.id,s.showTagDialog.visible=!0},A=()=>{s.showTagDialog.visible=!1,setTimeout(()=>{s.showTagDialog.tagTreeTeams=[]},500)},se=async()=>{await g.saveTeamTags.request({teamId:s.showTagDialog.teamId,tagIds:s.showTagDialog.tagTreeTeams}),C.success("\u4FDD\u5B58\u6210\u529F"),A()},ue=(t,l)=>{const i=B.value.getNode(t.id);console.log(i),i.checked&&i.parent&&(console.log(i.parent),B.value.setChecked(i.parent,!1,!1)),console.log(t),console.log(l)};return(t,l)=>{const i=r("el-button"),k=r("el-input"),N=r("el-radio"),c=r("el-table-column"),S=r("el-link"),ne=r("el-divider"),j=r("el-table"),R=r("el-pagination"),ie=r("el-row"),de=r("el-card"),E=r("el-form-item"),z=r("el-form"),M=r("el-dialog"),re=r("el-tag"),me=r("el-tree-select"),ce=r("el-option"),pe=r("el-select"),h=De("auth");return p(),L("div",Ce,[o(de,null,{default:u(()=>[w((p(),_(i,{type:"primary",icon:"plus",onClick:l[0]||(l[0]=e=>U(!1))},{default:u(()=>[d("\u6DFB\u52A0")]),_:1})),[[h,"team:save"]]),w((p(),_(i,{disabled:!a(F),onClick:l[1]||(l[1]=e=>U(a($))),type:"primary",icon:"edit"},{default:u(()=>[d("\u7F16\u8F91")]),_:1},8,["disabled"])),[[h,"team:save"]]),w((p(),_(i,{disabled:!a(F),onClick:l[2]||(l[2]=e=>X(a($))),type:"danger",icon:"delete"},{default:u(()=>[d("\u5220\u9664")]),_:1},8,["disabled"])),[[h,"team:del"]]),m("div",ke,[o(k,{placeholder:"\u8BF7\u8F93\u5165\u56E2\u961F\u540D\u79F0",class:"mr2",style:{width:"200px"},modelValue:a(y).name,"onUpdate:modelValue":l[3]||(l[3]=e=>a(y).name=e),onClear:D,clearable:""},null,8,["modelValue"]),o(i,{onClick:D,type:"success",icon:"search"})]),o(j,{data:a(H),onCurrentChange:K,ref:"table",style:{width:"100%"}},{default:u(()=>[o(c,{label:"\u9009\u62E9",width:"55px"},{default:u(e=>[o(N,{modelValue:a(F),"onUpdate:modelValue":l[4]||(l[4]=T=>he(F)?F.value=T:null),label:e.row.id},{default:u(()=>[Ee]),_:2},1032,["modelValue","label"])]),_:1}),o(c,{prop:"name",label:"\u56E2\u961F\u540D\u79F0"}),o(c,{prop:"remark",label:"\u5907\u6CE8","min-width":"160px","show-overflow-tooltip":""}),o(c,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:u(e=>[d(V(a(G)(e.row.createTime)),1)]),_:1}),o(c,{prop:"creator",label:"\u521B\u5EFA\u8005"}),o(c,{label:"\u64CD\u4F5C","min-width":"80px"},{default:u(e=>[o(S,{onClick:Q(T=>Y(e.row),["prevent"]),underline:!1,type:"primary"},{default:u(()=>[d("\u6210\u5458")]),_:2},1032,["onClick"]),o(ne,{direction:"vertical","border-style":"dashed"}),o(S,{onClick:Q(T=>te(e.row),["prevent"]),underline:!1,type:"success"},{default:u(()=>[d("\u6807\u7B7E")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),o(ie,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:u(()=>[o(R,{style:{"text-align":"right"},onCurrentChange:J,total:a(W),layout:"prev, pager, next, total, jumper","current-page":a(y).pageNum,"onUpdate:current-page":l[5]||(l[5]=e=>a(y).pageNum=e),"page-size":a(y).pageSize},null,8,["total","current-page","page-size"])]),_:1})]),_:1}),o(M,{width:"400px",title:"\u56E2\u961F\u7F16\u8F91","before-close":I,modelValue:a(b).visible,"onUpdate:modelValue":l[9]||(l[9]=e=>a(b).visible=e)},{footer:u(()=>[m("div",Me,[o(i,{onClick:l[8]||(l[8]=e=>I())},{default:u(()=>[d("\u53D6 \u6D88")]),_:1}),o(i,{onClick:O,type:"primary"},{default:u(()=>[d("\u786E \u5B9A")]),_:1})])]),default:u(()=>[o(z,{ref_key:"teamForm",ref:x,model:a(b).form,"label-width":"70px"},{default:u(()=>[o(E,{prop:"name",label:"\u56E2\u961F\u540D:",required:""},{default:u(()=>[o(k,{modelValue:a(b).form.name,"onUpdate:modelValue":l[6]||(l[6]=e=>a(b).form.name=e),"auto-complete":"off"},null,8,["modelValue"])]),_:1}),o(E,{label:"\u5907\u6CE8:"},{default:u(()=>[o(k,{modelValue:a(b).form.remark,"onUpdate:modelValue":l[7]||(l[7]=e=>a(b).form.remark=e),"auto-complete":"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(M,{width:"500px",title:a(f).title,"before-close":A,modelValue:a(f).visible,"onUpdate:modelValue":l[13]||(l[13]=e=>a(f).visible=e)},{footer:u(()=>[m("div",Ae,[o(i,{onClick:l[11]||(l[11]=e=>A())},{default:u(()=>[d("\u53D6 \u6D88")]),_:1}),w((p(),_(i,{onClick:l[12]||(l[12]=e=>se()),type:"primary"},{default:u(()=>[d("\u786E \u5B9A")]),_:1})),[[h,"team:tag:save"]])])]),default:u(()=>[o(z,{"label-width":"70px"},{default:u(()=>[o(E,{prop:"project",label:"\u6807\u7B7E:"},{default:u(()=>[o(me,{ref_key:"tagTreeRef",ref:B,style:{width:"100%"},modelValue:a(f).tagTreeTeams,"onUpdate:modelValue":l[10]||(l[10]=e=>a(f).tagTreeTeams=e),data:a(f).tags,"default-expanded-keys":a(f).tagTreeTeams,multiple:"","render-after-expand":!0,"show-checkbox":"","check-strictly":"","node-key":"id",props:a(f).props,onCheck:ue},{default:u(({data:e})=>[m("span",xe,[m("span",Be,[d(V(e.code)+" ",1),Ie,d(" "+V(e.name)+" ",1),qe,e.children!==null?(p(),_(re,{key:0,size:"small"},{default:u(()=>[d(V(e.children.length),1)]),_:2},1024)):we("",!0)])])]),_:1},8,["modelValue","data","default-expanded-keys","props"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"]),o(M,{width:"700px",title:a(n).title,modelValue:a(n).visible,"onUpdate:modelValue":l[21]||(l[21]=e=>a(n).visible=e)},{default:u(()=>[m("div",ze,[w((p(),_(i,{onClick:l[14]||(l[14]=e=>ae()),type:"primary",icon:"plus",size:"small"},{default:u(()=>[d("\u6DFB\u52A0")]),_:1})),[[h,"team:member:save"]]),w((p(),_(i,{onClick:le,disabled:a(n).chooseId==null,type:"danger",icon:"delete",size:"small"},{default:u(()=>[d("\u79FB\u9664")]),_:1},8,["disabled"])),[[h,"team:member:del"]]),m("div",$e,[o(k,{placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",class:"mr2",style:{width:"150px"},modelValue:a(n).query.username,"onUpdate:modelValue":l[15]||(l[15]=e=>a(n).query.username=e),size:"small",onClear:D,clearable:""},null,8,["modelValue"]),o(i,{onClick:v,type:"success",icon:"search",size:"small"})])]),o(j,{onCurrentChange:ee,border:"",data:a(n).members.list,size:"small"},{default:u(()=>[o(c,{label:"\u9009\u62E9",width:"50px"},{default:u(e=>[o(N,{modelValue:a(n).chooseId,"onUpdate:modelValue":l[16]||(l[16]=T=>a(n).chooseId=T),label:e.row.id},{default:u(()=>[Ue]),_:2},1032,["modelValue","label"])]),_:1}),o(c,{property:"name",label:"\u59D3\u540D",width:"115"}),o(c,{property:"username",label:"\u8D26\u53F7",width:"135"}),o(c,{property:"createTime",label:"\u52A0\u5165\u65F6\u95F4"},{default:u(e=>[d(V(a(G)(e.row.createTime)),1)]),_:1}),o(c,{property:"creator",label:"\u5206\u914D\u8005",width:"135"})]),_:1},8,["data"]),o(R,{size:"small",onCurrentChange:v,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:a(n).members.total,"current-page":a(n).query.pageNum,"onUpdate:current-page":l[17]||(l[17]=e=>a(n).query.pageNum=e),"page-size":a(n).query.pageSize},null,8,["total","current-page","page-size"]),o(M,{width:"400px",title:"\u6DFB\u52A0\u6210\u5458","before-close":q,modelValue:a(n).addVisible,"onUpdate:modelValue":l[20]||(l[20]=e=>a(n).addVisible=e)},{footer:u(()=>[m("div",Ne,[o(i,{onClick:l[19]||(l[19]=e=>q())},{default:u(()=>[d("\u53D6 \u6D88")]),_:1}),o(i,{onClick:oe,type:"primary"},{default:u(()=>[d("\u786E \u5B9A")]),_:1})])]),default:u(()=>[o(z,{model:a(n).memForm,"label-width":"70px"},{default:u(()=>[o(E,{label:"\u8D26\u53F7:"},{default:u(()=>[o(pe,{style:{width:"100%"},remote:"","remote-method":Z,modelValue:a(n).memForm.accountIds,"onUpdate:modelValue":l[18]||(l[18]=e=>a(n).memForm.accountIds=e),filterable:"",multiple:"",placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u6A21\u7CCA\u641C\u7D22\u5E76\u9009\u62E9"},{default:u(()=>[(p(!0),L(ye,null,Fe(a(n).accounts,e=>(p(),_(ce,{key:e.id,label:`${e.username} [${e.name}]`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1},8,["title","modelValue"])])}}});export{Qe as default};
