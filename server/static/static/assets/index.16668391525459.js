var Oe=Object.defineProperty,We=Object.defineProperties;var ze=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var qe=(n,m,b)=>m in n?Oe(n,m,{enumerable:!0,configurable:!0,writable:!0,value:b}):n[m]=b,Ne=(n,m)=>{for(var b in m||(m={}))Pe.call(m,b)&&qe(n,b,m[b]);if(ve)for(var b of ve(m))je.call(m,b)&&qe(n,b,m[b]);return n},De=(n,m)=>We(n,ze(m));import{d as P,S as Qe,l as He}from"./SqlExecBox.1666839152545.js";import{a as Ke,_ as Ye}from"./codemirror.1666839152545.js";import{n as de,i as me,a as we}from"./assert.1666839152545.js";import{_ as Ge,d as Ze,r as Je,M as Xe,c as et,e as tt,t as at,k as q,R as lt,m as C,p as j,y as V,q as s,w as r,O as J,P as X,v as R,D as pe,A as Y,z as fe,G as Se,S as ke,a6 as nt,E as le,L as ot}from"./index.1666839152545.js";import{t as ut}from"./api.16668391525452.js";import"./Api.1666839152545.js";var st={exports:{}};(function(n,m){(function(b){b(Ke.exports,st.exports)})(function(b){var Q,t,ne,g,x={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},F=b.Pos,ee=b.cmpPos;function M(i){return Object.prototype.toString.call(i)=="[object Array]"}function H(i){var u=i.doc.modeOption;return u==="sql"&&(u="text/x-sql"),b.resolveMode(u).keywords}function N(i){var u=i.doc.modeOption;return u==="sql"&&(u="text/x-sql"),b.resolveMode(u).identifierQuote||"`"}function $(i){return typeof i=="string"?i:i.text}function O(i,u){return M(u)&&(u={columns:u}),u.text||(u.text=i),u}function oe(i){var u={};if(M(i))for(var a=i.length-1;a>=0;a--){var c=i[a];u[$(c).toUpperCase()]=O($(c),c)}else if(i)for(var h in i)u[h.toUpperCase()]=O(h,i[h]);return u}function U(i){return Q[i.toUpperCase()]}function W(i){var u={};for(var a in i)i.hasOwnProperty(a)&&(u[a]=i[a]);return u}function G(i,u){var a=i.length,c=$(u).substr(0,a);return i.toUpperCase()===c.toUpperCase()}function L(i,u,a,c){if(M(a))for(var h=0;h<a.length;h++)G(u,a[h])&&i.push(c(a[h]));else for(var T in a)if(a.hasOwnProperty(T)){var p=a[T];!p||p===!0?p=T:p=p.displayText?{text:p.text,displayText:p.displayText}:p.text,G(u,p)&&i.push(c(p))}}function ue(i){i.charAt(0)=="."&&(i=i.substr(1));for(var u=i.split(g+g),a=0;a<u.length;a++)u[a]=u[a].replace(new RegExp(g,"g"),"");return u.join(g)}function K(i){for(var u=$(i).split("."),a=0;a<u.length;a++)u[a]=g+u[a].replace(new RegExp(g,"g"),g+g)+g;var c=u.join(".");return typeof i=="string"?c:(i=W(i),i.text=c,i)}function se(i,u,a,c){for(var h=!1,T=[],p=u.start,S=!0;S;)S=u.string.charAt(0)==".",h=h||u.string.charAt(0)==g,p=u.start,T.unshift(ue(u.string)),u=c.getTokenAt(F(i.line,u.start)),u.string=="."&&(S=!0,u=c.getTokenAt(F(i.line,u.start)));var A=T.join(".");L(a,A,Q,function(D){return h?K(D):D}),L(a,A,t,function(D){return h?K(D):D}),A=T.pop();var y=T.join("."),_=!1,k=y;if(!U(y)){var B=y;y=te(y,c),y!==B&&(_=!0)}var z=U(y);return z&&z.columns&&(z=z.columns),z&&L(a,A,z,function(D){var re=y;return _==!0&&(re=k),typeof D=="string"?D=re+"."+D:(D=W(D),D.text=re+"."+D.text),h?K(D):D}),p}function ie(i,u){for(var a=i.split(/\s+/),c=0;c<a.length;c++)a[c]&&u(a[c].replace(/[`,;]/g,""))}function te(i,u){for(var a=u.doc,c=a.getValue(),h=i.toUpperCase(),T="",p="",S=[],A={start:F(0,0),end:F(u.lastLine(),u.getLineHandle(u.lastLine()).length)},y=c.indexOf(x.QUERY_DIV);y!=-1;)S.push(a.posFromIndex(y)),y=c.indexOf(x.QUERY_DIV,y+1);S.unshift(F(0,0)),S.push(F(u.lastLine(),u.getLineHandle(u.lastLine()).text.length));for(var _=null,k=u.getCursor(),B=0;B<S.length;B++){if((_==null||ee(k,_)>0)&&ee(k,S[B])<=0){A={start:_,end:S[B]};break}_=S[B]}if(A.start)for(var z=a.getRange(A.start,A.end,!1),B=0;B<z.length;B++){var D=z[B];if(ie(D,function(ce){var ae=ce.toUpperCase();ae===h&&U(T)&&(p=T),ae!==x.ALIAS_KEYWORD&&(T=ce)}),p)break}return p}b.registerHelper("hint","sql",function(i,u){Q=oe(u&&u.tables);var a=u&&u.defaultTable,c=u&&u.disableKeywords;t=a&&U(a),ne=H(i),g=N(i),a&&!t&&(t=te(a,i)),t=t||[],t.columns&&(t=t.columns);var h=i.getCursor(),T=[],p=i.getTokenAt(h),S,A,y;if(p.end>h.ch&&(p.end=h.ch,p.string=p.string.slice(0,h.ch-p.start)),p.string.match(/^[.`"'\w@][\w$#]*$/g)?(y=p.string,S=p.start,A=p.end):(S=A=h.ch,y=""),y.charAt(0)=="."||y.charAt(0)==g)S=se(h,p,T,i);else{var _=function(k,B){return typeof k=="object"?k.className=B:k={text:k,className:B},k};L(T,y,t,function(k){return _(k,"CodeMirror-hint-table CodeMirror-hint-default-table")}),L(T,y,Q,function(k){return _(k,"CodeMirror-hint-table")}),c||L(T,y,ne,function(k){return _(k.toUpperCase(),"CodeMirror-hint-keyword")})}return{list:T,from:F(h.line,S),to:F(h.line,A)}})})})();const it=Ze({name:"SqlExec",components:{},setup(){const n=Je(null),m=Xe("token");let b=null;const Q=new Map,t=et({token:m,defalutLimit:20,tags:[],dbs:[],databaseList:[],db:"",dbType:"",tables:[],dbId:null,tableName:"",tableMetadata:[],sqlName:"",sqlNames:[],activeName:"Query",queryTabName:"Query",nowTableName:"",dataTabs:{},dataTabsTableHeight:600,queryTab:{label:"\u67E5\u8BE2",name:"Query",execRes:{data:[],tableColumn:[]},loading:!1,nowTableName:"",selectionDatas:[]},params:{pageNum:1,pageSize:100,tagPath:null},conditionDialog:{title:"",placeholder:"",columnRow:null,dataTab:null,visible:!1,condition:"=",value:null},genSqlDialog:{visible:!1,sql:""},cmOptions:{tabSize:4,mode:"text/x-sql",lineNumbers:!0,line:!0,indentWithTabs:!0,smartIndent:!0,matchBrackets:!0,theme:"base16-light",autofocus:!0,extraKeys:{Tab:"autocomplete"},hintOptions:{completeSingle:!1,tables:{}}}}),ne=()=>{b=Ye.fromTextArea(n.value,t.cmOptions),b.on("inputRead",(e,l)=>{/^[a-zA-Z]/.test(l.text[0])&&e.showHint()}),b.on("beforeChange",(e,l)=>{var o=l.text[0];l.text[0]=o.split("  ")[0]})};tt(()=>{ne(),g(),window.onresize=()=>(()=>{g()})()});const g=()=>{b.setSize("auto",`${window.innerHeight-538}px`),t.dataTabsTableHeight=window.innerHeight-274},x=()=>{t.dbs=[],t.dbId=null,t.db="",t.databaseList=[],be(),Me()},F=async()=>{t.tags=await ut.getAccountTags.request(null)},ee=(e,l)=>{var o=l.text[0];l.text[0]=o.split("  ")[0]},M=async()=>{de(t.dbId,"\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93");let e=K();me(e&&e.trim(),"\u8BF7\u9009\u4E2D\u9700\u8981\u6267\u884C\u7684sql"),e=e.replace(/(^\s*)/g,"");let l="",o=!0;if((e.startsWith("update")||e.startsWith("UPDATE")||e.startsWith("INSERT")||e.startsWith("insert")||e.startsWith("DELETE")||e.startsWith("delete"))&&(l=(await ke.prompt("\u8BF7\u8F93\u5165\u5907\u6CE8","Tip",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputPattern:/^[\s\S]*.*[^\s][\s\S]*$/,inputErrorMessage:"\u8BF7\u8F93\u5165\u6267\u884C\u8BE5sql\u7684\u5907\u6CE8\u4FE1\u606F"})).value,l||(o=!1)),!!o){try{t.queryTab.loading=!0;const d=await N(e,l);t.queryTab.execRes.data=d.res,t.queryTab.execRes.tableColumn=d.colNames,t.queryTab.loading=!1}catch{t.queryTab.loading=!1}if(e.startsWith("SELECT *")||e.startsWith("select *")||e.startsWith(`SELECT
  *`)){t.queryTab.selectionDatas=[];const d=e.split(/from/i)[1];if(d){const f=d.trim().split(" ")[0];t.queryTab.nowTableName=f,t.nowTableName=f}else t.queryTab.nowTableName="",t.nowTableName=""}else t.queryTab.nowTableName="",t.nowTableName=""}},H=()=>{const e=t.queryTab.execRes.data;me(e.length>0,"\u6CA1\u6709\u6570\u636E\u53EF\u5BFC\u51FA");const l=t.queryTab.execRes.tableColumn,o=[l];for(let v of e){let I=[];for(let Z of l)I.push(v[Z]);o.push(I)}const d=o.map(v=>v.join(",")).join(`
`);let f=document.createElement("a"),w="\uFEFF",E=new Blob([w+d],{type:"text/plain;charset=utrf-8"});f.id="download-csv",f.setAttribute("href",URL.createObjectURL(E)),f.setAttribute("download",`\u67E5\u8BE2\u6570\u636E\u5BFC\u51FA-${nt("yyyyMMddHHmmss",new Date)}.csv`),document.body.appendChild(f),f.click()},N=async(e,l="")=>await P.sqlExec.request({id:t.dbId,db:t.db,sql:e.trim(),remark:l}),$=e=>{const l=Object.keys(t.dataTabs);let o=t.activeName;l.forEach((d,f)=>{if(d===e){const w=l[f+1]||l[f-1]||t.queryTab.name;w&&(o=w)}}),t.activeName=o,delete t.dataTabs[e]},O=e=>{const l=e.props.name;l!=t.queryTab.name?(t.tableName=l,t.nowTableName=l):t.nowTableName=t.queryTab.nowTableName},oe=e=>{if(!t.dbId)return le.error("\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93"),!1;le.success(`'${e.name}' \u6B63\u5728\u4E0A\u4F20\u6267\u884C, \u8BF7\u5173\u6CE8\u7ED3\u679C\u901A\u77E5`)},U=e=>{e.code!==200&&le.error(e.msg)},W=()=>`${ot.baseApiUrl}/dbs/${t.dbId}/exec-sql-file?db=${t.db}`,G=(e,l,o="equal")=>{e=e+"";let d="";if(!l||!l.length||l.length===0||l===void 0||!e||!e.length||e.length===0||e===void 0)return;if(o==="equal"){for(let v=0;v<l.length;v++)if((l[v][e]+"").length>0){d=l[v][e]+"";break}}else{let v=0;for(let I=0;I<l.length;I++){if(l[I][e]===null)return;const Z=l[I][e]+"",Ee=l[v][e]+"";Z.length>Ee.length&&(v=I)}d=l[v][e]+""}const f=L(d),w=L(e)+43;return(f>w?f:w)+"px"},L=e=>{let l=0;for(const o of e){if(l>500)break;if(o>="0"&&o<="9"||o>="a"&&o<="z"){l+=8.5;continue}if(o>="A"&&o<="Z"){l+=9;continue}o>="\u4E00"&&o<="\u9FA5"?l+=16:l+=8}return l>500&&(l=500),l},ue=(e,l)=>{let o=u(e);if(!o)return"";const d=o.find(w=>w.columnName==l),f=d.columnComment;return`${d.columnType} ${f?" |  "+f:""}`},K=()=>{let e=b.getSelection();return e||(e=Be()),e},se=e=>{t.db="";const l=t.dbs.find(o=>o.id==e);t.dbType=l.type,t.databaseList=l.database.split(" "),be()},ie=e=>{!e||(be(),P.tableMetadata.request({id:t.dbId,db:e}).then(l=>{t.tableMetadata=l}),P.hintTables.request({id:t.dbId,db:e}).then(l=>{t.cmOptions.hintOptions.tables=l}),Te())},te=async(e,l=!0)=>{if(e==""||!l)return;t.nowTableName=e,t.activeName=e;let o=t.dataTabs[e];o||(o={label:e,name:e,datas:[],columnNames:[],pageNum:1,count:0},o.columnNames=await a(e),t.dataTabs[e]=o,p(e))},i=async e=>{let l=u(e);return l||(l=await P.columnMetadata.request({id:t.dbId,db:t.db,tableName:e}),Q.set(e,l),l)},u=e=>Q.get(e),a=async e=>(await i(e)).map(o=>o.columnName),c=(e,l)=>{const o=e[0];t.conditionDialog.title=`\u8BF7\u8F93\u5165 [${o.columnName}] \u7684\u503C`,t.conditionDialog.placeholder=`${o.columnType}  ${o.columnComment}`,t.conditionDialog.columnRow=o,t.conditionDialog.dataTab=l,t.conditionDialog.visible=!0},h=()=>{const e=t.conditionDialog,l=t.conditionDialog.dataTab;let o=l.condition;o&&(o+=" AND ");const d=e.columnRow;o+=`${d.columnName} ${e.condition} `,l.condition=o+ge(d,e.value),T()},T=()=>{t.conditionDialog.visible=!1,t.conditionDialog.title="",t.conditionDialog.placeholder="",t.conditionDialog.value=null,t.conditionDialog.columnRow=null,t.conditionDialog.dataTab=null},p=async e=>{const l=t.dataTabs[e];l.condition="",l.pageNum=1,y(l)},S=async e=>{y(e)},A=async(e,l)=>{we(l,"\u6761\u4EF6\u4E0D\u80FD\u4E3A\u7A7A");const o=t.dataTabs[e];o.pageNum=1,y(o)},y=async e=>{e.loading=!0;try{if(e.count=await _(e.name,e.condition),e.count>0){const l=await N(k(e.name,e.condition,e.orderBy,e.pageNum));e.datas=l.res}else e.datas=[]}finally{e.loading=!1}},_=async(e,l="")=>(await N(B(e,l))).res[0].count,k=(e,l="",o="",d=1)=>{const f=`SELECT * FROM ${e} ${l?"WHERE "+l:""} ${o||""}`;return t.dbType=="mysql"?`${f} LIMIT ${(d-1)*t.defalutLimit}, ${t.defalutLimit};`:t.dbType=="postgres"?`${f} OFFSET ${(d-1)*t.defalutLimit} LIMIT ${t.defalutLimit};`:f},B=(e,l="")=>`SELECT COUNT(*) count FROM ${e} ${l?"WHERE "+l:""}`,z=()=>{de(t.dbId,"\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93"),N("COMMIT;"),le.success("COMMIT success")},D=async e=>{if(!t.nowTableName||!e.prop)return;const l=t.activeName,o=e.order=="descending"?"DESC":"ASC",d=`ORDER BY ${e.prop} ${o}`;t.dataTabs[t.activeName].orderBy=d,p(l)},re=()=>{ce()},ce=()=>{de(t.dbId,"\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93"),P.getSql.request({id:t.dbId,type:1,name:t.sqlName,db:t.db}).then(e=>{ae(e?e.sql:"")})},ae=e=>{b.setValue(e)},Be=()=>{b.getValue()},Te=()=>{P.getSqlNames.request({id:t.dbId,db:t.db}).then(e=>{e&&e.length>0?(t.sqlNames=e.map(l=>l.name),t.sqlName=t.sqlNames[0]):(t.sqlNames=["default"],t.sqlName="default"),ce()})},Fe=async()=>{const e=b.getValue();we(e,"sql\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"),de(t.dbId,"\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93\u5B9E\u4F8B"),await P.saveSql.request({id:t.dbId,db:t.db,sql:e,type:1,name:t.sqlName}),le.success("\u4FDD\u5B58\u6210\u529F"),P.getSqlNames.request({id:t.dbId,db:t.db}).then(l=>{l&&(t.sqlNames=l.map(o=>o.name))})},$e=async()=>{de(t.dbId,"\u8BF7\u5148\u9009\u62E9\u6570\u636E\u5E93");try{await ke.confirm(`\u786E\u5B9A\u5220\u9664\u3010${t.sqlName}\u3011\u8BE5SQL\u6A21\u677F?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await P.deleteDbSql.request({id:t.dbId,name:t.sqlName,db:t.db}),le.success("\u5220\u9664\u6210\u529F"),Te()}catch{}},be=()=>{t.tableName="",t.nowTableName="",t.tableMetadata=[],t.dataTabs={},ae(""),t.sqlNames=[],t.sqlName="",t.activeName=t.queryTab.name,t.queryTab.execRes.data=[],t.queryTab.execRes.tableColumn=[],t.cmOptions.hintOptions.tables=[],Q.clear()},Ae=e=>{he()?t.queryTab.selectionDatas=e:t.dataTabs[t.activeName].selectionDatas=e},Re=async()=>{const e=he(),l=e?t.queryTab.selectionDatas:t.dataTabs[t.activeName].selectionDatas;me(l&&l.length>0,"\u8BF7\u5148\u9009\u62E9\u8981\u5220\u9664\u7684\u6570\u636E");const o=await ye(t.nowTableName),d=o.columnName,f=l.map(E=>`${ge(o,E[d])}`).join(","),w=`DELETE FROM ${t.nowTableName} WHERE ${d} IN (${f})`;Ce(w,null,()=>{e?(t.queryTab.execRes.data=t.queryTab.execRes.data.filter(E=>l.findIndex(v=>v[d]==E[d])==-1),t.queryTab.selectionDatas=[]):p(t.activeName)})},_e=async()=>{const l=he()?t.queryTab.selectionDatas:t.dataTabs[t.activeName].selectionDatas;me(l&&l.length>0,"\u8BF7\u5148\u9009\u62E9\u8981\u751F\u6210insert\u8BED\u53E5\u7684\u6570\u636E");const o=t.nowTableName,d=await i(o),f=[];for(let w of l){let E=[],v=[];for(let I of d){const Z=I.columnName;E.push(Z),v.push(Ie(w[Z]))}f.push(`INSERT INTO ${o} (${E.join(", ")}) VALUES(${v.join(", ")})`)}t.genSqlDialog.sql=f.join(`;
`)+";",t.genSqlDialog.visible=!0},Ie=e=>e==null?"NULL":typeof e=="number"?e:`'${e}'`,he=()=>t.activeName==t.queryTab.name,Ve=(e,l,o)=>{const d=l.property;if(!t.nowTableName||!d)return;let f=(e[d]?e[d]:"")+"",w=o.children[0];if(w){let E=document.createElement("input");E.setAttribute("value",f),E.setAttribute("style","height:30px;"+w.getAttribute("style")),o.replaceChildren(E),E.focus(),E.addEventListener("blur",async()=>{if(e[d]=E.value,o.replaceChildren(w),E.value!==f){const v=await ye(t.nowTableName),I=v.columnName,Z=await ye(t.nowTableName,l.rawColumnKey),Ee=`UPDATE ${t.nowTableName} SET ${l.rawColumnKey} = ${ge(Z,E.value)} 
                                        WHERE ${I} = ${ge(v,e[I])}`;Ce(Ee,()=>{e[d]=f})}})}},ye=async(e,l="")=>{const o=await i(e);return l?o.find(d=>d.columnName==l):o[0]},ge=(e,l)=>xe(e.columnType)?l:`'${l}'`,xe=e=>e.match(/int|double|float|nubmer|decimal/gi),Ce=(e,l=null,o=null)=>{Qe({sql:e,dbId:t.dbId,db:t.db,runSuccessCallback:o,cancelCallback:l})},Ue=async()=>{const e=t.nowTableName,l=await i(e);let o={};l.forEach(E=>{o[`${E.columnName}`]=`'${E.columnName}[${E.columnType}]${E.nullable=="YES"?"":"[not null]"}'`});let d=Object.keys(o).join(","),f=Object.values(o).join(","),w=`INSERT INTO ${t.nowTableName} (${d}) VALUES (${f});`;Ce(w,null,()=>{p(e)})},Le=()=>{let e=b.getSelection();me(e,"\u8BF7\u9009\u4E2D\u9700\u8981\u683C\u5F0F\u5316\u7684sql"),b.replaceSelection(He.format(e))},Me=async()=>{const e=await P.dbs.request(t.params);t.dbs=e.list};return De(Ne({},at(t)),{getTags:F,codeTextarea:n,changeTag:x,changeTable:te,cellClick:Ve,onRunSql:M,exportData:H,removeDataTab:$,onDataTabClick:O,beforeUpload:oe,getUploadSqlFileUrl:W,execSqlFileSuccess:U,flexColumnWidth:G,getColumnTip:ue,getColumns4Map:u,onConditionRowClick:c,onConfirmCondition:h,onCancelCondition:T,changeSqlTemplate:re,deleteSql:$e,saveSql:Fe,changeDbInstance:se,changeDb:ie,clearDb:be,formatSql:Le,onBeforeChange:ee,onRefresh:p,handlePageChange:S,selectByCondition:A,onCommit:z,addRow:Ue,onDataSelectionChange:Ae,onDeleteData:Re,onTableSortChange:D,onGenerateInsertSql:_e})}}),rt={class:"toolbar"},ct={style:{float:"left"}},dt={style:{float:"rignt",color:"#8492a6","margin-left":"10px","font-size":"13px"}},mt={class:"toolbar"},pt={class:"fl"},ft={style:{float:"right"},class:"fl"},bt={class:"mt5 sqlEditor"},gt={ref:"codeTextarea"},ht={class:"mt5"},yt={key:1},Ct=V("span",{style:{"font-size":"12px"}},"\u5BFC\u51FA",-1),Et={class:"dialog-footer"};function Tt(n,m,b,Q,t,ne){const g=q("el-option"),x=q("el-select"),F=q("el-form-item"),ee=q("el-form"),M=q("el-col"),H=q("el-row"),N=q("el-link"),$=q("el-divider"),O=q("el-tooltip"),oe=q("el-upload"),U=q("el-button"),W=q("el-table-column"),G=q("el-table"),L=q("el-tab-pane"),ue=q("el-popover"),K=q("el-input"),se=q("el-pagination"),ie=q("el-tabs"),te=q("el-container"),i=q("el-dialog"),u=lt("loading");return C(),j("div",null,[V("div",rt,[s(H,{type:"flex",justify:"space-between"},{default:r(()=>[s(M,{span:24},{default:r(()=>[s(ee,{class:"search-form","label-position":"right",inline:!0},{default:r(()=>[s(F,{label:"\u6807\u7B7E"},{default:r(()=>[s(x,{onChange:n.changeTag,onFocus:n.getTags,modelValue:n.params.tagPath,"onUpdate:modelValue":m[0]||(m[0]=a=>n.params.tagPath=a),placeholder:"\u8BF7\u9009\u62E9\u6807\u7B7E",filterable:"",style:{width:"220px"}},{default:r(()=>[(C(!0),j(J,null,X(n.tags,a=>(C(),R(g,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["onChange","onFocus","modelValue"])]),_:1}),s(F,{label:"\u8D44\u6E90"},{default:r(()=>[s(x,{modelValue:n.dbId,"onUpdate:modelValue":m[1]||(m[1]=a=>n.dbId=a),placeholder:"\u8BF7\u9009\u62E9\u8D44\u6E90\u5B9E\u4F8B",onChange:n.changeDbInstance,filterable:"",style:{width:"220px"}},{default:r(()=>[(C(!0),j(J,null,X(n.dbs,a=>(C(),R(g,{key:a.id,label:`${a.name} [${a.tagPath}]`,value:a.id},{default:r(()=>[V("span",ct,pe(`${a.name} [${a.tagPath}]`),1),V("span",dt,pe(`${a.host}:${a.port} ${a.type}`),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),s(F,{label:"\u6570\u636E\u5E93"},{default:r(()=>[s(x,{modelValue:n.db,"onUpdate:modelValue":m[2]||(m[2]=a=>n.db=a),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93",onChange:n.changeDb,onClear:n.clearDb,clearable:"",filterable:"",style:{width:"150px"}},{default:r(()=>[(C(!0),j(J,null,X(n.databaseList,a=>(C(),R(g,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange","onClear"])]),_:1}),s(F,{"label-width":"20",label:"\u8868"},{default:r(()=>[s(x,{modelValue:n.tableName,"onUpdate:modelValue":m[3]||(m[3]=a=>n.tableName=a),placeholder:"\u9009\u62E9\u8868\u67E5\u770B\u8868\u6570\u636E",onChange:n.changeTable,filterable:"",style:{width:"250px"}},{default:r(()=>[(C(!0),j(J,null,X(n.tableMetadata,a=>(C(),R(g,{key:a.tableName,label:a.tableName+(a.tableComment!=""?`\u3010${a.tableComment}\u3011`:""),value:a.tableName},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1})]),_:1})]),_:1})]),s(te,{id:"data-exec",style:{border:"1px solid #eee","margin-top":"1px"}},{default:r(()=>[s(ie,{onTabRemove:n.removeDataTab,onTabClick:n.onDataTabClick,style:{width:"100%"},modelValue:n.activeName,"onUpdate:modelValue":m[5]||(m[5]=a=>n.activeName=a)},{default:r(()=>[s(L,{label:n.queryTab.label,name:n.queryTab.name},{default:r(()=>[V("div",null,[V("div",null,[V("div",mt,[V("div",pt,[s(N,{onClick:n.onRunSql,underline:!1,class:"ml15",icon:"VideoPlay"},null,8,["onClick"]),s($,{direction:"vertical","border-style":"dashed"}),s(O,{class:"box-item",effect:"dark",content:"format sql",placement:"top"},{default:r(()=>[s(N,{onClick:n.formatSql,type:"primary",underline:!1,icon:"MagicStick"},null,8,["onClick"])]),_:1}),s($,{direction:"vertical","border-style":"dashed"}),s(O,{class:"box-item",effect:"dark",content:"commit",placement:"top"},{default:r(()=>[s(N,{onClick:n.onCommit,type:"success",underline:!1,icon:"CircleCheck"},null,8,["onClick"])]),_:1}),s($,{direction:"vertical","border-style":"dashed"}),s(oe,{style:{display:"inline-block"},"before-upload":n.beforeUpload,"on-success":n.execSqlFileSuccess,headers:{Authorization:n.token},data:{dbId:1},action:n.getUploadSqlFileUrl(),"show-file-list":!1,name:"file",multiple:"",limit:100},{default:r(()=>[s(O,{class:"box-item",effect:"dark",content:"SQL\u811A\u672C\u6267\u884C",placement:"top"},{default:r(()=>[s(N,{type:"success",underline:!1,icon:"Document"})]),_:1})]),_:1},8,["before-upload","on-success","headers","action"])]),V("div",ft,[s(x,{modelValue:n.sqlName,"onUpdate:modelValue":m[4]||(m[4]=a=>n.sqlName=a),placeholder:"\u9009\u62E9or\u8F93\u5165SQL\u6A21\u677F\u540D",onChange:n.changeSqlTemplate,filterable:"","allow-create":"","default-first-option":"",size:"small",class:"mr10"},{default:r(()=>[(C(!0),j(J,null,X(n.sqlNames,a=>(C(),R(g,{key:a,label:a.database,value:a},{default:r(()=>[Y(pe(a),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),s(U,{onClick:n.saveSql,type:"primary",icon:"document-add",plain:"",size:"small"},{default:r(()=>[Y("\u4FDD\u5B58")]),_:1},8,["onClick"]),s(U,{onClick:n.deleteSql,type:"danger",icon:"delete",plain:"",size:"small"},{default:r(()=>[Y("\u5220\u9664")]),_:1},8,["onClick"])])])]),V("div",bt,[V("textarea",gt,null,512)]),V("div",ht,[s(H,null,{default:r(()=>[n.queryTab.nowTableName?(C(),R(N,{key:0,onClick:n.onDeleteData,class:"ml5",type:"danger",icon:"delete",underline:!1},null,8,["onClick"])):fe("",!0),n.queryTab.execRes.data.length>0?(C(),j("span",yt,[s($,{direction:"vertical","border-style":"dashed"}),s(N,{type:"success",underline:!1,onClick:n.exportData},{default:r(()=>[Ct]),_:1},8,["onClick"])])):fe("",!0)]),_:1}),Se((C(),R(G,{onCellDblclick:n.cellClick,onSelectionChange:n.onDataSelectionChange,data:n.queryTab.execRes.data,"element-loading-text":"\u67E5\u8BE2\u4E2D...",size:"small","max-height":"250","empty-text":"tips: select *\u5F00\u5934\u7684\u5355\u8868\u67E5\u8BE2\u6216\u70B9\u51FB\u8868\u540D\u9ED8\u8BA4\u67E5\u8BE2\u7684\u6570\u636E,\u53EF\u53CC\u51FB\u6570\u636E\u5728\u7EBF\u4FEE\u6539",stripe:"",border:"",class:"mt5"},{default:r(()=>[n.queryTab.execRes.tableColumn.length>0&&n.queryTab.nowTableName?(C(),R(W,{key:0,type:"selection",width:"35"})):fe("",!0),(C(!0),j(J,null,X(n.queryTab.execRes.tableColumn,a=>(C(),R(W,{"min-width":"100",width:n.flexColumnWidth(a,n.queryTab.execRes.data),align:"center",key:a,prop:a,label:a,"show-overflow-tooltip":""},null,8,["width","prop","label"]))),128))]),_:1},8,["onCellDblclick","onSelectionChange","data"])),[[u,n.queryTab.loading]])])])]),_:1},8,["label","name"]),(C(!0),j(J,null,X(n.dataTabs,a=>(C(),R(L,{closable:"",key:a.name,label:a.label,name:a.name},{default:r(()=>[n.dbId?(C(),R(H,{key:0},{default:r(()=>[s(M,{span:8},{default:r(()=>[s(N,{onClick:c=>n.onRefresh(a.name),icon:"refresh",underline:!1,class:"ml5"},null,8,["onClick"]),s($,{direction:"vertical","border-style":"dashed"}),s(N,{onClick:n.addRow,type:"primary",icon:"plus",underline:!1},null,8,["onClick"]),s($,{direction:"vertical","border-style":"dashed"}),s(N,{onClick:n.onDeleteData,type:"danger",icon:"delete",underline:!1},null,8,["onClick"]),s($,{direction:"vertical","border-style":"dashed"}),s(O,{class:"box-item",effect:"dark",content:"commit",placement:"top"},{default:r(()=>[s(N,{onClick:n.onCommit,type:"success",icon:"CircleCheck",underline:!1},null,8,["onClick"])]),_:1}),s($,{direction:"vertical","border-style":"dashed"}),s(O,{class:"box-item",effect:"dark",content:"\u751F\u6210insert sql",placement:"top"},{default:r(()=>[s(N,{onClick:n.onGenerateInsertSql,type:"success",underline:!1},{default:r(()=>[Y("gi")]),_:1},8,["onClick"])]),_:1})]),_:2},1024),s(M,{span:16},{default:r(()=>[s(K,{modelValue:a.condition,"onUpdate:modelValue":c=>a.condition=c,placeholder:"\u82E5\u9700\u6761\u4EF6\u8FC7\u6EE4\uFF0C\u53EF\u9009\u62E9\u5217\u5E76\u70B9\u51FB\u5BF9\u5E94\u7684\u5B57\u6BB5\u5E76\u8F93\u5165\u9700\u8981\u8FC7\u6EE4\u7684\u5185\u5BB9\u70B9\u51FB\u67E5\u8BE2\u6309\u94AE\u5373\u53EF",clearable:"",size:"small",style:{width:"100%"}},{prepend:r(()=>[s(ue,{trigger:"click",width:320,placement:"right"},{reference:r(()=>[s(N,{type:"success",underline:!1},{default:r(()=>[Y("\u9009\u62E9\u5217")]),_:1})]),default:r(()=>[s(G,{data:n.getColumns4Map(a.name),"max-height":"500",size:"small",onRowClick:(...c)=>{n.onConditionRowClick(c,a)},style:{cursor:"pointer"}},{default:r(()=>[s(W,{property:"columnName",label:"\u5217\u540D","show-overflow-tooltip":""}),s(W,{property:"columnComment",label:"\u5907\u6CE8","show-overflow-tooltip":""})]),_:2},1032,["data","onRowClick"])]),_:2},1024)]),append:r(()=>[s(U,{onClick:c=>n.selectByCondition(a.name,a.condition),icon:"search",size:"small"},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):fe("",!0),Se((C(),R(G,{onCellDblclick:n.cellClick,onSortChange:n.onTableSortChange,onSelectionChange:n.onDataSelectionChange,data:a.datas,size:"small","max-height":n.dataTabsTableHeight,"element-loading-text":"\u67E5\u8BE2\u4E2D...","empty-text":"\u6682\u65E0\u6570\u636E",stripe:"",border:"",class:"mt5"},{default:r(()=>[a.datas.length>0?(C(),R(W,{key:0,type:"selection",width:"35"})):fe("",!0),(C(!0),j(J,null,X(a.columnNames,c=>(C(),R(W,{"min-width":"100",width:n.flexColumnWidth(c,a.datas),align:"center",key:c,prop:c,label:c,"show-overflow-tooltip":"",sortable:n.nowTableName!=""?"custom":!1},{header:r(()=>[s(O,{"raw-content":"",placement:"top",effect:"customized"},{content:r(()=>[Y(pe(n.getColumnTip(a.name,c)),1)]),default:r(()=>[Y(" "+pe(c),1)]),_:2},1024)]),_:2},1032,["width","prop","label","sortable"]))),128))]),_:2},1032,["onCellDblclick","onSortChange","onSelectionChange","data","max-height"])),[[u,a.loading]]),s(H,{type:"flex",class:"mt5",justify:"center"},{default:r(()=>[s(se,{small:"",total:a.count,onCurrentChange:c=>n.handlePageChange(a),layout:"prev, pager, next, total, jumper","current-page":a.pageNum,"onUpdate:current-page":c=>a.pageNum=c,"page-size":n.defalutLimit},null,8,["total","onCurrentChange","current-page","onUpdate:current-page","page-size"])]),_:2},1024)]),_:2},1032,["label","name"]))),128))]),_:1},8,["onTabRemove","onTabClick","modelValue"])]),_:1}),s(i,{modelValue:n.conditionDialog.visible,"onUpdate:modelValue":m[8]||(m[8]=a=>n.conditionDialog.visible=a),title:n.conditionDialog.title,width:"420px"},{footer:r(()=>[V("span",Et,[s(U,{onClick:n.onCancelCondition},{default:r(()=>[Y("\u53D6\u6D88")]),_:1},8,["onClick"]),s(U,{type:"primary",onClick:n.onConfirmCondition},{default:r(()=>[Y("\u786E\u5B9A")]),_:1},8,["onClick"])])]),default:r(()=>[s(H,null,{default:r(()=>[s(M,{span:5},{default:r(()=>[s(x,{modelValue:n.conditionDialog.condition,"onUpdate:modelValue":m[6]||(m[6]=a=>n.conditionDialog.condition=a)},{default:r(()=>[s(g,{label:"=",value:"="}),s(g,{label:"LIKE",value:"LIKE"}),s(g,{label:">",value:">"}),s(g,{label:">=",value:">="}),s(g,{label:"<",value:"<"}),s(g,{label:"<=",value:"<="})]),_:1},8,["modelValue"])]),_:1}),s(M,{span:19},{default:r(()=>[s(K,{modelValue:n.conditionDialog.value,"onUpdate:modelValue":m[7]||(m[7]=a=>n.conditionDialog.value=a),placeholder:n.conditionDialog.placeholder},null,8,["modelValue","placeholder"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"]),s(i,{onClose:m[10]||(m[10]=a=>n.genSqlDialog.visible=!1),modelValue:n.genSqlDialog.visible,"onUpdate:modelValue":m[11]||(m[11]=a=>n.genSqlDialog.visible=a),title:"SQL",width:"1000px"},{default:r(()=>[s(K,{modelValue:n.genSqlDialog.sql,"onUpdate:modelValue":m[9]||(m[9]=a=>n.genSqlDialog.sql=a),type:"textarea",rows:"20"},null,8,["modelValue"])]),_:1},8,["modelValue"])])}var Bt=Ge(it,[["render",Tt]]);export{Bt as default};
